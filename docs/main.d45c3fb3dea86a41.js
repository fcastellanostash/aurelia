(self.webpackChunkeliApp=self.webpackChunkeliApp||[]).push([[179],{888:(Cm,Uu,Gu)=>{"use strict";function wn(n){return"function"==typeof n}function Kd(n){const e=n(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const Em=Kd(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,s)=>`${s+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function p(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class Wn{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const c of e)c.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(wn(i))try{i()}catch(c){t=c instanceof Em?c.errors:[c]}const{_teardowns:s}=this;if(s){this._teardowns=null;for(const c of s)try{Be(c)}catch(f){t=null!=t?t:[],f instanceof Em?t=[...t,...f.errors]:t.push(f)}}if(t)throw new Em(t)}}add(t){var e;if(t&&t!==this)if(this.closed)Be(t);else{if(t instanceof Wn){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(e=this._teardowns)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&p(e,t)}remove(t){const{_teardowns:e}=this;e&&p(e,t),t instanceof Wn&&t._removeParent(this)}}Wn.EMPTY=(()=>{const n=new Wn;return n.closed=!0,n})();const Do=Wn.EMPTY;function kr(n){return n instanceof Wn||n&&"closed"in n&&wn(n.remove)&&wn(n.add)&&wn(n.unsubscribe)}function Be(n){wn(n)?n():n.unsubscribe()}const Bt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},gt={setTimeout(...n){const{delegate:t}=gt;return((null==t?void 0:t.setTimeout)||setTimeout)(...n)},clearTimeout(n){const{delegate:t}=gt;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function Bs(n){gt.setTimeout(()=>{const{onUnhandledError:t}=Bt;if(!t)throw n;t(n)})}function Jr(){}const cn=Mo("C",void 0,void 0);function Mo(n,t,e){return{kind:n,value:t,error:e}}let es=null;function ts(n){if(Bt.useDeprecatedSynchronousErrorHandling){const t=!es;if(t&&(es={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:i}=es;if(es=null,e)throw i}}else n()}class $a extends Wn{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,kr(t)&&t.add(this)):this.destination=Mc}static create(t,e,i){return new gs(t,e,i)}next(t){this.isStopped?bi(function $u(n){return Mo("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?bi(function Fr(n){return Mo("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?bi(cn,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class gs extends $a{constructor(t,e,i){let s;if(super(),wn(t))s=t;else if(t){let c;({next:s,error:e,complete:i}=t),this&&Bt.useDeprecatedNextContext?(c=Object.create(t),c.unsubscribe=()=>this.unsubscribe()):c=t,s=null==s?void 0:s.bind(c),e=null==e?void 0:e.bind(c),i=null==i?void 0:i.bind(c)}this.destination={next:s?aa(s):Jr,error:aa(null!=e?e:Il),complete:i?aa(i):Jr}}}function aa(n,t){return(...e)=>{try{n(...e)}catch(i){Bt.useDeprecatedSynchronousErrorHandling?function on(n){Bt.useDeprecatedSynchronousErrorHandling&&es&&(es.errorThrown=!0,es.error=n)}(i):Bs(i)}}}function Il(n){throw n}function bi(n,t){const{onStoppedNotification:e}=Bt;e&&gt.setTimeout(()=>e(n,t))}const Mc={closed:!0,next:Jr,error:Il,complete:Jr},la="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ns(n){return n}let un=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,s){const c=function Sc(n){return n&&n instanceof $a||function ua(n){return n&&wn(n.next)&&wn(n.error)&&wn(n.complete)}(n)&&kr(n)}(e)?e:new gs(e,i,s);return ts(()=>{const{operator:f,source:v}=this;c.add(f?f.call(c,v):v?this._subscribe(c):this._trySubscribe(c))}),c}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=zs(i))((s,c)=>{let f;f=this.subscribe(v=>{try{e(v)}catch(C){c(C),null==f||f.unsubscribe()}},c,s)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[la](){return this}pipe(...e){return function ca(n){return 0===n.length?Ns:1===n.length?n[0]:function(e){return n.reduce((i,s)=>s(i),e)}}(e)(this)}toPromise(e){return new(e=zs(e))((i,s)=>{let c;this.subscribe(f=>c=f,f=>s(f),()=>i(c))})}}return n.create=t=>new n(t),n})();function zs(n){var t;return null!==(t=null!=n?n:Bt.Promise)&&void 0!==t?t:Promise}const _s=Kd(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Nt=(()=>{class n extends un{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new Rn(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new _s}next(e){ts(()=>{if(this._throwIfClosed(),!this.isStopped){const i=this.observers.slice();for(const s of i)s.next(e)}})}error(e){ts(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){ts(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:s,observers:c}=this;return i||s?Do:(c.push(e),new Wn(()=>p(c,e)))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:s,isStopped:c}=this;i?e.error(s):c&&e.complete()}asObservable(){const e=new un;return e.source=this,e}}return n.create=(t,e)=>new Rn(t,e),n})();class Rn extends Nt{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:Do}}function Ji(n){return wn(null==n?void 0:n.lift)}function Pn(n){return t=>{if(Ji(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}class Cn extends $a{constructor(t,e,i,s,c){super(t),this.onFinalize=c,this._next=e?function(f){try{e(f)}catch(v){t.error(v)}}:super._next,this._error=s?function(f){try{s(f)}catch(v){t.error(v)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(f){t.error(f)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}function Tt(n,t){return Pn((e,i)=>{let s=0;e.subscribe(new Cn(i,c=>{i.next(n.call(t,c,s++))}))})}function vs(n){return this instanceof vs?(this.v=n,this):new vs(n)}function Wa(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,i=e.apply(n,t||[]),c=[];return s={},f("next"),f("throw"),f("return"),s[Symbol.asyncIterator]=function(){return this},s;function f(q){i[q]&&(s[q]=function(X){return new Promise(function(ue,xe){c.push([q,X,ue,xe])>1||v(q,X)})})}function v(q,X){try{!function C(q){q.value instanceof vs?Promise.resolve(q.value.v).then(S,I):L(c[0][2],q)}(i[q](X))}catch(ue){L(c[0][3],ue)}}function S(q){v("next",q)}function I(q){v("throw",q)}function L(q,X){q(X),c.shift(),c.length&&v(c[0][0],c[0][1])}}function Za(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function ha(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(c){e[c]=n[c]&&function(f){return new Promise(function(v,C){!function s(c,f,v,C){Promise.resolve(C).then(function(S){c({value:S,done:v})},f)}(v,C,(f=n[c](f)).done,f.value)})}}}const Ic=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function kc(n){return wn(null==n?void 0:n.then)}function Fc(n){return wn(n[la])}function Ka(n){return Symbol.asyncIterator&&wn(null==n?void 0:n[Symbol.asyncIterator])}function Rc(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Pc=function Ya(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function xs(n){return wn(null==n?void 0:n[Pc])}function Ao(n){return Wa(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:i,done:s}=yield vs(e.read());if(s)return yield vs(void 0);yield yield vs(i)}}finally{e.releaseLock()}})}function fa(n){return wn(null==n?void 0:n.getReader)}function Ri(n){if(n instanceof un)return n;if(null!=n){if(Fc(n))return function Pl(n){return new un(t=>{const e=n[la]();if(wn(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Ic(n))return function Oc(n){return new un(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(kc(n))return function Ol(n){return new un(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,Bs)})}(n);if(Ka(n))return N(n);if(xs(n))return function J(n){return new un(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(fa(n))return function j(n){return N(Ao(n))}(n)}throw Rc(n)}function N(n){return new un(t=>{(function K(n,t){var e,i,s,c;return function Rr(n,t,e,i){return new(e||(e=Promise))(function(c,f){function v(I){try{S(i.next(I))}catch(L){f(L)}}function C(I){try{S(i.throw(I))}catch(L){f(L)}}function S(I){I.done?c(I.value):function s(c){return c instanceof e?c:new e(function(f){f(c)})}(I.value).then(v,C)}S((i=i.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=Za(n);!(i=yield e.next()).done;)if(t.next(i.value),t.closed)return}catch(f){s={error:f}}finally{try{i&&!i.done&&(c=e.return)&&(yield c.call(e))}finally{if(s)throw s.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function re(n,t,e,i=0,s=!1){const c=t.schedule(function(){e(),s?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(c),!s)return c}function me(n,t,e=1/0){return wn(t)?me((i,s)=>Tt((c,f)=>t(i,c,s,f))(Ri(n(i,s))),e):("number"==typeof t&&(e=t),Pn((i,s)=>function de(n,t,e,i,s,c,f,v){const C=[];let S=0,I=0,L=!1;const q=()=>{L&&!C.length&&!S&&t.complete()},X=xe=>S<i?ue(xe):C.push(xe),ue=xe=>{c&&t.next(xe),S++;let ke=!1;Ri(e(xe,I++)).subscribe(new Cn(t,Ie=>{null==s||s(Ie),c?X(Ie):t.next(Ie)},()=>{ke=!0},void 0,()=>{if(ke)try{for(S--;C.length&&S<i;){const Ie=C.shift();f?re(t,f,()=>ue(Ie)):ue(Ie)}q()}catch(Ie){t.error(Ie)}}))};return n.subscribe(new Cn(t,X,()=>{L=!0,q()})),()=>{null==v||v()}}(i,s,n,e)))}function _e(n=1/0){return me(Ns,n)}const he=new un(n=>n.complete());function Je(n){return n&&wn(n.schedule)}function ze(n){return n[n.length-1]}function xt(n){return wn(ze(n))?n.pop():void 0}function pt(n){return Je(ze(n))?n.pop():void 0}function Et(n,t=0){return Pn((e,i)=>{e.subscribe(new Cn(i,s=>re(i,n,()=>i.next(s),t),()=>re(i,n,()=>i.complete(),t),s=>re(i,n,()=>i.error(s),t)))})}function we(n,t=0){return Pn((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function pa(n,t){if(!n)throw new Error("Iterable cannot be null");return new un(e=>{re(e,t,()=>{const i=n[Symbol.asyncIterator]();re(e,t,()=>{i.next().then(s=>{s.done?e.complete():e.next(s.value)})},0,!0)})})}function Mt(n,t){return t?function Qe(n,t){if(null!=n){if(Fc(n))return function vn(n,t){return Ri(n).pipe(we(t),Et(t))}(n,t);if(Ic(n))return function gn(n,t){return new un(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}(n,t);if(kc(n))return function lt(n,t){return Ri(n).pipe(we(t),Et(t))}(n,t);if(Ka(n))return pa(n,t);if(xs(n))return function xn(n,t){return new un(e=>{let i;return re(e,t,()=>{i=n[Pc](),re(e,t,()=>{let s,c;try{({value:s,done:c}=i.next())}catch(f){return void e.error(f)}c?e.complete():e.next(s)},0,!0)}),()=>wn(null==i?void 0:i.return)&&i.return()})}(n,t);if(fa(n))return function To(n,t){return pa(Ao(n),t)}(n,t)}throw Rc(n)}(n,t):Ri(n)}function Ft(...n){const t=pt(n),e=function _t(n,t){return"number"==typeof ze(n)?n.pop():t}(n,1/0),i=n;return i.length?1===i.length?Ri(i[0]):_e(e)(Mt(i,t)):he}function jn(n){return n<=0?()=>he:Pn((t,e)=>{let i=0;t.subscribe(new Cn(e,s=>{++i<=n&&(e.next(s),n<=i&&e.complete())}))})}function ma(n={}){const{connector:t=(()=>new Nt),resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:s=!0}=n;return c=>{let f=null,v=null,C=null,S=0,I=!1,L=!1;const q=()=>{null==v||v.unsubscribe(),v=null},X=()=>{q(),f=C=null,I=L=!1},ue=()=>{const xe=f;X(),null==xe||xe.unsubscribe()};return Pn((xe,ke)=>{S++,!L&&!I&&q();const Ie=C=null!=C?C:t();ke.add(()=>{S--,0===S&&!L&&!I&&(v=Ht(ue,s))}),Ie.subscribe(ke),f||(f=new gs({next:Ee=>Ie.next(Ee),error:Ee=>{L=!0,q(),v=Ht(X,e,Ee),Ie.error(Ee)},complete:()=>{I=!0,q(),v=Ht(X,i),Ie.complete()}}),Mt(xe).subscribe(f))})(c)}}function Ht(n,t,...e){return!0===t?(n(),null):!1===t?null:t(...e).pipe(jn(1)).subscribe(()=>n())}function Mn(n){for(let t in n)if(n[t]===Mn)return t;throw Error("Could not find renamed property on target object.")}function ga(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function Wt(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Wt).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function Pr(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}const ni=Mn({__forward_ref__:Mn});function On(n){return n.__forward_ref__=On,n.toString=function(){return Wt(this())},n}function Ut(n){return Lc(n)?n():n}function Lc(n){return"function"==typeof n&&n.hasOwnProperty(ni)&&n.__forward_ref__===On}class dn extends Error{constructor(t,e){super(function Nc(n,t){return`NG0${Math.abs(n)}${t?": "+t:""}`}(t,e)),this.code=t}}function ot(n){return"string"==typeof n?n:null==n?"":String(n)}function Di(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():ot(n)}function Or(n,t){const e=t?` in ${t}`:"";throw new dn(-201,`No provider for ${Di(n)} found${e}`)}function ri(n,t){null==n&&function Zn(n,t,e,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${e} ${i} ${t} <=Actual]`))}(t,n,null,"!=")}function Ke(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function tn(n){return{providers:n.providers||[],imports:n.imports||[]}}function nh(n){return ih(n,Ja)||ih(n,rh)}function ih(n,t){return n.hasOwnProperty(t)?n[t]:null}function jf(n){return n&&(n.hasOwnProperty(el)||n.hasOwnProperty(Uf))?n[el]:null}const Ja=Mn({\u0275prov:Mn}),el=Mn({\u0275inj:Mn}),rh=Mn({ngInjectableDef:Mn}),Uf=Mn({ngInjectorDef:Mn});var Gt=(()=>((Gt=Gt||{})[Gt.Default=0]="Default",Gt[Gt.Host=1]="Host",Gt[Gt.Self=2]="Self",Gt[Gt.SkipSelf=4]="SkipSelf",Gt[Gt.Optional=8]="Optional",Gt))();let ko;function ws(n){const t=ko;return ko=n,t}function Ll(n,t,e){const i=nh(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&Gt.Optional?null:void 0!==t?t:void Or(Wt(n),"Injector")}function vr(n){return{toString:n}.toString()}var Br=(()=>((Br=Br||{})[Br.OnPush=0]="OnPush",Br[Br.Default=1]="Default",Br))(),ct=(()=>{return(n=ct||(ct={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",ct;var n})();const Ku="undefined"!=typeof globalThis&&globalThis,Gf="undefined"!=typeof window&&window,$f="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Ln=Ku||"undefined"!=typeof global&&global||Gf||$f,tl={},Bn=[],js=Mn({\u0275cmp:Mn}),ya=Mn({\u0275dir:Mn}),jc=Mn({\u0275pipe:Mn}),Uc=Mn({\u0275mod:Mn}),Us=Mn({\u0275fac:Mn}),Gc=Mn({__NG_ELEMENT_ID__:Mn});let $c=0;function Un(n){return vr(()=>{const e={},i={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Br.OnPush,directiveDefs:null,pipeDefs:null,selectors:n.selectors||Bn,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||ct.Emulated,id:"c",styles:n.styles||Bn,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.directives,c=n.features,f=n.pipes;return i.id+=$c++,i.inputs=qc(n.inputs,e),i.outputs=qc(n.outputs),c&&c.forEach(v=>v(i)),i.directiveDefs=s?()=>("function"==typeof s?s():s).map(Nr):null,i.pipeDefs=f?()=>("function"==typeof f?f():f).map(Hc):null,i})}function Nr(n){return Oi(n)||function Gs(n){return n[ya]||null}(n)}function Hc(n){return function va(n){return n[jc]||null}(n)}const Nl={};function Kt(n){return vr(()=>{const t={type:n.type,bootstrap:n.bootstrap||Bn,declarations:n.declarations||Bn,imports:n.imports||Bn,exports:n.exports||Bn,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(Nl[n.id]=n.type),t})}function qc(n,t){if(null==n)return tl;const e={};for(const i in n)if(n.hasOwnProperty(i)){let s=n[i],c=s;Array.isArray(s)&&(c=s[1],s=s[0]),e[s]=i,t&&(t[s]=c)}return e}const je=Un;function Oi(n){return n[js]||null}function ns(n,t){const e=n[Uc]||null;if(!e&&!0===t)throw new Error(`Type ${Wt(n)} does not have '\u0275mod' property.`);return e}function jr(n){return Array.isArray(n)&&"object"==typeof n[1]}function rs(n){return Array.isArray(n)&&!0===n[1]}function Kc(n){return 0!=(8&n.flags)}function Yc(n){return 2==(2&n.flags)}function rl(n){return 1==(1&n.flags)}function Ur(n){return null!==n.template}function et(n){return 0!=(512&n[2])}function Oo(n,t){return n.hasOwnProperty(Us)?n[Us]:null}class rd{constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function Li(){return ch}function ch(n){return n.type.prototype.ngOnChanges&&(n.setInput=Yf),Lo}function Lo(){const n=dh(this),t=null==n?void 0:n.current;if(t){const e=n.previous;if(e===tl)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function Yf(n,t,e,i){const s=dh(n)||function Qf(n,t){return n[uh]=t}(n,{previous:tl,current:null}),c=s.current||(s.current={}),f=s.previous,v=this.declaredInputs[e],C=f[v];c[v]=new rd(C&&C.currentValue,t,f===tl),n[i]=t}Li.ngInherit=!0;const uh="__ngSimpleChanges__";function dh(n){return n[uh]||null}let hh;function Gn(n){return!!n.listen}const qs={createRenderer:(n,t)=>function Hs(){return void 0!==hh?hh:"undefined"!=typeof document?document:void 0}()};function We(n){for(;Array.isArray(n);)n=n[0];return n}function wa(n,t){return We(t[n])}function tr(n,t){return We(t[n.index])}function od(n,t){return n.data[t]}function nr(n,t){const e=t[n];return jr(e)?e:e[0]}function ad(n){return 4==(4&n[2])}function ld(n){return 128==(128&n[2])}function Ws(n,t){return null==t?null:n[t]}function Gl(n){n[18]=0}function $l(n,t){n[5]+=t;let e=n,i=n[3];for(;null!==i&&(1===t&&1===e[5]||-1===t&&0===e[5]);)i[5]+=t,e=i,i=i[3]}const zt={lFrame:$n(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function _h(){return zt.bindingsEnabled}function $e(){return zt.lFrame.lView}function bn(){return zt.lFrame.tView}function No(n){return zt.lFrame.contextLView=n,n[8]}function mi(){let n=cd();for(;null!==n&&64===n.type;)n=n.parent;return n}function cd(){return zt.lFrame.currentTNode}function xr(n,t){const e=zt.lFrame;e.currentTNode=n,e.isParent=t}function ud(){return zt.lFrame.isParent}function ql(){zt.lFrame.isParent=!1}function nu(){return zt.isInCheckNoChangesMode}function iu(n){zt.isInCheckNoChangesMode=n}function Wl(){return zt.lFrame.bindingIndex++}function xh(n,t){const e=zt.lFrame;e.bindingIndex=e.bindingRootIndex=n,dr(t)}function dr(n){zt.lFrame.currentDirectiveIndex=n}function br(n){const t=zt.lFrame.currentDirectiveIndex;return-1===t?null:n[t]}function Xl(){return zt.lFrame.currentQueryIndex}function Vo(n){zt.lFrame.currentQueryIndex=n}function wh(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[6]:null}function su(n,t,e){if(e&Gt.SkipSelf){let s=t,c=n;for(;!(s=s.parent,null!==s||e&Gt.Host||(s=wh(c),null===s||(c=c[15],10&s.type))););if(null===s)return!1;t=s,n=c}const i=zt.lFrame=ss();return i.currentTNode=t,i.lView=n,!0}function jo(n){const t=ss(),e=n[1];zt.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function ss(){const n=zt.lFrame,t=null===n?null:n.child;return null===t?$n(n):t}function $n(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function Kl(){const n=zt.lFrame;return zt.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const cl=Kl;function m(){const n=Kl();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function _(){return zt.lFrame.selectedIndex}function b(n){zt.lFrame.selectedIndex=n}function w(){const n=zt.lFrame;return od(n.tView,n.selectedIndex)}function G(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){const c=n.data[e].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:v,ngAfterViewInit:C,ngAfterViewChecked:S,ngOnDestroy:I}=c;f&&(n.contentHooks||(n.contentHooks=[])).push(-e,f),v&&((n.contentHooks||(n.contentHooks=[])).push(e,v),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(e,v)),C&&(n.viewHooks||(n.viewHooks=[])).push(-e,C),S&&((n.viewHooks||(n.viewHooks=[])).push(e,S),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(e,S)),null!=I&&(n.destroyHooks||(n.destroyHooks=[])).push(e,I)}}function Z(n,t,e){ie(n,t,3,e)}function H(n,t,e,i){(3&n[2])===e&&ie(n,t,e,i)}function U(n,t){let e=n[2];(3&e)===t&&(e&=2047,e+=1,n[2]=e)}function ie(n,t,e,i){const c=null!=i?i:-1,f=t.length-1;let v=0;for(let C=void 0!==i?65535&n[18]:0;C<f;C++)if("number"==typeof t[C+1]){if(v=t[C],null!=i&&v>=i)break}else t[C]<0&&(n[18]+=65536),(v<c||-1==c)&&(Y(n,e,t,C),n[18]=(4294901760&n[18])+C+2),C++}function Y(n,t,e,i){const s=e[i]<0,c=e[i+1],v=n[s?-e[i]:e[i]];if(s){if(n[2]>>11<n[18]>>16&&(3&n[2])===t){n[2]+=2048;try{c.call(v)}finally{}}}else try{c.call(v)}finally{}}class ne{constructor(t,e,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function ye(n,t,e){const i=Gn(n);let s=0;for(;s<e.length;){const c=e[s];if("number"==typeof c){if(0!==c)break;s++;const f=e[s++],v=e[s++],C=e[s++];i?n.setAttribute(t,v,C,f):t.setAttributeNS(f,v,C)}else{const f=c,v=e[++s];Ue(f)?i&&n.setProperty(t,f,v):i?n.setAttribute(t,f,v):t.setAttribute(f,v),s++}}return s}function He(n){return 3===n||4===n||6===n}function Ue(n){return 64===n.charCodeAt(0)}function rt(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){const s=t[i];"number"==typeof s?e=s:0===e||Re(n,e,s,null,-1===e||2===e?t[++i]:null)}}return n}function Re(n,t,e,i,s){let c=0,f=n.length;if(-1===t)f=-1;else for(;c<n.length;){const v=n[c++];if("number"==typeof v){if(v===t){f=-1;break}if(v>t){f=c-1;break}}}for(;c<n.length;){const v=n[c];if("number"==typeof v)break;if(v===e){if(null===i)return void(null!==s&&(n[c+1]=s));if(i===n[c+1])return void(n[c+2]=s)}c++,null!==i&&c++,null!==s&&c++}-1!==f&&(n.splice(f,0,t),c=f+1),n.splice(c++,0,e),null!==i&&n.splice(c++,0,i),null!==s&&n.splice(c++,0,s)}function st(n){return-1!==n}function ft(n){return 32767&n}function nt(n,t){let e=function at(n){return n>>16}(n),i=t;for(;e>0;)i=i[15],e--;return i}let vt=!0;function It(n){const t=vt;return vt=n,t}let oi=0;function Si(n,t){const e=os(n,t);if(-1!==e)return e;const i=t[1];i.firstCreatePass&&(n.injectorIndex=t.length,wr(i.data,n),wr(t,null),wr(i.blueprint,null));const s=Ds(n,t),c=n.injectorIndex;if(st(s)){const f=ft(s),v=nt(s,t),C=v[1].data;for(let S=0;S<8;S++)t[c+S]=v[f+S]|C[f+S]}return t[c+8]=s,c}function wr(n,t){n.push(0,0,0,0,0,0,0,0,t)}function os(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function Ds(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,i=null,s=t;for(;null!==s;){const c=s[1],f=c.type;if(i=2===f?c.declTNode:1===f?s[6]:null,null===i)return-1;if(e++,s=s[15],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return-1}function Zs(n,t,e){!function hr(n,t,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(Gc)&&(i=e[Gc]),null==i&&(i=e[Gc]=oi++);const s=255&i;t.data[n+(s>>5)]|=1<<s}(n,t,e)}function ai(n,t,e){if(e&Gt.Optional)return n;Or(t,"NodeInjector")}function di(n,t,e,i){if(e&Gt.Optional&&void 0===i&&(i=null),0==(e&(Gt.Self|Gt.Host))){const s=n[9],c=ws(void 0);try{return s?s.get(t,i,e&Gt.Optional):Ll(t,i,e&Gt.Optional)}finally{ws(c)}}return ai(i,t,e)}function _n(n,t,e,i=Gt.Default,s){if(null!==n){const c=function ls(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(Gc)?n[Gc]:void 0;return"number"==typeof t?t>=0?255&t:as:t}(e);if("function"==typeof c){if(!su(t,n,i))return i&Gt.Host?ai(s,e,i):di(t,e,i,s);try{const f=c(i);if(null!=f||i&Gt.Optional)return f;Or(e)}finally{cl()}}else if("number"==typeof c){let f=null,v=os(n,t),C=-1,S=i&Gt.Host?t[16][6]:null;for((-1===v||i&Gt.SkipSelf)&&(C=-1===v?Ds(n,t):t[v+8],-1!==C&&Ch(i,!1)?(f=t[1],v=ft(C),t=nt(C,t)):v=-1);-1!==v;){const I=t[1];if(Ca(c,v,I.data)){const L=li(v,t,e,f,i,S);if(L!==yi)return L}C=t[v+8],-1!==C&&Ch(i,t[1].data[v+8]===S)&&Ca(c,v,t)?(f=I,v=ft(C),t=nt(C,t)):v=-1}}}return di(t,e,i,s)}const yi={};function as(){return new Ea(mi(),$e())}function li(n,t,e,i,s,c){const f=t[1],v=f.data[n+8],I=Cr(v,f,e,null==i?Yc(v)&&vt:i!=f&&0!=(3&v.type),s&Gt.Host&&c===v);return null!==I?Go(t,f,I,v):yi}function Cr(n,t,e,i,s){const c=n.providerIndexes,f=t.data,v=1048575&c,C=n.directiveStart,I=c>>20,q=s?v+I:n.directiveEnd;for(let X=i?v:v+I;X<q;X++){const ue=f[X];if(X<C&&e===ue||X>=C&&ue.type===e)return X}if(s){const X=f[C];if(X&&Ur(X)&&X.type===e)return C}return null}function Go(n,t,e,i){let s=n[e];const c=t.data;if(function oe(n){return n instanceof ne}(s)){const f=s;f.resolving&&function Jd(n,t){const e=t?`. Dependency path: ${t.join(" > ")} > ${n}`:"";throw new dn(-200,`Circular dependency in DI detected for ${n}${e}`)}(Di(c[e]));const v=It(f.canSeeViewProviders);f.resolving=!0;const C=f.injectImpl?ws(f.injectImpl):null;su(n,i,Gt.Default);try{s=n[e]=f.factory(void 0,c,n,i),t.firstCreatePass&&e>=i.directiveStart&&function z(n,t,e){const{ngOnChanges:i,ngOnInit:s,ngDoCheck:c}=t.type.prototype;if(i){const f=ch(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(n,f),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,f)}s&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-n,s),c&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n,c),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,c))}(e,c[e],t)}finally{null!==C&&ws(C),It(v),f.resolving=!1,cl()}}return s}function Ca(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function Ch(n,t){return!(n&Gt.Self||n&Gt.Host&&t)}class Ea{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return _n(this._tNode,this._lView,t,i,e)}}function wt(n){return vr(()=>{const t=n.prototype.constructor,e=t[Us]||Eh(t),i=Object.prototype;let s=Object.getPrototypeOf(n.prototype).constructor;for(;s&&s!==i;){const c=s[Us]||Eh(s);if(c&&c!==e)return c;s=Object.getPrototypeOf(s)}return c=>new c})}function Eh(n){return Lc(n)?()=>{const t=Eh(Ut(n));return t&&t()}:Oo(n)}function $r(n){return function Uo(n,t){if("class"===t)return n.classes;if("style"===t)return n.styles;const e=n.attrs;if(e){const i=e.length;let s=0;for(;s<i;){const c=e[s];if(He(c))break;if(0===c)s+=2;else if("number"==typeof c)for(s++;s<i&&"string"==typeof e[s];)s++;else{if(c===t)return e[s+1];s+=2}}}return null}(mi(),n)}const ul="__parameters__";function Ms(n,t,e){return vr(()=>{const i=function hd(n){return function(...e){if(n){const i=n(...e);for(const s in i)this[s]=i[s]}}}(t);function s(...c){if(this instanceof s)return i.apply(this,c),this;const f=new s(...c);return v.annotation=f,v;function v(C,S,I){const L=C.hasOwnProperty(ul)?C[ul]:Object.defineProperty(C,ul,{value:[]})[ul];for(;L.length<=I;)L.push(null);return(L[I]=L[I]||[]).push(f),C}}return e&&(s.prototype=Object.create(e.prototype)),s.prototype.ngMetadataName=n,s.annotationCls=s,s})}class dt{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=Ke({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}toString(){return`InjectionToken ${this._desc}`}}const b0=new dt("AnalyzeForEntryComponents");function mo(n,t){void 0===t&&(t=n);for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)?(t===n&&(t=n.slice(0,e)),mo(i,t)):t!==n&&t.push(i)}return t}function $o(n,t){n.forEach(e=>Array.isArray(e)?$o(e,t):t(e))}function Sh(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function Ss(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function Ah(n,t){const e=[];for(let i=0;i<n;i++)e.push(t);return e}function As(n,t,e){let i=Ma(n,t);return i>=0?n[1|i]=e:(i=~i,function Rt(n,t,e,i){let s=n.length;if(s==t)n.push(e,i);else if(1===s)n.push(i,n[0]),n[0]=e;else{for(s--,n.push(n[s-1],n[s]);s>t;)n[s]=n[s-2],s--;n[t]=e,n[t+1]=i}}(n,i,t,e)),i}function Th(n,t){const e=Ma(n,t);if(e>=0)return n[1|e]}function Ma(n,t){return function cu(n,t,e){let i=0,s=n.length>>e;for(;s!==i;){const c=i+(s-i>>1),f=n[c<<e];if(t===f)return c<<e;f>t?s=c:i=c+1}return~(s<<e)}(n,t,1)}const kh={},Ho="__NG_DI_FLAG__",Aa="ngTempTokenPath",cp=/\n/gm,Vm="__source",E0=Mn({provide:String,useValue:Mn});let pd;function ry(n){const t=pd;return pd=n,t}function jm(n,t=Gt.Default){if(void 0===pd)throw new dn(203,"");return null===pd?Ll(n,void 0,t):pd.get(n,t&Gt.Optional?null:void 0,t)}function Ce(n,t=Gt.Default){return(function Lr(){return ko}()||jm)(Ut(n),t)}const md=Ce;function dp(n){const t=[];for(let e=0;e<n.length;e++){const i=Ut(n[e]);if(Array.isArray(i)){if(0===i.length)throw new dn(900,"");let s,c=Gt.Default;for(let f=0;f<i.length;f++){const v=i[f],C=sy(v);"number"==typeof C?-1===C?s=v.token:c|=C:s=v}t.push(Ce(s,c))}else t.push(Ce(i))}return t}function Ta(n,t){return n[Ho]=t,n.prototype[Ho]=t,n}function sy(n){return n[Ho]}const Ql=Ta(Ms("Inject",n=>({token:n})),-1),Ts=Ta(Ms("Optional"),8),uu=Ta(Ms("SkipSelf"),4);let Ph;function Jl(n){var t;return(null===(t=function Oh(){if(void 0===Ph&&(Ph=null,Ln.trustedTypes))try{Ph=Ln.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return Ph}())||void 0===t?void 0:t.createHTML(n))||n}class _o{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class A0 extends _o{getTypeName(){return"HTML"}}class T0 extends _o{getTypeName(){return"Style"}}class yd extends _o{getTypeName(){return"Script"}}class cy extends _o{getTypeName(){return"URL"}}class uy extends _o{getTypeName(){return"ResourceURL"}}function Is(n){return n instanceof _o?n.changingThisBreaksApplicationSecurity:n}function yo(n,t){const e=ks(n);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see https://g.co/ng/security#xss)`)}return e===t}function ks(n){return n instanceof _o&&n.getTypeName()||null}class fy{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString(Jl(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class py{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const i=this.inertDocument.createElement("body");e.appendChild(i)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=Jl(t),e;const i=this.inertDocument.createElement("body");return i.innerHTML=Jl(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(t){const e=t.attributes;for(let s=e.length-1;0<s;s--){const f=e.item(s).name;("xmlns:ns1"===f||0===f.indexOf("ns1:"))&&t.removeAttribute(f)}let i=t.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const hl=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,R0=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function fu(n){return(n=String(n)).match(hl)||n.match(R0)?n:"unsafe:"+n}function Ia(n){const t={};for(const e of n.split(","))t[e]=!0;return t}function Bh(...n){const t={};for(const e of n)for(const i in e)e.hasOwnProperty(i)&&(t[i]=!0);return t}const Nh=Ia("area,br,col,hr,img,wbr"),gy=Ia("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),zh=Ia("rp,rt"),Xm=Bh(Nh,Bh(gy,Ia("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Bh(zh,Ia("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Bh(zh,gy)),Km=Ia("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Ym=Ia("srcset"),_y=Bh(Km,Ym,Ia("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Ia("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),O0=Ia("script,style,template");class Qm{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,i=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let s=this.checkClobberedElement(e,e.nextSibling);if(s){e=s;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!Xm.hasOwnProperty(e))return this.sanitizedSomething=!0,!O0.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const i=t.attributes;for(let s=0;s<i.length;s++){const c=i.item(s),f=c.name,v=f.toLowerCase();if(!_y.hasOwnProperty(v)){this.sanitizedSomething=!0;continue}let C=c.value;Km[v]&&(C=fu(C)),Ym[v]&&(n=C,C=(n=String(n)).split(",").map(t=>fu(t.trim())).join(", ")),this.buf.push(" ",f,'="',yy(C),'"')}var n;return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();Xm.hasOwnProperty(e)&&!Nh.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(yy(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const L0=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,vd=/([^\#-~ |!])/g;function yy(n){return n.replace(/&/g,"&amp;").replace(L0,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(vd,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let fi;function Vh(n,t){let e=null;try{fi=fi||function Wm(n){const t=new py(n);return function Zm(){try{return!!(new window.DOMParser).parseFromString(Jl(""),"text/html")}catch(n){return!1}}()?new fy(t):t}(n);let i=t?String(t):"";e=fi.getInertBodyElement(i);let s=5,c=i;do{if(0===s)throw new Error("Failed to sanitize html because the input is unstable");s--,i=c,c=e.innerHTML,e=fi.getInertBodyElement(i)}while(i!==c);return Jl((new Qm).sanitizeChildren(_p(e)||e))}finally{if(e){const i=_p(e)||e;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function _p(n){return"content"in n&&function yp(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var Sn=(()=>((Sn=Sn||{})[Sn.NONE=0]="NONE",Sn[Sn.HTML=1]="HTML",Sn[Sn.STYLE=2]="STYLE",Sn[Sn.SCRIPT=3]="SCRIPT",Sn[Sn.URL=4]="URL",Sn[Sn.RESOURCE_URL=5]="RESOURCE_URL",Sn))();function Uh(n){const t=function $h(){const n=$e();return n&&n[12]}();return t?t.sanitize(Sn.URL,n)||"":yo(n,"URL")?Is(n):fu(ot(n))}const wy="__ngContext__";function qr(n,t){n[wy]=t}function tg(n){const t=function Wh(n){return n[wy]||null}(n);return t?Array.isArray(t)?t:t.lView:null}function sg(n){return n.ngOriginalError}function Zh(n,...t){n.error(...t)}class Ys{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t),i=function U0(n){return n&&n.ngErrorLogger||Zh}(t);i(this._console,"ERROR",t),e&&i(this._console,"ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&sg(t);for(;e&&sg(e);)e=sg(e);return e||null}}const Sy=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Ln))();function ka(n){return n instanceof Function?n():n}var Qs=(()=>((Qs=Qs||{})[Qs.Important=1]="Important",Qs[Qs.DashCase=2]="DashCase",Qs))();function cg(n,t){return undefined(n,t)}function Ai(n){const t=n[3];return rs(t)?t[3]:t}function wd(n){return Iy(n[13])}function nc(n){return Iy(n[4])}function Iy(n){for(;null!==n&&!rs(n);)n=n[4];return n}function Fa(n,t,e,i,s){if(null!=i){let c,f=!1;rs(i)?c=i:jr(i)&&(f=!0,i=i[0]);const v=We(i);0===n&&null!==e?null==s?Ny(t,e,v):_u(t,e,v,s||null,!0):1===n&&null!==e?_u(t,e,v,s||null,!0):2===n?function Dp(n,t,e){const i=ml(n,t);i&&function Cp(n,t,e,i){Gn(n)?n.removeChild(t,e,i):t.removeChild(e)}(n,i,t,e)}(t,v,f):3===n&&t.destroyNode(v),null!=c&&function tb(n,t,e,i,s){const c=e[7];c!==We(e)&&Fa(t,n,i,c,s);for(let v=10;v<e.length;v++){const C=e[v];ef(C[1],C,n,t,i,c)}}(t,n,c,e,s)}}function bp(n,t,e){return Gn(n)?n.createElement(t,e):null===e?n.createElement(t):n.createElementNS(e,t)}function gu(n,t){const e=n[9],i=e.indexOf(t),s=t[3];1024&t[2]&&(t[2]&=-1025,$l(s,-1)),e.splice(i,1)}function wp(n,t){if(n.length<=10)return;const e=10+t,i=n[e];if(i){const s=i[17];null!==s&&s!==n&&gu(s,i),t>0&&(n[e-1][4]=i[4]);const c=Ss(n,10+t);!function Yh(n,t){ef(n,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const f=c[19];null!==f&&f.detachView(c[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function Oy(n,t){if(!(256&t[2])){const e=t[11];Gn(e)&&e.destroyNode&&ef(n,t,e,3,null,null),function Ry(n){let t=n[13];if(!t)return hg(n[1],n);for(;t;){let e=null;if(jr(t))e=t[13];else{const i=t[10];i&&(e=i)}if(!e){for(;t&&!t[4]&&t!==n;)jr(t)&&hg(t[1],t),t=t[3];null===t&&(t=n),jr(t)&&hg(t[1],t),e=t&&t[4]}t=e}}(t)}}function hg(n,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function eb(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let i=0;i<e.length;i+=2){const s=t[e[i]];if(!(s instanceof ne)){const c=e[i+1];if(Array.isArray(c))for(let f=0;f<c.length;f+=2){const v=s[c[f]],C=c[f+1];try{C.call(v)}finally{}}else try{c.call(s)}finally{}}}}(n,t),function J0(n,t){const e=n.cleanup,i=t[7];let s=-1;if(null!==e)for(let c=0;c<e.length-1;c+=2)if("string"==typeof e[c]){const f=e[c+1],v="function"==typeof f?f(t):We(t[f]),C=i[s=e[c+2]],S=e[c+3];"boolean"==typeof S?v.removeEventListener(e[c],C,S):S>=0?i[s=S]():i[s=-S].unsubscribe(),c+=2}else{const f=i[s=e[c+1]];e[c].call(f)}if(null!==i){for(let c=s+1;c<i.length;c++)i[c]();t[7]=null}}(n,t),1===t[1].type&&Gn(t[11])&&t[11].destroy();const e=t[17];if(null!==e&&rs(t[3])){e!==t[3]&&gu(e,t);const i=t[19];null!==i&&i.detachView(n)}}}function Ly(n,t,e){return function By(n,t,e){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return e[0];if(2&i.flags){const s=n.data[i.directiveStart].encapsulation;if(s===ct.None||s===ct.Emulated)return null}return tr(i,e)}(n,t.parent,e)}function _u(n,t,e,i,s){Gn(n)?n.insertBefore(t,e,i,s):t.insertBefore(e,i,s)}function Ny(n,t,e){Gn(n)?n.appendChild(t,e):t.appendChild(e)}function zy(n,t,e,i,s){null!==i?_u(n,t,e,i,s):Ny(n,t,e)}function ml(n,t){return Gn(n)?n.parentNode(t):t.parentNode}function jy(n,t,e){return Gy(n,t,e)}let Gy=function Uy(n,t,e){return 40&n.type?tr(n,e):null};function Jh(n,t,e,i){const s=Ly(n,i,t),c=t[11],v=jy(i.parent||t[6],i,t);if(null!=s)if(Array.isArray(e))for(let C=0;C<e.length;C++)zy(c,s,e[C],v,!1);else zy(c,s,e,v,!1)}function Wr(n,t){if(null!==t){const e=t.type;if(3&e)return tr(t,n);if(4&e)return ic(-1,n[t.index]);if(8&e){const i=t.child;if(null!==i)return Wr(n,i);{const s=n[t.index];return rs(s)?ic(-1,s):We(s)}}if(32&e)return cg(t,n)()||We(n[t.index]);{const i=Cd(n,t);return null!==i?Array.isArray(i)?i[0]:Wr(Ai(n[16]),i):Wr(n,t.next)}}return null}function Cd(n,t){return null!==t?n[16][6].projection[t.projection]:null}function ic(n,t){const e=10+n+1;if(e<t.length){const i=t[e],s=i[1].firstChild;if(null!==s)return Wr(i,s)}return t[7]}function Ed(n,t,e,i,s,c,f){for(;null!=e;){const v=i[e.index],C=e.type;if(f&&0===t&&(v&&qr(We(v),i),e.flags|=4),64!=(64&e.flags))if(8&C)Ed(n,t,e.child,i,s,c,!1),Fa(t,n,s,v,c);else if(32&C){const S=cg(e,i);let I;for(;I=S();)Fa(t,n,s,I,c);Fa(t,n,s,v,c)}else 16&C?fg(n,t,i,e,s,c):Fa(t,n,s,v,c);e=f?e.projectionNext:e.next}}function ef(n,t,e,i,s,c){Ed(e,i,n.firstChild,t,s,c,!1)}function fg(n,t,e,i,s,c){const f=e[16],C=f[6].projection[i.projection];if(Array.isArray(C))for(let S=0;S<C.length;S++)Fa(t,n,s,C[S],c);else Ed(n,t,C,f[3],s,c,!0)}function pg(n,t,e){Gn(n)?n.setAttribute(t,"style",e):t.style.cssText=e}function tf(n,t,e){Gn(n)?""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e):t.className=e}function Mp(n,t,e){let i=n.length;for(;;){const s=n.indexOf(t,e);if(-1===s)return s;if(0===s||n.charCodeAt(s-1)<=32){const c=t.length;if(s+c===i||n.charCodeAt(s+c)<=32)return s}e=s+1}}const qy="ng-template";function Wy(n,t,e){let i=0;for(;i<n.length;){let s=n[i++];if(e&&"class"===s){if(s=n[i],-1!==Mp(s.toLowerCase(),t,0))return!0}else if(1===s){for(;i<n.length&&"string"==typeof(s=n[i++]);)if(s.toLowerCase()===t)return!0;return!1}}return!1}function Ra(n){return 4===n.type&&n.value!==qy}function Zy(n,t,e){return t===(4!==n.type||e?n.value:qy)}function Xy(n,t,e){let i=4;const s=n.attrs||[],c=function Qy(n){for(let t=0;t<n.length;t++)if(He(n[t]))return t;return n.length}(s);let f=!1;for(let v=0;v<t.length;v++){const C=t[v];if("number"!=typeof C){if(!f)if(4&i){if(i=2|1&i,""!==C&&!Zy(n,C,e)||""===C&&1===t.length){if(vo(i))return!1;f=!0}}else{const S=8&i?C:t[++v];if(8&i&&null!==n.attrs){if(!Wy(n.attrs,S,e)){if(vo(i))return!1;f=!0}continue}const L=Ky(8&i?"class":C,s,Ra(n),e);if(-1===L){if(vo(i))return!1;f=!0;continue}if(""!==S){let q;q=L>c?"":s[L+1].toLowerCase();const X=8&i?q:null;if(X&&-1!==Mp(X,S,0)||2&i&&S!==q){if(vo(i))return!1;f=!0}}}}else{if(!f&&!vo(i)&&!vo(C))return!1;if(f&&vo(C))continue;f=!1,i=C|1&i}}return vo(i)||f}function vo(n){return 0==(1&n)}function Ky(n,t,e,i){if(null===t)return-1;let s=0;if(i||!e){let c=!1;for(;s<t.length;){const f=t[s];if(f===n)return s;if(3===f||6===f)c=!0;else{if(1===f||2===f){let v=t[++s];for(;"string"==typeof v;)v=t[++s];continue}if(4===f)break;if(0===f){s+=4;continue}}s+=c?1:2}return-1}return function Jy(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const i=n[e];if("number"==typeof i)return-1;if(i===t)return e;e++}return-1}(t,n)}function Yy(n,t,e=!1){for(let i=0;i<t.length;i++)if(Xy(n,t[i],e))return!0;return!1}function nf(n,t){e:for(let e=0;e<t.length;e++){const i=t[e];if(n.length===i.length){for(let s=0;s<n.length;s++)if(n[s]!==i[s])continue e;return!0}}return!1}function mg(n,t){return n?":not("+t.trim()+")":t}function ev(n){let t=n[0],e=1,i=2,s="",c=!1;for(;e<n.length;){let f=n[e];if("string"==typeof f)if(2&i){const v=n[++e];s+="["+f+(v.length>0?'="'+v+'"':"")+"]"}else 8&i?s+="."+f:4&i&&(s+=" "+f);else""!==s&&!vo(f)&&(t+=mg(c,s),s=""),i=f,c=c||!vo(i);e++}return""!==s&&(t+=mg(c,s)),t}const Xt={};function Zr(n){_g(bn(),$e(),_()+n,nu())}function _g(n,t,e,i){if(!i)if(3==(3&t[2])){const c=n.preOrderCheckHooks;null!==c&&Z(t,c,e)}else{const c=n.preOrderHooks;null!==c&&H(t,c,0,e)}b(e)}function yu(n,t){return n<<17|t<<2}function Zo(n){return n>>17&32767}function yg(n){return 2|n}function gl(n){return(131068&n)>>2}function rc(n,t){return-131069&n|t<<2}function vg(n){return 1|n}function Bp(n,t){const e=n.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const s=e[i],c=e[i+1];if(-1!==c){const f=n.data[c];Vo(s),f.contentQueries(2,t[c],c)}}}function vu(n,t,e,i,s,c,f,v,C,S){const I=t.blueprint.slice();return I[0]=s,I[2]=140|i,Gl(I),I[3]=I[15]=n,I[8]=e,I[10]=f||n&&n[10],I[11]=v||n&&n[11],I[12]=C||n&&n[12]||null,I[9]=S||n&&n[9]||null,I[6]=c,I[16]=2==t.type?n[16]:I,I}function xu(n,t,e,i,s){let c=n.data[t];if(null===c)c=function Ko(n,t,e,i,s){const c=cd(),f=ud(),C=n.data[t]=function hb(n,t,e,i,s,c){return{type:e,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:s,attrs:c,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?c:c&&c.parent,e,t,i,s);return null===n.firstChild&&(n.firstChild=C),null!==c&&(f?null==c.child&&null!==C.parent&&(c.child=C):null===c.next&&(c.next=C)),C}(n,t,e,i,s),function vh(){return zt.lFrame.inI18n}()&&(c.flags|=64);else if(64&c.type){c.type=e,c.value=i,c.attrs=s;const f=function Hl(){const n=zt.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();c.injectorIndex=null===f?-1:f.injectorIndex}return xr(c,!0),c}function bu(n,t,e,i){if(0===e)return-1;const s=t.length;for(let c=0;c<e;c++)t.push(i),n.blueprint.push(i),n.data.push(null);return s}function wu(n,t,e){jo(t);try{const i=n.viewQuery;null!==i&&Ug(1,i,e);const s=n.template;null!==s&&Mg(n,t,s,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Bp(n,t),n.staticViewQueries&&Ug(2,n.viewQuery,e);const c=n.components;null!==c&&function db(n,t){for(let e=0;e<t.length;e++)bv(n,t[e])}(t,c)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[2]&=-5,m()}}function Cu(n,t,e,i){const s=t[2];if(256==(256&s))return;jo(t);const c=nu();try{Gl(t),function ru(n){return zt.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&Mg(n,t,e,2,i);const f=3==(3&s);if(!c)if(f){const S=n.preOrderCheckHooks;null!==S&&Z(t,S,null)}else{const S=n.preOrderHooks;null!==S&&H(t,S,0,null),U(t,0)}if(function vv(n){for(let t=wd(n);null!==t;t=nc(t)){if(!t[2])continue;const e=t[9];for(let i=0;i<e.length;i++){const s=e[i],c=s[3];0==(1024&s[2])&&$l(c,1),s[2]|=1024}}}(t),function Du(n){for(let t=wd(n);null!==t;t=nc(t))for(let e=10;e<t.length;e++){const i=t[e],s=i[1];ld(i)&&Cu(s,i,s.template,i[8])}}(t),null!==n.contentQueries&&Bp(n,t),!c)if(f){const S=n.contentCheckHooks;null!==S&&Z(t,S)}else{const S=n.contentHooks;null!==S&&H(t,S,1),U(t,1)}!function ub(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const s=e[i];if(s<0)b(~s);else{const c=s,f=e[++i],v=e[++i];xh(f,c),v(2,t[c])}}}finally{b(-1)}}(n,t);const v=n.components;null!==v&&function af(n,t){for(let e=0;e<t.length;e++)xv(n,t[e])}(t,v);const C=n.viewQuery;if(null!==C&&Ug(2,C,i),!c)if(f){const S=n.viewCheckHooks;null!==S&&Z(t,S)}else{const S=n.viewHooks;null!==S&&H(t,S,2),U(t,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),c||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,$l(t[3],-1))}finally{m()}}function uv(n,t,e,i){const s=t[10],c=!nu(),f=ad(t);try{c&&!f&&s.begin&&s.begin(),f&&wu(n,t,i),Cu(n,t,e,i)}finally{c&&!f&&s.end&&s.end()}}function Mg(n,t,e,i,s){const c=_(),f=2&i;try{b(-1),f&&t.length>20&&_g(n,t,20,nu()),e(i,s)}finally{b(c)}}function Ag(n,t,e){!_h()||(function fv(n,t,e,i){const s=e.directiveStart,c=e.directiveEnd;n.firstCreatePass||Si(e,t),qr(i,t);const f=e.initialInputs;for(let v=s;v<c;v++){const C=n.data[v],S=Ur(C);S&&Sd(t,e,C);const I=Go(t,n,v,e);qr(I,t),null!==f&&La(0,v-s,I,C,0,f),S&&(nr(e.index,t)[8]=I)}}(n,t,e,tr(e,t)),128==(128&e.flags)&&function pv(n,t,e){const i=e.directiveStart,s=e.directiveEnd,f=e.index,v=function bh(){return zt.lFrame.currentDirectiveIndex}();try{b(f);for(let C=i;C<s;C++){const S=n.data[C],I=t[C];dr(C),(null!==S.hostBindings||0!==S.hostVars||null!==S.hostAttrs)&&Ng(S,I)}}finally{b(-1),dr(v)}}(n,t,e))}function Tg(n,t,e=tr){const i=t.localNames;if(null!==i){let s=t.index+1;for(let c=0;c<i.length;c+=2){const f=i[c+1],v=-1===f?e(t,n):n[f];n[s++]=v}}}function Ig(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=Eu(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):t}function Eu(n,t,e,i,s,c,f,v,C,S){const I=20+i,L=I+s,q=function dv(n,t){const e=[];for(let i=0;i<t;i++)e.push(i<n?null:Xt);return e}(I,L),X="function"==typeof S?S():S;return q[1]={type:n,blueprint:q,template:e,queries:null,viewQuery:v,declTNode:t,data:q.slice().fill(null,I),bindingStartIndex:I,expandoStartIndex:L,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof c?c():c,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:C,consts:X,incompleteFirstPass:!1}}function kg(n,t,e,i){const s=Td(t);null===e?s.push(i):(s.push(e),n.firstCreatePass&&Id(n).push(i,s.length-1))}function Fg(n,t,e){for(let i in n)if(n.hasOwnProperty(i)){const s=n[i];(e=null===e?{}:e).hasOwnProperty(i)?e[i].push(t,s):e[i]=[t,s]}return e}function qi(n,t,e,i,s,c,f,v){const C=tr(t,e);let I,S=t.inputs;!v&&null!=S&&(I=S[i])?(Cv(n,e,I,i,s),Yc(t)&&function Oa(n,t){const e=nr(t,n);16&e[2]||(e[2]|=64)}(e,t.index)):3&t.type&&(i=function Pa(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),s=null!=f?f(s,t.value||"",i):s,Gn(c)?c.setProperty(C,i,s):Ue(i)||(C.setProperty?C.setProperty(i,s):C[i]=s))}function Lg(n,t,e,i){let s=!1;if(_h()){const c=function mv(n,t,e){const i=n.directiveRegistry;let s=null;if(i)for(let c=0;c<i.length;c++){const f=i[c];Yy(e,f.selectors,!1)&&(s||(s=[]),Zs(Si(e,t),n,f.type),Ur(f)?(zg(n,e),s.unshift(f)):s.push(f))}return s}(n,t,e),f=null===i?null:{"":-1};if(null!==c){s=!0,lf(e,n.data.length,c.length);for(let I=0;I<c.length;I++){const L=c[I];L.providersResolver&&L.providersResolver(L)}let v=!1,C=!1,S=bu(n,t,c.length,null);for(let I=0;I<c.length;I++){const L=c[I];e.mergedAttrs=rt(e.mergedAttrs,L.hostAttrs),_v(n,e,t,S,L),gv(S,L,f),null!==L.contentQueries&&(e.flags|=8),(null!==L.hostBindings||null!==L.hostAttrs||0!==L.hostVars)&&(e.flags|=128);const q=L.type.prototype;!v&&(q.ngOnChanges||q.ngOnInit||q.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e.index),v=!0),!C&&(q.ngOnChanges||q.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e.index),C=!0),S++}!function xo(n,t){const i=t.directiveEnd,s=n.data,c=t.attrs,f=[];let v=null,C=null;for(let S=t.directiveStart;S<i;S++){const I=s[S],L=I.inputs,q=null===c||Ra(t)?null:Vg(L,c);f.push(q),v=Fg(L,S,v),C=Fg(I.outputs,S,C)}null!==v&&(v.hasOwnProperty("class")&&(t.flags|=16),v.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=f,t.inputs=v,t.outputs=C}(n,e)}f&&function lc(n,t,e){if(t){const i=n.localNames=[];for(let s=0;s<t.length;s+=2){const c=e[t[s+1]];if(null==c)throw new dn(-301,`Export of name '${t[s+1]}' not found!`);i.push(t[s],c)}}}(e,i,f)}return e.mergedAttrs=rt(e.mergedAttrs,e.attrs),s}function Bg(n,t,e,i,s,c){const f=c.hostBindings;if(f){let v=n.hostBindingOpCodes;null===v&&(v=n.hostBindingOpCodes=[]);const C=~t.index;(function hv(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(v)!=C&&v.push(C),v.push(i,s,f)}}function Ng(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function zg(n,t){t.flags|=2,(n.components||(n.components=[])).push(t.index)}function gv(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;Ur(t)&&(e[""]=n)}}function lf(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function _v(n,t,e,i,s){n.data[i]=s;const c=s.factory||(s.factory=Oo(s.type)),f=new ne(c,Ur(s),null);n.blueprint[i]=f,e[i]=f,Bg(n,t,0,i,bu(n,e,s.hostVars,Xt),s)}function Sd(n,t,e){const i=tr(t,n),s=Ig(e),c=n[10],f=zp(n,vu(n,s,null,e.onPush?64:16,i,t,c,c.createRenderer(i,e),null,null));n[t.index]=f}function bo(n,t,e,i,s,c){const f=tr(n,t);!function cf(n,t,e,i,s,c,f){if(null==c)Gn(n)?n.removeAttribute(t,s,e):t.removeAttribute(s);else{const v=null==f?ot(c):f(c,i||"",s);Gn(n)?n.setAttribute(t,s,v,e):e?t.setAttributeNS(e,s,v):t.setAttribute(s,v)}}(t[11],f,c,n.value,e,i,s)}function La(n,t,e,i,s,c){const f=c[t];if(null!==f){const v=i.setInput;for(let C=0;C<f.length;){const S=f[C++],I=f[C++],L=f[C++];null!==v?i.setInput(e,L,S,I):e[I]=L}}}function Vg(n,t){let e=null,i=0;for(;i<t.length;){const s=t[i];if(0!==s)if(5!==s){if("number"==typeof s)break;n.hasOwnProperty(s)&&(null===e&&(e=[]),e.push(s,n[s],t[i+1])),i+=2}else i+=2;else i+=4}return e}function wo(n,t,e,i){return new Array(n,!0,!1,t,null,0,i,e,null,null)}function xv(n,t){const e=nr(t,n);if(ld(e)){const i=e[1];80&e[2]?Cu(i,e,i.template,e[8]):e[5]>0&&Ad(e)}}function Ad(n){for(let i=wd(n);null!==i;i=nc(i))for(let s=10;s<i.length;s++){const c=i[s];if(1024&c[2]){const f=c[1];Cu(f,c,f.template,c[8])}else c[5]>0&&Ad(c)}const e=n[1].components;if(null!==e)for(let i=0;i<e.length;i++){const s=nr(e[i],n);ld(s)&&s[5]>0&&Ad(s)}}function bv(n,t){const e=nr(t,n),i=e[1];(function wv(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])})(i,e),wu(i,e,e[8])}function zp(n,t){return n[13]?n[14][4]=t:n[13]=t,n[14]=t,t}function Vp(n){for(;n;){n[2]|=64;const t=Ai(n);if(et(n)&&!t)return n;n=t}return null}function jp(n,t,e){const i=t[10];i.begin&&i.begin();try{Cu(n,t,n.template,e)}catch(s){throw hf(t,s),s}finally{i.end&&i.end()}}function jg(n){!function uf(n){for(let t=0;t<n.components.length;t++){const e=n.components[t],i=tg(e),s=i[1];uv(s,i,s.template,e)}}(n[8])}function Ug(n,t,e){Vo(0),t(n,e)}const df=(()=>Promise.resolve(null))();function Td(n){return n[7]||(n[7]=[])}function Id(n){return n.cleanup||(n.cleanup=[])}function kd(n,t,e){return(null===n||Ur(n))&&(e=function Jf(n){for(;Array.isArray(n);){if("object"==typeof n[1])return n;n=n[0]}return null}(e[t.index])),e[11]}function hf(n,t){const e=n[9],i=e?e.get(Ys,null):null;i&&i.handleError(t)}function Cv(n,t,e,i,s){for(let c=0;c<e.length;){const f=e[c++],v=e[c++],C=t[f],S=n.data[f];null!==S.setInput?S.setInput(C,s,i,v):C[v]=s}}function yl(n,t,e){const i=wa(t,n);!function ky(n,t,e){Gn(n)?n.setValue(t,e):t.textContent=e}(n[11],i,e)}function vl(n,t,e){let i=e?n.styles:null,s=e?n.classes:null,c=0;if(null!==t)for(let f=0;f<t.length;f++){const v=t[f];"number"==typeof v?c=v:1==c?s=Pr(s,v):2==c&&(i=Pr(i,v+": "+t[++f]+";"))}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=s:n.classesWithoutHost=s}const Gg=new dt("INJECTOR",-1);class $g{get(t,e=kh){if(e===kh){const i=new Error(`NullInjectorError: No provider for ${Wt(t)}!`);throw i.name="NullInjectorError",i}return e}}const Hg=new dt("Set Injector scope."),Fd={},a={};let r;function l(){return void 0===r&&(r=new $g),r}function u(n,t=null,e=null,i){const s=h(n,t,e,i);return s._resolveInjectorDefTypes(),s}function h(n,t=null,e=null,i){return new g(n,e,t||l(),i)}class g{constructor(t,e,i,s=null){this.parent=i,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const c=[];e&&$o(e,v=>this.processProvider(v,t,e)),$o([t],v=>this.processInjectorType(v,[],c)),this.records.set(Gg,T(void 0,this));const f=this.records.get(Hg);this.scope=null!=f?f.value:null,this.source=s||("object"==typeof t?null:Wt(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,e=kh,i=Gt.Default){this.assertNotDestroyed();const s=ry(this),c=ws(void 0);try{if(!(i&Gt.SkipSelf)){let v=this.records.get(t);if(void 0===v){const C=function le(n){return"function"==typeof n||"object"==typeof n&&n instanceof dt}(t)&&nh(t);v=C&&this.injectableDefInScope(C)?T(y(t),Fd):null,this.records.set(t,v)}if(null!=v)return this.hydrate(t,v)}return(i&Gt.Self?l():this.parent).get(t,e=i&Gt.Optional&&e===kh?null:e)}catch(f){if("NullInjectorError"===f.name){if((f[Aa]=f[Aa]||[]).unshift(Wt(t)),s)throw f;return function D0(n,t,e,i){const s=n[Aa];throw t[Vm]&&s.unshift(t[Vm]),n.message=function gd(n,t,e,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.substr(2):n;let s=Wt(t);if(Array.isArray(t))s=t.map(Wt).join(" -> ");else if("object"==typeof t){let c=[];for(let f in t)if(t.hasOwnProperty(f)){let v=t[f];c.push(f+":"+("string"==typeof v?JSON.stringify(v):Wt(v)))}s=`{${c.join(", ")}}`}return`${e}${i?"("+i+")":""}[${s}]: ${n.replace(cp,"\n  ")}`}("\n"+n.message,s,e,i),n.ngTokenPath=s,n[Aa]=null,n}(f,t,"R3InjectorError",this.source)}throw f}finally{ws(c),ry(s)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((i,s)=>t.push(Wt(s))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new dn(205,"")}processInjectorType(t,e,i){if(!(t=Ut(t)))return!1;let s=jf(t);const c=null==s&&t.ngModule||void 0,f=void 0===c?t:c,v=-1!==i.indexOf(f);if(void 0!==c&&(s=jf(c)),null==s)return!1;if(null!=s.imports&&!v){let I;i.push(f);try{$o(s.imports,L=>{this.processInjectorType(L,e,i)&&(void 0===I&&(I=[]),I.push(L))})}finally{}if(void 0!==I)for(let L=0;L<I.length;L++){const{ngModule:q,providers:X}=I[L];$o(X,ue=>this.processProvider(ue,q,X||Bn))}}this.injectorDefTypes.add(f);const C=Oo(f)||(()=>new f);this.records.set(f,T(C,Fd));const S=s.providers;if(null!=S&&!v){const I=t;$o(S,L=>this.processProvider(L,I,S))}return void 0!==c&&void 0!==t.providers}processProvider(t,e,i){let s=V(t=Ut(t))?t:Ut(t&&t.provide);const c=function E(n,t,e){return k(n)?T(void 0,n.useValue):T(M(n),Fd)}(t);if(V(t)||!0!==t.multi)this.records.get(s);else{let f=this.records.get(s);f||(f=T(void 0,Fd,!0),f.factory=()=>dp(f.multi),this.records.set(s,f)),s=t,f.multi.push(t)}this.records.set(s,c)}hydrate(t,e){return e.value===Fd&&(e.value=a,e.value=e.factory()),"object"==typeof e.value&&e.value&&function Q(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this.onDestroy.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=Ut(t.providedIn);return"string"==typeof e?"any"===e||e===this.scope:this.injectorDefTypes.has(e)}}function y(n){const t=nh(n),e=null!==t?t.factory:Oo(n);if(null!==e)return e;if(n instanceof dt)throw new dn(204,"");if(n instanceof Function)return function x(n){const t=n.length;if(t>0)throw Ah(t,"?"),new dn(204,"");const e=function Am(n){const t=n&&(n[Ja]||n[rh]);if(t){const e=function Vf(n){if(n.hasOwnProperty("name"))return n.name;const t=(""+n).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new dn(204,"")}function M(n,t,e){let i;if(V(n)){const s=Ut(n);return Oo(s)||y(s)}if(k(n))i=()=>Ut(n.useValue);else if(function B(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...dp(n.deps||[]));else if(function R(n){return!(!n||!n.useExisting)}(n))i=()=>Ce(Ut(n.useExisting));else{const s=Ut(n&&(n.useClass||n.provide));if(!function W(n){return!!n.deps}(n))return Oo(s)||y(s);i=()=>new s(...dp(n.deps))}return i}function T(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function k(n){return null!==n&&"object"==typeof n&&E0 in n}function V(n){return"function"==typeof n}let ce=(()=>{class n{static create(e,i){var s;if(Array.isArray(e))return u({name:""},i,e,"");{const c=null!==(s=e.name)&&void 0!==s?s:"";return u({name:c},e.parent,e.providers,c)}}}return n.THROW_IF_NOT_FOUND=kh,n.NULL=new $g,n.\u0275prov=Ke({token:n,providedIn:"any",factory:()=>Ce(Gg)}),n.__NG_ELEMENT_ID__=-1,n})();function pi(n,t){G(tg(n)[1],mi())}function qe(n){let t=function wi(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const i=[n];for(;t;){let s;if(Ur(n))s=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new dn(903,"");s=t.\u0275dir}if(s){if(e){i.push(s);const f=n;f.inputs=Mr(n.inputs),f.declaredInputs=Mr(n.declaredInputs),f.outputs=Mr(n.outputs);const v=s.hostBindings;v&&Ps(n,v);const C=s.viewQuery,S=s.contentQueries;if(C&&Vn(n,C),S&&Xr(n,S),ga(n.inputs,s.inputs),ga(n.declaredInputs,s.declaredInputs),ga(n.outputs,s.outputs),Ur(s)&&s.data.animation){const I=n.data;I.animation=(I.animation||[]).concat(s.data.animation)}}const c=s.features;if(c)for(let f=0;f<c.length;f++){const v=c[f];v&&v.ngInherit&&v(n),v===qe&&(e=!1)}}t=Object.getPrototypeOf(t)}!function Rs(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){const s=n[i];s.hostVars=t+=s.hostVars,s.hostAttrs=rt(s.hostAttrs,e=rt(e,s.hostAttrs))}}(i)}function Mr(n){return n===tl?{}:n===Bn?[]:n}function Vn(n,t){const e=n.viewQuery;n.viewQuery=e?(i,s)=>{t(i,s),e(i,s)}:t}function Xr(n,t){const e=n.contentQueries;n.contentQueries=e?(i,s,c)=>{t(i,s,c),e(i,s,c)}:t}function Ps(n,t){const e=n.hostBindings;n.hostBindings=e?(i,s)=>{t(i,s),e(i,s)}:t}let Fn=null;function Zi(){if(!Fn){const n=Ln.Symbol;if(n&&n.iterator)Fn=n.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const i=t[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(Fn=i)}}}return Fn}function ci(n){return!!Ti(n)&&(Array.isArray(n)||!(n instanceof Map)&&Zi()in n)}function Ti(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function Xi(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function rr(n,t,e,i){const s=$e();return Xi(s,Wl(),t)&&(bn(),bo(w(),s,n,t,e,i)),rr}function mc(n,t,e,i,s,c,f,v){const C=$e(),S=bn(),I=n+20,L=S.firstCreatePass?function JF(n,t,e,i,s,c,f,v,C){const S=t.consts,I=xu(t,n,4,f||null,Ws(S,v));Lg(t,e,I,Ws(S,C)),G(t,I);const L=I.tViews=Eu(2,I,i,s,c,t.directiveRegistry,t.pipeRegistry,null,t.schemas,S);return null!==t.queries&&(t.queries.template(t,I),L.queries=t.queries.embeddedTView(I)),I}(I,S,C,t,e,i,s,c,f):S.data[I];xr(L,!1);const q=C[11].createComment("");Jh(S,C,q,L),qr(q,C),zp(C,C[I]=wo(q,C,q,L)),rl(L)&&Ag(S,C,L),null!=f&&Tg(C,L,v)}function Wg(n){return function Bo(n,t){return n[t]}(function dd(){return zt.lFrame.contextLView}(),20+n)}function se(n,t=Gt.Default){const e=$e();return null===e?Ce(n,t):_n(mi(),e,Ut(n),t)}function Mv(){throw new Error("invalid")}function ps(n,t,e){const i=$e();return Xi(i,Wl(),t)&&qi(bn(),w(),i,n,t,i[11],e,!1),ps}function Cb(n,t,e,i,s){const f=s?"class":"style";Cv(n,e,t.inputs[f],f,i)}function Jt(n,t,e,i){const s=$e(),c=bn(),f=20+n,v=s[11],C=s[f]=bp(v,t,function O(){return zt.lFrame.currentNamespace}()),S=c.firstCreatePass?function xR(n,t,e,i,s,c,f){const v=t.consts,S=xu(t,n,2,s,Ws(v,c));return Lg(t,e,S,Ws(v,f)),null!==S.attrs&&vl(S,S.attrs,!1),null!==S.mergedAttrs&&vl(S,S.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,S),S}(f,c,s,0,t,e,i):c.data[f];xr(S,!0);const I=S.mergedAttrs;null!==I&&ye(v,C,I);const L=S.classes;null!==L&&tf(v,C,L);const q=S.styles;null!==q&&pg(v,C,q),64!=(64&S.flags)&&Jh(c,s,C,S),0===function ep(){return zt.lFrame.elementDepthCount}()&&qr(C,s),function gh(){zt.lFrame.elementDepthCount++}(),rl(S)&&(Ag(c,s,S),function Sg(n,t,e){if(Kc(t)){const s=t.directiveEnd;for(let c=t.directiveStart;c<s;c++){const f=n.data[c];f.contentQueries&&f.contentQueries(1,e[c],c)}}}(c,S,s)),null!==i&&Tg(s,S)}function en(){let n=mi();ud()?ql():(n=n.parent,xr(n,!1));const t=n;!function tp(){zt.lFrame.elementDepthCount--}();const e=bn();e.firstCreatePass&&(G(e,n),Kc(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function Me(n){return 0!=(16&n.flags)}(t)&&Cb(e,t,$e(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Fe(n){return 0!=(32&n.flags)}(t)&&Cb(e,t,$e(),t.stylesWithoutHost,!1)}function pr(n,t,e,i){Jt(n,t,e,i),en()}function Zg(){return $e()}function Xg(n){return!!n&&"function"==typeof n.then}const Eb=function mE(n){return!!n&&"function"==typeof n.subscribe};function Ki(n,t,e,i){const s=$e(),c=bn(),f=mi();return gE(c,s,s[11],f,n,t,!!e,i),Ki}function Sv(n,t){const e=mi(),i=$e(),s=bn();return gE(s,i,kd(br(s.data),e,i),e,n,t,!1),Sv}function gE(n,t,e,i,s,c,f,v){const C=rl(i),I=n.firstCreatePass&&Id(n),L=t[8],q=Td(t);let X=!0;if(3&i.type||v){const ke=tr(i,t),Ie=v?v(ke):ke,Ee=q.length,it=v?bt=>v(We(bt[i.index])):i.index;if(Gn(e)){let bt=null;if(!v&&C&&(bt=function CR(n,t,e,i){const s=n.cleanup;if(null!=s)for(let c=0;c<s.length-1;c+=2){const f=s[c];if(f===e&&s[c+1]===i){const v=t[7],C=s[c+2];return v.length>C?v[C]:null}"string"==typeof f&&(c+=2)}return null}(n,t,s,i.index)),null!==bt)(bt.__ngLastListenerFn__||bt).__ngNextListenerFn__=c,bt.__ngLastListenerFn__=c,X=!1;else{c=Db(i,t,L,c,!1);const ln=e.listen(Ie,s,c);q.push(c,ln),I&&I.push(s,it,Ee,Ee+1)}}else c=Db(i,t,L,c,!0),Ie.addEventListener(s,c,f),q.push(c),I&&I.push(s,it,Ee,f)}else c=Db(i,t,L,c,!1);const ue=i.outputs;let xe;if(X&&null!==ue&&(xe=ue[s])){const ke=xe.length;if(ke)for(let Ie=0;Ie<ke;Ie+=2){const Fi=t[xe[Ie]][xe[Ie+1]].subscribe(c),Ui=q.length;q.push(c,Fi),I&&I.push(s,i.index,Ui,-(Ui+1))}}}function _E(n,t,e,i){try{return!1!==e(i)}catch(s){return hf(n,s),!1}}function Db(n,t,e,i,s){return function c(f){if(f===Function)return i;const v=2&n.flags?nr(n.index,t):t;0==(32&t[2])&&Vp(v);let C=_E(t,0,i,f),S=c.__ngNextListenerFn__;for(;S;)C=_E(t,0,S,f)&&C,S=S.__ngNextListenerFn__;return s&&!1===C&&(f.preventDefault(),f.returnValue=!1),C}}function Pd(n=1){return function o(n){return(zt.lFrame.contextLView=function d(n,t){for(;n>0;)t=t[15],n--;return t}(n,zt.lFrame.contextLView))[8]}(n)}function ER(n,t){let e=null;const i=function ib(n){const t=n.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(n);for(let s=0;s<t.length;s++){const c=t[s];if("*"!==c){if(null===i?Yy(n,c,!0):nf(i,c))return s}else e=s}return e}function Os(n){const t=$e()[16][6];if(!t.projection){const i=t.projection=Ah(n?n.length:1,null),s=i.slice();let c=t.child;for(;null!==c;){const f=n?ER(c,n):0;null!==f&&(s[f]?s[f].projectionNext=c:i[f]=c,s[f]=c),c=c.next}}}function _i(n,t=0,e){const i=$e(),s=bn(),c=xu(s,20+n,16,null,e||null);null===c.projection&&(c.projection=t),ql(),64!=(64&c.flags)&&function $y(n,t,e){fg(t[11],0,t,e,Ly(n,e,t),jy(e.parent||t[6],e,t))}(s,i,c)}function SE(n,t,e,i,s){const c=n[e+1],f=null===t;let v=i?Zo(c):gl(c),C=!1;for(;0!==v&&(!1===C||f);){const I=n[v+1];SR(n[v],t)&&(C=!0,n[v+1]=i?vg(I):yg(I)),v=i?Zo(I):gl(I)}C&&(n[e+1]=i?yg(c):vg(c))}function SR(n,t){return null===n||null==t||(Array.isArray(n)?n[1]:n)===t||!(!Array.isArray(n)||"string"!=typeof t)&&Ma(n,t)>=0}function Kg(n,t,e){return xl(n,t,e,!1),Kg}function sr(n,t){return xl(n,t,null,!0),sr}function xl(n,t,e,i){const s=$e(),c=bn(),f=function zo(n){const t=zt.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}(2);c.firstUpdatePass&&function OE(n,t,e,i){const s=n.data;if(null===s[e+1]){const c=s[_()],f=function PE(n,t){return t>=n.expandoStartIndex}(n,e);(function zE(n,t){return 0!=(n.flags&(t?16:32))})(c,i)&&null===t&&!f&&(t=!1),t=function LR(n,t,e,i){const s=br(n);let c=i?t.residualClasses:t.residualStyles;if(null===s)0===(i?t.classBindings:t.styleBindings)&&(e=Yg(e=Sb(null,n,t,e,i),t.attrs,i),c=null);else{const f=t.directiveStylingLast;if(-1===f||n[f]!==s)if(e=Sb(s,n,t,e,i),null===c){let C=function BR(n,t,e){const i=e?t.classBindings:t.styleBindings;if(0!==gl(i))return n[Zo(i)]}(n,t,i);void 0!==C&&Array.isArray(C)&&(C=Sb(null,n,t,C[1],i),C=Yg(C,t.attrs,i),function NR(n,t,e,i){n[Zo(e?t.classBindings:t.styleBindings)]=i}(n,t,i,C))}else c=function zR(n,t,e){let i;const s=t.directiveEnd;for(let c=1+t.directiveStylingLast;c<s;c++)i=Yg(i,n[c].hostAttrs,e);return Yg(i,t.attrs,e)}(n,t,i)}return void 0!==c&&(i?t.residualClasses=c:t.residualStyles=c),e}(s,c,t,i),function DR(n,t,e,i,s,c){let f=c?t.classBindings:t.styleBindings,v=Zo(f),C=gl(f);n[i]=e;let I,S=!1;if(Array.isArray(e)){const L=e;I=L[1],(null===I||Ma(L,I)>0)&&(S=!0)}else I=e;if(s)if(0!==C){const q=Zo(n[v+1]);n[i+1]=yu(q,v),0!==q&&(n[q+1]=rc(n[q+1],i)),n[v+1]=function rb(n,t){return 131071&n|t<<17}(n[v+1],i)}else n[i+1]=yu(v,0),0!==v&&(n[v+1]=rc(n[v+1],i)),v=i;else n[i+1]=yu(C,0),0===v?v=i:n[C+1]=rc(n[C+1],i),C=i;S&&(n[i+1]=yg(n[i+1])),SE(n,I,i,!0),SE(n,I,i,!1),function MR(n,t,e,i,s){const c=s?n.residualClasses:n.residualStyles;null!=c&&"string"==typeof t&&Ma(c,t)>=0&&(e[i+1]=vg(e[i+1]))}(t,I,n,i,c),f=yu(v,C),c?t.classBindings=f:t.styleBindings=f}(s,c,t,e,f,i)}}(c,n,f,i),t!==Xt&&Xi(s,f,t)&&function BE(n,t,e,i,s,c,f,v){if(!(3&t.type))return;const C=n.data,S=C[v+1];Av(function Sp(n){return 1==(1&n)}(S)?NE(C,t,e,s,gl(S),f):void 0)||(Av(c)||function tv(n){return 2==(2&n)}(S)&&(c=NE(C,null,e,s,v,f)),function Hy(n,t,e,i,s){const c=Gn(n);if(t)s?c?n.addClass(e,i):e.classList.add(i):c?n.removeClass(e,i):e.classList.remove(i);else{let f=-1===i.indexOf("-")?void 0:Qs.DashCase;if(null==s)c?n.removeStyle(e,i,f):e.style.removeProperty(i);else{const v="string"==typeof s&&s.endsWith("!important");v&&(s=s.slice(0,-10),f|=Qs.Important),c?n.setStyle(e,i,s,f):e.style.setProperty(i,s,v?"important":"")}}}(i,f,wa(_(),e),s,c))}(c,c.data[_()],s,s[11],n,s[f+1]=function UR(n,t){return null==n||("string"==typeof t?n+=t:"object"==typeof n&&(n=Wt(Is(n)))),n}(t,e),i,f)}function Sb(n,t,e,i,s){let c=null;const f=e.directiveEnd;let v=e.directiveStylingLast;for(-1===v?v=e.directiveStart:v++;v<f&&(c=t[v],i=Yg(i,c.hostAttrs,s),c!==n);)v++;return null!==n&&(e.directiveStylingLast=v),i}function Yg(n,t,e){const i=e?1:2;let s=-1;if(null!==t)for(let c=0;c<t.length;c++){const f=t[c];"number"==typeof f?s=f:s===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),As(n,f,!!e||t[++c]))}return void 0===n?null:n}function NE(n,t,e,i,s,c){const f=null===t;let v;for(;s>0;){const C=n[s],S=Array.isArray(C),I=S?C[1]:C,L=null===I;let q=e[s+1];q===Xt&&(q=L?Bn:void 0);let X=L?Th(q,i):I===i?q:void 0;if(S&&!Av(X)&&(X=Th(C,i)),Av(X)&&(v=X,f))return v;const ue=n[s+1];s=f?Zo(ue):gl(ue)}if(null!==t){let C=c?t.residualClasses:t.residualStyles;null!=C&&(v=Th(C,i))}return v}function Av(n){return void 0!==n}function Qo(n,t=""){const e=$e(),i=bn(),s=n+20,c=i.firstCreatePass?xu(i,s,1,t,null):i.data[s],f=e[s]=function ug(n,t){return Gn(n)?n.createText(t):n.createTextNode(t)}(e[11],t);Jh(i,e,f,c),xr(c,!1)}function Tv(n){return Iv("",n,""),Tv}function Iv(n,t,e){const i=$e(),s=function Su(n,t,e,i){return Xi(n,Wl(),e)?t+ot(e)+i:Xt}(i,n,t,e);return s!==Xt&&yl(i,_(),s),Iv}function Ab(n,t,e){const i=$e();return Xi(i,Wl(),t)&&qi(bn(),w(),i,n,t,i[11],e,!0),Ab}function kv(n,t,e){const i=$e();if(Xi(i,Wl(),t)){const c=bn(),f=w();qi(c,f,i,n,t,kd(br(c.data),f,i),e,!0)}return kv}const pf=void 0;var c2=["en",[["a","p"],["AM","PM"],pf],[["AM","PM"],pf,pf],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],pf,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],pf,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",pf,"{1} 'at' {0}",pf],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function l2(n){const e=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===i?1:5}];let Wp={};function rD(n){return n in Wp||(Wp[n]=Ln.ng&&Ln.ng.common&&Ln.ng.common.locales&&Ln.ng.common.locales[n]),Wp[n]}var mt=(()=>((mt=mt||{})[mt.LocaleId=0]="LocaleId",mt[mt.DayPeriodsFormat=1]="DayPeriodsFormat",mt[mt.DayPeriodsStandalone=2]="DayPeriodsStandalone",mt[mt.DaysFormat=3]="DaysFormat",mt[mt.DaysStandalone=4]="DaysStandalone",mt[mt.MonthsFormat=5]="MonthsFormat",mt[mt.MonthsStandalone=6]="MonthsStandalone",mt[mt.Eras=7]="Eras",mt[mt.FirstDayOfWeek=8]="FirstDayOfWeek",mt[mt.WeekendRange=9]="WeekendRange",mt[mt.DateFormat=10]="DateFormat",mt[mt.TimeFormat=11]="TimeFormat",mt[mt.DateTimeFormat=12]="DateTimeFormat",mt[mt.NumberSymbols=13]="NumberSymbols",mt[mt.NumberFormats=14]="NumberFormats",mt[mt.CurrencyCode=15]="CurrencyCode",mt[mt.CurrencySymbol=16]="CurrencySymbol",mt[mt.CurrencyName=17]="CurrencyName",mt[mt.Currencies=18]="Currencies",mt[mt.Directionality=19]="Directionality",mt[mt.PluralCase=20]="PluralCase",mt[mt.ExtraData=21]="ExtraData",mt))();const Fv="en-US";let sD=Fv;function kb(n,t,e,i,s){if(n=Ut(n),Array.isArray(n))for(let c=0;c<n.length;c++)kb(n[c],t,e,i,s);else{const c=bn(),f=$e();let v=V(n)?n:Ut(n.provide),C=M(n);const S=mi(),I=1048575&S.providerIndexes,L=S.directiveStart,q=S.providerIndexes>>20;if(V(n)||!n.multi){const X=new ne(C,s,se),ue=Rb(v,t,s?I:I+q,L);-1===ue?(Zs(Si(S,f),c,v),Fb(c,n,t.length),t.push(v),S.directiveStart++,S.directiveEnd++,s&&(S.providerIndexes+=1048576),e.push(X),f.push(X)):(e[ue]=X,f[ue]=X)}else{const X=Rb(v,t,I+q,L),ue=Rb(v,t,I,I+q),xe=X>=0&&e[X],ke=ue>=0&&e[ue];if(s&&!ke||!s&&!xe){Zs(Si(S,f),c,v);const Ie=function lP(n,t,e,i,s){const c=new ne(n,e,se);return c.multi=[],c.index=t,c.componentProviders=0,TD(c,s,i&&!e),c}(s?aP:oP,e.length,s,i,C);!s&&ke&&(e[ue].providerFactory=Ie),Fb(c,n,t.length,0),t.push(v),S.directiveStart++,S.directiveEnd++,s&&(S.providerIndexes+=1048576),e.push(Ie),f.push(Ie)}else Fb(c,n,X>-1?X:ue,TD(e[s?ue:X],C,!s&&i));!s&&i&&ke&&e[ue].componentProviders++}}}function Fb(n,t,e,i){const s=V(t),c=function $(n){return!!n.useClass}(t);if(s||c){const C=(c?Ut(t.useClass):t).prototype.ngOnDestroy;if(C){const S=n.destroyHooks||(n.destroyHooks=[]);if(!s&&t.multi){const I=S.indexOf(e);-1===I?S.push(e,[i,C]):S[I+1].push(i,C)}else S.push(e,C)}}}function TD(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function Rb(n,t,e,i){for(let s=e;s<i;s++)if(t[s]===n)return s;return-1}function oP(n,t,e,i){return Pb(this.multi,[])}function aP(n,t,e,i){const s=this.multi;let c;if(this.providerFactory){const f=this.providerFactory.componentProviders,v=Go(e,e[1],this.providerFactory.index,i);c=v.slice(0,f),Pb(s,c);for(let C=f;C<v.length;C++)c.push(v[C])}else c=[],Pb(s,c);return c}function Pb(n,t){for(let e=0;e<n.length;e++)t.push((0,n[e])());return t}function ei(n,t=[]){return e=>{e.providersResolver=(i,s)=>function sP(n,t,e){const i=bn();if(i.firstCreatePass){const s=Ur(n);kb(e,i.data,i.blueprint,s,!0),kb(t,i.data,i.blueprint,s,!1)}}(i,s?s(n):n,t)}}class ID{}class dP{resolveComponentFactory(t){throw function uP(n){const t=Error(`No component factory found for ${Wt(n)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=n,t}(t)}}let Od=(()=>{class n{}return n.NULL=new dP,n})();function hP(){return Xp(mi(),$e())}function Xp(n,t){return new Pt(tr(n,t))}let Pt=(()=>{class n{constructor(e){this.nativeElement=e}}return n.__NG_ELEMENT_ID__=hP,n})();function fP(n){return n instanceof Pt?n.nativeElement:n}class n_{}let wl=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function mP(){const n=$e(),e=nr(mi().index,n);return function pP(n){return n[11]}(jr(e)?e:n)}(),n})(),gP=(()=>{class n{}return n.\u0275prov=Ke({token:n,providedIn:"root",factory:()=>null}),n})();class Ld{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const _P=new Ld("13.1.3"),Ob={};function Bv(n,t,e,i,s=!1){for(;null!==e;){const c=t[e.index];if(null!==c&&i.push(We(c)),rs(c))for(let v=10;v<c.length;v++){const C=c[v],S=C[1].firstChild;null!==S&&Bv(C[1],C,S,i)}const f=e.type;if(8&f)Bv(n,t,e.child,i);else if(32&f){const v=cg(e,t);let C;for(;C=v();)i.push(C)}else if(16&f){const v=Cd(t,e);if(Array.isArray(v))i.push(...v);else{const C=Ai(t[16]);Bv(C[1],C,v,i,!0)}}e=s?e.projectionNext:e.next}return i}class i_{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return Bv(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(rs(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(wp(t,i),Ss(e,i))}this._attachedToViewContainer=!1}Oy(this._lView[1],this._lView)}onDestroy(t){kg(this._lView[1],this._lView,null,t)}markForCheck(){Vp(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){jp(this._lView[1],this._lView,this.context)}checkNoChanges(){!function gb(n,t,e){iu(!0);try{jp(n,t,e)}finally{iu(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new dn(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function dg(n,t){ef(n,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new dn(902,"");this._appRef=t}}class yP extends i_{constructor(t){super(t),this._view=t}detectChanges(){jg(this._view)}checkNoChanges(){!function cc(n){iu(!0);try{jg(n)}finally{iu(!1)}}(this._view)}get context(){return null}}class FD extends Od{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=Oi(t);return new Lb(e,this.ngModule)}}function RD(n){const t=[];for(let e in n)n.hasOwnProperty(e)&&t.push({propName:n[e],templateName:e});return t}const xP=new dt("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Sy});class Lb extends ID{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function gg(n){return n.map(ev).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return RD(this.componentDef.inputs)}get outputs(){return RD(this.componentDef.outputs)}create(t,e,i,s){const c=(s=s||this.ngModule)?function bP(n,t){return{get:(e,i,s)=>{const c=n.get(e,Ob,s);return c!==Ob||i===Ob?c:t.get(e,i,s)}}}(t,s.injector):t,f=c.get(n_,qs),v=c.get(gP,null),C=f.createRenderer(null,this.componentDef),S=this.componentDef.selectors[0][0]||"div",I=i?function oc(n,t,e){if(Gn(n))return n.selectRootElement(t,e===ct.ShadowDom);let i="string"==typeof t?n.querySelector(t):t;return i.textContent="",i}(C,i,this.componentDef.encapsulation):bp(f.createRenderer(null,this.componentDef),S,function vP(n){const t=n.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(S)),L=this.componentDef.onPush?576:528,q=function In(n,t){return{components:[],scheduler:n||Sy,clean:df,playerHandler:t||null,flags:0}}(),X=Eu(0,null,null,1,0,null,null,null,null,null),ue=vu(null,X,q,L,null,null,f,C,v,c);let xe,ke;jo(ue);try{const Ie=function yn(n,t,e,i,s,c){const f=e[1];e[20]=n;const C=xu(f,20,2,"#host",null),S=C.mergedAttrs=t.hostAttrs;null!==S&&(vl(C,S,!0),null!==n&&(ye(s,n,S),null!==C.classes&&tf(s,n,C.classes),null!==C.styles&&pg(s,n,C.styles)));const I=i.createRenderer(n,t),L=vu(e,Ig(t),null,t.onPush?64:16,e[20],C,i,I,c||null,null);return f.firstCreatePass&&(Zs(Si(C,e),f,t.type),zg(f,C),lf(C,e.length,1)),zp(e,L),e[20]=L}(I,this.componentDef,ue,f,C);if(I)if(i)ye(C,I,["ng-version",_P.full]);else{const{attrs:Ee,classes:it}=function Dd(n){const t=[],e=[];let i=1,s=2;for(;i<n.length;){let c=n[i];if("string"==typeof c)2===s?""!==c&&t.push(c,n[++i]):8===s&&e.push(c);else{if(!vo(s))break;s=c}i++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);Ee&&ye(C,I,Ee),it&&it.length>0&&tf(C,I,it.join(" "))}if(ke=od(X,20),void 0!==e){const Ee=ke.projection=[];for(let it=0;it<this.ngContentSelectors.length;it++){const bt=e[it];Ee.push(null!=bt?Array.from(bt):null)}}xe=function nn(n,t,e,i,s){const c=e[1],f=function Og(n,t,e){const i=mi();n.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),_v(n,i,t,bu(n,t,1,null),e));const s=Go(t,n,i.directiveStart,i);qr(s,t);const c=tr(i,t);return c&&qr(c,t),s}(c,e,t);if(i.components.push(f),n[8]=f,s&&s.forEach(C=>C(f,t)),t.contentQueries){const C=mi();t.contentQueries(1,f,C.directiveStart)}const v=mi();return!c.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(b(v.index),Bg(e[1],v,0,v.directiveStart,v.directiveEnd,t),Ng(t,f)),f}(Ie,this.componentDef,ue,q,[pi]),wu(X,ue,null)}finally{m()}return new CP(this.componentType,xe,Xp(ke,ue),ue,ke)}}class CP extends class cP{}{constructor(t,e,i,s,c){super(),this.location=i,this._rootLView=s,this._tNode=c,this.instance=e,this.hostView=this.changeDetectorRef=new yP(s),this.componentType=t}get injector(){return new Ea(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class Tu{}class PD{}const Kp=new Map;class BD extends Tu{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new FD(this);const i=ns(t);this._bootstrapComponents=ka(i.bootstrap),this._r3Injector=h(t,e,[{provide:Tu,useValue:this},{provide:Od,useValue:this.componentFactoryResolver}],Wt(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,e=ce.THROW_IF_NOT_FOUND,i=Gt.Default){return t===ce||t===Tu||t===Gg?this:this._r3Injector.get(t,e,i)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class Bb extends PD{constructor(t){super(),this.moduleType=t,null!==ns(t)&&function DP(n){const t=new Set;!function e(i){const s=ns(i,!0),c=s.id;null!==c&&(function OD(n,t,e){if(t&&t!==e)throw new Error(`Duplicate module registered for ${n} - ${Wt(t)} vs ${Wt(t.name)}`)}(c,Kp.get(c),i),Kp.set(c,i));const f=ka(s.imports);for(const v of f)t.has(v)||(t.add(v),e(v))}(n)}(t)}create(t){return new BD(this.moduleType,t)}}function Nb(n,t,e,i){return function ND(n,t,e,i,s,c){const f=t+e;return Xi(n,f,s)?function Ni(n,t,e){return n[t]=e}(n,f+1,c?i.call(c,s):i(s)):function r_(n,t){const e=n[t];return e===Xt?void 0:e}(n,f+1)}($e(),function Hi(){const n=zt.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}(),n,t,e,i)}function zb(n){return t=>{setTimeout(n,void 0,t)}}const ti=class UP extends Nt{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,i){var s,c,f;let v=t,C=e||(()=>null),S=i;if(t&&"object"==typeof t){const L=t;v=null===(s=L.next)||void 0===s?void 0:s.bind(L),C=null===(c=L.error)||void 0===c?void 0:c.bind(L),S=null===(f=L.complete)||void 0===f?void 0:f.bind(L)}this.__isAsync&&(C=zb(C),v&&(v=zb(v)),S&&(S=zb(S)));const I=super.subscribe({next:v,error:C,complete:S});return t instanceof Wn&&t.add(I),I}};function GP(){return this._results[Zi()]()}class Yp{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Zi(),i=Yp.prototype;i[e]||(i[e]=GP)}get changes(){return this._changes||(this._changes=new ti)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const i=this;i.dirty=!1;const s=mo(t);(this._changesDetected=!function w0(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let s=n[i],c=t[i];if(e&&(s=e(s),c=e(c)),c!==s)return!1}return!0}(i._results,s,e))&&(i._results=s,i.length=s.length,i.last=s[this.length-1],i.first=s[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let yc=(()=>{class n{}return n.__NG_ELEMENT_ID__=qP,n})();const $P=yc,HP=class extends $P{constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(t){const e=this._declarationTContainer.tViews,i=vu(this._declarationLView,e,t,16,null,e.declTNode,null,null,null,null);i[17]=this._declarationLView[this._declarationTContainer.index];const c=this._declarationLView[19];return null!==c&&(i[19]=c.createEmbeddedView(e)),wu(e,i,t),new i_(i)}};function qP(){return Nv(mi(),$e())}function Nv(n,t){return 4&n.type?new HP(t,n,Xp(n,t)):null}let Ba=(()=>{class n{}return n.__NG_ELEMENT_ID__=WP,n})();function WP(){return HD(mi(),$e())}const ZP=Ba,GD=class extends ZP{constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return Xp(this._hostTNode,this._hostLView)}get injector(){return new Ea(this._hostTNode,this._hostLView)}get parentInjector(){const t=Ds(this._hostTNode,this._hostLView);if(st(t)){const e=nt(t,this._hostLView),i=ft(t);return new Ea(e[1].data[i+8],e)}return new Ea(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=$D(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,i){const s=t.createEmbeddedView(e||{});return this.insert(s,i),s}createComponent(t,e,i,s,c){const f=t&&!function Mh(n){return"function"==typeof n}(t);let v;if(f)v=e;else{const L=e||{};v=L.index,i=L.injector,s=L.projectableNodes,c=L.ngModuleRef}const C=f?t:new Lb(Oi(t)),S=i||this.parentInjector;if(!c&&null==C.ngModule&&S){const L=S.get(Tu,null);L&&(c=L)}const I=C.create(S,s,void 0,c);return this.insert(I.hostView,v),I}insert(t,e){const i=t._lView,s=i[1];if(function mh(n){return rs(n[3])}(i)){const I=this.indexOf(t);if(-1!==I)this.detach(I);else{const L=i[3],q=new GD(L,L[6],L[3]);q.detach(q.indexOf(t))}}const c=this._adjustIndex(e),f=this._lContainer;!function Py(n,t,e,i){const s=10+i,c=e.length;i>0&&(e[s-1][4]=t),i<c-10?(t[4]=e[s],Sh(e,10+i,t)):(e.push(t),t[4]=null),t[3]=e;const f=t[17];null!==f&&e!==f&&function pl(n,t){const e=n[9];t[16]!==t[3][3][16]&&(n[2]=!0),null===e?n[9]=[t]:e.push(t)}(f,t);const v=t[19];null!==v&&v.insertView(n),t[2]|=128}(s,i,f,c);const v=ic(c,f),C=i[11],S=ml(C,f[7]);return null!==S&&function Hn(n,t,e,i,s,c){i[0]=s,i[6]=t,ef(n,i,e,1,s,c)}(s,f[6],C,i,S,v),t.attachToViewContainerRef(),Sh(Vb(f),c,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=$D(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=wp(this._lContainer,e);i&&(Ss(Vb(this._lContainer),e),Oy(i[1],i))}detach(t){const e=this._adjustIndex(t,-1),i=wp(this._lContainer,e);return i&&null!=Ss(Vb(this._lContainer),e)?new i_(i):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function $D(n){return n[8]}function Vb(n){return n[8]||(n[8]=[])}function HD(n,t){let e;const i=t[n.index];if(rs(i))e=i;else{let s;if(8&n.type)s=We(i);else{const c=t[11];s=c.createComment("");const f=tr(n,t);_u(c,ml(c,f),s,function Vy(n,t){return Gn(n)?n.nextSibling(t):t.nextSibling}(c,f),!1)}t[n.index]=e=wo(i,t,s,n),zp(t,e)}return new GD(e,n,t)}class jb{constructor(t){this.queryList=t,this.matches=null}clone(){return new jb(this.queryList)}setDirty(){this.queryList.setDirty()}}class Ub{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,s=[];for(let c=0;c<i;c++){const f=e.getByIndex(c);s.push(this.queries[f.indexInDeclarationView].clone())}return new Ub(s)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==KD(t,e).matches&&this.queries[e].setDirty()}}class qD{constructor(t,e,i=null){this.predicate=t,this.flags=e,this.read=i}}class Gb{constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const s=null!==e?e.length:0,c=this.getByIndex(i).embeddedTView(t,s);c&&(c.indexInDeclarationView=i,null!==e?e.push(c):e=[c])}return null!==e?new Gb(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class $b{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new $b(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let s=0;s<i.length;s++){const c=i[s];this.matchTNodeWithReadOption(t,e,YP(e,c)),this.matchTNodeWithReadOption(t,e,Cr(e,t,c,!1,!1))}else i===yc?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,Cr(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const s=this.metadata.read;if(null!==s)if(s===Pt||s===Ba||s===yc&&4&e.type)this.addMatch(e.index,-2);else{const c=Cr(e,t,s,!1,!1);null!==c&&this.addMatch(e.index,c)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function YP(n,t){const e=n.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1];return null}function JP(n,t,e,i){return-1===e?function QP(n,t){return 11&n.type?Xp(n,t):4&n.type?Nv(n,t):null}(t,n):-2===e?function eO(n,t,e){return e===Pt?Xp(t,n):e===yc?Nv(t,n):e===Ba?HD(t,n):void 0}(n,t,i):Go(n,n[1],e,t)}function WD(n,t,e,i){const s=t[19].queries[i];if(null===s.matches){const c=n.data,f=e.matches,v=[];for(let C=0;C<f.length;C+=2){const S=f[C];v.push(S<0?null:JP(t,c[S],f[C+1],e.metadata.read))}s.matches=v}return s.matches}function Hb(n,t,e,i){const s=n.queries.getByIndex(e),c=s.matches;if(null!==c){const f=WD(n,t,s,e);for(let v=0;v<c.length;v+=2){const C=c[v];if(C>0)i.push(f[v/2]);else{const S=c[v+1],I=t[-C];for(let L=10;L<I.length;L++){const q=I[L];q[17]===q[3]&&Hb(q[1],q,S,i)}if(null!==I[9]){const L=I[9];for(let q=0;q<L.length;q++){const X=L[q];Hb(X[1],X,S,i)}}}}}return i}function or(n){const t=$e(),e=bn(),i=Xl();Vo(i+1);const s=KD(e,i);if(n.dirty&&ad(t)===(2==(2&s.metadata.flags))){if(null===s.matches)n.reset([]);else{const c=s.crossesNgTemplate?Hb(e,t,i,[]):WD(e,t,s,i);n.reset(c,fP),n.notifyOnChanges()}return!0}return!1}function mf(n,t,e){const i=bn();i.firstCreatePass&&(XD(i,new qD(n,t,e),-1),2==(2&t)&&(i.staticViewQueries=!0)),ZD(i,$e(),t)}function io(n,t,e,i){const s=bn();if(s.firstCreatePass){const c=mi();XD(s,new qD(t,e,i),c.index),function nO(n,t){const e=n.contentQueries||(n.contentQueries=[]);t!==(e.length?e[e.length-1]:-1)&&e.push(n.queries.length-1,t)}(s,n),2==(2&e)&&(s.staticContentQueries=!0)}ZD(s,$e(),e)}function ar(){return function tO(n,t){return n[19].queries[t].queryList}($e(),Xl())}function ZD(n,t,e){const i=new Yp(4==(4&e));kg(n,t,i,i.destroy),null===t[19]&&(t[19]=new Ub),t[19].queries.push(new jb(i))}function XD(n,t,e){null===n.queries&&(n.queries=new Gb),n.queries.track(new $b(t,e))}function KD(n,t){return n.queries.getByIndex(t)}function jv(...n){}const a_=new dt("Application Initializer");let Jp=(()=>{class n{constructor(e){this.appInits=e,this.resolve=jv,this.reject=jv,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,s)=>{this.resolve=i,this.reject=s})}runInitializers(){if(this.initialized)return;const e=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let s=0;s<this.appInits.length;s++){const c=this.appInits[s]();if(Xg(c))e.push(c);else if(Eb(c)){const f=new Promise((v,C)=>{c.subscribe({complete:v,error:C})});e.push(f)}}Promise.all(e).then(()=>{i()}).catch(s=>{this.reject(s)}),0===e.length&&i(),this.initialized=!0}}return n.\u0275fac=function(e){return new(e||n)(Ce(a_,8))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();const l_=new dt("AppId"),bO={provide:l_,useFactory:function xO(){return`${Yb()}${Yb()}${Yb()}`},deps:[]};function Yb(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const fM=new dt("Platform Initializer"),so=new dt("Platform ID"),Qb=new dt("appBootstrapListener");let pM=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();const Iu=new dt("LocaleId"),mM=new dt("DefaultCurrencyCode");class wO{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let Uv=(()=>{class n{compileModuleSync(e){return new Bb(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),c=ka(ns(e).declarations).reduce((f,v)=>{const C=Oi(v);return C&&f.push(new Lb(C)),f},[]);return new wO(i,c)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();const EO=(()=>Promise.resolve(0))();function Jb(n){"undefined"==typeof Zone?EO.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class fn{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ti(!1),this.onMicrotaskEmpty=new ti(!1),this.onStable=new ti(!1),this.onError=new ti(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!i&&e,s.shouldCoalesceRunChangeDetection=i,s.lastRequestAnimationFrameId=-1,s.nativeRequestAnimationFrame=function DO(){let n=Ln.requestAnimationFrame,t=Ln.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&t){const e=n[Zone.__symbol__("OriginalDelegate")];e&&(n=e);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function AO(n){const t=()=>{!function SO(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Ln,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,tw(n),n.isCheckStableRunning=!0,ew(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),tw(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,s,c,f,v)=>{try{return gM(n),e.invokeTask(s,c,f,v)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===c.type||n.shouldCoalesceRunChangeDetection)&&t(),_M(n)}},onInvoke:(e,i,s,c,f,v,C)=>{try{return gM(n),e.invoke(s,c,f,v,C)}finally{n.shouldCoalesceRunChangeDetection&&t(),_M(n)}},onHasTask:(e,i,s,c)=>{e.hasTask(s,c),i===s&&("microTask"==c.change?(n._hasPendingMicrotasks=c.microTask,tw(n),ew(n)):"macroTask"==c.change&&(n.hasPendingMacrotasks=c.macroTask))},onHandleError:(e,i,s,c)=>(e.handleError(s,c),n.runOutsideAngular(()=>n.onError.emit(c)),!1)})}(s)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!fn.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(fn.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,s){const c=this._inner,f=c.scheduleEventTask("NgZoneEvent: "+s,t,MO,jv,jv);try{return c.runTask(f,e,i)}finally{c.cancelTask(f)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const MO={};function ew(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function tw(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function gM(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function _M(n){n._nesting--,ew(n)}class TO{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ti,this.onMicrotaskEmpty=new ti,this.onStable=new ti,this.onError=new ti}run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,s){return t.apply(e,i)}}let nw=(()=>{class n{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{fn.assertNotInAngularZone(),Jb(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Jb(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,s){let c=-1;i&&i>0&&(c=setTimeout(()=>{this._callbacks=this._callbacks.filter(f=>f.timeoutId!==c),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:c,updateCb:s})}whenStable(e,i,s){if(s&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,s),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,i,s){return[]}}return n.\u0275fac=function(e){return new(e||n)(Ce(fn))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})(),yM=(()=>{class n{constructor(){this._applications=new Map,iw.addToWindow(this)}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){return iw.findTestabilityInTree(this,e,i)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();class IO{addToWindow(t){}findTestabilityInTree(t,e,i){return null}}let Cl,iw=new IO;const vM=new dt("AllowMultipleToken");class xM{constructor(t,e){this.name=t,this.token=e}}function bM(n,t,e=[]){const i=`Platform: ${t}`,s=new dt(i);return(c=[])=>{let f=wM();if(!f||f.injector.get(vM,!1))if(n)n(e.concat(c).concat({provide:s,useValue:!0}));else{const v=e.concat(c).concat({provide:s,useValue:!0},{provide:Hg,useValue:"platform"});!function PO(n){if(Cl&&!Cl.destroyed&&!Cl.injector.get(vM,!1))throw new dn(400,"");Cl=n.get(CM);const t=n.get(fM,null);t&&t.forEach(e=>e())}(ce.create({providers:v,name:i}))}return function OO(n){const t=wM();if(!t)throw new dn(401,"");return t}()}}function wM(){return Cl&&!Cl.destroyed?Cl:null}let CM=(()=>{class n{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const v=function LO(n,t){let e;return e="noop"===n?new TO:("zone.js"===n?void 0:n)||new fn({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),e}(i?i.ngZone:void 0,{ngZoneEventCoalescing:i&&i.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:i&&i.ngZoneRunCoalescing||!1}),C=[{provide:fn,useValue:v}];return v.run(()=>{const S=ce.create({providers:C,parent:this.injector,name:e.moduleType.name}),I=e.create(S),L=I.injector.get(Ys,null);if(!L)throw new dn(402,"");return v.runOutsideAngular(()=>{const q=v.onError.subscribe({next:X=>{L.handleError(X)}});I.onDestroy(()=>{rw(this._modules,I),q.unsubscribe()})}),function BO(n,t,e){try{const i=e();return Xg(i)?i.catch(s=>{throw t.runOutsideAngular(()=>n.handleError(s)),s}):i}catch(i){throw t.runOutsideAngular(()=>n.handleError(i)),i}}(L,v,()=>{const q=I.injector.get(Jp);return q.runInitializers(),q.donePromise.then(()=>(function p2(n){ri(n,"Expected localeId to be defined"),"string"==typeof n&&(sD=n.toLowerCase().replace(/_/g,"-"))}(I.injector.get(Iu,Fv)||Fv),this._moduleDoBootstrap(I),I))})})}bootstrapModule(e,i=[]){const s=EM({},i);return function FO(n,t,e){const i=new Bb(e);return Promise.resolve(i)}(0,0,e).then(c=>this.bootstrapModuleFactory(c,s))}_moduleDoBootstrap(e){const i=e.injector.get(gf);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(s=>i.bootstrap(s));else{if(!e.instance.ngDoBootstrap)throw new dn(403,"");e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new dn(404,"");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(e){return new(e||n)(Ce(ce))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();function EM(n,t){return Array.isArray(t)?t.reduce(EM,n):Object.assign(Object.assign({},n),t)}let gf=(()=>{class n{constructor(e,i,s,c,f){this._zone=e,this._injector=i,this._exceptionHandler=s,this._componentFactoryResolver=c,this._initStatus=f,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const v=new un(S=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{S.next(this._stable),S.complete()})}),C=new un(S=>{let I;this._zone.runOutsideAngular(()=>{I=this._zone.onStable.subscribe(()=>{fn.assertNotInAngularZone(),Jb(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,S.next(!0))})})});const L=this._zone.onUnstable.subscribe(()=>{fn.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{S.next(!1)}))});return()=>{I.unsubscribe(),L.unsubscribe()}});this.isStable=Ft(v,C.pipe(ma()))}bootstrap(e,i){if(!this._initStatus.done)throw new dn(405,"");let s;s=e instanceof ID?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(s.componentType);const c=function RO(n){return n.isBoundToModule}(s)?void 0:this._injector.get(Tu),v=s.create(ce.NULL,[],i||s.selector,c),C=v.location.nativeElement,S=v.injector.get(nw,null),I=S&&v.injector.get(yM);return S&&I&&I.registerApplication(C,S),v.onDestroy(()=>{this.detachView(v.hostView),rw(this.components,v),I&&I.unregisterApplication(C)}),this._loadComponent(v),v}tick(){if(this._runningTick)throw new dn(101,"");try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;rw(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(Qb,[]).concat(this._bootstrapListeners).forEach(s=>s(e))}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return n.\u0275fac=function(e){return new(e||n)(Ce(fn),Ce(ce),Ce(Ys),Ce(Od),Ce(Jp))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();function rw(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}let MM=!0,vc=(()=>{class n{}return n.__NG_ELEMENT_ID__=VO,n})();function VO(n){return function jO(n,t,e){if(Yc(n)&&!e){const i=nr(n.index,t);return new i_(i,i)}return 47&n.type?new i_(t[16],t):null}(mi(),$e(),16==(16&n))}class RM{constructor(){}supports(t){return ci(t)}create(t){return new WO(t)}}const qO=(n,t)=>t;class WO{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||qO}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,s=0,c=null;for(;e||i;){const f=!i||e&&e.currentIndex<OM(i,s,c)?e:i,v=OM(f,s,c),C=f.currentIndex;if(f===i)s--,i=i._nextRemoved;else if(e=e._next,null==f.previousIndex)s++;else{c||(c=[]);const S=v-s,I=C-s;if(S!=I){for(let q=0;q<S;q++){const X=q<c.length?c[q]:c[q]=0,ue=X+q;I<=ue&&ue<S&&(c[q]=X+1)}c[f.previousIndex]=I-S}}v!==C&&t(f,v,C)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!ci(t))throw new dn(900,"");return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let s,c,f,e=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let v=0;v<this.length;v++)c=t[v],f=this._trackByFn(v,c),null!==e&&Object.is(e.trackById,f)?(i&&(e=this._verifyReinsertion(e,c,f,v)),Object.is(e.item,c)||this._addIdentityChange(e,c)):(e=this._mismatch(e,c,f,v),i=!0),e=e._next}else s=0,function Sr(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[Zi()]();let i;for(;!(i=e.next()).done;)t(i.value)}}(t,v=>{f=this._trackByFn(s,v),null!==e&&Object.is(e.trackById,f)?(i&&(e=this._verifyReinsertion(e,v,f,s)),Object.is(e.item,v)||this._addIdentityChange(e,v)):(e=this._mismatch(e,v,f,s),i=!0),e=e._next,s++}),this.length=s;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,s){let c;return null===t?c=this._itTail:(c=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,c,s)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,s))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,c,s)):t=this._addAfter(new ZO(e,i),c,s),t}_verifyReinsertion(t,e,i,s){let c=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==c?t=this._reinsertAfter(c,t._prev,s):t.currentIndex!=s&&(t.currentIndex=s,this._addToMoves(t,s)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const s=t._prevRemoved,c=t._nextRemoved;return null===s?this._removalsHead=c:s._nextRemoved=c,null===c?this._removalsTail=s:c._prevRemoved=s,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const s=null===e?this._itHead:e._next;return t._next=s,t._prev=e,null===s?this._itTail=t:s._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new PM),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new PM),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class ZO{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class XO{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class PM{constructor(){this.map=new Map}put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new XO,this.map.set(e,i)),i.add(t)}get(t,e){const s=this.map.get(t);return s?s.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function OM(n,t,e){const i=n.previousIndex;if(null===i)return i;let s=0;return e&&i<e.length&&(s=e[i]),i+t+s}class LM{constructor(){}supports(t){return t instanceof Map||Ti(t)}create(){return new KO}}class KO{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||Ti(t)))throw new dn(900,"")}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,s)=>{if(e&&e.key===s)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const c=this._getOrCreateRecordForKey(s,i);e=this._insertBeforeOrAppend(e,c)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const s=this._records.get(t);this._maybeAddToChanges(s,e);const c=s._prev,f=s._next;return c&&(c._next=f),f&&(f._prev=c),s._next=null,s._prev=null,s}const i=new YO(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}}class YO{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function BM(){return new em([new RM])}let em=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(null!=i){const s=i.factories.slice();e=e.concat(s)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||BM()),deps:[[n,new uu,new Ts]]}}find(e){const i=this.factories.find(s=>s.supports(e));if(null!=i)return i;throw new dn(901,"")}}return n.\u0275prov=Ke({token:n,providedIn:"root",factory:BM}),n})();function NM(){return new Bd([new LM])}let Bd=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(i){const s=i.factories.slice();e=e.concat(s)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||NM()),deps:[[n,new uu,new Ts]]}}find(e){const i=this.factories.find(c=>c.supports(e));if(i)return i;throw new dn(901,"")}}return n.\u0275prov=Ke({token:n,providedIn:"root",factory:NM}),n})();const QO=[new LM],eL=new em([new RM]),tL=new Bd(QO),nL=bM(null,"core",[{provide:so,useValue:"unknown"},{provide:CM,deps:[ce]},{provide:yM,deps:[]},{provide:pM,deps:[]}]),aL=[{provide:gf,useClass:gf,deps:[fn,ce,Ys,Od,Jp]},{provide:xP,deps:[fn],useFactory:function lL(n){let t=[];return n.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:Jp,useClass:Jp,deps:[[new Ts,a_]]},{provide:Uv,useClass:Uv,deps:[]},bO,{provide:em,useFactory:function iL(){return eL},deps:[]},{provide:Bd,useFactory:function rL(){return tL},deps:[]},{provide:Iu,useFactory:function sL(n){return n||function oL(){return"undefined"!=typeof $localize&&$localize.locale||Fv}()},deps:[[new Ql(Iu),new Ts,new uu]]},{provide:mM,useValue:"USD"}];let cL=(()=>{class n{constructor(e){}}return n.\u0275fac=function(e){return new(e||n)(Ce(gf))},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({providers:aL}),n})(),$v=null;function xc(){return $v}const sn=new dt("DocumentToken");let yf=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ke({token:n,factory:function(){return function fL(){return Ce(zM)}()},providedIn:"platform"}),n})();const pL=new dt("Location Initialized");let zM=(()=>{class n extends yf{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return xc().getBaseHref(this._doc)}onPopState(e){const i=xc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=xc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,i,s){VM()?this._history.pushState(e,i,s):this.location.hash=s}replaceState(e,i,s){VM()?this._history.replaceState(e,i,s):this.location.hash=s}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return n.\u0275fac=function(e){return new(e||n)(Ce(sn))},n.\u0275prov=Ke({token:n,factory:function(){return function mL(){return new zM(Ce(sn))}()},providedIn:"platform"}),n})();function VM(){return!!window.history.pushState}function cw(n,t){if(0==n.length)return t;if(0==t.length)return n;let e=0;return n.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?n+t.substring(1):1==e?n+t:n+"/"+t}function jM(n){const t=n.match(/#|\?|$/),e=t&&t.index||n.length;return n.slice(0,e-("/"===n[e-1]?1:0))+n.slice(e)}function ku(n){return n&&"?"!==n[0]?"?"+n:n}let tm=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ke({token:n,factory:function(){return function gL(n){const t=Ce(sn).location;return new UM(Ce(yf),t&&t.origin||"")}()},providedIn:"root"}),n})();const uw=new dt("appBaseHref");let UM=(()=>{class n extends tm{constructor(e,i){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==i&&(i=this._platformLocation.getBaseHrefFromDOM()),null==i)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=i}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return cw(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+ku(this._platformLocation.search),s=this._platformLocation.hash;return s&&e?`${i}${s}`:i}pushState(e,i,s,c){const f=this.prepareExternalUrl(s+ku(c));this._platformLocation.pushState(e,i,f)}replaceState(e,i,s,c){const f=this.prepareExternalUrl(s+ku(c));this._platformLocation.replaceState(e,i,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var i,s;null===(s=(i=this._platformLocation).historyGo)||void 0===s||s.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Ce(yf),Ce(uw,8))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})(),_L=(()=>{class n extends tm{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=cw(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,s,c){let f=this.prepareExternalUrl(s+ku(c));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.pushState(e,i,f)}replaceState(e,i,s,c){let f=this.prepareExternalUrl(s+ku(c));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var i,s;null===(s=(i=this._platformLocation).historyGo)||void 0===s||s.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Ce(yf),Ce(uw,8))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})(),c_=(()=>{class n{constructor(e,i){this._subject=new ti,this._urlChangeListeners=[],this._platformStrategy=e;const s=this._platformStrategy.getBaseHref();this._platformLocation=i,this._baseHref=jM(GM(s)),this._platformStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+ku(i))}normalize(e){return n.stripTrailingSlash(function vL(n,t){return n&&t.startsWith(n)?t.substring(n.length):t}(this._baseHref,GM(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,i="",s=null){this._platformStrategy.pushState(s,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ku(i)),s)}replaceState(e,i="",s=null){this._platformStrategy.replaceState(s,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ku(i)),s)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(e=0){var i,s;null===(s=(i=this._platformStrategy).historyGo)||void 0===s||s.call(i,e)}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}))}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(s=>s(e,i))}subscribe(e,i,s){return this._subject.subscribe({next:e,error:i,complete:s})}}return n.normalizeQueryParams=ku,n.joinWithSlash=cw,n.stripTrailingSlash=jM,n.\u0275fac=function(e){return new(e||n)(Ce(tm),Ce(yf))},n.\u0275prov=Ke({token:n,factory:function(){return function yL(){return new c_(Ce(tm),Ce(yf))}()},providedIn:"root"}),n})();function GM(n){return n.replace(/\/index.html$/,"")}var mr=(()=>((mr=mr||{})[mr.Zero=0]="Zero",mr[mr.One=1]="One",mr[mr.Two=2]="Two",mr[mr.Few=3]="Few",mr[mr.Many=4]="Many",mr[mr.Other=5]="Other",mr))();const ML=function iD(n){return function no(n){const t=function u2(n){return n.toLowerCase().replace(/_/g,"-")}(n);let e=rD(t);if(e)return e;const i=t.split("-")[0];if(e=rD(i),e)return e;if("en"===i)return c2;throw new Error(`Missing locale data for the locale "${n}".`)}(n)[mt.PluralCase]};class ex{}let tB=(()=>{class n extends ex{constructor(e){super(),this.locale=e}getPluralCategory(e,i){switch(ML(i||this.locale)(e)){case mr.Zero:return"zero";case mr.One:return"one";case mr.Two:return"two";case mr.Few:return"few";case mr.Many:return"many";default:return"other"}}}return n.\u0275fac=function(e){return new(e||n)(Ce(Iu))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();function QM(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const i=e.indexOf("="),[s,c]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(s.trim()===t)return decodeURIComponent(c)}return null}class iB{constructor(t,e,i,s){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=s}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let xw=(()=>{class n{constructor(e,i,s){this._viewContainer=e,this._template=i,this._differs=s,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((s,c,f)=>{if(null==s.previousIndex)i.createEmbeddedView(this._template,new iB(s.item,this._ngForOf,-1,-1),null===f?void 0:f);else if(null==f)i.remove(null===c?void 0:c);else if(null!==c){const v=i.get(c);i.move(v,f),JM(v,s)}});for(let s=0,c=i.length;s<c;s++){const v=i.get(s).context;v.index=s,v.count=c,v.ngForOf=this._ngForOf}e.forEachIdentityChange(s=>{JM(i.get(s.currentIndex),s)})}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(se(Ba),se(yc),se(em))},n.\u0275dir=je({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),n})();function JM(n,t){n.context.$implicit=t.item}let h_=(()=>{class n{constructor(e,i){this._viewContainer=e,this._context=new rB,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){eS("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){eS("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(se(Ba),se(yc))},n.\u0275dir=je({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),n})();class rB{constructor(){this.$implicit=null,this.ngIf=null}}function eS(n,t){if(t&&!t.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${Wt(t)}'.`)}let f_=(()=>{class n{constructor(e,i,s){this._ngEl=e,this._differs=i,this._renderer=s,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){const[s,c]=e.split(".");null!=(i=null!=i&&c?`${i}${c}`:i)?this._renderer.setStyle(this._ngEl.nativeElement,s,i):this._renderer.removeStyle(this._ngEl.nativeElement,s)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(Bd),se(wl))},n.\u0275dir=je({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),n})(),tx=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({providers:[{provide:ex,useClass:tB}]}),n})();const iS="browser";function Ru(n){return n===iS}function nm(n){return"server"===n}let RB=(()=>{class n{}return n.\u0275prov=Ke({token:n,providedIn:"root",factory:()=>new PB(Ce(sn),window)}),n})();class PB{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function OB(n,t){const e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let s=i.currentNode;for(;s;){const c=s.shadowRoot;if(c){const f=c.getElementById(t)||c.querySelector(`[name="${t}"]`);if(f)return f}s=i.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),this.attemptFocus(e))}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),i=e.left+this.window.pageXOffset,s=e.top+this.window.pageYOffset,c=this.offset();this.window.scrollTo(i-c[0],s-c[1])}attemptFocus(t){return t.focus(),this.document.activeElement===t}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=rS(this.window.history)||rS(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function rS(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class sS{}class Dw extends class LB extends class hL{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function dL(n){$v||($v=n)}(new Dw)}onAndCancel(t,e,i){return t.addEventListener(e,i,!1),()=>{t.removeEventListener(e,i,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function BB(){return p_=p_||document.querySelector("base"),p_?p_.getAttribute("href"):null}();return null==e?null:function NB(n){nx=nx||document.createElement("a"),nx.setAttribute("href",n);const t=nx.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){p_=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return QM(document.cookie,t)}}let nx,p_=null;const oS=new dt("TRANSITION_ID"),VB=[{provide:a_,useFactory:function zB(n,t,e){return()=>{e.get(Jp).donePromise.then(()=>{const i=xc(),s=t.querySelectorAll(`style[ng-transition="${n}"]`);for(let c=0;c<s.length;c++)i.remove(s[c])})}},deps:[oS,sn,ce],multi:!0}];class Mw{static init(){!function kO(n){iw=n}(new Mw)}addToWindow(t){Ln.getAngularTestability=(i,s=!0)=>{const c=t.findTestabilityInTree(i,s);if(null==c)throw new Error("Could not find testability for element.");return c},Ln.getAllAngularTestabilities=()=>t.getAllTestabilities(),Ln.getAllAngularRootElements=()=>t.getAllRootElements(),Ln.frameworkStabilizers||(Ln.frameworkStabilizers=[]),Ln.frameworkStabilizers.push(i=>{const s=Ln.getAllAngularTestabilities();let c=s.length,f=!1;const v=function(C){f=f||C,c--,0==c&&i(f)};s.forEach(function(C){C.whenStable(v)})})}findTestabilityInTree(t,e,i){if(null==e)return null;const s=t.getTestability(e);return null!=s?s:i?xc().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}}let jB=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();const ix=new dt("EventManagerPlugins");let rx=(()=>{class n{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(s=>s.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,i,s){return this._findPluginFor(i).addEventListener(e,i,s)}addGlobalEventListener(e,i,s){return this._findPluginFor(i).addGlobalEventListener(e,i,s)}getZone(){return this._zone}_findPluginFor(e){const i=this._eventNameToPlugin.get(e);if(i)return i;const s=this._plugins;for(let c=0;c<s.length;c++){const f=s[c];if(f.supports(e))return this._eventNameToPlugin.set(e,f),f}throw new Error(`No event manager plugin found for event ${e}`)}}return n.\u0275fac=function(e){return new(e||n)(Ce(ix),Ce(fn))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();class aS{constructor(t){this._doc=t}addGlobalEventListener(t,e,i){const s=xc().getGlobalEventTarget(this._doc,t);if(!s)throw new Error(`Unsupported event target ${s} for event ${e}`);return this.addEventListener(s,e,i)}}let lS=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(e){const i=new Set;e.forEach(s=>{this._stylesSet.has(s)||(this._stylesSet.add(s),i.add(s))}),this.onStylesAdded(i)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})(),m_=(()=>{class n extends lS{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,i,s){e.forEach(c=>{const f=this._doc.createElement("style");f.textContent=c,s.push(i.appendChild(f))})}addHost(e){const i=[];this._addStylesToHost(this._stylesSet,e,i),this._hostNodes.set(e,i)}removeHost(e){const i=this._hostNodes.get(e);i&&i.forEach(cS),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((i,s)=>{this._addStylesToHost(e,s,i)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(cS))}}return n.\u0275fac=function(e){return new(e||n)(Ce(sn))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();function cS(n){xc().remove(n)}const Sw={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Aw=/%COMP%/g;function sx(n,t,e){for(let i=0;i<t.length;i++){let s=t[i];Array.isArray(s)?sx(n,s,e):(s=s.replace(Aw,n),e.push(s))}return e}function hS(n){return t=>{if("__ngUnwrap__"===t)return n;!1===n(t)&&(t.preventDefault(),t.returnValue=!1)}}let ox=(()=>{class n{constructor(e,i,s){this.eventManager=e,this.sharedStylesHost=i,this.appId=s,this.rendererByCompId=new Map,this.defaultRenderer=new Tw(e)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;switch(i.encapsulation){case ct.Emulated:{let s=this.rendererByCompId.get(i.id);return s||(s=new WB(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,s)),s.applyToHost(e),s}case 1:case ct.ShadowDom:return new ZB(this.eventManager,this.sharedStylesHost,e,i);default:if(!this.rendererByCompId.has(i.id)){const s=sx(i.id,i.styles,[]);this.sharedStylesHost.addStyles(s),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(e){return new(e||n)(Ce(rx),Ce(m_),Ce(l_))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();class Tw{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS(Sw[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){t.appendChild(e)}insertBefore(t,e,i){t&&t.insertBefore(e,i)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,s){if(s){e=s+":"+e;const c=Sw[s];c?t.setAttributeNS(c,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const s=Sw[i];s?t.removeAttributeNS(s,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,s){s&(Qs.DashCase|Qs.Important)?t.style.setProperty(e,i,s&Qs.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&Qs.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t[e]=i}setValue(t,e){t.nodeValue=e}listen(t,e,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,hS(i)):this.eventManager.addEventListener(t,e,hS(i))}}class WB extends Tw{constructor(t,e,i,s){super(t),this.component=i;const c=sx(s+"-"+i.id,i.styles,[]);e.addStyles(c),this.contentAttr=function $B(n){return"_ngcontent-%COMP%".replace(Aw,n)}(s+"-"+i.id),this.hostAttr=function HB(n){return"_nghost-%COMP%".replace(Aw,n)}(s+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}class ZB extends Tw{constructor(t,e,i,s){super(t),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=sx(s.id,s.styles,[]);for(let f=0;f<c.length;f++){const v=document.createElement("style");v.textContent=c[f],this.shadowRoot.appendChild(v)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let XB=(()=>{class n extends aS{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,s){return e.addEventListener(i,s,!1),()=>this.removeEventListener(e,i,s)}removeEventListener(e,i,s){return e.removeEventListener(i,s)}}return n.\u0275fac=function(e){return new(e||n)(Ce(sn))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();const pS=["alt","control","meta","shift"],YB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},mS={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},QB={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let JB=(()=>{class n extends aS{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,i,s){const c=n.parseEventName(i),f=n.eventCallback(c.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>xc().onAndCancel(e,c.domEventName,f))}static parseEventName(e){const i=e.toLowerCase().split("."),s=i.shift();if(0===i.length||"keydown"!==s&&"keyup"!==s)return null;const c=n._normalizeKey(i.pop());let f="";if(pS.forEach(C=>{const S=i.indexOf(C);S>-1&&(i.splice(S,1),f+=C+".")}),f+=c,0!=i.length||0===c.length)return null;const v={};return v.domEventName=s,v.fullKey=f,v}static getEventFullKey(e){let i="",s=function eN(n){let t=n.key;if(null==t){if(t=n.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===n.location&&mS.hasOwnProperty(t)&&(t=mS[t]))}return YB[t]||t}(e);return s=s.toLowerCase()," "===s?s="space":"."===s&&(s="dot"),pS.forEach(c=>{c!=s&&QB[c](e)&&(i+=c+".")}),i+=s,i}static eventCallback(e,i,s){return c=>{n.getEventFullKey(c)===e&&s.runGuarded(()=>i(c))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return n.\u0275fac=function(e){return new(e||n)(Ce(sn))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();const rN=bM(nL,"browser",[{provide:so,useValue:iS},{provide:fM,useValue:function tN(){Dw.makeCurrent(),Mw.init()},multi:!0},{provide:sn,useFactory:function iN(){return function Pm(n){hh=n}(document),document},deps:[]}]),sN=[{provide:Hg,useValue:"root"},{provide:Ys,useFactory:function nN(){return new Ys},deps:[]},{provide:ix,useClass:XB,multi:!0,deps:[sn,fn,so]},{provide:ix,useClass:JB,multi:!0,deps:[sn]},{provide:ox,useClass:ox,deps:[rx,m_,l_]},{provide:n_,useExisting:ox},{provide:lS,useExisting:m_},{provide:m_,useClass:m_,deps:[sn]},{provide:nw,useClass:nw,deps:[fn]},{provide:rx,useClass:rx,deps:[ix,fn]},{provide:sS,useClass:jB,deps:[]}];let gS=(()=>{class n{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(e){return{ngModule:n,providers:[{provide:l_,useValue:e.appId},{provide:oS,useExisting:l_},VB]}}}return n.\u0275fac=function(e){return new(e||n)(Ce(n,12))},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({providers:sN,imports:[tx,cL]}),n})();"undefined"!=typeof window&&window;let ax=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ke({token:n,factory:function(e){let i=null;return i=e?new(e||n):Ce(vS),i},providedIn:"root"}),n})(),vS=(()=>{class n extends ax{constructor(e){super(),this._doc=e}sanitize(e,i){if(null==i)return null;switch(e){case Sn.NONE:return i;case Sn.HTML:return yo(i,"HTML")?Is(i):Vh(this._doc,String(i)).toString();case Sn.STYLE:return yo(i,"Style")?Is(i):i;case Sn.SCRIPT:if(yo(i,"Script"))return Is(i);throw new Error("unsafe value used in a script context");case Sn.URL:return ks(i),yo(i,"URL")?Is(i):fu(String(i));case Sn.RESOURCE_URL:if(yo(i,"ResourceURL"))return Is(i);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function dy(n){return new A0(n)}(e)}bypassSecurityTrustStyle(e){return function I0(n){return new T0(n)}(e)}bypassSecurityTrustScript(e){return function hy(n){return new yd(n)}(e)}bypassSecurityTrustUrl(e){return function k0(n){return new cy(n)}(e)}bypassSecurityTrustResourceUrl(e){return function F0(n){return new uy(n)}(e)}}return n.\u0275fac=function(e){return new(e||n)(Ce(sn))},n.\u0275prov=Ke({token:n,factory:function(e){let i=null;return i=e?new e:function mN(n){return new vS(n.get(sn))}(Ce(ce)),i},providedIn:"root"}),n})();function Ot(...n){return Mt(n,pt(n))}function im(n,t){return wn(t)?me(n,t,1):me(n,1)}function ui(n,t){return Pn((e,i)=>{let s=0;e.subscribe(new Cn(i,c=>n.call(t,c,s++)&&i.next(c)))})}class xS{}class bS{}class Pu{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const s=e.slice(0,i),c=s.toLowerCase(),f=e.slice(i+1).trim();this.maybeSetNormalizedName(s,c),this.headers.has(c)?this.headers.get(c).push(f):this.headers.set(c,[f])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let i=t[e];const s=e.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(s,i),this.maybeSetNormalizedName(e,s))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof Pu?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new Pu;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Pu?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const s=("a"===t.op?this.headers.get(e):void 0)||[];s.push(...i),this.headers.set(e,s);break;case"d":const c=t.value;if(c){let f=this.headers.get(e);if(!f)return;f=f.filter(v=>-1===c.indexOf(v)),0===f.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,f)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class gN{encodeKey(t){return wS(t)}encodeValue(t){return wS(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const yN=/%(\d[a-f0-9])/gi,vN={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function wS(n){return encodeURIComponent(n).replace(yN,(t,e)=>{var i;return null!==(i=vN[e])&&void 0!==i?i:t})}function CS(n){return`${n}`}class zd{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new gN,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function _N(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(s=>{const c=s.indexOf("="),[f,v]=-1==c?[t.decodeKey(s),""]:[t.decodeKey(s.slice(0,c)),t.decodeValue(s.slice(c+1))],C=e.get(f)||[];C.push(v),e.set(f,C)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e];this.map.set(e,Array.isArray(i)?i:[i])})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const s=t[i];Array.isArray(s)?s.forEach(c=>{e.push({param:i,value:c,op:"a"})}):e.push({param:i,value:s,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new zd({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(CS(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const s=i.indexOf(CS(t.value));-1!==s&&i.splice(s,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class xN{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function ES(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function DS(n){return"undefined"!=typeof Blob&&n instanceof Blob}function MS(n){return"undefined"!=typeof FormData&&n instanceof FormData}class g_{constructor(t,e,i,s){let c;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function bN(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||s?(this.body=void 0!==i?i:null,c=s):c=i,c&&(this.reportProgress=!!c.reportProgress,this.withCredentials=!!c.withCredentials,c.responseType&&(this.responseType=c.responseType),c.headers&&(this.headers=c.headers),c.context&&(this.context=c.context),c.params&&(this.params=c.params)),this.headers||(this.headers=new Pu),this.context||(this.context=new xN),this.params){const f=this.params.toString();if(0===f.length)this.urlWithParams=e;else{const v=e.indexOf("?");this.urlWithParams=e+(-1===v?"?":v<e.length-1?"&":"")+f}}else this.params=new zd,this.urlWithParams=e}serializeBody(){return null===this.body?null:ES(this.body)||DS(this.body)||MS(this.body)||function wN(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof zd?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||MS(this.body)?null:DS(this.body)?this.body.type||null:ES(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof zd?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const i=t.method||this.method,s=t.url||this.url,c=t.responseType||this.responseType,f=void 0!==t.body?t.body:this.body,v=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,C=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let S=t.headers||this.headers,I=t.params||this.params;const L=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(S=Object.keys(t.setHeaders).reduce((q,X)=>q.set(X,t.setHeaders[X]),S)),t.setParams&&(I=Object.keys(t.setParams).reduce((q,X)=>q.set(X,t.setParams[X]),I)),new g_(i,s,f,{params:I,headers:S,context:L,reportProgress:C,responseType:c,withCredentials:v})}}var _r=(()=>((_r=_r||{})[_r.Sent=0]="Sent",_r[_r.UploadProgress=1]="UploadProgress",_r[_r.ResponseHeader=2]="ResponseHeader",_r[_r.DownloadProgress=3]="DownloadProgress",_r[_r.Response=4]="Response",_r[_r.User=5]="User",_r))();class kw{constructor(t,e=200,i="OK"){this.headers=t.headers||new Pu,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class Fw extends kw{constructor(t={}){super(t),this.type=_r.ResponseHeader}clone(t={}){return new Fw({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class lx extends kw{constructor(t={}){super(t),this.type=_r.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new lx({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class SS extends kw{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function Rw(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let cx=(()=>{class n{constructor(e){this.handler=e}request(e,i,s={}){let c;if(e instanceof g_)c=e;else{let C,S;C=s.headers instanceof Pu?s.headers:new Pu(s.headers),s.params&&(S=s.params instanceof zd?s.params:new zd({fromObject:s.params})),c=new g_(e,i,void 0!==s.body?s.body:null,{headers:C,context:s.context,params:S,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials})}const f=Ot(c).pipe(im(C=>this.handler.handle(C)));if(e instanceof g_||"events"===s.observe)return f;const v=f.pipe(ui(C=>C instanceof lx));switch(s.observe||"body"){case"body":switch(c.responseType){case"arraybuffer":return v.pipe(Tt(C=>{if(null!==C.body&&!(C.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return C.body}));case"blob":return v.pipe(Tt(C=>{if(null!==C.body&&!(C.body instanceof Blob))throw new Error("Response is not a Blob.");return C.body}));case"text":return v.pipe(Tt(C=>{if(null!==C.body&&"string"!=typeof C.body)throw new Error("Response is not a string.");return C.body}));default:return v.pipe(Tt(C=>C.body))}case"response":return v;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new zd).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,s={}){return this.request("PATCH",e,Rw(s,i))}post(e,i,s={}){return this.request("POST",e,Rw(s,i))}put(e,i,s={}){return this.request("PUT",e,Rw(s,i))}}return n.\u0275fac=function(e){return new(e||n)(Ce(xS))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();class AS{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const TS=new dt("HTTP_INTERCEPTORS");let CN=(()=>{class n{intercept(e,i){return i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();const EN=/^\)\]\}',?\n/;let IS=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new un(i=>{const s=this.xhrFactory.build();if(s.open(e.method,e.urlWithParams),e.withCredentials&&(s.withCredentials=!0),e.headers.forEach((X,ue)=>s.setRequestHeader(X,ue.join(","))),e.headers.has("Accept")||s.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const X=e.detectContentTypeHeader();null!==X&&s.setRequestHeader("Content-Type",X)}if(e.responseType){const X=e.responseType.toLowerCase();s.responseType="json"!==X?X:"text"}const c=e.serializeBody();let f=null;const v=()=>{if(null!==f)return f;const X=1223===s.status?204:s.status,ue=s.statusText||"OK",xe=new Pu(s.getAllResponseHeaders()),ke=function DN(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(s)||e.url;return f=new Fw({headers:xe,status:X,statusText:ue,url:ke}),f},C=()=>{let{headers:X,status:ue,statusText:xe,url:ke}=v(),Ie=null;204!==ue&&(Ie=void 0===s.response?s.responseText:s.response),0===ue&&(ue=Ie?200:0);let Ee=ue>=200&&ue<300;if("json"===e.responseType&&"string"==typeof Ie){const it=Ie;Ie=Ie.replace(EN,"");try{Ie=""!==Ie?JSON.parse(Ie):null}catch(bt){Ie=it,Ee&&(Ee=!1,Ie={error:bt,text:Ie})}}Ee?(i.next(new lx({body:Ie,headers:X,status:ue,statusText:xe,url:ke||void 0})),i.complete()):i.error(new SS({error:Ie,headers:X,status:ue,statusText:xe,url:ke||void 0}))},S=X=>{const{url:ue}=v(),xe=new SS({error:X,status:s.status||0,statusText:s.statusText||"Unknown Error",url:ue||void 0});i.error(xe)};let I=!1;const L=X=>{I||(i.next(v()),I=!0);let ue={type:_r.DownloadProgress,loaded:X.loaded};X.lengthComputable&&(ue.total=X.total),"text"===e.responseType&&!!s.responseText&&(ue.partialText=s.responseText),i.next(ue)},q=X=>{let ue={type:_r.UploadProgress,loaded:X.loaded};X.lengthComputable&&(ue.total=X.total),i.next(ue)};return s.addEventListener("load",C),s.addEventListener("error",S),s.addEventListener("timeout",S),s.addEventListener("abort",S),e.reportProgress&&(s.addEventListener("progress",L),null!==c&&s.upload&&s.upload.addEventListener("progress",q)),s.send(c),i.next({type:_r.Sent}),()=>{s.removeEventListener("error",S),s.removeEventListener("abort",S),s.removeEventListener("load",C),s.removeEventListener("timeout",S),e.reportProgress&&(s.removeEventListener("progress",L),null!==c&&s.upload&&s.upload.removeEventListener("progress",q)),s.readyState!==s.DONE&&s.abort()}})}}return n.\u0275fac=function(e){return new(e||n)(Ce(sS))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();const Pw=new dt("XSRF_COOKIE_NAME"),Ow=new dt("XSRF_HEADER_NAME");class kS{}let MN=(()=>{class n{constructor(e,i,s){this.doc=e,this.platform=i,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=QM(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return n.\u0275fac=function(e){return new(e||n)(Ce(sn),Ce(so),Ce(Pw))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})(),Lw=(()=>{class n{constructor(e,i){this.tokenService=e,this.headerName=i}intercept(e,i){const s=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||s.startsWith("http://")||s.startsWith("https://"))return i.handle(e);const c=this.tokenService.getToken();return null!==c&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,c)})),i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Ce(kS),Ce(Ow))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})(),SN=(()=>{class n{constructor(e,i){this.backend=e,this.injector=i,this.chain=null}handle(e){if(null===this.chain){const i=this.injector.get(TS,[]);this.chain=i.reduceRight((s,c)=>new AS(s,c),this.backend)}return this.chain.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Ce(bS),Ce(ce))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})(),AN=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:Lw,useClass:CN}]}}static withOptions(e={}){return{ngModule:n,providers:[e.cookieName?{provide:Pw,useValue:e.cookieName}:[],e.headerName?{provide:Ow,useValue:e.headerName}:[]]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({providers:[Lw,{provide:TS,useExisting:Lw,multi:!0},{provide:kS,useClass:MN},{provide:Pw,useValue:"XSRF-TOKEN"},{provide:Ow,useValue:"X-XSRF-TOKEN"}]}),n})(),TN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({providers:[cx,{provide:xS,useClass:SN},IS,{provide:bS,useExisting:IS}],imports:[[AN.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),n})();class Jo extends Nt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}const{isArray:IN}=Array,{getPrototypeOf:kN,prototype:FN,keys:RN}=Object;function FS(n){if(1===n.length){const t=n[0];if(IN(t))return{args:t,keys:null};if(function PN(n){return n&&"object"==typeof n&&kN(n)===FN}(t)){const e=RN(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}const{isArray:ON}=Array;function Bw(n){return Tt(t=>function LN(n,t){return ON(t)?n(...t):n(t)}(n,t))}function RS(n,t){return n.reduce((e,i,s)=>(e[i]=t[s],e),{})}function PS(n,t,e){n?re(e,n,t):t()}const ux=Kd(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function __(...n){return function zN(){return _e(1)}()(Mt(n,pt(n)))}function y_(n){return new un(t=>{Ri(n()).subscribe(t)})}function OS(){return Pn((n,t)=>{let e=null;n._refCount++;const i=new Cn(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(e=null);const s=n._connection,c=e;e=null,s&&(!c||s===c)&&s.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}class LS extends un{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,Ji(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Wn;const e=this.getSubject();t.add(this.source.subscribe(new Cn(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Wn.EMPTY)}return t}refCount(){return OS()(this)}}function Ml(n,t){return Pn((e,i)=>{let s=null,c=0,f=!1;const v=()=>f&&!s&&i.complete();e.subscribe(new Cn(i,C=>{null==s||s.unsubscribe();let S=0;const I=c++;Ri(n(C,I)).subscribe(s=new Cn(i,L=>i.next(t?t(C,L,I,S++):L),()=>{s=null,v()}))},()=>{f=!0,v()}))})}function rm(...n){const t=pt(n);return Pn((e,i)=>{(t?__(n,e,t):__(n,e)).subscribe(i)})}function VN(n,t,e,i,s){return(c,f)=>{let v=e,C=t,S=0;c.subscribe(new Cn(f,I=>{const L=S++;C=v?n(C,I,L):(v=!0,I),i&&f.next(C)},s&&(()=>{v&&f.next(C),f.complete()})))}}function BS(n,t){return Pn(VN(n,t,arguments.length>=2,!0))}function Ou(n){return Pn((t,e)=>{let c,i=null,s=!1;i=t.subscribe(new Cn(e,void 0,void 0,f=>{c=Ri(n(f,Ou(n)(t))),i?(i.unsubscribe(),i=null,c.subscribe(e)):s=!0})),s&&(i.unsubscribe(),i=null,c.subscribe(e))})}function Nw(n){return n<=0?()=>he:Pn((t,e)=>{let i=[];t.subscribe(new Cn(e,s=>{i.push(s),n<i.length&&i.shift()},()=>{for(const s of i)e.next(s);e.complete()},void 0,()=>{i=null}))})}function NS(n=jN){return Pn((t,e)=>{let i=!1;t.subscribe(new Cn(e,s=>{i=!0,e.next(s)},()=>i?e.complete():e.error(n())))})}function jN(){return new ux}function zS(n){return Pn((t,e)=>{let i=!1;t.subscribe(new Cn(e,s=>{i=!0,e.next(s)},()=>{i||e.next(n),e.complete()}))})}function sm(n,t){const e=arguments.length>=2;return i=>i.pipe(n?ui((s,c)=>n(s,c,i)):Ns,jn(1),e?zS(t):NS(()=>new ux))}function Ir(n,t,e){const i=wn(n)||t||e?{next:n,error:t,complete:e}:n;return i?Pn((s,c)=>{var f;null===(f=i.subscribe)||void 0===f||f.call(i);let v=!0;s.subscribe(new Cn(c,C=>{var S;null===(S=i.next)||void 0===S||S.call(i,C),c.next(C)},()=>{var C;v=!1,null===(C=i.complete)||void 0===C||C.call(i),c.complete()},C=>{var S;v=!1,null===(S=i.error)||void 0===S||S.call(i,C),c.error(C)},()=>{var C,S;v&&(null===(C=i.unsubscribe)||void 0===C||C.call(i)),null===(S=i.finalize)||void 0===S||S.call(i)}))}):Ns}function VS(n){return Pn((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}class Lu{constructor(t,e){this.id=t,this.url=e}}class zw extends Lu{constructor(t,e,i="imperative",s=null){super(t,e),this.navigationTrigger=i,this.restoredState=s}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class v_ extends Lu{constructor(t,e,i){super(t,e),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class jS extends Lu{constructor(t,e,i){super(t,e),this.reason=i}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class GN extends Lu{constructor(t,e,i){super(t,e),this.error=i}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class $N extends Lu{constructor(t,e,i,s){super(t,e),this.urlAfterRedirects=i,this.state=s}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class HN extends Lu{constructor(t,e,i,s){super(t,e),this.urlAfterRedirects=i,this.state=s}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qN extends Lu{constructor(t,e,i,s,c){super(t,e),this.urlAfterRedirects=i,this.state=s,this.shouldActivate=c}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class WN extends Lu{constructor(t,e,i,s){super(t,e),this.urlAfterRedirects=i,this.state=s}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ZN extends Lu{constructor(t,e,i,s){super(t,e),this.urlAfterRedirects=i,this.state=s}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class US{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class GS{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class XN{constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class KN{constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class YN{constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class QN{constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class $S{constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Dn="primary";class JN{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function om(n){return new JN(n)}const HS="ngNavigationCancelingError";function Vw(n){const t=Error("NavigationCancelingError: "+n);return t[HS]=!0,t}function tz(n,t,e){const i=e.path.split("/");if(i.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||i.length<n.length))return null;const s={};for(let c=0;c<i.length;c++){const f=i[c],v=n[c];if(f.startsWith(":"))s[f.substring(1)]=v;else if(f!==v.path)return null}return{consumed:n.slice(0,i.length),posParams:s}}function bc(n,t){const e=n?Object.keys(n):void 0,i=t?Object.keys(t):void 0;if(!e||!i||e.length!=i.length)return!1;let s;for(let c=0;c<e.length;c++)if(s=e[c],!qS(n[s],t[s]))return!1;return!0}function qS(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),i=[...t].sort();return e.every((s,c)=>i[c]===s)}return n===t}function WS(n){return Array.prototype.concat.apply([],n)}function ZS(n){return n.length>0?n[n.length-1]:null}function ms(n,t){for(const e in n)n.hasOwnProperty(e)&&t(n[e],e)}function wc(n){return Eb(n)?n:Xg(n)?Mt(Promise.resolve(n)):Ot(n)}const rz={exact:function YS(n,t,e){if(!xf(n.segments,t.segments)||!dx(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!n.children[i]||!YS(n.children[i],t.children[i],e))return!1;return!0},subset:QS},XS={exact:function sz(n,t){return bc(n,t)},subset:function oz(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>qS(n[e],t[e]))},ignored:()=>!0};function KS(n,t,e){return rz[e.paths](n.root,t.root,e.matrixParams)&&XS[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function QS(n,t,e){return JS(n,t,t.segments,e)}function JS(n,t,e,i){if(n.segments.length>e.length){const s=n.segments.slice(0,e.length);return!(!xf(s,e)||t.hasChildren()||!dx(s,e,i))}if(n.segments.length===e.length){if(!xf(n.segments,e)||!dx(n.segments,e,i))return!1;for(const s in t.children)if(!n.children[s]||!QS(n.children[s],t.children[s],i))return!1;return!0}{const s=e.slice(0,n.segments.length),c=e.slice(n.segments.length);return!!(xf(n.segments,s)&&dx(n.segments,s,i)&&n.children[Dn])&&JS(n.children[Dn],t,c,i)}}function dx(n,t,e){return t.every((i,s)=>XS[e](n[s].parameters,i.parameters))}class vf{constructor(t,e,i){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=om(this.queryParams)),this._queryParamMap}toString(){return cz.serialize(this)}}class kn{constructor(t,e){this.segments=t,this.children=e,this.parent=null,ms(e,(i,s)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return hx(this)}}class x_{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=om(this.parameters)),this._parameterMap}toString(){return rA(this)}}function xf(n,t){return n.length===t.length&&n.every((e,i)=>e.path===t[i].path)}class eA{}class tA{parse(t){const e=new yz(t);return new vf(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${b_(t.root,!0)}`,i=function hz(n){const t=Object.keys(n).map(e=>{const i=n[e];return Array.isArray(i)?i.map(s=>`${fx(e)}=${fx(s)}`).join("&"):`${fx(e)}=${fx(i)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${e}${i}${"string"==typeof t.fragment?`#${function uz(n){return encodeURI(n)}(t.fragment)}`:""}`}}const cz=new tA;function hx(n){return n.segments.map(t=>rA(t)).join("/")}function b_(n,t){if(!n.hasChildren())return hx(n);if(t){const e=n.children[Dn]?b_(n.children[Dn],!1):"",i=[];return ms(n.children,(s,c)=>{c!==Dn&&i.push(`${c}:${b_(s,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function lz(n,t){let e=[];return ms(n.children,(i,s)=>{s===Dn&&(e=e.concat(t(i,s)))}),ms(n.children,(i,s)=>{s!==Dn&&(e=e.concat(t(i,s)))}),e}(n,(i,s)=>s===Dn?[b_(n.children[Dn],!1)]:[`${s}:${b_(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[Dn]?`${hx(n)}/${e[0]}`:`${hx(n)}/(${e.join("//")})`}}function nA(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function fx(n){return nA(n).replace(/%3B/gi,";")}function jw(n){return nA(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function px(n){return decodeURIComponent(n)}function iA(n){return px(n.replace(/\+/g,"%20"))}function rA(n){return`${jw(n.path)}${function dz(n){return Object.keys(n).map(t=>`;${jw(t)}=${jw(n[t])}`).join("")}(n.parameters)}`}const fz=/^[^\/()?;=#]+/;function mx(n){const t=n.match(fz);return t?t[0]:""}const pz=/^[^=?&#]+/,gz=/^[^&#]+/;class yz{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new kn([],{}):new kn([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[Dn]=new kn(t,e)),i}parseSegment(){const t=mx(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new x_(px(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=mx(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const s=mx(this.remaining);s&&(i=s,this.capture(i))}t[px(e)]=px(i)}parseQueryParam(t){const e=function mz(n){const t=n.match(pz);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const f=function _z(n){const t=n.match(gz);return t?t[0]:""}(this.remaining);f&&(i=f,this.capture(i))}const s=iA(e),c=iA(i);if(t.hasOwnProperty(s)){let f=t[s];Array.isArray(f)||(f=[f],t[s]=f),f.push(c)}else t[s]=c}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=mx(this.remaining),s=this.remaining[i.length];if("/"!==s&&")"!==s&&";"!==s)throw new Error(`Cannot parse url '${this.url}'`);let c;i.indexOf(":")>-1?(c=i.substr(0,i.indexOf(":")),this.capture(c),this.capture(":")):t&&(c=Dn);const f=this.parseChildren();e[c]=1===Object.keys(f).length?f[Dn]:new kn([],f),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class sA{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=Uw(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){const e=Uw(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=Gw(t,this._root);return e.length<2?[]:e[e.length-2].children.map(s=>s.value).filter(s=>s!==t)}pathFromRoot(t){return Gw(t,this._root).map(e=>e.value)}}function Uw(n,t){if(n===t.value)return t;for(const e of t.children){const i=Uw(n,e);if(i)return i}return null}function Gw(n,t){if(n===t.value)return[t];for(const e of t.children){const i=Gw(n,e);if(i.length)return i.unshift(t),i}return[]}class Bu{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function am(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class oA extends sA{constructor(t,e){super(t),this.snapshot=e,$w(this,t)}toString(){return this.snapshot.toString()}}function aA(n,t){const e=function vz(n,t){const f=new gx([],{},{},"",{},Dn,t,null,n.root,-1,{});return new cA("",new Bu(f,[]))}(n,t),i=new Jo([new x_("",{})]),s=new Jo({}),c=new Jo({}),f=new Jo({}),v=new Jo(""),C=new lm(i,s,f,v,c,Dn,t,e.root);return C.snapshot=e.root,new oA(new Bu(C,[]),e)}class lm{constructor(t,e,i,s,c,f,v,C){this.url=t,this.params=e,this.queryParams=i,this.fragment=s,this.data=c,this.outlet=f,this.component=v,this._futureSnapshot=C}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Tt(t=>om(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Tt(t=>om(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function lA(n,t="emptyOnly"){const e=n.pathFromRoot;let i=0;if("always"!==t)for(i=e.length-1;i>=1;){const s=e[i],c=e[i-1];if(s.routeConfig&&""===s.routeConfig.path)i--;else{if(c.component)break;i--}}return function xz(n){return n.reduce((t,e)=>({params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign({},t.resolve),e._resolvedData)}),{params:{},data:{},resolve:{}})}(e.slice(i))}class gx{constructor(t,e,i,s,c,f,v,C,S,I,L){this.url=t,this.params=e,this.queryParams=i,this.fragment=s,this.data=c,this.outlet=f,this.component=v,this.routeConfig=C,this._urlSegment=S,this._lastPathIndex=I,this._resolve=L}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=om(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=om(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class cA extends sA{constructor(t,e){super(e),this.url=t,$w(this,e)}toString(){return uA(this._root)}}function $w(n,t){t.value._routerState=n,t.children.forEach(e=>$w(n,e))}function uA(n){const t=n.children.length>0?` { ${n.children.map(uA).join(", ")} } `:"";return`${n.value}${t}`}function Hw(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,bc(t.queryParams,e.queryParams)||n.queryParams.next(e.queryParams),t.fragment!==e.fragment&&n.fragment.next(e.fragment),bc(t.params,e.params)||n.params.next(e.params),function nz(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!bc(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.url.next(e.url),bc(t.data,e.data)||n.data.next(e.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function qw(n,t){const e=bc(n.params,t.params)&&function az(n,t){return xf(n,t)&&n.every((e,i)=>bc(e.parameters,t[i].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||qw(n.parent,t.parent))}function w_(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=t.value;const s=function wz(n,t,e){return t.children.map(i=>{for(const s of e.children)if(n.shouldReuseRoute(i.value,s.value.snapshot))return w_(n,i,s);return w_(n,i)})}(n,t,e);return new Bu(i,s)}{if(n.shouldAttach(t.value)){const c=n.retrieve(t.value);if(null!==c){const f=c.route;return f.value._futureSnapshot=t.value,f.children=t.children.map(v=>w_(n,v)),f}}const i=function Cz(n){return new lm(new Jo(n.url),new Jo(n.params),new Jo(n.queryParams),new Jo(n.fragment),new Jo(n.data),n.outlet,n.component,n)}(t.value),s=t.children.map(c=>w_(n,c));return new Bu(i,s)}}function _x(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function C_(n){return"object"==typeof n&&null!=n&&n.outlets}function Ww(n,t,e,i,s){let c={};return i&&ms(i,(f,v)=>{c[v]=Array.isArray(f)?f.map(C=>`${C}`):`${f}`}),new vf(e.root===n?t:dA(e.root,n,t),c,s)}function dA(n,t,e){const i={};return ms(n.children,(s,c)=>{i[c]=s===t?e:dA(s,t,e)}),new kn(n.segments,i)}class hA{constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&_x(i[0]))throw new Error("Root segment cannot have matrix parameters");const s=i.find(C_);if(s&&s!==ZS(i))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Zw{constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}function fA(n,t,e){if(n||(n=new kn([],{})),0===n.segments.length&&n.hasChildren())return yx(n,t,e);const i=function Tz(n,t,e){let i=0,s=t;const c={match:!1,pathIndex:0,commandIndex:0};for(;s<n.segments.length;){if(i>=e.length)return c;const f=n.segments[s],v=e[i];if(C_(v))break;const C=`${v}`,S=i<e.length-1?e[i+1]:null;if(s>0&&void 0===C)break;if(C&&S&&"object"==typeof S&&void 0===S.outlets){if(!mA(C,S,f))return c;i+=2}else{if(!mA(C,{},f))return c;i++}s++}return{match:!0,pathIndex:s,commandIndex:i}}(n,t,e),s=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const c=new kn(n.segments.slice(0,i.pathIndex),{});return c.children[Dn]=new kn(n.segments.slice(i.pathIndex),n.children),yx(c,0,s)}return i.match&&0===s.length?new kn(n.segments,{}):i.match&&!n.hasChildren()?Xw(n,t,e):i.match?yx(n,0,s):Xw(n,t,e)}function yx(n,t,e){if(0===e.length)return new kn(n.segments,{});{const i=function Az(n){return C_(n[0])?n[0].outlets:{[Dn]:n}}(e),s={};return ms(i,(c,f)=>{"string"==typeof c&&(c=[c]),null!==c&&(s[f]=fA(n.children[f],t,c))}),ms(n.children,(c,f)=>{void 0===i[f]&&(s[f]=c)}),new kn(n.segments,s)}}function Xw(n,t,e){const i=n.segments.slice(0,t);let s=0;for(;s<e.length;){const c=e[s];if(C_(c)){const C=Iz(c.outlets);return new kn(i,C)}if(0===s&&_x(e[0])){i.push(new x_(n.segments[t].path,pA(e[0]))),s++;continue}const f=C_(c)?c.outlets[Dn]:`${c}`,v=s<e.length-1?e[s+1]:null;f&&v&&_x(v)?(i.push(new x_(f,pA(v))),s+=2):(i.push(new x_(f,{})),s++)}return new kn(i,{})}function Iz(n){const t={};return ms(n,(e,i)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[i]=Xw(new kn([],{}),0,e))}),t}function pA(n){const t={};return ms(n,(e,i)=>t[i]=`${e}`),t}function mA(n,t,e){return n==e.path&&bc(t,e.parameters)}class Fz{constructor(t,e,i,s){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=s}activate(t){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),Hw(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){const s=am(e);t.children.forEach(c=>{const f=c.value.outlet;this.deactivateRoutes(c,s[f],i),delete s[f]}),ms(s,(c,f)=>{this.deactivateRouteAndItsChildren(c,i)})}deactivateRoutes(t,e,i){const s=t.value,c=e?e.value:null;if(s===c)if(s.component){const f=i.getContext(s.outlet);f&&this.deactivateChildRoutes(t,e,f.children)}else this.deactivateChildRoutes(t,e,i);else c&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const i=e.getContext(t.value.outlet),s=i&&t.value.component?i.children:e,c=am(t);for(const f of Object.keys(c))this.deactivateRouteAndItsChildren(c[f],s);if(i&&i.outlet){const f=i.outlet.detach(),v=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:f,route:t,contexts:v})}}deactivateRouteAndOutlet(t,e){const i=e.getContext(t.value.outlet),s=i&&t.value.component?i.children:e,c=am(t);for(const f of Object.keys(c))this.deactivateRouteAndItsChildren(c[f],s);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,e,i){const s=am(e);t.children.forEach(c=>{this.activateRoutes(c,s[c.value.outlet],i),this.forwardEvent(new QN(c.value.snapshot))}),t.children.length&&this.forwardEvent(new KN(t.value.snapshot))}activateRoutes(t,e,i){const s=t.value,c=e?e.value:null;if(Hw(s),s===c)if(s.component){const f=i.getOrCreateContext(s.outlet);this.activateChildRoutes(t,e,f.children)}else this.activateChildRoutes(t,e,i);else if(s.component){const f=i.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const v=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),f.children.onOutletReAttached(v.contexts),f.attachRef=v.componentRef,f.route=v.route.value,f.outlet&&f.outlet.attach(v.componentRef,v.route.value),Hw(v.route.value),this.activateChildRoutes(t,null,f.children)}else{const v=function Rz(n){for(let t=n.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(s.snapshot),C=v?v.module.componentFactoryResolver:null;f.attachRef=null,f.route=s,f.resolver=C,f.outlet&&f.outlet.activateWith(s,C),this.activateChildRoutes(t,null,f.children)}}else this.activateChildRoutes(t,null,i)}}class Kw{constructor(t,e){this.routes=t,this.module=e}}function Vd(n){return"function"==typeof n}function bf(n){return n instanceof vf}const E_=Symbol("INITIAL_VALUE");function D_(){return Ml(n=>function BN(...n){const t=pt(n),e=xt(n),{args:i,keys:s}=FS(n);if(0===i.length)return Mt([],t);const c=new un(function NN(n,t,e=Ns){return i=>{PS(t,()=>{const{length:s}=n,c=new Array(s);let f=s,v=s;for(let C=0;C<s;C++)PS(t,()=>{const S=Mt(n[C],t);let I=!1;S.subscribe(new Cn(i,L=>{c[C]=L,I||(I=!0,v--),v||i.next(e(c.slice()))},()=>{--f||i.complete()}))},i)},i)}}(i,t,s?f=>RS(s,f):Ns));return e?c.pipe(Bw(e)):c}(n.map(t=>t.pipe(jn(1),rm(E_)))).pipe(BS((t,e)=>{let i=!1;return e.reduce((s,c,f)=>s!==E_?s:(c===E_&&(i=!0),i||!1!==c&&f!==e.length-1&&!bf(c)?s:c),t)},E_),ui(t=>t!==E_),Tt(t=>bf(t)?t:!0===t),jn(1)))}class zz{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new M_,this.attachRef=null}}class M_{constructor(){this.contexts=new Map}onChildOutletCreated(t,e){const i=this.getOrCreateContext(t);i.outlet=e,this.contexts.set(t,i)}onChildOutletDestroyed(t){const e=this.getContext(t);e&&(e.outlet=null,e.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let e=this.getContext(t);return e||(e=new zz,this.contexts.set(t,e)),e}getContext(t){return this.contexts.get(t)||null}}let Yw=(()=>{class n{constructor(e,i,s,c,f){this.parentContexts=e,this.location=i,this.resolver=s,this.changeDetector=f,this.activated=null,this._activatedRoute=null,this.activateEvents=new ti,this.deactivateEvents=new ti,this.attachEvents=new ti,this.detachEvents=new ti,this.name=c||Dn,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const f=(i=i||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),v=this.parentContexts.getOrCreateContext(this.name).children,C=new Vz(e,v,this.location.injector);this.activated=this.location.createComponent(f,this.location.length,C),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(e){return new(e||n)(se(M_),se(Ba),se(Od),$r("name"),se(vc))},n.\u0275dir=je({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),n})();class Vz{constructor(t,e,i){this.route=t,this.childContexts=e,this.parent=i}get(t,e){return t===lm?this.route:t===M_?this.childContexts:this.parent.get(t,e)}}let gA=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Un({type:n,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,i){1&e&&pr(0,"router-outlet")},directives:[Yw],encapsulation:2}),n})();function _A(n,t=""){for(let e=0;e<n.length;e++){const i=n[e];jz(i,Uz(t,i))}}function jz(n,t){n.children&&_A(n.children,t)}function Uz(n,t){return t?n||t.path?n&&!t.path?`${n}/`:!n&&t.path?t.path:`${n}/${t.path}`:"":n}function Qw(n){const t=n.children&&n.children.map(Qw),e=t?Object.assign(Object.assign({},n),{children:t}):Object.assign({},n);return!e.component&&(t||e.loadChildren)&&e.outlet&&e.outlet!==Dn&&(e.component=gA),e}function Va(n){return n.outlet||Dn}function yA(n,t){const e=n.filter(i=>Va(i)===t);return e.push(...n.filter(i=>Va(i)!==t)),e}const vA={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function vx(n,t,e){var i;if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?Object.assign({},vA):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const c=(t.matcher||tz)(e,n,t);if(!c)return Object.assign({},vA);const f={};ms(c.posParams,(C,S)=>{f[S]=C.path});const v=c.consumed.length>0?Object.assign(Object.assign({},f),c.consumed[c.consumed.length-1].parameters):f;return{matched:!0,consumedSegments:c.consumed,lastChild:c.consumed.length,parameters:v,positionalParamSegments:null!==(i=c.posParams)&&void 0!==i?i:{}}}function xx(n,t,e,i,s="corrected"){if(e.length>0&&function Hz(n,t,e){return e.some(i=>bx(n,t,i)&&Va(i)!==Dn)}(n,e,i)){const f=new kn(t,function $z(n,t,e,i){const s={};s[Dn]=i,i._sourceSegment=n,i._segmentIndexShift=t.length;for(const c of e)if(""===c.path&&Va(c)!==Dn){const f=new kn([],{});f._sourceSegment=n,f._segmentIndexShift=t.length,s[Va(c)]=f}return s}(n,t,i,new kn(e,n.children)));return f._sourceSegment=n,f._segmentIndexShift=t.length,{segmentGroup:f,slicedSegments:[]}}if(0===e.length&&function qz(n,t,e){return e.some(i=>bx(n,t,i))}(n,e,i)){const f=new kn(n.segments,function Gz(n,t,e,i,s,c){const f={};for(const v of i)if(bx(n,e,v)&&!s[Va(v)]){const C=new kn([],{});C._sourceSegment=n,C._segmentIndexShift="legacy"===c?n.segments.length:t.length,f[Va(v)]=C}return Object.assign(Object.assign({},s),f)}(n,t,e,i,n.children,s));return f._sourceSegment=n,f._segmentIndexShift=t.length,{segmentGroup:f,slicedSegments:e}}const c=new kn(n.segments,n.children);return c._sourceSegment=n,c._segmentIndexShift=t.length,{segmentGroup:c,slicedSegments:e}}function bx(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function xA(n,t,e,i){return!!(Va(n)===i||i!==Dn&&bx(t,e,n))&&("**"===n.path||vx(t,n,e).matched)}function bA(n,t,e){return 0===t.length&&!n.children[e]}class S_{constructor(t){this.segmentGroup=t||null}}class wA{constructor(t){this.urlTree=t}}function wx(n){return new un(t=>t.error(new S_(n)))}function CA(n){return new un(t=>t.error(new wA(n)))}function Wz(n){return new un(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${n}'`)))}class Kz{constructor(t,e,i,s,c){this.configLoader=e,this.urlSerializer=i,this.urlTree=s,this.config=c,this.allowRedirects=!0,this.ngModule=t.get(Tu)}apply(){const t=xx(this.urlTree.root,[],[],this.config).segmentGroup,e=new kn(t.segments,t.children);return this.expandSegmentGroup(this.ngModule,this.config,e,Dn).pipe(Tt(c=>this.createUrlTree(Jw(c),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Ou(c=>{if(c instanceof wA)return this.allowRedirects=!1,this.match(c.urlTree);throw c instanceof S_?this.noMatchError(c):c}))}match(t){return this.expandSegmentGroup(this.ngModule,this.config,t.root,Dn).pipe(Tt(s=>this.createUrlTree(Jw(s),t.queryParams,t.fragment))).pipe(Ou(s=>{throw s instanceof S_?this.noMatchError(s):s}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,e,i){const s=t.segments.length>0?new kn([],{[Dn]:t}):t;return new vf(s,e,i)}expandSegmentGroup(t,e,i,s){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,e,i).pipe(Tt(c=>new kn([],c))):this.expandSegment(t,i,e,i.segments,s,!0)}expandChildren(t,e,i){const s=[];for(const c of Object.keys(i.children))"primary"===c?s.unshift(c):s.push(c);return Mt(s).pipe(im(c=>{const f=i.children[c],v=yA(e,c);return this.expandSegmentGroup(t,v,f,c).pipe(Tt(C=>({segment:C,outlet:c})))}),BS((c,f)=>(c[f.outlet]=f.segment,c),{}),function UN(n,t){const e=arguments.length>=2;return i=>i.pipe(n?ui((s,c)=>n(s,c,i)):Ns,Nw(1),e?zS(t):NS(()=>new ux))}())}expandSegment(t,e,i,s,c,f){return Mt(i).pipe(im(v=>this.expandSegmentAgainstRoute(t,e,i,v,s,c,f).pipe(Ou(S=>{if(S instanceof S_)return Ot(null);throw S}))),sm(v=>!!v),Ou((v,C)=>{if(v instanceof ux||"EmptyError"===v.name){if(bA(e,s,c))return Ot(new kn([],{}));throw new S_(e)}throw v}))}expandSegmentAgainstRoute(t,e,i,s,c,f,v){return xA(s,e,c,f)?void 0===s.redirectTo?this.matchSegmentAgainstRoute(t,e,s,c,f):v&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,i,s,c,f):wx(e):wx(e)}expandSegmentAgainstRouteUsingRedirect(t,e,i,s,c,f){return"**"===s.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,s,f):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,s,c,f)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,i,s){const c=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?CA(c):this.lineralizeSegments(i,c).pipe(me(f=>{const v=new kn(f,{});return this.expandSegment(t,v,e,f,s,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,s,c,f){const{matched:v,consumedSegments:C,lastChild:S,positionalParamSegments:I}=vx(e,s,c);if(!v)return wx(e);const L=this.applyRedirectCommands(C,s.redirectTo,I);return s.redirectTo.startsWith("/")?CA(L):this.lineralizeSegments(s,L).pipe(me(q=>this.expandSegment(t,e,i,q.concat(c.slice(S)),f,!1)))}matchSegmentAgainstRoute(t,e,i,s,c){if("**"===i.path)return i.loadChildren?(i._loadedConfig?Ot(i._loadedConfig):this.configLoader.load(t.injector,i)).pipe(Tt(q=>(i._loadedConfig=q,new kn(s,{})))):Ot(new kn(s,{}));const{matched:f,consumedSegments:v,lastChild:C}=vx(e,i,s);if(!f)return wx(e);const S=s.slice(C);return this.getChildConfig(t,i,s).pipe(me(L=>{const q=L.module,X=L.routes,{segmentGroup:ue,slicedSegments:xe}=xx(e,v,S,X),ke=new kn(ue.segments,ue.children);if(0===xe.length&&ke.hasChildren())return this.expandChildren(q,X,ke).pipe(Tt(bt=>new kn(v,bt)));if(0===X.length&&0===xe.length)return Ot(new kn(v,{}));const Ie=Va(i)===c;return this.expandSegment(q,ke,X,xe,Ie?Dn:c,!0).pipe(Tt(it=>new kn(v.concat(it.segments),it.children)))}))}getChildConfig(t,e,i){return e.children?Ot(new Kw(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?Ot(e._loadedConfig):this.runCanLoadGuards(t.injector,e,i).pipe(me(s=>s?this.configLoader.load(t.injector,e).pipe(Tt(c=>(e._loadedConfig=c,c))):function Zz(n){return new un(t=>t.error(Vw(`Cannot load children because the guard of the route "path: '${n.path}'" returned false`)))}(e))):Ot(new Kw([],t))}runCanLoadGuards(t,e,i){const s=e.canLoad;return s&&0!==s.length?Ot(s.map(f=>{const v=t.get(f);let C;if(function Oz(n){return n&&Vd(n.canLoad)}(v))C=v.canLoad(e,i);else{if(!Vd(v))throw new Error("Invalid CanLoad guard");C=v(e,i)}return wc(C)})).pipe(D_(),Ir(f=>{if(!bf(f))return;const v=Vw(`Redirecting to "${this.urlSerializer.serialize(f)}"`);throw v.url=f,v}),Tt(f=>!0===f)):Ot(!0)}lineralizeSegments(t,e){let i=[],s=e.root;for(;;){if(i=i.concat(s.segments),0===s.numberOfChildren)return Ot(i);if(s.numberOfChildren>1||!s.children[Dn])return Wz(t.redirectTo);s=s.children[Dn]}}applyRedirectCommands(t,e,i){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,i)}applyRedirectCreatreUrlTree(t,e,i,s){const c=this.createSegmentGroup(t,e.root,i,s);return new vf(c,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const i={};return ms(t,(s,c)=>{if("string"==typeof s&&s.startsWith(":")){const v=s.substring(1);i[c]=e[v]}else i[c]=s}),i}createSegmentGroup(t,e,i,s){const c=this.createSegments(t,e.segments,i,s);let f={};return ms(e.children,(v,C)=>{f[C]=this.createSegmentGroup(t,v,i,s)}),new kn(c,f)}createSegments(t,e,i,s){return e.map(c=>c.path.startsWith(":")?this.findPosParam(t,c,s):this.findOrReturn(c,i))}findPosParam(t,e,i){const s=i[e.path.substring(1)];if(!s)throw new Error(`Cannot redirect to '${t}'. Cannot find '${e.path}'.`);return s}findOrReturn(t,e){let i=0;for(const s of e){if(s.path===t.path)return e.splice(i),s;i++}return t}}function Jw(n){const t={};for(const i of Object.keys(n.children)){const c=Jw(n.children[i]);(c.segments.length>0||c.hasChildren())&&(t[i]=c)}return function Yz(n){if(1===n.numberOfChildren&&n.children[Dn]){const t=n.children[Dn];return new kn(n.segments.concat(t.segments),t.children)}return n}(new kn(n.segments,t))}class EA{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Cx{constructor(t,e){this.component=t,this.route=e}}function Jz(n,t,e){const i=n._root;return A_(i,t?t._root:null,e,[i.value])}function Ex(n,t,e){const i=function tV(n){if(!n)return null;for(let t=n.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(t);return(i?i.module.injector:e).get(n)}function A_(n,t,e,i,s={canDeactivateChecks:[],canActivateChecks:[]}){const c=am(t);return n.children.forEach(f=>{(function nV(n,t,e,i,s={canDeactivateChecks:[],canActivateChecks:[]}){const c=n.value,f=t?t.value:null,v=e?e.getContext(n.value.outlet):null;if(f&&c.routeConfig===f.routeConfig){const C=function iV(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!xf(n.url,t.url);case"pathParamsOrQueryParamsChange":return!xf(n.url,t.url)||!bc(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!qw(n,t)||!bc(n.queryParams,t.queryParams);default:return!qw(n,t)}}(f,c,c.routeConfig.runGuardsAndResolvers);C?s.canActivateChecks.push(new EA(i)):(c.data=f.data,c._resolvedData=f._resolvedData),A_(n,t,c.component?v?v.children:null:e,i,s),C&&v&&v.outlet&&v.outlet.isActivated&&s.canDeactivateChecks.push(new Cx(v.outlet.component,f))}else f&&T_(t,v,s),s.canActivateChecks.push(new EA(i)),A_(n,null,c.component?v?v.children:null:e,i,s)})(f,c[f.value.outlet],e,i.concat([f.value]),s),delete c[f.value.outlet]}),ms(c,(f,v)=>T_(f,e.getContext(v),s)),s}function T_(n,t,e){const i=am(n),s=n.value;ms(i,(c,f)=>{T_(c,s.component?t?t.children.getContext(f):null:t,e)}),e.canDeactivateChecks.push(new Cx(s.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,s))}class hV{}function DA(n){return new un(t=>t.error(n))}class pV{constructor(t,e,i,s,c,f){this.rootComponentType=t,this.config=e,this.urlTree=i,this.url=s,this.paramsInheritanceStrategy=c,this.relativeLinkResolution=f}recognize(){const t=xx(this.urlTree.root,[],[],this.config.filter(f=>void 0===f.redirectTo),this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,t,Dn);if(null===e)return null;const i=new gx([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Dn,this.rootComponentType,null,this.urlTree.root,-1,{}),s=new Bu(i,e),c=new cA(this.url,s);return this.inheritParamsAndData(c._root),c}inheritParamsAndData(t){const e=t.value,i=lA(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),t.children.forEach(s=>this.inheritParamsAndData(s))}processSegmentGroup(t,e,i){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,i)}processChildren(t,e){const i=[];for(const c of Object.keys(e.children)){const f=e.children[c],v=yA(t,c),C=this.processSegmentGroup(v,f,c);if(null===C)return null;i.push(...C)}const s=MA(i);return function mV(n){n.sort((t,e)=>t.value.outlet===Dn?-1:e.value.outlet===Dn?1:t.value.outlet.localeCompare(e.value.outlet))}(s),s}processSegment(t,e,i,s){for(const c of t){const f=this.processSegmentAgainstRoute(c,e,i,s);if(null!==f)return f}return bA(e,i,s)?[]:null}processSegmentAgainstRoute(t,e,i,s){if(t.redirectTo||!xA(t,e,i,s))return null;let c,f=[],v=[];if("**"===t.path){const X=i.length>0?ZS(i).parameters:{};c=new gx(i,X,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,TA(t),Va(t),t.component,t,SA(e),AA(e)+i.length,IA(t))}else{const X=vx(e,t,i);if(!X.matched)return null;f=X.consumedSegments,v=i.slice(X.lastChild),c=new gx(f,X.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,TA(t),Va(t),t.component,t,SA(e),AA(e)+f.length,IA(t))}const C=function gV(n){return n.children?n.children:n.loadChildren?n._loadedConfig.routes:[]}(t),{segmentGroup:S,slicedSegments:I}=xx(e,f,v,C.filter(X=>void 0===X.redirectTo),this.relativeLinkResolution);if(0===I.length&&S.hasChildren()){const X=this.processChildren(C,S);return null===X?null:[new Bu(c,X)]}if(0===C.length&&0===I.length)return[new Bu(c,[])];const L=Va(t)===s,q=this.processSegment(C,S,I,L?Dn:s);return null===q?null:[new Bu(c,q)]}}function _V(n){const t=n.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function MA(n){const t=[],e=new Set;for(const i of n){if(!_V(i)){t.push(i);continue}const s=t.find(c=>i.value.routeConfig===c.value.routeConfig);void 0!==s?(s.children.push(...i.children),e.add(s)):t.push(i)}for(const i of e){const s=MA(i.children);t.push(new Bu(i.value,s))}return t.filter(i=>!e.has(i))}function SA(n){let t=n;for(;t._sourceSegment;)t=t._sourceSegment;return t}function AA(n){let t=n,e=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,e+=t._segmentIndexShift?t._segmentIndexShift:0;return e-1}function TA(n){return n.data||{}}function IA(n){return n.resolve||{}}function e1(n){return Ml(t=>{const e=n(t);return e?Mt(e).pipe(Tt(()=>t)):Ot(t)})}class DV extends class EV{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const t1=new dt("ROUTES");class kA{constructor(t,e,i,s){this.injector=t,this.compiler=e,this.onLoadStartListener=i,this.onLoadEndListener=s}load(t,e){if(e._loader$)return e._loader$;this.onLoadStartListener&&this.onLoadStartListener(e);const s=this.loadModuleFactory(e.loadChildren).pipe(Tt(c=>{this.onLoadEndListener&&this.onLoadEndListener(e);const f=c.create(t);return new Kw(WS(f.injector.get(t1,void 0,Gt.Self|Gt.Optional)).map(Qw),f)}),Ou(c=>{throw e._loader$=void 0,c}));return e._loader$=new LS(s,()=>new Nt).pipe(OS()),e._loader$}loadModuleFactory(t){return wc(t()).pipe(me(e=>e instanceof PD?Ot(e):Mt(this.compiler.compileModuleAsync(e))))}}class SV{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function AV(n){throw n}function TV(n,t,e){return t.parse("/")}function FA(n,t){return Ot(null)}const IV={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},kV={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ea=(()=>{class n{constructor(e,i,s,c,f,v,C){this.rootComponentType=e,this.urlSerializer=i,this.rootContexts=s,this.location=c,this.config=C,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Nt,this.errorHandler=AV,this.malformedUriErrorHandler=TV,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:FA,afterPreactivation:FA},this.urlHandlingStrategy=new SV,this.routeReuseStrategy=new DV,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=f.get(Tu),this.console=f.get(pM);const L=f.get(fn);this.isNgZoneEnabled=L instanceof fn&&fn.isInAngularZone(),this.resetConfig(C),this.currentUrlTree=function iz(){return new vf(new kn([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new kA(f,v,q=>this.triggerEvent(new US(q)),q=>this.triggerEvent(new GS(q))),this.routerState=aA(this.currentUrlTree,this.rootComponentType),this.transitions=new Jo({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const i=this.events;return e.pipe(ui(s=>0!==s.id),Tt(s=>Object.assign(Object.assign({},s),{extractedUrl:this.urlHandlingStrategy.extract(s.rawUrl)})),Ml(s=>{let c=!1,f=!1;return Ot(s).pipe(Ir(v=>{this.currentNavigation={id:v.id,initialUrl:v.currentRawUrl,extractedUrl:v.extractedUrl,trigger:v.source,extras:v.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Ml(v=>{const C=this.browserUrlTree.toString(),S=!this.navigated||v.extractedUrl.toString()!==C||C!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||S)&&this.urlHandlingStrategy.shouldProcessUrl(v.rawUrl))return Dx(v.source)&&(this.browserUrlTree=v.extractedUrl),Ot(v).pipe(Ml(L=>{const q=this.transitions.getValue();return i.next(new zw(L.id,this.serializeUrl(L.extractedUrl),L.source,L.restoredState)),q!==this.transitions.getValue()?he:Promise.resolve(L)}),function Qz(n,t,e,i){return Ml(s=>function Xz(n,t,e,i,s){return new Kz(n,t,e,i,s).apply()}(n,t,e,s.extractedUrl,i).pipe(Tt(c=>Object.assign(Object.assign({},s),{urlAfterRedirects:c}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Ir(L=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:L.urlAfterRedirects})}),function yV(n,t,e,i,s){return me(c=>function fV(n,t,e,i,s="emptyOnly",c="legacy"){try{const f=new pV(n,t,e,i,s,c).recognize();return null===f?DA(new hV):Ot(f)}catch(f){return DA(f)}}(n,t,c.urlAfterRedirects,e(c.urlAfterRedirects),i,s).pipe(Tt(f=>Object.assign(Object.assign({},c),{targetSnapshot:f}))))}(this.rootComponentType,this.config,L=>this.serializeUrl(L),this.paramsInheritanceStrategy,this.relativeLinkResolution),Ir(L=>{if("eager"===this.urlUpdateStrategy){if(!L.extras.skipLocationChange){const X=this.urlHandlingStrategy.merge(L.urlAfterRedirects,L.rawUrl);this.setBrowserUrl(X,L)}this.browserUrlTree=L.urlAfterRedirects}const q=new $N(L.id,this.serializeUrl(L.extractedUrl),this.serializeUrl(L.urlAfterRedirects),L.targetSnapshot);i.next(q)}));if(S&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:q,extractedUrl:X,source:ue,restoredState:xe,extras:ke}=v,Ie=new zw(q,this.serializeUrl(X),ue,xe);i.next(Ie);const Ee=aA(X,this.rootComponentType).snapshot;return Ot(Object.assign(Object.assign({},v),{targetSnapshot:Ee,urlAfterRedirects:X,extras:Object.assign(Object.assign({},ke),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=v.rawUrl,v.resolve(null),he}),e1(v=>{const{targetSnapshot:C,id:S,extractedUrl:I,rawUrl:L,extras:{skipLocationChange:q,replaceUrl:X}}=v;return this.hooks.beforePreactivation(C,{navigationId:S,appliedUrlTree:I,rawUrlTree:L,skipLocationChange:!!q,replaceUrl:!!X})}),Ir(v=>{const C=new HN(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(C)}),Tt(v=>Object.assign(Object.assign({},v),{guards:Jz(v.targetSnapshot,v.currentSnapshot,this.rootContexts)})),function rV(n,t){return me(e=>{const{targetSnapshot:i,currentSnapshot:s,guards:{canActivateChecks:c,canDeactivateChecks:f}}=e;return 0===f.length&&0===c.length?Ot(Object.assign(Object.assign({},e),{guardsResult:!0})):function sV(n,t,e,i){return Mt(n).pipe(me(s=>function dV(n,t,e,i,s){const c=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return c&&0!==c.length?Ot(c.map(v=>{const C=Ex(v,t,s);let S;if(function Nz(n){return n&&Vd(n.canDeactivate)}(C))S=wc(C.canDeactivate(n,t,e,i));else{if(!Vd(C))throw new Error("Invalid CanDeactivate guard");S=wc(C(n,t,e,i))}return S.pipe(sm())})).pipe(D_()):Ot(!0)}(s.component,s.route,e,t,i)),sm(s=>!0!==s,!0))}(f,i,s,n).pipe(me(v=>v&&function Pz(n){return"boolean"==typeof n}(v)?function oV(n,t,e,i){return Mt(t).pipe(im(s=>__(function lV(n,t){return null!==n&&t&&t(new XN(n)),Ot(!0)}(s.route.parent,i),function aV(n,t){return null!==n&&t&&t(new YN(n)),Ot(!0)}(s.route,i),function uV(n,t,e){const i=t[t.length-1],c=t.slice(0,t.length-1).reverse().map(f=>function eV(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(f)).filter(f=>null!==f).map(f=>y_(()=>Ot(f.guards.map(C=>{const S=Ex(C,f.node,e);let I;if(function Bz(n){return n&&Vd(n.canActivateChild)}(S))I=wc(S.canActivateChild(i,n));else{if(!Vd(S))throw new Error("Invalid CanActivateChild guard");I=wc(S(i,n))}return I.pipe(sm())})).pipe(D_())));return Ot(c).pipe(D_())}(n,s.path,e),function cV(n,t,e){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return Ot(!0);const s=i.map(c=>y_(()=>{const f=Ex(c,t,e);let v;if(function Lz(n){return n&&Vd(n.canActivate)}(f))v=wc(f.canActivate(t,n));else{if(!Vd(f))throw new Error("Invalid CanActivate guard");v=wc(f(t,n))}return v.pipe(sm())}));return Ot(s).pipe(D_())}(n,s.route,e))),sm(s=>!0!==s,!0))}(i,c,n,t):Ot(v)),Tt(v=>Object.assign(Object.assign({},e),{guardsResult:v})))})}(this.ngModule.injector,v=>this.triggerEvent(v)),Ir(v=>{if(bf(v.guardsResult)){const S=Vw(`Redirecting to "${this.serializeUrl(v.guardsResult)}"`);throw S.url=v.guardsResult,S}const C=new qN(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot,!!v.guardsResult);this.triggerEvent(C)}),ui(v=>!!v.guardsResult||(this.restoreHistory(v),this.cancelNavigationTransition(v,""),!1)),e1(v=>{if(v.guards.canActivateChecks.length)return Ot(v).pipe(Ir(C=>{const S=new WN(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(C.urlAfterRedirects),C.targetSnapshot);this.triggerEvent(S)}),Ml(C=>{let S=!1;return Ot(C).pipe(function vV(n,t){return me(e=>{const{targetSnapshot:i,guards:{canActivateChecks:s}}=e;if(!s.length)return Ot(e);let c=0;return Mt(s).pipe(im(f=>function xV(n,t,e,i){return function bV(n,t,e,i){const s=Object.keys(n);if(0===s.length)return Ot({});const c={};return Mt(s).pipe(me(f=>function wV(n,t,e,i){const s=Ex(n,t,i);return wc(s.resolve?s.resolve(t,e):s(t,e))}(n[f],t,e,i).pipe(Ir(v=>{c[f]=v}))),Nw(1),me(()=>Object.keys(c).length===s.length?Ot(c):he))}(n._resolve,n,t,i).pipe(Tt(c=>(n._resolvedData=c,n.data=Object.assign(Object.assign({},n.data),lA(n,e).resolve),null)))}(f.route,i,n,t)),Ir(()=>c++),Nw(1),me(f=>c===s.length?Ot(e):he))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Ir({next:()=>S=!0,complete:()=>{S||(this.restoreHistory(C),this.cancelNavigationTransition(C,"At least one route resolver didn't emit any value."))}}))}),Ir(C=>{const S=new ZN(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(C.urlAfterRedirects),C.targetSnapshot);this.triggerEvent(S)}))}),e1(v=>{const{targetSnapshot:C,id:S,extractedUrl:I,rawUrl:L,extras:{skipLocationChange:q,replaceUrl:X}}=v;return this.hooks.afterPreactivation(C,{navigationId:S,appliedUrlTree:I,rawUrlTree:L,skipLocationChange:!!q,replaceUrl:!!X})}),Tt(v=>{const C=function bz(n,t,e){const i=w_(n,t._root,e?e._root:void 0);return new oA(i,t)}(this.routeReuseStrategy,v.targetSnapshot,v.currentRouterState);return Object.assign(Object.assign({},v),{targetRouterState:C})}),Ir(v=>{this.currentUrlTree=v.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(v.urlAfterRedirects,v.rawUrl),this.routerState=v.targetRouterState,"deferred"===this.urlUpdateStrategy&&(v.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,v),this.browserUrlTree=v.urlAfterRedirects)}),((n,t,e)=>Tt(i=>(new Fz(t,i.targetRouterState,i.currentRouterState,e).activate(n),i)))(this.rootContexts,this.routeReuseStrategy,v=>this.triggerEvent(v)),Ir({next(){c=!0},complete(){c=!0}}),VS(()=>{var v;c||f||this.cancelNavigationTransition(s,`Navigation ID ${s.id} is not equal to the current navigation id ${this.navigationId}`),(null===(v=this.currentNavigation)||void 0===v?void 0:v.id)===s.id&&(this.currentNavigation=null)}),Ou(v=>{if(f=!0,function ez(n){return n&&n[HS]}(v)){const C=bf(v.url);C||(this.navigated=!0,this.restoreHistory(s,!0));const S=new jS(s.id,this.serializeUrl(s.extractedUrl),v.message);i.next(S),C?setTimeout(()=>{const I=this.urlHandlingStrategy.merge(v.url,this.rawUrlTree),L={skipLocationChange:s.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Dx(s.source)};this.scheduleNavigation(I,"imperative",null,L,{resolve:s.resolve,reject:s.reject,promise:s.promise})},0):s.resolve(!1)}else{this.restoreHistory(s,!0);const C=new GN(s.id,this.serializeUrl(s.extractedUrl),v);i.next(C);try{s.resolve(this.errorHandler(v))}catch(S){s.reject(S)}}return he}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i="popstate"===e.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var s;const c={replaceUrl:!0},f=(null===(s=e.state)||void 0===s?void 0:s.navigationId)?e.state:null;if(f){const C=Object.assign({},f);delete C.navigationId,delete C.\u0275routerPageId,0!==Object.keys(C).length&&(c.state=C)}const v=this.parseUrl(e.url);this.scheduleNavigation(v,i,f,c)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){_A(e),this.config=e.map(Qw),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,i={}){const{relativeTo:s,queryParams:c,fragment:f,queryParamsHandling:v,preserveFragment:C}=i,S=s||this.routerState.root,I=C?this.currentUrlTree.fragment:f;let L=null;switch(v){case"merge":L=Object.assign(Object.assign({},this.currentUrlTree.queryParams),c);break;case"preserve":L=this.currentUrlTree.queryParams;break;default:L=c||null}return null!==L&&(L=this.removeEmptyProps(L)),function Ez(n,t,e,i,s){if(0===e.length)return Ww(t.root,t.root,t,i,s);const c=function Dz(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new hA(!0,0,n);let t=0,e=!1;const i=n.reduce((s,c,f)=>{if("object"==typeof c&&null!=c){if(c.outlets){const v={};return ms(c.outlets,(C,S)=>{v[S]="string"==typeof C?C.split("/"):C}),[...s,{outlets:v}]}if(c.segmentPath)return[...s,c.segmentPath]}return"string"!=typeof c?[...s,c]:0===f?(c.split("/").forEach((v,C)=>{0==C&&"."===v||(0==C&&""===v?e=!0:".."===v?t++:""!=v&&s.push(v))}),s):[...s,c]},[]);return new hA(e,t,i)}(e);if(c.toRoot())return Ww(t.root,new kn([],{}),t,i,s);const f=function Mz(n,t,e){if(n.isAbsolute)return new Zw(t.root,!0,0);if(-1===e.snapshot._lastPathIndex){const c=e.snapshot._urlSegment;return new Zw(c,c===t.root,0)}const i=_x(n.commands[0])?0:1;return function Sz(n,t,e){let i=n,s=t,c=e;for(;c>s;){if(c-=s,i=i.parent,!i)throw new Error("Invalid number of '../'");s=i.segments.length}return new Zw(i,!1,s-c)}(e.snapshot._urlSegment,e.snapshot._lastPathIndex+i,n.numberOfDoubleDots)}(c,t,n),v=f.processChildren?yx(f.segmentGroup,f.index,c.commands):fA(f.segmentGroup,f.index,c.commands);return Ww(f.segmentGroup,v,t,i,s)}(S,this.currentUrlTree,e,L,null!=I?I:null)}navigateByUrl(e,i={skipLocationChange:!1}){const s=bf(e)?e:this.parseUrl(e),c=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(c,"imperative",null,i)}navigate(e,i={skipLocationChange:!1}){return function FV(n){for(let t=0;t<n.length;t++){const e=n[t];if(null==e)throw new Error(`The requested path contains ${e} segment at index ${t}`)}}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(s){i=this.malformedUriErrorHandler(s,this.urlSerializer,e)}return i}isActive(e,i){let s;if(s=!0===i?Object.assign({},IV):!1===i?Object.assign({},kV):i,bf(e))return KS(this.currentUrlTree,e,s);const c=this.parseUrl(e);return KS(this.currentUrlTree,c,s)}removeEmptyProps(e){return Object.keys(e).reduce((i,s)=>{const c=e[s];return null!=c&&(i[s]=c),i},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new v_(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,i,s,c,f){var v,C,S;if(this.disposed)return Promise.resolve(!1);const I=this.transitions.value,L=Dx(i)&&I&&!Dx(I.source),q=I.rawUrl.toString()===e.toString(),X=I.id===(null===(v=this.currentNavigation)||void 0===v?void 0:v.id);if(L&&q&&X)return Promise.resolve(!0);let xe,ke,Ie;f?(xe=f.resolve,ke=f.reject,Ie=f.promise):Ie=new Promise((bt,ln)=>{xe=bt,ke=ln});const Ee=++this.navigationId;let it;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(s=this.location.getState()),it=s&&s.\u0275routerPageId?s.\u0275routerPageId:c.replaceUrl||c.skipLocationChange?null!==(C=this.browserPageId)&&void 0!==C?C:0:(null!==(S=this.browserPageId)&&void 0!==S?S:0)+1):it=0,this.setTransition({id:Ee,targetPageId:it,source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:c,resolve:xe,reject:ke,promise:Ie,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Ie.catch(bt=>Promise.reject(bt))}setBrowserUrl(e,i){const s=this.urlSerializer.serialize(e),c=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl?this.location.replaceState(s,"",c):this.location.go(s,"",c)}restoreHistory(e,i=!1){var s,c;if("computed"===this.canceledNavigationResolution){const f=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(s=this.currentNavigation)||void 0===s?void 0:s.finalUrl)||0===f?this.currentUrlTree===(null===(c=this.currentNavigation)||void 0===c?void 0:c.finalUrl)&&0===f&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(f)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,i){const s=new jS(e.id,this.serializeUrl(e.extractedUrl),i);this.triggerEvent(s),e.resolve(!1)}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}}return n.\u0275fac=function(e){Mv()},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();function Dx(n){return"imperative"!==n}let Mx=(()=>{class n{constructor(e,i,s,c,f){this.router=e,this.route=i,this.tabIndexAttribute=s,this.renderer=c,this.el=f,this.commands=null,this.onChanges=new Nt,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(e){if(null!=this.tabIndexAttribute)return;const i=this.renderer,s=this.el.nativeElement;null!==e?i.setAttribute(s,"tabindex",e):i.removeAttribute(s,"tabindex")}ngOnChanges(e){this.onChanges.next(this)}set routerLink(e){null!=e?(this.commands=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const e={skipLocationChange:cm(this.skipLocationChange),replaceUrl:cm(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,e),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:cm(this.preserveFragment)})}}return n.\u0275fac=function(e){return new(e||n)(se(ea),se(lm),$r("tabindex"),se(wl),se(Pt))},n.\u0275dir=je({type:n,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(e,i){1&e&&Ki("click",function(){return i.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[Li]}),n})(),Sx=(()=>{class n{constructor(e,i,s){this.router=e,this.route=i,this.locationStrategy=s,this.commands=null,this.href=null,this.onChanges=new Nt,this.subscription=e.events.subscribe(c=>{c instanceof v_&&this.updateTargetUrlAndHref()})}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:null}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,i,s,c,f){if(0!==e||i||s||c||f||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const v={skipLocationChange:cm(this.skipLocationChange),replaceUrl:cm(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,v),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:cm(this.preserveFragment)})}}return n.\u0275fac=function(e){return new(e||n)(se(ea),se(lm),se(tm))},n.\u0275dir=je({type:n,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,i){1&e&&Ki("click",function(c){return i.onClick(c.button,c.ctrlKey,c.shiftKey,c.altKey,c.metaKey)}),2&e&&rr("target",i.target)("href",i.href,Uh)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[Li]}),n})();function cm(n){return""===n||!!n}class RA{}class PA{preload(t,e){return Ot(null)}}let OA=(()=>{class n{constructor(e,i,s,c){this.router=e,this.injector=s,this.preloadingStrategy=c,this.loader=new kA(s,i,C=>e.triggerEvent(new US(C)),C=>e.triggerEvent(new GS(C)))}setUpPreloading(){this.subscription=this.router.events.pipe(ui(e=>e instanceof v_),im(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(Tu);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){const s=[];for(const c of i)if(c.loadChildren&&!c.canLoad&&c._loadedConfig){const f=c._loadedConfig;s.push(this.processRoutes(f.module,f.routes))}else c.loadChildren&&!c.canLoad?s.push(this.preloadConfig(e,c)):c.children&&s.push(this.processRoutes(e,c.children));return Mt(s).pipe(_e(),Tt(c=>{}))}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>(i._loadedConfig?Ot(i._loadedConfig):this.loader.load(e.injector,i)).pipe(me(c=>(i._loadedConfig=c,this.processRoutes(c.module,c.routes)))))}}return n.\u0275fac=function(e){return new(e||n)(Ce(ea),Ce(Uv),Ce(ce),Ce(RA))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})(),n1=(()=>{class n{constructor(e,i,s={}){this.router=e,this.viewportScroller=i,this.options=s,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},s.scrollPositionRestoration=s.scrollPositionRestoration||"disabled",s.anchorScrolling=s.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof zw?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof v_&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof $S&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.router.triggerEvent(new $S(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(e){Mv()},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();const wf=new dt("ROUTER_CONFIGURATION"),LA=new dt("ROUTER_FORROOT_GUARD"),LV=[c_,{provide:eA,useClass:tA},{provide:ea,useFactory:function jV(n,t,e,i,s,c,f={},v,C){const S=new ea(null,n,t,e,i,s,WS(c));return v&&(S.urlHandlingStrategy=v),C&&(S.routeReuseStrategy=C),function UV(n,t){n.errorHandler&&(t.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(t.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(t.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(t.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(t.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(t.canceledNavigationResolution=n.canceledNavigationResolution)}(f,S),f.enableTracing&&S.events.subscribe(I=>{var L,q;null===(L=console.group)||void 0===L||L.call(console,`Router Event: ${I.constructor.name}`),console.log(I.toString()),console.log(I),null===(q=console.groupEnd)||void 0===q||q.call(console)}),S},deps:[eA,M_,c_,ce,Uv,t1,wf,[class MV{},new Ts],[class CV{},new Ts]]},M_,{provide:lm,useFactory:function GV(n){return n.routerState.root},deps:[ea]},OA,PA,class OV{preload(t,e){return e().pipe(Ou(()=>Ot(null)))}},{provide:wf,useValue:{enableTracing:!1}}];function BV(){return new xM("Router",ea)}let BA=(()=>{class n{constructor(e,i){}static forRoot(e,i){return{ngModule:n,providers:[LV,NA(e),{provide:LA,useFactory:VV,deps:[[ea,new Ts,new uu]]},{provide:wf,useValue:i||{}},{provide:tm,useFactory:zV,deps:[yf,[new Ql(uw),new Ts],wf]},{provide:n1,useFactory:NV,deps:[ea,RB,wf]},{provide:RA,useExisting:i&&i.preloadingStrategy?i.preloadingStrategy:PA},{provide:xM,multi:!0,useFactory:BV},[r1,{provide:a_,multi:!0,useFactory:$V,deps:[r1]},{provide:zA,useFactory:HV,deps:[r1]},{provide:Qb,multi:!0,useExisting:zA}]]}}static forChild(e){return{ngModule:n,providers:[NA(e)]}}}return n.\u0275fac=function(e){return new(e||n)(Ce(LA,8),Ce(ea,8))},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({}),n})();function NV(n,t,e){return e.scrollOffset&&t.setOffset(e.scrollOffset),new n1(n,t,e)}function zV(n,t,e={}){return e.useHash?new _L(n,t):new UM(n,t)}function VV(n){return"guarded"}function NA(n){return[{provide:b0,multi:!0,useValue:n},{provide:t1,multi:!0,useValue:n}]}let r1=(()=>{class n{constructor(e){this.injector=e,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Nt}appInitializer(){return this.injector.get(pL,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let i=null;const s=new Promise(v=>i=v),c=this.injector.get(ea),f=this.injector.get(wf);return"disabled"===f.initialNavigation?(c.setUpLocationChangeListener(),i(!0)):"enabled"===f.initialNavigation||"enabledBlocking"===f.initialNavigation?(c.hooks.afterPreactivation=()=>this.initNavigation?Ot(null):(this.initNavigation=!0,i(!0),this.resultOfPreactivationDone),c.initialNavigation()):i(!0),s})}bootstrapListener(e){const i=this.injector.get(wf),s=this.injector.get(OA),c=this.injector.get(n1),f=this.injector.get(ea),v=this.injector.get(gf);e===v.components[0]&&(("enabledNonBlocking"===i.initialNavigation||void 0===i.initialNavigation)&&f.initialNavigation(),s.setUpPreloading(),c.init(),f.resetRootComponentType(v.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return n.\u0275fac=function(e){return new(e||n)(Ce(ce))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();function $V(n){return n.appInitializer.bind(n)}function HV(n){return n.bootstrapListener.bind(n)}const zA=new dt("Router Initializer");let VA=(()=>{class n{constructor(e){this.http=e,this.baseUrl="./assets/data"}getProductos(){return this.http.get(`${this.baseUrl}/data.json`)}getSucursales(){return this.http.get(`${this.baseUrl}/sucursales.json`)}}return n.\u0275fac=function(e){return new(e||n)(Ce(cx))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Ii(n){return null!=n&&"false"!=`${n}`}function jA(n,t=0){return function WV(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):t}function UA(n){return Array.isArray(n)?n:[n]}function yr(n){return null==n?"":"string"==typeof n?n:`${n}px`}function um(n){return n instanceof Pt?n.nativeElement:n}const ZV=new dt("cdk-dir-doc",{providedIn:"root",factory:function XV(){return md(sn)}}),KV=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let s1,Cf=(()=>{class n{constructor(e){if(this.value="ltr",this.change=new ti,e){const s=e.documentElement?e.documentElement.dir:null;this.value=function YV(n){const t=(null==n?void 0:n.toLowerCase())||"";return"auto"===t&&"undefined"!=typeof navigator&&(null==navigator?void 0:navigator.language)?KV.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((e.body?e.body.dir:null)||s||"ltr")}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(e){return new(e||n)(Ce(ZV,8))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),dm=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({}),n})();try{s1="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){s1=!1}let I_,Tx,Ef,a1,ja=(()=>{class n{constructor(e){this._platformId=e,this.isBrowser=this._platformId?Ru(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!s1)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(e){return new(e||n)(Ce(so))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function o1(n){return function QV(){if(null==I_&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>I_=!0}))}finally{I_=I_||!1}return I_}()?n:!!n.capture}function HA(){if(null==Ef){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Ef=!1,Ef;if("scrollBehavior"in document.documentElement.style)Ef=!0;else{const n=Element.prototype.scrollTo;Ef=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return Ef}function k_(){if("object"!=typeof document||!document)return 0;if(null==Tx){const n=document.createElement("div"),t=n.style;n.dir="rtl",t.width="1px",t.overflow="auto",t.visibility="hidden",t.pointerEvents="none",t.position="absolute";const e=document.createElement("div"),i=e.style;i.width="2px",i.height="1px",n.appendChild(e),document.body.appendChild(n),Tx=0,0===n.scrollLeft&&(n.scrollLeft=1,Tx=0===n.scrollLeft?1:2),n.remove()}return Tx}function l1(){let n="undefined"!=typeof document&&document?document.activeElement:null;for(;n&&n.shadowRoot;){const t=n.shadowRoot.activeElement;if(t===n)break;n=t}return n}function Df(n){return n.composedPath?n.composedPath()[0]:n.target}function c1(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}function F_(n,...t){return t.length?t.some(e=>n[e]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}class _3 extends Wn{constructor(t,e){super()}schedule(t,e=0){return this}}const Ix={setInterval(...n){const{delegate:t}=Ix;return((null==t?void 0:t.setInterval)||setInterval)(...n)},clearInterval(n){const{delegate:t}=Ix;return((null==t?void 0:t.clearInterval)||clearInterval)(n)},delegate:void 0};class u1 extends _3{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const i=this.id,s=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(s,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(s,this.id,e),this}requestAsyncId(t,e,i=0){return Ix.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;Ix.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let s,i=!1;try{this.work(t)}catch(c){i=!0,s=c||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,p(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}const KA={now:()=>(KA.delegate||Date).now(),delegate:void 0};class R_{constructor(t,e=R_.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}}R_.now=KA.now;class d1 extends R_{constructor(t,e=R_.now){super(t,e),this.actions=[],this._active=!1,this._scheduled=void 0}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}const h1=new d1(u1),YA=h1;function JA(n,t=Ns){return n=null!=n?n:v3,Pn((e,i)=>{let s,c=!0;e.subscribe(new Cn(i,f=>{const v=t(f);(c||!n(s,v))&&(c=!1,s=v,i.next(f))}))})}function v3(n,t){return n===t}function Vi(n){return Pn((t,e)=>{Ri(n).subscribe(new Cn(e,()=>e.complete(),Jr)),!e.closed&&t.subscribe(e)})}let f1=(()=>{class n{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function D3(n){return!!(n.offsetWidth||n.offsetHeight||"function"==typeof n.getClientRects&&n.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const i=function E3(n){try{return n.frameElement}catch(t){return null}}(function R3(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}(e));if(i&&(-1===iT(i)||!this.isVisible(i)))return!1;let s=e.nodeName.toLowerCase(),c=iT(e);return e.hasAttribute("contenteditable")?-1!==c:!("iframe"===s||"object"===s||this._platform.WEBKIT&&this._platform.IOS&&!function k3(n){let t=n.nodeName.toLowerCase(),e="input"===t&&n.type;return"text"===e||"password"===e||"select"===t||"textarea"===t}(e))&&("audio"===s?!!e.hasAttribute("controls")&&-1!==c:"video"===s?-1!==c&&(null!==c||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,i){return function F3(n){return!function S3(n){return function T3(n){return"input"==n.nodeName.toLowerCase()}(n)&&"hidden"==n.type}(n)&&(function M3(n){let t=n.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(n)||function A3(n){return function I3(n){return"a"==n.nodeName.toLowerCase()}(n)&&n.hasAttribute("href")}(n)||n.hasAttribute("contenteditable")||nT(n))}(e)&&!this.isDisabled(e)&&((null==i?void 0:i.ignoreVisibility)||this.isVisible(e))}}return n.\u0275fac=function(e){return new(e||n)(Ce(ja))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function nT(n){if(!n.hasAttribute("tabindex")||void 0===n.tabIndex)return!1;let t=n.getAttribute("tabindex");return!(!t||isNaN(parseInt(t,10)))}function iT(n){if(!nT(n))return null;const t=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}class P3{constructor(t,e,i,s,c=!1){this._element=t,this._checker=e,this._ngZone=i,this._document=s,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,c||this.attachAnchors()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}destroy(){const t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){const e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return"start"==t?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return null==i||i.focus(t),!!i}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){const e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=0;i<e.length;i++){const s=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(s)return s}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=e.length-1;i>=0;i--){const s=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(s)return s}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(jn(1)).subscribe(t)}}let rT=(()=>{class n{constructor(e,i,s){this._checker=e,this._ngZone=i,this._document=s}create(e,i=!1){return new P3(e,this._checker,this._ngZone,this._document,i)}}return n.\u0275fac=function(e){return new(e||n)(Ce(f1),Ce(fn),Ce(sn))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function sT(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}function oT(n){const t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}const O3=new dt("cdk-input-modality-detector-options"),L3={ignoreKeys:[18,17,224,91,16]},fm=o1({passive:!0,capture:!0});let B3=(()=>{class n{constructor(e,i,s,c){this._platform=e,this._mostRecentTarget=null,this._modality=new Jo(null),this._lastTouchMs=0,this._onKeydown=f=>{var v,C;(null===(C=null===(v=this._options)||void 0===v?void 0:v.ignoreKeys)||void 0===C?void 0:C.some(S=>S===f.keyCode))||(this._modality.next("keyboard"),this._mostRecentTarget=Df(f))},this._onMousedown=f=>{Date.now()-this._lastTouchMs<650||(this._modality.next(sT(f)?"keyboard":"mouse"),this._mostRecentTarget=Df(f))},this._onTouchstart=f=>{oT(f)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Df(f))},this._options=Object.assign(Object.assign({},L3),c),this.modalityDetected=this._modality.pipe(function y3(n){return ui((t,e)=>n<=e)}(1)),this.modalityChanged=this.modalityDetected.pipe(JA()),e.isBrowser&&i.runOutsideAngular(()=>{s.addEventListener("keydown",this._onKeydown,fm),s.addEventListener("mousedown",this._onMousedown,fm),s.addEventListener("touchstart",this._onTouchstart,fm)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,fm),document.removeEventListener("mousedown",this._onMousedown,fm),document.removeEventListener("touchstart",this._onTouchstart,fm))}}return n.\u0275fac=function(e){return new(e||n)(Ce(ja),Ce(fn),Ce(sn),Ce(O3,8))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const z3=new dt("cdk-focus-monitor-default-options"),kx=o1({passive:!0,capture:!0});let Fx=(()=>{class n{constructor(e,i,s,c,f){this._ngZone=e,this._platform=i,this._inputModalityDetector=s,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Nt,this._rootNodeFocusAndBlurListener=v=>{const C=Df(v),S="focus"===v.type?this._onFocus:this._onBlur;for(let I=C;I;I=I.parentElement)S.call(this,v,I)},this._document=c,this._detectionMode=(null==f?void 0:f.detectionMode)||0}monitor(e,i=!1){const s=um(e);if(!this._platform.isBrowser||1!==s.nodeType)return Ot(null);const c=function e3(n){if(function JV(){if(null==a1){const n="undefined"!=typeof document?document.head:null;a1=!(!n||!n.createShadowRoot&&!n.attachShadow)}return a1}()){const t=n.getRootNode?n.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(s)||this._getDocument(),f=this._elementInfo.get(s);if(f)return i&&(f.checkChildren=!0),f.subject;const v={checkChildren:i,subject:new Nt,rootNode:c};return this._elementInfo.set(s,v),this._registerGlobalListeners(v),v.subject}stopMonitoring(e){const i=um(e),s=this._elementInfo.get(i);s&&(s.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(s))}focusVia(e,i,s){const c=um(e);c===this._getDocument().activeElement?this._getClosestElementsInfo(c).forEach(([v,C])=>this._originChanged(v,i,C)):(this._setOrigin(i),"function"==typeof c.focus&&c.focus(s))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!!(null==e?void 0:e.contains(this._inputModalityDetector._mostRecentTarget))}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused","touch"===i),e.classList.toggle("cdk-keyboard-focused","keyboard"===i),e.classList.toggle("cdk-mouse-focused","mouse"===i),e.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,i){const s=this._elementInfo.get(i),c=Df(e);!s||!s.checkChildren&&i!==c||this._originChanged(i,this._getFocusOrigin(c),s)}_onBlur(e,i){const s=this._elementInfo.get(i);!s||s.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(s.subject,null))}_emitOrigin(e,i){this._ngZone.run(()=>e.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const i=e.rootNode,s=this._rootNodeFocusListenerCount.get(i)||0;s||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,kx),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,kx)}),this._rootNodeFocusListenerCount.set(i,s+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Vi(this._stopInputModalityDetector)).subscribe(c=>{this._setOrigin(c,!0)}))}_removeGlobalListeners(e){const i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const s=this._rootNodeFocusListenerCount.get(i);s>1?this._rootNodeFocusListenerCount.set(i,s-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,kx),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,kx),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,s){this._setClasses(e,i),this._emitOrigin(s.subject,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){const i=[];return this._elementInfo.forEach((s,c)=>{(c===e||s.checkChildren&&c.contains(e))&&i.push([c,s])}),i}}return n.\u0275fac=function(e){return new(e||n)(Ce(fn),Ce(ja),Ce(B3),Ce(sn,8),Ce(z3,8))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const lT="cdk-high-contrast-black-on-white",cT="cdk-high-contrast-white-on-black",p1="cdk-high-contrast-active";let V3=(()=>{class n{constructor(e,i){this._platform=e,this._document=i}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,s=i&&i.getComputedStyle?i.getComputedStyle(e):null,c=(s&&s.backgroundColor||"").replace(/ /g,"");switch(e.remove(),c){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(p1),e.remove(lT),e.remove(cT),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?(e.add(p1),e.add(lT)):2===i&&(e.add(p1),e.add(cT))}}}return n.\u0275fac=function(e){return new(e||n)(Ce(ja),Ce(sn))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class uT{}const Nu="*";function m1(n,t){return{type:7,name:n,definitions:t,options:{}}}function P_(n,t=null){return{type:4,styles:t,timings:n}}function dT(n,t=null){return{type:3,steps:n,options:t}}function hT(n,t=null){return{type:2,steps:n,options:t}}function Cc(n){return{type:6,styles:n,offset:null}}function O_(n,t,e){return{type:0,name:n,styles:t,options:e}}function L_(n,t,e=null){return{type:1,expr:n,animation:t,options:e}}function fT(n=null){return{type:9,options:n}}function pT(n,t,e=null){return{type:11,selector:n,animation:t,options:e}}function mT(n){Promise.resolve(null).then(n)}class pm{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){mT(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class gT{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,i=0,s=0;const c=this.players.length;0==c?mT(()=>this._onFinish()):this.players.forEach(f=>{f.onDone(()=>{++e==c&&this._onFinish()}),f.onDestroy(()=>{++i==c&&this._onDestroy()}),f.onStart(()=>{++s==c&&this._onStart()})}),this.totalTime=this.players.reduce((f,v)=>Math.max(f,v.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(i=>{const s=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(s)})}getPosition(){const t=this.players.reduce((e,i)=>null===e||i.totalTime>e.totalTime?i:e,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}function _T(){return"undefined"!=typeof window&&void 0!==window.document}function _1(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function jd(n){switch(n.length){case 0:return new pm;case 1:return n[0];default:return new gT(n)}}function yT(n,t,e,i,s={},c={}){const f=[],v=[];let C=-1,S=null;if(i.forEach(I=>{const L=I.offset,q=L==C,X=q&&S||{};Object.keys(I).forEach(ue=>{let xe=ue,ke=I[ue];if("offset"!==ue)switch(xe=t.normalizePropertyName(xe,f),ke){case"!":ke=s[ue];break;case Nu:ke=c[ue];break;default:ke=t.normalizeStyleValue(ue,xe,ke,f)}X[xe]=ke}),q||v.push(X),S=X,C=L}),f.length){const I="\n - ";throw new Error(`Unable to animate due to the following errors:${I}${f.join(I)}`)}return v}function y1(n,t,e,i){switch(t){case"start":n.onStart(()=>i(e&&v1(e,"start",n)));break;case"done":n.onDone(()=>i(e&&v1(e,"done",n)));break;case"destroy":n.onDestroy(()=>i(e&&v1(e,"destroy",n)))}}function v1(n,t,e){const i=e.totalTime,c=x1(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,null==i?n.totalTime:i,!!e.disabled),f=n._data;return null!=f&&(c._data=f),c}function x1(n,t,e,i,s="",c=0,f){return{element:n,triggerName:t,fromState:e,toState:i,phaseName:s,totalTime:c,disabled:!!f}}function ta(n,t,e){let i;return n instanceof Map?(i=n.get(t),i||n.set(t,i=e)):(i=n[t],i||(i=n[t]=e)),i}function vT(n){const t=n.indexOf(":");return[n.substring(1,t),n.substr(t+1)]}let b1=(n,t)=>!1,xT=(n,t,e)=>[];(_1()||"undefined"!=typeof Element)&&(b1=_T()?(n,t)=>{for(;t&&t!==document.documentElement;){if(t===n)return!0;t=t.parentNode||t.host}return!1}:(n,t)=>n.contains(t),xT=(n,t,e)=>{if(e)return Array.from(n.querySelectorAll(t));const i=n.querySelector(t);return i?[i]:[]});let Mf=null,bT=!1;function w1(n){Mf||(Mf=function G3(){return"undefined"!=typeof document?document.body:null}()||{},bT=!!Mf.style&&"WebkitAppearance"in Mf.style);let t=!0;return Mf.style&&!function U3(n){return"ebkit"==n.substring(1,6)}(n)&&(t=n in Mf.style,!t&&bT&&(t="Webkit"+n.charAt(0).toUpperCase()+n.substr(1)in Mf.style)),t}const C1=b1,E1=xT;function wT(n){const t={};return Object.keys(n).forEach(e=>{const i=e.replace(/([a-z])([A-Z])/g,"$1-$2");t[i]=n[e]}),t}let CT=(()=>{class n{validateStyleProperty(e){return w1(e)}matchesElement(e,i){return!1}containsElement(e,i){return C1(e,i)}query(e,i,s){return E1(e,i,s)}computeStyle(e,i,s){return s||""}animate(e,i,s,c,f,v=[],C){return new pm(s,c)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})(),D1=(()=>{class n{}return n.NOOP=new CT,n})();const M1="ng-enter",Rx="ng-leave",Px="ng-trigger",Ox=".ng-trigger",DT="ng-animating",S1=".ng-animating";function Sf(n){if("number"==typeof n)return n;const t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:A1(parseFloat(t[1]),t[2])}function A1(n,t){return"s"===t?1e3*n:n}function Lx(n,t,e){return n.hasOwnProperty("duration")?n:function q3(n,t,e){let s,c=0,f="";if("string"==typeof n){const v=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===v)return t.push(`The provided timing value "${n}" is invalid.`),{duration:0,delay:0,easing:""};s=A1(parseFloat(v[1]),v[2]);const C=v[3];null!=C&&(c=A1(parseFloat(C),v[4]));const S=v[5];S&&(f=S)}else s=n;if(!e){let v=!1,C=t.length;s<0&&(t.push("Duration values below 0 are not allowed for this animation step."),v=!0),c<0&&(t.push("Delay values below 0 are not allowed for this animation step."),v=!0),v&&t.splice(C,0,`The provided timing value "${n}" is invalid.`)}return{duration:s,delay:c,easing:f}}(n,t,e)}function mm(n,t={}){return Object.keys(n).forEach(e=>{t[e]=n[e]}),t}function Ud(n,t,e={}){if(t)for(let i in n)e[i]=n[i];else mm(n,e);return e}function ST(n,t,e){return e?t+":"+e+";":""}function AT(n){let t="";for(let e=0;e<n.style.length;e++){const i=n.style.item(e);t+=ST(0,i,n.style.getPropertyValue(i))}for(const e in n.style)n.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=ST(0,X3(e),n.style[e]));n.setAttribute("style",t)}function Ec(n,t,e){n.style&&(Object.keys(t).forEach(i=>{const s=I1(i);e&&!e.hasOwnProperty(i)&&(e[i]=n.style[s]),n.style[s]=t[i]}),_1()&&AT(n))}function Af(n,t){n.style&&(Object.keys(t).forEach(e=>{const i=I1(e);n.style[i]=""}),_1()&&AT(n))}function B_(n){return Array.isArray(n)?1==n.length?n[0]:hT(n):n}const T1=new RegExp("{{\\s*(.+?)\\s*}}","g");function TT(n){let t=[];if("string"==typeof n){let e;for(;e=T1.exec(n);)t.push(e[1]);T1.lastIndex=0}return t}function Bx(n,t,e){const i=n.toString(),s=i.replace(T1,(c,f)=>{let v=t[f];return t.hasOwnProperty(f)||(e.push(`Please provide a value for the animation param ${f}`),v=""),v.toString()});return s==i?n:s}function Nx(n){const t=[];let e=n.next();for(;!e.done;)t.push(e.value),e=n.next();return t}const Z3=/-+([a-z0-9])/g;function I1(n){return n.replace(Z3,(...t)=>t[1].toUpperCase())}function X3(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function IT(n,t){return 0===n||0===t}function kT(n,t,e){const i=Object.keys(e);if(i.length&&t.length){let c=t[0],f=[];if(i.forEach(v=>{c.hasOwnProperty(v)||f.push(v),c[v]=e[v]}),f.length)for(var s=1;s<t.length;s++){let v=t[s];f.forEach(function(C){v[C]=k1(n,C)})}}return t}function na(n,t,e){switch(t.type){case 7:return n.visitTrigger(t,e);case 0:return n.visitState(t,e);case 1:return n.visitTransition(t,e);case 2:return n.visitSequence(t,e);case 3:return n.visitGroup(t,e);case 4:return n.visitAnimate(t,e);case 5:return n.visitKeyframes(t,e);case 6:return n.visitStyle(t,e);case 8:return n.visitReference(t,e);case 9:return n.visitAnimateChild(t,e);case 10:return n.visitAnimateRef(t,e);case 11:return n.visitQuery(t,e);case 12:return n.visitStagger(t,e);default:throw new Error(`Unable to resolve animation metadata node #${t.type}`)}}function k1(n,t){return window.getComputedStyle(n)[t]}function K3(n,t){const e=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function Y3(n,t,e){if(":"==n[0]){const C=function Q3(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return t.push(`The transition alias value "${n}" is not supported`),"* => *"}}(n,e);if("function"==typeof C)return void t.push(C);n=C}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return e.push(`The provided transition expression "${n}" is not supported`),t;const s=i[1],c=i[2],f=i[3];t.push(FT(s,f));"<"==c[0]&&!("*"==s&&"*"==f)&&t.push(FT(f,s))}(i,e,t)):e.push(n),e}const Vx=new Set(["true","1"]),jx=new Set(["false","0"]);function FT(n,t){const e=Vx.has(n)||jx.has(n),i=Vx.has(t)||jx.has(t);return(s,c)=>{let f="*"==n||n==s,v="*"==t||t==c;return!f&&e&&"boolean"==typeof s&&(f=s?Vx.has(n):jx.has(n)),!v&&i&&"boolean"==typeof c&&(v=c?Vx.has(t):jx.has(t)),f&&v}}const J3=new RegExp("s*:selfs*,?","g");function F1(n,t,e){return new ej(n).build(t,e)}class ej{constructor(t){this._driver=t}build(t,e){const i=new ij(e);return this._resetContextStyleTimingState(i),na(this,B_(t),i)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles={},t.collectedStyles[""]={},t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,s=e.depCount=0;const c=[],f=[];return"@"==t.name.charAt(0)&&e.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),t.definitions.forEach(v=>{if(this._resetContextStyleTimingState(e),0==v.type){const C=v,S=C.name;S.toString().split(/\s*,\s*/).forEach(I=>{C.name=I,c.push(this.visitState(C,e))}),C.name=S}else if(1==v.type){const C=this.visitTransition(v,e);i+=C.queryCount,s+=C.depCount,f.push(C)}else e.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:t.name,states:c,transitions:f,queryCount:i,depCount:s,options:null}}visitState(t,e){const i=this.visitStyle(t.styles,e),s=t.options&&t.options.params||null;if(i.containsDynamicStyles){const c=new Set,f=s||{};if(i.styles.forEach(v=>{if(Ux(v)){const C=v;Object.keys(C).forEach(S=>{TT(C[S]).forEach(I=>{f.hasOwnProperty(I)||c.add(I)})})}}),c.size){const v=Nx(c.values());e.errors.push(`state("${t.name}", ...) must define default values for all the following style substitutions: ${v.join(", ")}`)}}return{type:0,name:t.name,style:i,options:s?{params:s}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const i=na(this,B_(t.animation),e);return{type:1,matchers:K3(t.expr,e.errors),animation:i,queryCount:e.queryCount,depCount:e.depCount,options:Tf(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(i=>na(this,i,e)),options:Tf(t.options)}}visitGroup(t,e){const i=e.currentTime;let s=0;const c=t.steps.map(f=>{e.currentTime=i;const v=na(this,f,e);return s=Math.max(s,e.currentTime),v});return e.currentTime=s,{type:3,steps:c,options:Tf(t.options)}}visitAnimate(t,e){const i=function sj(n,t){let e=null;if(n.hasOwnProperty("duration"))e=n;else if("number"==typeof n)return R1(Lx(n,t).duration,0,"");const i=n;if(i.split(/\s+/).some(c=>"{"==c.charAt(0)&&"{"==c.charAt(1))){const c=R1(0,0,"");return c.dynamic=!0,c.strValue=i,c}return e=e||Lx(i,t),R1(e.duration,e.delay,e.easing)}(t.timings,e.errors);e.currentAnimateTimings=i;let s,c=t.styles?t.styles:Cc({});if(5==c.type)s=this.visitKeyframes(c,e);else{let f=t.styles,v=!1;if(!f){v=!0;const S={};i.easing&&(S.easing=i.easing),f=Cc(S)}e.currentTime+=i.duration+i.delay;const C=this.visitStyle(f,e);C.isEmptyStep=v,s=C}return e.currentAnimateTimings=null,{type:4,timings:i,style:s,options:null}}visitStyle(t,e){const i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){const i=[];Array.isArray(t.styles)?t.styles.forEach(f=>{"string"==typeof f?f==Nu?i.push(f):e.errors.push(`The provided style string value ${f} is not allowed.`):i.push(f)}):i.push(t.styles);let s=!1,c=null;return i.forEach(f=>{if(Ux(f)){const v=f,C=v.easing;if(C&&(c=C,delete v.easing),!s)for(let S in v)if(v[S].toString().indexOf("{{")>=0){s=!0;break}}}),{type:6,styles:i,easing:c,offset:t.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(t,e){const i=e.currentAnimateTimings;let s=e.currentTime,c=e.currentTime;i&&c>0&&(c-=i.duration+i.delay),t.styles.forEach(f=>{"string"!=typeof f&&Object.keys(f).forEach(v=>{if(!this._driver.validateStyleProperty(v))return void e.errors.push(`The provided animation property "${v}" is not a supported CSS property for animations`);const C=e.collectedStyles[e.currentQuerySelector],S=C[v];let I=!0;S&&(c!=s&&c>=S.startTime&&s<=S.endTime&&(e.errors.push(`The CSS property "${v}" that exists between the times of "${S.startTime}ms" and "${S.endTime}ms" is also being animated in a parallel animation between the times of "${c}ms" and "${s}ms"`),I=!1),c=S.startTime),I&&(C[v]={startTime:c,endTime:s}),e.options&&function W3(n,t,e){const i=t.params||{},s=TT(n);s.length&&s.forEach(c=>{i.hasOwnProperty(c)||e.push(`Unable to resolve the local animation param ${c} in the given list of values`)})}(f[v],e.options,e.errors)})})}visitKeyframes(t,e){const i={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push("keyframes() must be placed inside of a call to animate()"),i;let c=0;const f=[];let v=!1,C=!1,S=0;const I=t.steps.map(Ie=>{const Ee=this._makeStyleAst(Ie,e);let it=null!=Ee.offset?Ee.offset:function rj(n){if("string"==typeof n)return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(Ux(e)&&e.hasOwnProperty("offset")){const i=e;t=parseFloat(i.offset),delete i.offset}});else if(Ux(n)&&n.hasOwnProperty("offset")){const e=n;t=parseFloat(e.offset),delete e.offset}return t}(Ee.styles),bt=0;return null!=it&&(c++,bt=Ee.offset=it),C=C||bt<0||bt>1,v=v||bt<S,S=bt,f.push(bt),Ee});C&&e.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),v&&e.errors.push("Please ensure that all keyframe offsets are in order");const L=t.steps.length;let q=0;c>0&&c<L?e.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==c&&(q=1/(L-1));const X=L-1,ue=e.currentTime,xe=e.currentAnimateTimings,ke=xe.duration;return I.forEach((Ie,Ee)=>{const it=q>0?Ee==X?1:q*Ee:f[Ee],bt=it*ke;e.currentTime=ue+xe.delay+bt,xe.duration=bt,this._validateStyleAst(Ie,e),Ie.offset=it,i.styles.push(Ie)}),i}visitReference(t,e){return{type:8,animation:na(this,B_(t.animation),e),options:Tf(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:Tf(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:Tf(t.options)}}visitQuery(t,e){const i=e.currentQuerySelector,s=t.options||{};e.queryCount++,e.currentQuery=t;const[c,f]=function tj(n){const t=!!n.split(/\s*,\s*/).find(e=>":self"==e);return t&&(n=n.replace(J3,"")),n=n.replace(/@\*/g,Ox).replace(/@\w+/g,e=>Ox+"-"+e.substr(1)).replace(/:animating/g,S1),[n,t]}(t.selector);e.currentQuerySelector=i.length?i+" "+c:c,ta(e.collectedStyles,e.currentQuerySelector,{});const v=na(this,B_(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:11,selector:c,limit:s.limit||0,optional:!!s.optional,includeSelf:f,animation:v,originalSelector:t.selector,options:Tf(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push("stagger() can only be used inside of query()");const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:Lx(t.timings,e.errors,!0);return{type:12,animation:na(this,B_(t.animation),e),timings:i,options:null}}}class ij{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null}}function Ux(n){return!Array.isArray(n)&&"object"==typeof n}function Tf(n){return n?(n=mm(n)).params&&(n.params=function nj(n){return n?mm(n):null}(n.params)):n={},n}function R1(n,t,e){return{duration:n,delay:t,easing:e}}function P1(n,t,e,i,s,c,f=null,v=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:i,duration:s,delay:c,totalTime:s+c,easing:f,subTimeline:v}}class Gx{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const lj=new RegExp(":enter","g"),uj=new RegExp(":leave","g");function O1(n,t,e,i,s,c={},f={},v,C,S=[]){return(new dj).buildKeyframes(n,t,e,i,s,c,f,v,C,S)}class dj{buildKeyframes(t,e,i,s,c,f,v,C,S,I=[]){S=S||new Gx;const L=new L1(t,e,S,s,c,I,[]);L.options=C,L.currentTimeline.setStyles([f],null,L.errors,C),na(this,i,L);const q=L.timelines.filter(X=>X.containsAnimation());if(Object.keys(v).length){let X;for(let ue=q.length-1;ue>=0;ue--){const xe=q[ue];if(xe.element===e){X=xe;break}}X&&!X.allowOnlyTimelineStyles()&&X.setStyles([v],null,L.errors,C)}return q.length?q.map(X=>X.buildKeyframes()):[P1(e,[],[],[],0,0,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const i=e.subInstructions.get(e.element);if(i){const s=e.createSubContext(t.options),c=e.currentTimeline.currentTime,f=this._visitSubInstructions(i,s,s.options);c!=f&&e.transformIntoNewTimeline(f)}e.previousNode=t}visitAnimateRef(t,e){const i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_visitSubInstructions(t,e,i){let c=e.currentTimeline.currentTime;const f=null!=i.duration?Sf(i.duration):null,v=null!=i.delay?Sf(i.delay):null;return 0!==f&&t.forEach(C=>{const S=e.appendInstructionToTimeline(C,f,v);c=Math.max(c,S.duration+S.delay)}),c}visitReference(t,e){e.updateOptions(t.options,!0),na(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const i=e.subContextCount;let s=e;const c=t.options;if(c&&(c.params||c.delay)&&(s=e.createSubContext(c),s.transformIntoNewTimeline(),null!=c.delay)){6==s.previousNode.type&&(s.currentTimeline.snapshotCurrentStyles(),s.previousNode=$x);const f=Sf(c.delay);s.delayNextStep(f)}t.steps.length&&(t.steps.forEach(f=>na(this,f,s)),s.currentTimeline.applyStylesToKeyframe(),s.subContextCount>i&&s.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const i=[];let s=e.currentTimeline.currentTime;const c=t.options&&t.options.delay?Sf(t.options.delay):0;t.steps.forEach(f=>{const v=e.createSubContext(t.options);c&&v.delayNextStep(c),na(this,f,v),s=Math.max(s,v.currentTimeline.currentTime),i.push(v.currentTimeline)}),i.forEach(f=>e.currentTimeline.mergeTimelineCollectedStyles(f)),e.transformIntoNewTimeline(s),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const i=t.strValue;return Lx(e.params?Bx(i,e.params,e.errors):i,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const i=e.currentAnimateTimings=this._visitTiming(t.timings,e),s=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),s.snapshotCurrentStyles());const c=t.style;5==c.type?this.visitKeyframes(c,e):(e.incrementTime(i.duration),this.visitStyle(c,e),s.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const i=e.currentTimeline,s=e.currentAnimateTimings;!s&&i.getCurrentStyleProperties().length&&i.forwardFrame();const c=s&&s.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(c):i.setStyles(t.styles,c,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const i=e.currentAnimateTimings,s=e.currentTimeline.duration,c=i.duration,v=e.createSubContext().currentTimeline;v.easing=i.easing,t.styles.forEach(C=>{v.forwardTime((C.offset||0)*c),v.setStyles(C.styles,C.easing,e.errors,e.options),v.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(v),e.transformIntoNewTimeline(s+c),e.previousNode=t}visitQuery(t,e){const i=e.currentTimeline.currentTime,s=t.options||{},c=s.delay?Sf(s.delay):0;c&&(6===e.previousNode.type||0==i&&e.currentTimeline.getCurrentStyleProperties().length)&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=$x);let f=i;const v=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!s.optional,e.errors);e.currentQueryTotal=v.length;let C=null;v.forEach((S,I)=>{e.currentQueryIndex=I;const L=e.createSubContext(t.options,S);c&&L.delayNextStep(c),S===e.element&&(C=L.currentTimeline),na(this,t.animation,L),L.currentTimeline.applyStylesToKeyframe(),f=Math.max(f,L.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(f),C&&(e.currentTimeline.mergeTimelineCollectedStyles(C),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const i=e.parentContext,s=e.currentTimeline,c=t.timings,f=Math.abs(c.duration),v=f*(e.currentQueryTotal-1);let C=f*e.currentQueryIndex;switch(c.duration<0?"reverse":c.easing){case"reverse":C=v-C;break;case"full":C=i.currentStaggerTime}const I=e.currentTimeline;C&&I.delayNextStep(C);const L=I.currentTime;na(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=s.currentTime-L+(s.startTime-i.currentTimeline.startTime)}}const $x={};class L1{constructor(t,e,i,s,c,f,v,C){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=s,this._leaveClassName=c,this.errors=f,this.timelines=v,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=$x,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=C||new Hx(this._driver,e,0),v.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const i=t;let s=this.options;null!=i.duration&&(s.duration=Sf(i.duration)),null!=i.delay&&(s.delay=Sf(i.delay));const c=i.params;if(c){let f=s.params;f||(f=this.options.params={}),Object.keys(c).forEach(v=>{(!e||!f.hasOwnProperty(v))&&(f[v]=Bx(c[v],f,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const i=t.params={};Object.keys(e).forEach(s=>{i[s]=e[s]})}}return t}createSubContext(t=null,e,i){const s=e||this.element,c=new L1(this._driver,s,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(s,i||0));return c.previousNode=this.previousNode,c.currentAnimateTimings=this.currentAnimateTimings,c.options=this._copyOptions(),c.updateOptions(t),c.currentQueryIndex=this.currentQueryIndex,c.currentQueryTotal=this.currentQueryTotal,c.parentContext=this,this.subContextCount++,c}transformIntoNewTimeline(t){return this.previousNode=$x,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){const s={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=i?i:0)+t.delay,easing:""},c=new hj(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,s,t.stretchStartingKeyframe);return this.timelines.push(c),s}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,s,c,f){let v=[];if(s&&v.push(this.element),t.length>0){t=(t=t.replace(lj,"."+this._enterClassName)).replace(uj,"."+this._leaveClassName);let S=this._driver.query(this.element,t,1!=i);0!==i&&(S=i<0?S.slice(S.length+i,S.length):S.slice(0,i)),v.push(...S)}return!c&&0==v.length&&f.push(`\`query("${e}")\` returned zero elements. (Use \`query("${e}", { optional: true })\` if you wish to allow this.)`),v}}class Hx{constructor(t,e,i,s){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=s,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new Hx(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles[t]=e,this._globalTimelineStyles[t]=e,this._styleSummary[t]={time:this.currentTime,value:e}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&(this._previousKeyframe.easing=t),Object.keys(this._globalTimelineStyles).forEach(e=>{this._backFill[e]=this._globalTimelineStyles[e]||Nu,this._currentKeyframe[e]=Nu}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,s){e&&(this._previousKeyframe.easing=e);const c=s&&s.params||{},f=function fj(n,t){const e={};let i;return n.forEach(s=>{"*"===s?(i=i||Object.keys(t),i.forEach(c=>{e[c]=Nu})):Ud(s,!1,e)}),e}(t,this._globalTimelineStyles);Object.keys(f).forEach(v=>{const C=Bx(f[v],c,i);this._pendingStyles[v]=C,this._localTimelineStyles.hasOwnProperty(v)||(this._backFill[v]=this._globalTimelineStyles.hasOwnProperty(v)?this._globalTimelineStyles[v]:Nu),this._updateStyle(v,C)})}applyStylesToKeyframe(){const t=this._pendingStyles,e=Object.keys(t);0!=e.length&&(this._pendingStyles={},e.forEach(i=>{this._currentKeyframe[i]=t[i]}),Object.keys(this._localTimelineStyles).forEach(i=>{this._currentKeyframe.hasOwnProperty(i)||(this._currentKeyframe[i]=this._localTimelineStyles[i])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(t=>{const e=this._localTimelineStyles[t];this._pendingStyles[t]=e,this._updateStyle(t,e)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){Object.keys(t._styleSummary).forEach(e=>{const i=this._styleSummary[e],s=t._styleSummary[e];(!i||s.time>i.time)&&this._updateStyle(e,s.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,i=1===this._keyframes.size&&0===this.duration;let s=[];this._keyframes.forEach((v,C)=>{const S=Ud(v,!0);Object.keys(S).forEach(I=>{const L=S[I];"!"==L?t.add(I):L==Nu&&e.add(I)}),i||(S.offset=C/this.duration),s.push(S)});const c=t.size?Nx(t.values()):[],f=e.size?Nx(e.values()):[];if(i){const v=s[0],C=mm(v);v.offset=0,C.offset=1,s=[v,C]}return P1(this.element,s,c,f,this.duration,this.startTime,this.easing,!1)}}class hj extends Hx{constructor(t,e,i,s,c,f,v=!1){super(t,e,f.delay),this.keyframes=i,this.preStyleProps=s,this.postStyleProps=c,this._stretchStartingKeyframe=v,this.timings={duration:f.duration,delay:f.delay,easing:f.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:s}=this.timings;if(this._stretchStartingKeyframe&&e){const c=[],f=i+e,v=e/f,C=Ud(t[0],!1);C.offset=0,c.push(C);const S=Ud(t[0],!1);S.offset=OT(v),c.push(S);const I=t.length-1;for(let L=1;L<=I;L++){let q=Ud(t[L],!1);q.offset=OT((e+q.offset*i)/f),c.push(q)}i=f,e=0,s="",t=c}return P1(this.element,t,this.preStyleProps,this.postStyleProps,i,e,s,!0)}}function OT(n,t=3){const e=Math.pow(10,t-1);return Math.round(n*e)/e}class B1{}class pj extends B1{normalizePropertyName(t,e){return I1(t)}normalizeStyleValue(t,e,i,s){let c="";const f=i.toString().trim();if(mj[e]&&0!==i&&"0"!==i)if("number"==typeof i)c="px";else{const v=i.match(/^[+-]?[\d\.]+([a-z]*)$/);v&&0==v[1].length&&s.push(`Please provide a CSS unit value for ${t}:${i}`)}return f+c}}const mj=(()=>function gj(n){const t={};return n.forEach(e=>t[e]=!0),t}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function LT(n,t,e,i,s,c,f,v,C,S,I,L,q){return{type:0,element:n,triggerName:t,isRemovalTransition:s,fromState:e,fromStyles:c,toState:i,toStyles:f,timelines:v,queriedElements:C,preStyleProps:S,postStyleProps:I,totalTime:L,errors:q}}const N1={};class BT{constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,s){return function _j(n,t,e,i,s){return n.some(c=>c(t,e,i,s))}(this.ast.matchers,t,e,i,s)}buildStyles(t,e,i){const s=this._stateStyles["*"],c=this._stateStyles[t],f=s?s.buildStyles(e,i):{};return c?c.buildStyles(e,i):f}build(t,e,i,s,c,f,v,C,S,I){const L=[],q=this.ast.options&&this.ast.options.params||N1,ue=this.buildStyles(i,v&&v.params||N1,L),xe=C&&C.params||N1,ke=this.buildStyles(s,xe,L),Ie=new Set,Ee=new Map,it=new Map,bt="void"===s,ln={params:Object.assign(Object.assign({},q),xe)},Fi=I?[]:O1(t,e,this.ast.animation,c,f,ue,ke,ln,S,L);let Ui=0;if(Fi.forEach(ra=>{Ui=Math.max(ra.duration+ra.delay,Ui)}),L.length)return LT(e,this._triggerName,i,s,bt,ue,ke,[],[],Ee,it,Ui,L);Fi.forEach(ra=>{const sa=ra.element,xm=ta(Ee,sa,{});ra.preStyleProps.forEach(Tl=>xm[Tl]=!0);const ju=ta(it,sa,{});ra.postStyleProps.forEach(Tl=>ju[Tl]=!0),sa!==e&&Ie.add(sa)});const ia=Nx(Ie.values());return LT(e,this._triggerName,i,s,bt,ue,ke,Fi,ia,Ee,it,Ui)}}class yj{constructor(t,e,i){this.styles=t,this.defaultParams=e,this.normalizer=i}buildStyles(t,e){const i={},s=mm(this.defaultParams);return Object.keys(t).forEach(c=>{const f=t[c];null!=f&&(s[c]=f)}),this.styles.styles.forEach(c=>{if("string"!=typeof c){const f=c;Object.keys(f).forEach(v=>{let C=f[v];C.length>1&&(C=Bx(C,s,e));const S=this.normalizer.normalizePropertyName(v,e);C=this.normalizer.normalizeStyleValue(v,S,C,e),i[S]=C})}}),i}}class xj{constructor(t,e,i){this.name=t,this.ast=e,this._normalizer=i,this.transitionFactories=[],this.states={},e.states.forEach(s=>{this.states[s.name]=new yj(s.style,s.options&&s.options.params||{},i)}),NT(this.states,"true","1"),NT(this.states,"false","0"),e.transitions.forEach(s=>{this.transitionFactories.push(new BT(t,s,this.states))}),this.fallbackTransition=function bj(n,t,e){return new BT(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(f,v)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,s){return this.transitionFactories.find(f=>f.match(t,e,i,s))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}}function NT(n,t,e){n.hasOwnProperty(t)?n.hasOwnProperty(e)||(n[e]=n[t]):n.hasOwnProperty(e)&&(n[t]=n[e])}const wj=new Gx;class Cj{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._animations={},this._playersById={},this.players=[]}register(t,e){const i=[],s=F1(this._driver,e,i);if(i.length)throw new Error(`Unable to build the animation due to the following errors: ${i.join("\n")}`);this._animations[t]=s}_buildPlayer(t,e,i){const s=t.element,c=yT(0,this._normalizer,0,t.keyframes,e,i);return this._driver.animate(s,c,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){const s=[],c=this._animations[t];let f;const v=new Map;if(c?(f=O1(this._driver,e,c,M1,Rx,{},{},i,wj,s),f.forEach(I=>{const L=ta(v,I.element,{});I.postStyleProps.forEach(q=>L[q]=null)})):(s.push("The requested animation doesn't exist or has already been destroyed"),f=[]),s.length)throw new Error(`Unable to create the animation due to the following errors: ${s.join("\n")}`);v.forEach((I,L)=>{Object.keys(I).forEach(q=>{I[q]=this._driver.computeStyle(L,q,Nu)})});const S=jd(f.map(I=>{const L=v.get(I.element);return this._buildPlayer(I,{},L)}));return this._playersById[t]=S,S.onDestroy(()=>this.destroy(t)),this.players.push(S),S}destroy(t){const e=this._getPlayer(t);e.destroy(),delete this._playersById[t];const i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){const e=this._playersById[t];if(!e)throw new Error(`Unable to find the timeline player referenced by ${t}`);return e}listen(t,e,i,s){const c=x1(e,"","","");return y1(this._getPlayer(t),i,c,s),()=>{}}command(t,e,i,s){if("register"==i)return void this.register(t,s[0]);if("create"==i)return void this.create(t,e,s[0]||{});const c=this._getPlayer(t);switch(i){case"play":c.play();break;case"pause":c.pause();break;case"reset":c.reset();break;case"restart":c.restart();break;case"finish":c.finish();break;case"init":c.init();break;case"setPosition":c.setPosition(parseFloat(s[0]));break;case"destroy":this.destroy(t)}}}const zT="ng-animate-queued",z1="ng-animate-disabled",Aj=[],VT={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},Tj={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Ua="__ng_removed";class V1{constructor(t,e=""){this.namespaceId=e;const i=t&&t.hasOwnProperty("value");if(this.value=function Rj(n){return null!=n?n:null}(i?t.value:t),i){const c=mm(t);delete c.value,this.options=c}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const i=this.options.params;Object.keys(e).forEach(s=>{null==i[s]&&(i[s]=e[s])})}}}const N_="void",j1=new V1(N_);class Ij{constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,Ga(e,this._hostClassName)}listen(t,e,i,s){if(!this._triggers.hasOwnProperty(e))throw new Error(`Unable to listen on the animation trigger event "${i}" because the animation trigger "${e}" doesn't exist!`);if(null==i||0==i.length)throw new Error(`Unable to listen on the animation trigger "${e}" because the provided event is undefined!`);if(!function Pj(n){return"start"==n||"done"==n}(i))throw new Error(`The provided animation trigger event "${i}" for the animation trigger "${e}" is not supported!`);const c=ta(this._elementListeners,t,[]),f={name:e,phase:i,callback:s};c.push(f);const v=ta(this._engine.statesByElement,t,{});return v.hasOwnProperty(e)||(Ga(t,Px),Ga(t,Px+"-"+e),v[e]=j1),()=>{this._engine.afterFlush(()=>{const C=c.indexOf(f);C>=0&&c.splice(C,1),this._triggers[e]||delete v[e]})}}register(t,e){return!this._triggers[t]&&(this._triggers[t]=e,!0)}_getTrigger(t){const e=this._triggers[t];if(!e)throw new Error(`The provided animation trigger "${t}" has not been registered!`);return e}trigger(t,e,i,s=!0){const c=this._getTrigger(e),f=new U1(this.id,e,t);let v=this._engine.statesByElement.get(t);v||(Ga(t,Px),Ga(t,Px+"-"+e),this._engine.statesByElement.set(t,v={}));let C=v[e];const S=new V1(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&C&&S.absorbOptions(C.options),v[e]=S,C||(C=j1),S.value!==N_&&C.value===S.value){if(!function Bj(n,t){const e=Object.keys(n),i=Object.keys(t);if(e.length!=i.length)return!1;for(let s=0;s<e.length;s++){const c=e[s];if(!t.hasOwnProperty(c)||n[c]!==t[c])return!1}return!0}(C.params,S.params)){const xe=[],ke=c.matchStyles(C.value,C.params,xe),Ie=c.matchStyles(S.value,S.params,xe);xe.length?this._engine.reportError(xe):this._engine.afterFlush(()=>{Af(t,ke),Ec(t,Ie)})}return}const q=ta(this._engine.playersByElement,t,[]);q.forEach(xe=>{xe.namespaceId==this.id&&xe.triggerName==e&&xe.queued&&xe.destroy()});let X=c.matchTransition(C.value,S.value,t,S.params),ue=!1;if(!X){if(!s)return;X=c.fallbackTransition,ue=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:X,fromState:C,toState:S,player:f,isFallbackTransition:ue}),ue||(Ga(t,zT),f.onStart(()=>{gm(t,zT)})),f.onDone(()=>{let xe=this.players.indexOf(f);xe>=0&&this.players.splice(xe,1);const ke=this._engine.playersByElement.get(t);if(ke){let Ie=ke.indexOf(f);Ie>=0&&ke.splice(Ie,1)}}),this.players.push(f),q.push(f),f}deregister(t){delete this._triggers[t],this._engine.statesByElement.forEach((e,i)=>{delete e[t]}),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(s=>s.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const i=this._engine.driver.query(t,Ox,!0);i.forEach(s=>{if(s[Ua])return;const c=this._engine.fetchNamespacesByElement(s);c.size?c.forEach(f=>f.triggerLeaveAnimation(s,e,!1,!0)):this.clearElementCache(s)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(s=>this.clearElementCache(s)))}triggerLeaveAnimation(t,e,i,s){const c=this._engine.statesByElement.get(t),f=new Map;if(c){const v=[];if(Object.keys(c).forEach(C=>{if(f.set(C,c[C].value),this._triggers[C]){const S=this.trigger(t,C,N_,s);S&&v.push(S)}}),v.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,f),i&&jd(v).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){const s=new Set;e.forEach(c=>{const f=c.name;if(s.has(f))return;s.add(f);const C=this._triggers[f].fallbackTransition,S=i[f]||j1,I=new V1(N_),L=new U1(this.id,f,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:f,transition:C,fromState:S,toState:I,player:L,isFallbackTransition:!0})})}}removeNode(t,e){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let s=!1;if(i.totalAnimations){const c=i.players.length?i.playersByQueriedElement.get(t):[];if(c&&c.length)s=!0;else{let f=t;for(;f=f.parentNode;)if(i.statesByElement.get(f)){s=!0;break}}}if(this.prepareLeaveAnimationListeners(t),s)i.markElementAsRemoved(this.id,t,!1,e);else{const c=t[Ua];(!c||c===VT)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){Ga(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(i=>{const s=i.player;if(s.destroyed)return;const c=i.element,f=this._elementListeners.get(c);f&&f.forEach(v=>{if(v.name==i.triggerName){const C=x1(c,i.triggerName,i.fromState.value,i.toState.value);C._data=t,y1(i.player,v.phase,C,v.callback)}}),s.markedForDestroy?this._engine.afterFlush(()=>{s.destroy()}):e.push(i)}),this._queue=[],e.sort((i,s)=>{const c=i.transition.ast.depCount,f=s.transition.ast.depCount;return 0==c||0==f?c-f:this._engine.driver.containsElement(i.element,s.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(i=>i.element===t)||e,e}}class kj{constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(s,c)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,e){const i=new Ij(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){const i=this._namespaceList.length-1;if(i>=0){let s=!1;for(let c=i;c>=0;c--)if(this.driver.containsElement(this._namespaceList[c].hostElement,e)){this._namespaceList.splice(c+1,0,t),s=!0;break}s||this._namespaceList.splice(0,0,t)}else this._namespaceList.push(t);return this.namespacesByHostElement.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let s=this._namespaceLookup[t];s&&s.register(e,i)&&this.totalAnimations++}destroy(t,e){if(!t)return;const i=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[t];const s=this._namespaceList.indexOf(i);s>=0&&this._namespaceList.splice(s,1)}),this.afterFlushAnimationsDone(()=>i.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,i=this.statesByElement.get(t);if(i){const s=Object.keys(i);for(let c=0;c<s.length;c++){const f=i[s[c]].namespaceId;if(f){const v=this._fetchNamespace(f);v&&e.add(v)}}}return e}trigger(t,e,i,s){if(qx(e)){const c=this._fetchNamespace(t);if(c)return c.trigger(e,i,s),!0}return!1}insertNode(t,e,i,s){if(!qx(e))return;const c=e[Ua];if(c&&c.setForRemoval){c.setForRemoval=!1,c.setForMove=!0;const f=this.collectedLeaveElements.indexOf(e);f>=0&&this.collectedLeaveElements.splice(f,1)}if(t){const f=this._fetchNamespace(t);f&&f.insertNode(e,i)}s&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Ga(t,z1)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),gm(t,z1))}removeNode(t,e,i,s){if(qx(e)){const c=t?this._fetchNamespace(t):null;if(c?c.removeNode(e,s):this.markElementAsRemoved(t,e,!1,s),i){const f=this.namespacesByHostElement.get(e);f&&f.id!==t&&f.removeNode(e,s)}}else this._onRemovalComplete(e,s)}markElementAsRemoved(t,e,i,s,c){this.collectedLeaveElements.push(e),e[Ua]={namespaceId:t,setForRemoval:s,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:c}}listen(t,e,i,s,c){return qx(e)?this._fetchNamespace(t).listen(e,i,s,c):()=>{}}_buildInstruction(t,e,i,s,c){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,s,t.fromState.options,t.toState.options,e,c)}destroyInnerAnimations(t){let e=this.driver.query(t,Ox,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,S1,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return jd(this.players).onDone(()=>t());t()})}processLeaveNode(t){var e;const i=t[Ua];if(i&&i.setForRemoval){if(t[Ua]=VT,i.namespaceId){this.destroyInnerAnimations(t);const s=this._fetchNamespace(i.namespaceId);s&&s.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}(null===(e=t.classList)||void 0===e?void 0:e.contains(z1))&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(s=>{this.markElementAsDisabled(s,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,s)=>this._balanceNamespaceList(i,s)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Ga(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{e=this._flushAnimations(i,t)}finally{for(let s=0;s<i.length;s++)i[s]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],e.length?jd(e).onDone(()=>{i.forEach(s=>s())}):i.forEach(s=>s())}}reportError(t){throw new Error(`Unable to process animations due to the following failed trigger transitions\n ${t.join("\n")}`)}_flushAnimations(t,e){const i=new Gx,s=[],c=new Map,f=[],v=new Map,C=new Map,S=new Map,I=new Set;this.disabledNodes.forEach(Ct=>{I.add(Ct);const Lt=this.driver.query(Ct,".ng-animate-queued",!0);for(let jt=0;jt<Lt.length;jt++)I.add(Lt[jt])});const L=this.bodyNode,q=Array.from(this.statesByElement.keys()),X=GT(q,this.collectedEnterElements),ue=new Map;let xe=0;X.forEach((Ct,Lt)=>{const jt=M1+xe++;ue.set(Lt,jt),Ct.forEach(qn=>Ga(qn,jt))});const ke=[],Ie=new Set,Ee=new Set;for(let Ct=0;Ct<this.collectedLeaveElements.length;Ct++){const Lt=this.collectedLeaveElements[Ct],jt=Lt[Ua];jt&&jt.setForRemoval&&(ke.push(Lt),Ie.add(Lt),jt.hasAnimation?this.driver.query(Lt,".ng-star-inserted",!0).forEach(qn=>Ie.add(qn)):Ee.add(Lt))}const it=new Map,bt=GT(q,Array.from(Ie));bt.forEach((Ct,Lt)=>{const jt=Rx+xe++;it.set(Lt,jt),Ct.forEach(qn=>Ga(qn,jt))}),t.push(()=>{X.forEach((Ct,Lt)=>{const jt=ue.get(Lt);Ct.forEach(qn=>gm(qn,jt))}),bt.forEach((Ct,Lt)=>{const jt=it.get(Lt);Ct.forEach(qn=>gm(qn,jt))}),ke.forEach(Ct=>{this.processLeaveNode(Ct)})});const ln=[],Fi=[];for(let Ct=this._namespaceList.length-1;Ct>=0;Ct--)this._namespaceList[Ct].drainQueuedTransitions(e).forEach(jt=>{const qn=jt.player,Qr=jt.element;if(ln.push(qn),this.collectedEnterElements.length){const ao=Qr[Ua];if(ao&&ao.setForMove){if(ao.previousTriggersValues&&ao.previousTriggersValues.has(jt.triggerName)){const Lf=ao.previousTriggersValues.get(jt.triggerName),Xd=this.statesByElement.get(jt.element);Xd&&Xd[jt.triggerName]&&(Xd[jt.triggerName].value=Lf)}return void qn.destroy()}}const Dc=!L||!this.driver.containsElement(L,Qr),oa=it.get(Qr),Zd=ue.get(Qr),Gi=this._buildInstruction(jt,i,Zd,oa,Dc);if(Gi.errors&&Gi.errors.length)return void Fi.push(Gi);if(Dc)return qn.onStart(()=>Af(Qr,Gi.fromStyles)),qn.onDestroy(()=>Ec(Qr,Gi.toStyles)),void s.push(qn);if(jt.isFallbackTransition)return qn.onStart(()=>Af(Qr,Gi.fromStyles)),qn.onDestroy(()=>Ec(Qr,Gi.toStyles)),void s.push(qn);const YF=[];Gi.timelines.forEach(ao=>{ao.stretchStartingKeyframe=!0,this.disabledNodes.has(ao.element)||YF.push(ao)}),Gi.timelines=YF,i.append(Qr,Gi.timelines),f.push({instruction:Gi,player:qn,element:Qr}),Gi.queriedElements.forEach(ao=>ta(v,ao,[]).push(qn)),Gi.preStyleProps.forEach((ao,Lf)=>{const Xd=Object.keys(ao);if(Xd.length){let Bf=C.get(Lf);Bf||C.set(Lf,Bf=new Set),Xd.forEach(NC=>Bf.add(NC))}}),Gi.postStyleProps.forEach((ao,Lf)=>{const Xd=Object.keys(ao);let Bf=S.get(Lf);Bf||S.set(Lf,Bf=new Set),Xd.forEach(NC=>Bf.add(NC))})});if(Fi.length){const Ct=[];Fi.forEach(Lt=>{Ct.push(`@${Lt.triggerName} has failed due to:\n`),Lt.errors.forEach(jt=>Ct.push(`- ${jt}\n`))}),ln.forEach(Lt=>Lt.destroy()),this.reportError(Ct)}const Ui=new Map,ia=new Map;f.forEach(Ct=>{const Lt=Ct.element;i.has(Lt)&&(ia.set(Lt,Lt),this._beforeAnimationBuild(Ct.player.namespaceId,Ct.instruction,Ui))}),s.forEach(Ct=>{const Lt=Ct.element;this._getPreviousPlayers(Lt,!1,Ct.namespaceId,Ct.triggerName,null).forEach(qn=>{ta(Ui,Lt,[]).push(qn),qn.destroy()})});const ra=ke.filter(Ct=>HT(Ct,C,S)),sa=new Map;UT(sa,this.driver,Ee,S,Nu).forEach(Ct=>{HT(Ct,C,S)&&ra.push(Ct)});const ju=new Map;X.forEach((Ct,Lt)=>{UT(ju,this.driver,new Set(Ct),C,"!")}),ra.forEach(Ct=>{const Lt=sa.get(Ct),jt=ju.get(Ct);sa.set(Ct,Object.assign(Object.assign({},Lt),jt))});const Tl=[],bm=[],wm={};f.forEach(Ct=>{const{element:Lt,player:jt,instruction:qn}=Ct;if(i.has(Lt)){if(I.has(Lt))return jt.onDestroy(()=>Ec(Lt,qn.toStyles)),jt.disabled=!0,jt.overrideTotalTime(qn.totalTime),void s.push(jt);let Qr=wm;if(ia.size>1){let oa=Lt;const Zd=[];for(;oa=oa.parentNode;){const Gi=ia.get(oa);if(Gi){Qr=Gi;break}Zd.push(oa)}Zd.forEach(Gi=>ia.set(Gi,Qr))}const Dc=this._buildAnimation(jt.namespaceId,qn,Ui,c,ju,sa);if(jt.setRealPlayer(Dc),Qr===wm)Tl.push(jt);else{const oa=this.playersByElement.get(Qr);oa&&oa.length&&(jt.parentPlayer=jd(oa)),s.push(jt)}}else Af(Lt,qn.fromStyles),jt.onDestroy(()=>Ec(Lt,qn.toStyles)),bm.push(jt),I.has(Lt)&&s.push(jt)}),bm.forEach(Ct=>{const Lt=c.get(Ct.element);if(Lt&&Lt.length){const jt=jd(Lt);Ct.setRealPlayer(jt)}}),s.forEach(Ct=>{Ct.parentPlayer?Ct.syncPlayerEvents(Ct.parentPlayer):Ct.destroy()});for(let Ct=0;Ct<ke.length;Ct++){const Lt=ke[Ct],jt=Lt[Ua];if(gm(Lt,Rx),jt&&jt.hasAnimation)continue;let qn=[];if(v.size){let Dc=v.get(Lt);Dc&&Dc.length&&qn.push(...Dc);let oa=this.driver.query(Lt,S1,!0);for(let Zd=0;Zd<oa.length;Zd++){let Gi=v.get(oa[Zd]);Gi&&Gi.length&&qn.push(...Gi)}}const Qr=qn.filter(Dc=>!Dc.destroyed);Qr.length?Oj(this,Lt,Qr):this.processLeaveNode(Lt)}return ke.length=0,Tl.forEach(Ct=>{this.players.push(Ct),Ct.onDone(()=>{Ct.destroy();const Lt=this.players.indexOf(Ct);this.players.splice(Lt,1)}),Ct.play()}),Tl}elementContainsData(t,e){let i=!1;const s=e[Ua];return s&&s.setForRemoval&&(i=!0),this.playersByElement.has(e)&&(i=!0),this.playersByQueriedElement.has(e)&&(i=!0),this.statesByElement.has(e)&&(i=!0),this._fetchNamespace(t).elementContainsData(e)||i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,s,c){let f=[];if(e){const v=this.playersByQueriedElement.get(t);v&&(f=v)}else{const v=this.playersByElement.get(t);if(v){const C=!c||c==N_;v.forEach(S=>{S.queued||!C&&S.triggerName!=s||f.push(S)})}}return(i||s)&&(f=f.filter(v=>!(i&&i!=v.namespaceId||s&&s!=v.triggerName))),f}_beforeAnimationBuild(t,e,i){const c=e.element,f=e.isRemovalTransition?void 0:t,v=e.isRemovalTransition?void 0:e.triggerName;for(const C of e.timelines){const S=C.element,I=S!==c,L=ta(i,S,[]);this._getPreviousPlayers(S,I,f,v,e.toState).forEach(X=>{const ue=X.getRealPlayer();ue.beforeDestroy&&ue.beforeDestroy(),X.destroy(),L.push(X)})}Af(c,e.fromStyles)}_buildAnimation(t,e,i,s,c,f){const v=e.triggerName,C=e.element,S=[],I=new Set,L=new Set,q=e.timelines.map(ue=>{const xe=ue.element;I.add(xe);const ke=xe[Ua];if(ke&&ke.removedBeforeQueried)return new pm(ue.duration,ue.delay);const Ie=xe!==C,Ee=function Lj(n){const t=[];return $T(n,t),t}((i.get(xe)||Aj).map(Ui=>Ui.getRealPlayer())).filter(Ui=>!!Ui.element&&Ui.element===xe),it=c.get(xe),bt=f.get(xe),ln=yT(0,this._normalizer,0,ue.keyframes,it,bt),Fi=this._buildPlayer(ue,ln,Ee);if(ue.subTimeline&&s&&L.add(xe),Ie){const Ui=new U1(t,v,xe);Ui.setRealPlayer(Fi),S.push(Ui)}return Fi});S.forEach(ue=>{ta(this.playersByQueriedElement,ue.element,[]).push(ue),ue.onDone(()=>function Fj(n,t,e){let i;if(n instanceof Map){if(i=n.get(t),i){if(i.length){const s=i.indexOf(e);i.splice(s,1)}0==i.length&&n.delete(t)}}else if(i=n[t],i){if(i.length){const s=i.indexOf(e);i.splice(s,1)}0==i.length&&delete n[t]}return i}(this.playersByQueriedElement,ue.element,ue))}),I.forEach(ue=>Ga(ue,DT));const X=jd(q);return X.onDestroy(()=>{I.forEach(ue=>gm(ue,DT)),Ec(C,e.toStyles)}),L.forEach(ue=>{ta(s,ue,[]).push(X)}),X}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new pm(t.duration,t.delay)}}class U1{constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i,this._player=new pm,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,Object.keys(this._queuedCallbacks).forEach(e=>{this._queuedCallbacks[e].forEach(i=>y1(t,e,void 0,i))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){ta(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function qx(n){return n&&1===n.nodeType}function jT(n,t){const e=n.style.display;return n.style.display=null!=t?t:"none",e}function UT(n,t,e,i,s){const c=[];e.forEach(C=>c.push(jT(C)));const f=[];i.forEach((C,S)=>{const I={};C.forEach(L=>{const q=I[L]=t.computeStyle(S,L,s);(!q||0==q.length)&&(S[Ua]=Tj,f.push(S))}),n.set(S,I)});let v=0;return e.forEach(C=>jT(C,c[v++])),f}function GT(n,t){const e=new Map;if(n.forEach(v=>e.set(v,[])),0==t.length)return e;const s=new Set(t),c=new Map;function f(v){if(!v)return 1;let C=c.get(v);if(C)return C;const S=v.parentNode;return C=e.has(S)?S:s.has(S)?1:f(S),c.set(v,C),C}return t.forEach(v=>{const C=f(v);1!==C&&e.get(C).push(v)}),e}function Ga(n,t){var e;null===(e=n.classList)||void 0===e||e.add(t)}function gm(n,t){var e;null===(e=n.classList)||void 0===e||e.remove(t)}function Oj(n,t,e){jd(e).onDone(()=>n.processLeaveNode(t))}function $T(n,t){for(let e=0;e<n.length;e++){const i=n[e];i instanceof gT?$T(i.players,t):t.push(i)}}function HT(n,t,e){const i=e.get(n);if(!i)return!1;let s=t.get(n);return s?i.forEach(c=>s.add(c)):t.set(n,i),e.delete(n),!0}class Wx{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(s,c)=>{},this._transitionEngine=new kj(t,e,i),this._timelineEngine=new Cj(t,e,i),this._transitionEngine.onRemovalComplete=(s,c)=>this.onRemovalComplete(s,c)}registerTrigger(t,e,i,s,c){const f=t+"-"+s;let v=this._triggerCache[f];if(!v){const C=[],S=F1(this._driver,c,C);if(C.length)throw new Error(`The animation trigger "${s}" has failed to build due to the following errors:\n - ${C.join("\n - ")}`);v=function vj(n,t,e){return new xj(n,t,e)}(s,S,this._normalizer),this._triggerCache[f]=v}this._transitionEngine.registerTrigger(e,s,v)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,s){this._transitionEngine.insertNode(t,e,i,s)}onRemove(t,e,i,s){this._transitionEngine.removeNode(t,e,s||!1,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,s){if("@"==i.charAt(0)){const[c,f]=vT(i);this._timelineEngine.command(c,e,f,s)}else this._transitionEngine.trigger(t,e,i,s)}listen(t,e,i,s,c){if("@"==i.charAt(0)){const[f,v]=vT(i);return this._timelineEngine.listen(f,e,v,c)}return this._transitionEngine.listen(t,e,i,s,c)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}function qT(n,t){let e=null,i=null;return Array.isArray(t)&&t.length?(e=G1(t[0]),t.length>1&&(i=G1(t[t.length-1]))):t&&(e=G1(t)),e||i?new Nj(n,e,i):null}let Nj=(()=>{class n{constructor(e,i,s){this._element=e,this._startStyles=i,this._endStyles=s,this._state=0;let c=n.initialStylesByElement.get(e);c||n.initialStylesByElement.set(e,c={}),this._initialStyles=c}start(){this._state<1&&(this._startStyles&&Ec(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Ec(this._element,this._initialStyles),this._endStyles&&(Ec(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(Af(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Af(this._element,this._endStyles),this._endStyles=null),Ec(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function G1(n){let t=null;const e=Object.keys(n);for(let i=0;i<e.length;i++){const s=e[i];zj(s)&&(t=t||{},t[s]=n[s])}return t}function zj(n){return"display"===n||"position"===n}const WT="animation",ZT="animationend";class Uj{constructor(t,e,i,s,c,f,v){this._element=t,this._name=e,this._duration=i,this._delay=s,this._easing=c,this._fillMode=f,this._onDoneFn=v,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=C=>this._handleCallback(C)}apply(){(function Gj(n,t){const e=H1(n,"").trim();let i=0;e.length&&(i=function Hj(n,t){let e=0;for(let i=0;i<n.length;i++)n.charAt(i)===t&&e++;return e}(e,",")+1,t=`${e}, ${t}`),Zx(n,"",t)})(this._element,`${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`),YT(this._element,this._eventFn,!1),this._startTime=Date.now()}pause(){XT(this._element,this._name,"paused")}resume(){XT(this._element,this._name,"running")}setPosition(t){const e=KT(this._element,this._name);this._position=t*this._duration,Zx(this._element,"Delay",`-${this._position}ms`,e)}getPosition(){return this._position}_handleCallback(t){const e=t._ngTestManualTimestamp||Date.now(),i=1e3*parseFloat(t.elapsedTime.toFixed(3));t.animationName==this._name&&Math.max(e-this._startTime,0)>=this._delay&&i>=this._duration&&this.finish()}finish(){this._finished||(this._finished=!0,this._onDoneFn(),YT(this._element,this._eventFn,!0))}destroy(){this._destroyed||(this._destroyed=!0,this.finish(),function $j(n,t){const i=H1(n,"").split(","),s=$1(i,t);s>=0&&(i.splice(s,1),Zx(n,"",i.join(",")))}(this._element,this._name))}}function XT(n,t,e){Zx(n,"PlayState",e,KT(n,t))}function KT(n,t){const e=H1(n,"");return e.indexOf(",")>0?$1(e.split(","),t):$1([e],t)}function $1(n,t){for(let e=0;e<n.length;e++)if(n[e].indexOf(t)>=0)return e;return-1}function YT(n,t,e){e?n.removeEventListener(ZT,t):n.addEventListener(ZT,t)}function Zx(n,t,e,i){const s=WT+t;if(null!=i){const c=n.style[s];if(c.length){const f=c.split(",");f[i]=e,e=f.join(",")}}n.style[s]=e}function H1(n,t){return n.style[WT+t]||""}class QT{constructor(t,e,i,s,c,f,v,C){this.element=t,this.keyframes=e,this.animationName=i,this._duration=s,this._delay=c,this._finalStyles=v,this._specialStyles=C,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this.currentSnapshot={},this._state=0,this.easing=f||"linear",this.totalTime=s+c,this._buildStyler()}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}destroy(){this.init(),!(this._state>=4)&&(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}_flushDoneFns(){this._onDoneFns.forEach(t=>t()),this._onDoneFns=[]}_flushStartFns(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}finish(){this.init(),!(this._state>=3)&&(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}setPosition(t){this._styler.setPosition(t)}getPosition(){return this._styler.getPosition()}hasStarted(){return this._state>=2}init(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}play(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}pause(){this.init(),this._styler.pause()}restart(){this.reset(),this.play()}reset(){this._state=0,this._styler.destroy(),this._buildStyler(),this._styler.apply()}_buildStyler(){this._styler=new Uj(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",()=>this.finish())}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}beforeDestroy(){this.init();const t={};if(this.hasStarted()){const e=this._state>=3;Object.keys(this._finalStyles).forEach(i=>{"offset"!=i&&(t[i]=e?this._finalStyles[i]:k1(this.element,i))})}this.currentSnapshot=t}}class Zj extends pm{constructor(t,e){super(),this.element=t,this._startingStyles={},this.__initialized=!1,this._styles=wT(e)}init(){this.__initialized||!this._startingStyles||(this.__initialized=!0,Object.keys(this._styles).forEach(t=>{this._startingStyles[t]=this.element.style[t]}),super.init())}play(){!this._startingStyles||(this.init(),Object.keys(this._styles).forEach(t=>this.element.style.setProperty(t,this._styles[t])),super.play())}destroy(){!this._startingStyles||(Object.keys(this._startingStyles).forEach(t=>{const e=this._startingStyles[t];e?this.element.style.setProperty(t,e):this.element.style.removeProperty(t)}),this._startingStyles=null,super.destroy())}}class eI{constructor(){this._count=0}validateStyleProperty(t){return w1(t)}matchesElement(t,e){return!1}containsElement(t,e){return C1(t,e)}query(t,e,i){return E1(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}buildKeyframeElement(t,e,i){i=i.map(v=>wT(v));let s=`@keyframes ${e} {\n`,c="";i.forEach(v=>{c=" ";const C=parseFloat(v.offset);s+=`${c}${100*C}% {\n`,c+=" ",Object.keys(v).forEach(S=>{const I=v[S];switch(S){case"offset":return;case"easing":return void(I&&(s+=`${c}animation-timing-function: ${I};\n`));default:return void(s+=`${c}${S}: ${I};\n`)}}),s+=`${c}}\n`}),s+="}\n";const f=document.createElement("style");return f.textContent=s,f}animate(t,e,i,s,c,f=[],v){const C=f.filter(ke=>ke instanceof QT),S={};IT(i,s)&&C.forEach(ke=>{let Ie=ke.currentSnapshot;Object.keys(Ie).forEach(Ee=>S[Ee]=Ie[Ee])});const I=function Yj(n){let t={};return n&&(Array.isArray(n)?n:[n]).forEach(i=>{Object.keys(i).forEach(s=>{"offset"==s||"easing"==s||(t[s]=i[s])})}),t}(e=kT(t,e,S));if(0==i)return new Zj(t,I);const L="gen_css_kf_"+this._count++,q=this.buildKeyframeElement(t,L,e);(function Kj(n){var t;const e=null===(t=n.getRootNode)||void 0===t?void 0:t.call(n);return"undefined"!=typeof ShadowRoot&&e instanceof ShadowRoot?e:document.head})(t).appendChild(q);const ue=qT(t,e),xe=new QT(t,e,L,i,s,c,I,ue);return xe.onDestroy(()=>function Qj(n){n.parentNode.removeChild(n)}(q)),xe}}class nI{constructor(t,e,i,s){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=s,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(t,e,i){return t.animate(e,i)}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t={};if(this.hasStarted()){const e=this._finalKeyframe;Object.keys(e).forEach(i=>{"offset"!=i&&(t[i]=this._finished?e[i]:k1(this.element,i))})}this.currentSnapshot=t}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class Jj{constructor(){this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(iI().toString()),this._cssKeyframesDriver=new eI}validateStyleProperty(t){return w1(t)}matchesElement(t,e){return!1}containsElement(t,e){return C1(t,e)}query(t,e,i){return E1(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}overrideWebAnimationsSupport(t){this._isNativeImpl=t}animate(t,e,i,s,c,f=[],v){if(!v&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(t,e,i,s,c,f);const I={duration:i,delay:s,fill:0==s?"both":"forwards"};c&&(I.easing=c);const L={},q=f.filter(ue=>ue instanceof nI);IT(i,s)&&q.forEach(ue=>{let xe=ue.currentSnapshot;Object.keys(xe).forEach(ke=>L[ke]=xe[ke])});const X=qT(t,e=kT(t,e=e.map(ue=>Ud(ue,!1)),L));return new nI(t,e,I,X)}}function iI(){return _T()&&Element.prototype.animate||{}}let tU=(()=>{class n extends uT{constructor(e,i){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(i.body,{id:"0",encapsulation:ct.None,styles:[],data:{animation:[]}})}build(e){const i=this._nextAnimationId.toString();this._nextAnimationId++;const s=Array.isArray(e)?hT(e):e;return rI(this._renderer,null,i,"register",[s]),new nU(i,this._renderer)}}return n.\u0275fac=function(e){return new(e||n)(Ce(n_),Ce(sn))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();class nU extends class j3{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new iU(this._id,t,e||{},this._renderer)}}class iU{constructor(t,e,i,s){this.id=t,this.element=e,this._renderer=s,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return rI(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function rI(n,t,e,i,s){return n.setProperty(t,`@@${e}:${i}`,s)}const sI="@.disabled";let rU=(()=>{class n{constructor(e,i,s){this.delegate=e,this.engine=i,this._zone=s,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(c,f)=>{const v=null==f?void 0:f.parentNode(c);v&&f.removeChild(v,c)}}createRenderer(e,i){const c=this.delegate.createRenderer(e,i);if(!(e&&i&&i.data&&i.data.animation)){let I=this._rendererCache.get(c);return I||(I=new oI("",c,this.engine),this._rendererCache.set(c,I)),I}const f=i.id,v=i.id+"-"+this._currentId;this._currentId++,this.engine.register(v,e);const C=I=>{Array.isArray(I)?I.forEach(C):this.engine.registerTrigger(f,v,e,I.name,I)};return i.data.animation.forEach(C),new sU(this,v,c,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,i,s){e>=0&&e<this._microtaskId?this._zone.run(()=>i(s)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(c=>{const[f,v]=c;f(v)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,s]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(e){return new(e||n)(Ce(n_),Ce(Wx),Ce(fn))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();class oI{constructor(t,e,i){this.namespaceId=t,this.delegate=e,this.engine=i,this.destroyNode=this.delegate.destroyNode?s=>e.destroyNode(s):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,s=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,s)}removeChild(t,e,i){this.engine.onRemove(this.namespaceId,e,this.delegate,i)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,s){this.delegate.setAttribute(t,e,i,s)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,s){this.delegate.setStyle(t,e,i,s)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){"@"==e.charAt(0)&&e==sI?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i){return this.delegate.listen(t,e,i)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class sU extends oI{constructor(t,e,i,s){super(e,i,s),this.factory=t,this.namespaceId=e}setProperty(t,e,i){"@"==e.charAt(0)?"."==e.charAt(1)&&e==sI?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,e.substr(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i){if("@"==e.charAt(0)){const s=function oU(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(t);let c=e.substr(1),f="";return"@"!=c.charAt(0)&&([c,f]=function aU(n){const t=n.indexOf(".");return[n.substring(0,t),n.substr(t+1)]}(c)),this.engine.listen(this.namespaceId,s,c,f,v=>{this.factory.scheduleListenerCallback(v._data||-1,i,v)})}return this.delegate.listen(t,e,i)}}let lU=(()=>{class n extends Wx{constructor(e,i,s){super(e.body,i,s)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(e){return new(e||n)(Ce(sn),Ce(D1),Ce(B1))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();const Gd=new dt("AnimationModuleType"),aI=[{provide:uT,useClass:tU},{provide:B1,useFactory:function uU(){return new pj}},{provide:Wx,useClass:lU},{provide:n_,useFactory:function dU(n,t,e){return new rU(n,t,e)},deps:[ox,Wx,fn]}],lI=[{provide:D1,useFactory:function cU(){return function eU(){return"function"==typeof iI()}()?new Jj:new eI}},{provide:Gd,useValue:"BrowserAnimations"},...aI],hU=[{provide:D1,useClass:CT},{provide:Gd,useValue:"NoopAnimations"},...aI];let fU=(()=>{class n{static withConfig(e){return{ngModule:n,providers:e.disableAnimations?hU:lI}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({providers:lI,imports:[gS]}),n})();const mU=new dt("mat-sanity-checks",{providedIn:"root",factory:function pU(){return!0}});let Ci=(()=>{class n{constructor(e,i,s){this._sanityChecks=i,this._document=s,this._hasDoneGlobalChecks=!1,e._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!c1()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}}return n.\u0275fac=function(e){return new(e||n)(Ce(V3),Ce(mU,8),Ce(sn))},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[dm],dm]}),n})();function uI(n){return class extends n{constructor(...t){super(...t),this._disabled=!1}get disabled(){return this._disabled}set disabled(t){this._disabled=Ii(t)}}}function q1(n,t){return class extends n{constructor(...e){super(...e),this.defaultColor=t,this.color=t}get color(){return this._color}set color(e){const i=e||this.defaultColor;i!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),i&&this._elementRef.nativeElement.classList.add(`mat-${i}`),this._color=i)}}}function z_(n){return class extends n{constructor(...t){super(...t),this._disableRipple=!1}get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=Ii(t)}}}let dI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=je({type:n,selectors:[["","mat-line",""],["","matLine",""]],hostAttrs:[1,"mat-line"]}),n})();function V_(n,t,e){n.nativeElement.classList.toggle(t,e)}let Kx=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[Ci],Ci]}),n})();class _U{constructor(t,e,i){this._renderer=t,this.element=e,this.config=i,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const fI={enterDuration:225,exitDuration:150},W1=o1({passive:!0}),pI=["mousedown","touchstart"],mI=["mouseup","mouseleave","touchend","touchcancel"];class vU{constructor(t,e,i,s){this._target=t,this._ngZone=e,this._isPointerDown=!1,this._activeRipples=new Set,this._pointerUpEventsRegistered=!1,s.isBrowser&&(this._containerElement=um(i))}fadeInRipple(t,e,i={}){const s=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),c=Object.assign(Object.assign({},fI),i.animation);i.centered&&(t=s.left+s.width/2,e=s.top+s.height/2);const f=i.radius||function bU(n,t,e){const i=Math.max(Math.abs(n-e.left),Math.abs(n-e.right)),s=Math.max(Math.abs(t-e.top),Math.abs(t-e.bottom));return Math.sqrt(i*i+s*s)}(t,e,s),v=t-s.left,C=e-s.top,S=c.enterDuration,I=document.createElement("div");I.classList.add("mat-ripple-element"),I.style.left=v-f+"px",I.style.top=C-f+"px",I.style.height=2*f+"px",I.style.width=2*f+"px",null!=i.color&&(I.style.backgroundColor=i.color),I.style.transitionDuration=`${S}ms`,this._containerElement.appendChild(I),function xU(n){window.getComputedStyle(n).getPropertyValue("opacity")}(I),I.style.transform="scale(1)";const L=new _U(this,I,i);return L.state=0,this._activeRipples.add(L),i.persistent||(this._mostRecentTransientRipple=L),this._runTimeoutOutsideZone(()=>{const q=L===this._mostRecentTransientRipple;L.state=1,!i.persistent&&(!q||!this._isPointerDown)&&L.fadeOut()},S),L}fadeOutRipple(t){const e=this._activeRipples.delete(t);if(t===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),this._activeRipples.size||(this._containerRect=null),!e)return;const i=t.element,s=Object.assign(Object.assign({},fI),t.config.animation);i.style.transitionDuration=`${s.exitDuration}ms`,i.style.opacity="0",t.state=2,this._runTimeoutOutsideZone(()=>{t.state=3,i.remove()},s.exitDuration)}fadeOutAll(){this._activeRipples.forEach(t=>t.fadeOut())}fadeOutAllNonPersistent(){this._activeRipples.forEach(t=>{t.config.persistent||t.fadeOut()})}setupTriggerEvents(t){const e=um(t);!e||e===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=e,this._registerEvents(pI))}handleEvent(t){"mousedown"===t.type?this._onMousedown(t):"touchstart"===t.type?this._onTouchStart(t):this._onPointerUp(),this._pointerUpEventsRegistered||(this._registerEvents(mI),this._pointerUpEventsRegistered=!0)}_onMousedown(t){const e=sT(t),i=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!e&&!i&&(this._isPointerDown=!0,this.fadeInRipple(t.clientX,t.clientY,this._target.rippleConfig))}_onTouchStart(t){if(!this._target.rippleDisabled&&!oT(t)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const e=t.changedTouches;for(let i=0;i<e.length;i++)this.fadeInRipple(e[i].clientX,e[i].clientY,this._target.rippleConfig)}}_onPointerUp(){!this._isPointerDown||(this._isPointerDown=!1,this._activeRipples.forEach(t=>{!t.config.persistent&&(1===t.state||t.config.terminateOnPointerUp&&0===t.state)&&t.fadeOut()}))}_runTimeoutOutsideZone(t,e=0){this._ngZone.runOutsideAngular(()=>setTimeout(t,e))}_registerEvents(t){this._ngZone.runOutsideAngular(()=>{t.forEach(e=>{this._triggerElement.addEventListener(e,this,W1)})})}_removeTriggerEvents(){this._triggerElement&&(pI.forEach(t=>{this._triggerElement.removeEventListener(t,this,W1)}),this._pointerUpEventsRegistered&&mI.forEach(t=>{this._triggerElement.removeEventListener(t,this,W1)}))}}const wU=new dt("mat-ripple-global-options");let Yx=(()=>{class n{constructor(e,i,s,c,f){this._elementRef=e,this._animationMode=f,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=c||{},this._rippleRenderer=new vU(this,i,e,s)}get disabled(){return this._disabled}set disabled(e){e&&this.fadeOutAllNonPersistent(),this._disabled=e,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(e){this._trigger=e,this._setupTriggerEventsIfEnabled()}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Object.assign(Object.assign(Object.assign({},this._globalOptions.animation),"NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(e,i=0,s){return"number"==typeof e?this._rippleRenderer.fadeInRipple(e,i,Object.assign(Object.assign({},this.rippleConfig),s)):this._rippleRenderer.fadeInRipple(0,0,Object.assign(Object.assign({},this.rippleConfig),e))}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(fn),se(ja),se(wU,8),se(Gd,8))},n.\u0275dir=je({type:n,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(e,i){2&e&&sr("mat-ripple-unbounded",i.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]}),n})(),gI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[Ci],Ci]}),n})(),_I=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[Ci]]}),n})(),EU=(()=>{class n{constructor(){this._vertical=!1,this._inset=!1}get vertical(){return this._vertical}set vertical(e){this._vertical=Ii(e)}get inset(){return this._inset}set inset(e){this._inset=Ii(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Un({type:n,selectors:[["mat-divider"]],hostAttrs:["role","separator",1,"mat-divider"],hostVars:7,hostBindings:function(e,i){2&e&&(rr("aria-orientation",i.vertical?"vertical":"horizontal"),sr("mat-divider-vertical",i.vertical)("mat-divider-horizontal",!i.vertical)("mat-divider-inset",i.inset))},inputs:{vertical:"vertical",inset:"inset"},decls:0,vars:0,template:function(e,i){},styles:[".mat-divider{display:block;margin:0;border-top-width:1px;border-top-style:solid}.mat-divider.mat-divider-vertical{border-top:0;border-right-width:1px;border-right-style:solid}.mat-divider.mat-divider-inset{margin-left:80px}[dir=rtl] .mat-divider.mat-divider-inset{margin-left:auto;margin-right:80px}\n"],encapsulation:2,changeDetection:0}),n})(),DU=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[Ci],Ci]}),n})();function yI(n){for(let t in n){let e=n[t]||"";switch(t){case"display":n.display="flex"===e?["-webkit-flex","flex"]:"inline-flex"===e?["-webkit-inline-flex","inline-flex"]:e;break;case"align-items":case"align-self":case"align-content":case"flex":case"flex-basis":case"flex-flow":case"flex-grow":case"flex-shrink":case"flex-wrap":case"justify-content":n["-webkit-"+t]=e;break;case"flex-direction":e=e||"row",n["-webkit-flex-direction"]=e,n["flex-direction"]=e;break;case"order":n.order=n["-webkit-"+t]=isNaN(+e)?"0":e}}return n}const Z1="inline",Qx=["row","column","row-reverse","column-reverse"];function vI(n){let[t,e,i]=xI(n);return function SU(n,t=null,e=!1){return{display:e?"inline-flex":"flex","box-sizing":"border-box","flex-direction":n,"flex-wrap":t||null}}(t,e,i)}function xI(n){var t;n=null!==(t=null==n?void 0:n.toLowerCase())&&void 0!==t?t:"";let[e,i,s]=n.split(" ");return Qx.find(c=>c===e)||(e=Qx[0]),i===Z1&&(i=s!==Z1?s:"",s=Z1),[e,MU(i),!!s]}function j_(n){let[t]=xI(n);return t.indexOf("row")>-1}function MU(n){if(n)switch(n.toLowerCase()){case"reverse":case"wrap-reverse":case"reverse-wrap":n="wrap-reverse";break;case"no":case"none":case"nowrap":n="nowrap";break;default:n="wrap"}return n}function zu(n,...t){if(null==n)throw TypeError("Cannot convert undefined or null to object");for(let e of t)if(null!=e)for(let i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);return n}const TU={provide:Qb,useFactory:function AU(n,t){return()=>{if(Ru(t)){const e=Array.from(n.querySelectorAll(`[class*=${bI}]`)),i=/\bflex-layout-.+?\b/g;e.forEach(s=>{s.classList.contains(`${bI}ssr`)&&s.parentNode?s.parentNode.removeChild(s):s.className.replace(i,"")})}}},deps:[sn,so],multi:!0},bI="flex-layout-";let X1=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({providers:[TU]}),n})();class If{constructor(t=!1,e="all",i="",s="",c=0){this.matches=t,this.mediaQuery=e,this.mqAlias=i,this.suffix=s,this.priority=c,this.property=""}clone(){return new If(this.matches,this.mediaQuery,this.mqAlias,this.suffix)}}let IU=(()=>{class n{constructor(){this.stylesheet=new Map}addStyleToElement(e,i,s){const c=this.stylesheet.get(e);c?c.set(i,s):this.stylesheet.set(e,new Map([[i,s]]))}clearStyles(){this.stylesheet.clear()}getStyleForElement(e,i){const s=this.stylesheet.get(e);let c="";if(s){const f=s.get(i);("number"==typeof f||"string"==typeof f)&&(c=f+"")}return c}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const K1={addFlexToParent:!0,addOrientationBps:!1,disableDefaultBps:!1,disableVendorPrefixes:!1,serverLoaded:!1,useColumnBasisZero:!0,printWithBreakpoints:[],mediaTriggerAutoRestore:!0,ssrObserveBreakpoints:[],multiplier:void 0,defaultUnit:"px",detectLayoutDisplay:!1},Sl=new dt("Flex Layout token, config options for the library",{providedIn:"root",factory:()=>K1}),_m=new dt("FlexLayoutServerLoaded",{providedIn:"root",factory:()=>!1}),Y1=new dt("Flex Layout token, collect all breakpoints into one provider",{providedIn:"root",factory:()=>null});function wI(n,t){return n=n?n.clone():new If,t&&(n.mqAlias=t.alias,n.mediaQuery=t.mediaQuery,n.suffix=t.suffix,n.priority=t.priority),n}class Qi{constructor(){this.shouldCache=!0}sideEffect(t,e,i){}}let Ei=(()=>{class n{constructor(e,i,s,c){this._serverStylesheet=e,this._serverModuleLoaded=i,this._platformId=s,this.layoutConfig=c}applyStyleToElement(e,i,s=null){let c={};"string"==typeof i&&(c[i]=s,i=c),c=this.layoutConfig.disableVendorPrefixes?i:yI(i),this._applyMultiValueStyleToElement(c,e)}applyStyleToElements(e,i=[]){const s=this.layoutConfig.disableVendorPrefixes?e:yI(e);i.forEach(c=>{this._applyMultiValueStyleToElement(s,c)})}getFlowDirection(e){const i="flex-direction";let s=this.lookupStyle(e,i);return[s||"row",this.lookupInlineStyle(e,i)||nm(this._platformId)&&this._serverModuleLoaded?s:""]}hasWrap(e){return"wrap"===this.lookupStyle(e,"flex-wrap")}lookupAttributeValue(e,i){var s;return null!==(s=e.getAttribute(i))&&void 0!==s?s:""}lookupInlineStyle(e,i){return Ru(this._platformId)?e.style.getPropertyValue(i):function kU(n,t){var e;return null!==(e=CI(n)[t])&&void 0!==e?e:""}(e,i)}lookupStyle(e,i,s=!1){let c="";return e&&((c=this.lookupInlineStyle(e,i))||(Ru(this._platformId)?s||(c=getComputedStyle(e).getPropertyValue(i)):this._serverModuleLoaded&&(c=this._serverStylesheet.getStyleForElement(e,i)))),c?c.trim():""}_applyMultiValueStyleToElement(e,i){Object.keys(e).sort().forEach(s=>{const c=e[s],f=Array.isArray(c)?c:[c];f.sort();for(let v of f)v=v?v+"":"",Ru(this._platformId)||!this._serverModuleLoaded?Ru(this._platformId)?i.style.setProperty(s,v):FU(i,s,v):this._serverStylesheet.addStyleToElement(i,s,v)})}}return n.\u0275fac=function(e){return new(e||n)(Ce(IU),Ce(_m),Ce(so),Ce(Sl))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function FU(n,t,e){t=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();const i=CI(n);i[t]=null!=e?e:"",function RU(n,t){let e="";for(const i in t)t[i]&&(e+=`${i}:${t[i]};`);n.setAttribute("style",e)}(n,i)}function CI(n){const t={},e=n.getAttribute("style");if(e){const i=e.split(/;+/g);for(let s=0;s<i.length;s++){const c=i[s].trim();if(c.length>0){const f=c.indexOf(":");if(-1===f)throw new Error(`Invalid CSS style: ${c}`);t[c.substr(0,f).trim()]=c.substr(f+1).trim()}}}return t}function U_(n,t){return(t&&t.priority||0)-(n&&n.priority||0)}function PU(n,t){return(n.priority||0)-(t.priority||0)}let Q1=(()=>{class n{constructor(e,i,s){this._zone=e,this._platformId=i,this._document=s,this.source=new Jo(new If(!0)),this.registry=new Map,this.pendingRemoveListenerFns=[],this._observable$=this.source.asObservable()}get activations(){const e=[];return this.registry.forEach((i,s)=>{i.matches&&e.push(s)}),e}isActive(e){var i;const s=this.registry.get(e);return null!==(i=null==s?void 0:s.matches)&&void 0!==i?i:this.registerQuery(e).some(c=>c.matches)}observe(e,i=!1){if(e&&e.length){const s=this._observable$.pipe(ui(f=>!i||e.indexOf(f.mediaQuery)>-1));return Ft(new un(f=>{const v=this.registerQuery(e);if(v.length){const C=v.pop();v.forEach(S=>{f.next(S)}),this.source.next(C)}f.complete()}),s)}return this._observable$}registerQuery(e){const i=Array.isArray(e)?e:[e],s=[];return function OU(n,t){const e=n.filter(i=>!EI[i]);if(e.length>0){const i=e.join(", ");try{const s=t.createElement("style");s.setAttribute("type","text/css"),s.styleSheet||s.appendChild(t.createTextNode(`\n/*\n  @angular/flex-layout - workaround for possible browser quirk with mediaQuery listeners\n  see http://bit.ly/2sd4HMP\n*/\n@media ${i} {.fx-query-test{ }}\n`)),t.head.appendChild(s),e.forEach(c=>EI[c]=s)}catch(s){console.error(s)}}}(i,this._document),i.forEach(c=>{const f=C=>{this._zone.run(()=>this.source.next(new If(C.matches,c)))};let v=this.registry.get(c);v||(v=this.buildMQL(c),v.addListener(f),this.pendingRemoveListenerFns.push(()=>v.removeListener(f)),this.registry.set(c,v)),v.matches&&s.push(new If(!0,c))}),s}ngOnDestroy(){let e;for(;e=this.pendingRemoveListenerFns.pop();)e()}buildMQL(e){return function LU(n,t){return t&&window.matchMedia("all").addListener?window.matchMedia(n):{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{},onchange:null,addEventListener(){},removeEventListener(){},dispatchEvent:()=>!1}}(e,Ru(this._platformId))}}return n.\u0275fac=function(e){return new(e||n)(Ce(fn),Ce(so),Ce(sn))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const EI={},BU=[{alias:"xs",mediaQuery:"screen and (min-width: 0px) and (max-width: 599.98px)",priority:1e3},{alias:"sm",mediaQuery:"screen and (min-width: 600px) and (max-width: 959.98px)",priority:900},{alias:"md",mediaQuery:"screen and (min-width: 960px) and (max-width: 1279.98px)",priority:800},{alias:"lg",mediaQuery:"screen and (min-width: 1280px) and (max-width: 1919.98px)",priority:700},{alias:"xl",mediaQuery:"screen and (min-width: 1920px) and (max-width: 4999.98px)",priority:600},{alias:"lt-sm",overlapping:!0,mediaQuery:"screen and (max-width: 599.98px)",priority:950},{alias:"lt-md",overlapping:!0,mediaQuery:"screen and (max-width: 959.98px)",priority:850},{alias:"lt-lg",overlapping:!0,mediaQuery:"screen and (max-width: 1279.98px)",priority:750},{alias:"lt-xl",overlapping:!0,priority:650,mediaQuery:"screen and (max-width: 1919.98px)"},{alias:"gt-xs",overlapping:!0,mediaQuery:"screen and (min-width: 600px)",priority:-950},{alias:"gt-sm",overlapping:!0,mediaQuery:"screen and (min-width: 960px)",priority:-850},{alias:"gt-md",overlapping:!0,mediaQuery:"screen and (min-width: 1280px)",priority:-750},{alias:"gt-lg",overlapping:!0,mediaQuery:"screen and (min-width: 1920px)",priority:-650}],DI="(orientation: portrait) and (max-width: 599.98px)",MI="(orientation: landscape) and (max-width: 959.98px)",SI="(orientation: portrait) and (min-width: 600px) and (max-width: 839.98px)",AI="(orientation: landscape) and (min-width: 960px) and (max-width: 1279.98px)",TI="(orientation: portrait) and (min-width: 840px)",II="(orientation: landscape) and (min-width: 1280px)",Vu={HANDSET:`${DI}, ${MI}`,TABLET:`${SI} , ${AI}`,WEB:`${TI}, ${II} `,HANDSET_PORTRAIT:`${DI}`,TABLET_PORTRAIT:`${SI} `,WEB_PORTRAIT:`${TI}`,HANDSET_LANDSCAPE:`${MI}`,TABLET_LANDSCAPE:`${AI}`,WEB_LANDSCAPE:`${II}`},NU=[{alias:"handset",priority:2e3,mediaQuery:Vu.HANDSET},{alias:"handset.landscape",priority:2e3,mediaQuery:Vu.HANDSET_LANDSCAPE},{alias:"handset.portrait",priority:2e3,mediaQuery:Vu.HANDSET_PORTRAIT},{alias:"tablet",priority:2100,mediaQuery:Vu.TABLET},{alias:"tablet.landscape",priority:2100,mediaQuery:Vu.TABLET_LANDSCAPE},{alias:"tablet.portrait",priority:2100,mediaQuery:Vu.TABLET_PORTRAIT},{alias:"web",priority:2200,mediaQuery:Vu.WEB,overlapping:!0},{alias:"web.landscape",priority:2200,mediaQuery:Vu.WEB_LANDSCAPE,overlapping:!0},{alias:"web.portrait",priority:2200,mediaQuery:Vu.WEB_PORTRAIT,overlapping:!0}],zU=/(\.|-|_)/g;function VU(n){let t=n.length>0?n.charAt(0):"",e=n.length>1?n.slice(1):"";return t.toUpperCase()+e}const $U=new dt("Token (@angular/flex-layout) Breakpoints",{providedIn:"root",factory:()=>{const n=md(Y1),t=md(Sl),e=[].concat.apply([],(n||[]).map(s=>Array.isArray(s)?s:[s]));return function GU(n,t=[]){const e={};return n.forEach(i=>{e[i.alias]=i}),t.forEach(i=>{e[i.alias]?zu(e[i.alias],i):e[i.alias]=i}),function UU(n){return n.forEach(t=>{t.suffix||(t.suffix=function jU(n){return n.replace(zU,"|").split("|").map(VU).join("")}(t.alias),t.overlapping=!!t.overlapping)}),n}(Object.keys(e).map(i=>e[i]))}((t.disableDefaultBps?[]:BU).concat(t.addOrientationBps?NU:[]),e)}});let J1=(()=>{class n{constructor(e){this.findByMap=new Map,this.items=[...e].sort(PU)}findByAlias(e){return e?this.findWithPredicate(e,i=>i.alias===e):null}findByQuery(e){return this.findWithPredicate(e,i=>i.mediaQuery===e)}get overlappings(){return this.items.filter(e=>e.overlapping)}get aliases(){return this.items.map(e=>e.alias)}get suffixes(){return this.items.map(e=>{var i;return null!==(i=null==e?void 0:e.suffix)&&void 0!==i?i:""})}findWithPredicate(e,i){var s;let c=this.findByMap.get(e);return c||(c=null!==(s=this.items.find(i))&&void 0!==s?s:null,this.findByMap.set(e,c)),null!=c?c:null}}return n.\u0275fac=function(e){return new(e||n)(Ce($U))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const ym="print",HU={alias:ym,mediaQuery:ym,priority:1e3};let qU=(()=>{class n{constructor(e,i,s){this.breakpoints=e,this.layoutConfig=i,this._document=s,this.registeredBeforeAfterPrintHooks=!1,this.isPrintingBeforeAfterEvent=!1,this.beforePrintEventListeners=[],this.afterPrintEventListeners=[],this.formerActivations=null,this.isPrinting=!1,this.queue=new WU,this.deactivations=[]}withPrintQuery(e){return[...e,ym]}isPrintEvent(e){return e.mediaQuery.startsWith(ym)}get printAlias(){var e;return[...null!==(e=this.layoutConfig.printWithBreakpoints)&&void 0!==e?e:[]]}get printBreakPoints(){return this.printAlias.map(e=>this.breakpoints.findByAlias(e)).filter(e=>null!==e)}getEventBreakpoints({mediaQuery:e}){const i=this.breakpoints.findByQuery(e);return(i?[...this.printBreakPoints,i]:this.printBreakPoints).sort(U_)}updateEvent(e){var i;let s=this.breakpoints.findByQuery(e.mediaQuery);return this.isPrintEvent(e)&&(s=this.getEventBreakpoints(e)[0],e.mediaQuery=null!==(i=null==s?void 0:s.mediaQuery)&&void 0!==i?i:""),wI(e,s)}registerBeforeAfterPrintHooks(e){if(!this._document.defaultView||this.registeredBeforeAfterPrintHooks)return;this.registeredBeforeAfterPrintHooks=!0;const i=()=>{this.isPrinting||(this.isPrintingBeforeAfterEvent=!0,this.startPrinting(e,this.getEventBreakpoints(new If(!0,ym))),e.updateStyles())},s=()=>{this.isPrintingBeforeAfterEvent=!1,this.isPrinting&&(this.stopPrinting(e),e.updateStyles())};this._document.defaultView.addEventListener("beforeprint",i),this._document.defaultView.addEventListener("afterprint",s),this.beforePrintEventListeners.push(i),this.afterPrintEventListeners.push(s)}interceptEvents(e){return i=>{this.isPrintEvent(i)?i.matches&&!this.isPrinting?(this.startPrinting(e,this.getEventBreakpoints(i)),e.updateStyles()):!i.matches&&this.isPrinting&&!this.isPrintingBeforeAfterEvent&&(this.stopPrinting(e),e.updateStyles()):this.collectActivations(e,i)}}blockPropagation(){return e=>!(this.isPrinting||this.isPrintEvent(e))}startPrinting(e,i){this.isPrinting=!0,this.formerActivations=e.activatedBreakpoints,e.activatedBreakpoints=this.queue.addPrintBreakpoints(i)}stopPrinting(e){e.activatedBreakpoints=this.deactivations,this.deactivations=[],this.formerActivations=null,this.queue.clear(),this.isPrinting=!1}collectActivations(e,i){if(!this.isPrinting||this.isPrintingBeforeAfterEvent){if(!this.isPrintingBeforeAfterEvent)return void(this.deactivations=[]);if(!i.matches){const s=this.breakpoints.findByQuery(i.mediaQuery);if(s){const c=this.formerActivations&&this.formerActivations.includes(s),f=!this.formerActivations&&e.activatedBreakpoints.includes(s);(c||f)&&(this.deactivations.push(s),this.deactivations.sort(U_))}}}}ngOnDestroy(){this._document.defaultView&&(this.beforePrintEventListeners.forEach(e=>this._document.defaultView.removeEventListener("beforeprint",e)),this.afterPrintEventListeners.forEach(e=>this._document.defaultView.removeEventListener("afterprint",e)))}}return n.\u0275fac=function(e){return new(e||n)(Ce(J1),Ce(Sl),Ce(sn))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class WU{constructor(){this.printBreakpoints=[]}addPrintBreakpoints(t){return t.push(HU),t.sort(U_),t.forEach(e=>this.addBreakpoint(e)),this.printBreakpoints}addBreakpoint(t){t&&void 0===this.printBreakpoints.find(i=>i.mediaQuery===t.mediaQuery)&&(this.printBreakpoints=function ZU(n){var t;return null!==(t=null==n?void 0:n.mediaQuery.startsWith(ym))&&void 0!==t&&t}(t)?[t,...this.printBreakpoints]:[...this.printBreakpoints,t])}clear(){this.printBreakpoints=[]}}let ki=(()=>{class n{constructor(e,i,s){this.matchMedia=e,this.breakpoints=i,this.hook=s,this._useFallbacks=!0,this._activatedBreakpoints=[],this.elementMap=new Map,this.elementKeyMap=new WeakMap,this.watcherMap=new WeakMap,this.updateMap=new WeakMap,this.clearMap=new WeakMap,this.subject=new Nt,this.observeActivations()}get activatedAlias(){var e,i;return null!==(i=null===(e=this.activatedBreakpoints[0])||void 0===e?void 0:e.alias)&&void 0!==i?i:""}set activatedBreakpoints(e){this._activatedBreakpoints=[...e]}get activatedBreakpoints(){return[...this._activatedBreakpoints]}set useFallbacks(e){this._useFallbacks=e}onMediaChange(e){const i=this.findByQuery(e.mediaQuery);if(i){e=wI(e,i);const s=this.activatedBreakpoints.indexOf(i);e.matches&&-1===s?(this._activatedBreakpoints.push(i),this._activatedBreakpoints.sort(U_),this.updateStyles()):!e.matches&&-1!==s&&(this._activatedBreakpoints.splice(s,1),this._activatedBreakpoints.sort(U_),this.updateStyles())}}init(e,i,s,c,f=[]){kI(this.updateMap,e,i,s),kI(this.clearMap,e,i,c),this.buildElementKeyMap(e,i),this.watchExtraTriggers(e,i,f)}getValue(e,i,s){const c=this.elementMap.get(e);if(c){const f=void 0!==s?c.get(s):this.getActivatedValues(c,i);if(f)return f.get(i)}}hasValue(e,i){const s=this.elementMap.get(e);if(s){const c=this.getActivatedValues(s,i);if(c)return void 0!==c.get(i)||!1}return!1}setValue(e,i,s,c){var f;let v=this.elementMap.get(e);if(v){const S=(null!==(f=v.get(c))&&void 0!==f?f:new Map).set(i,s);v.set(c,S),this.elementMap.set(e,v)}else v=(new Map).set(c,(new Map).set(i,s)),this.elementMap.set(e,v);const C=this.getValue(e,i);void 0!==C&&this.updateElement(e,i,C)}trackValue(e,i){return this.subject.asObservable().pipe(ui(s=>s.element===e&&s.key===i))}updateStyles(){this.elementMap.forEach((e,i)=>{const s=new Set(this.elementKeyMap.get(i));let c=this.getActivatedValues(e);c&&c.forEach((f,v)=>{this.updateElement(i,v,f),s.delete(v)}),s.forEach(f=>{if(c=this.getActivatedValues(e,f),c){const v=c.get(f);this.updateElement(i,f,v)}else this.clearElement(i,f)})})}clearElement(e,i){const s=this.clearMap.get(e);if(s){const c=s.get(i);c&&(c(),this.subject.next({element:e,key:i,value:""}))}}updateElement(e,i,s){const c=this.updateMap.get(e);if(c){const f=c.get(i);f&&(f(s),this.subject.next({element:e,key:i,value:s}))}}releaseElement(e){const i=this.watcherMap.get(e);i&&(i.forEach(c=>c.unsubscribe()),this.watcherMap.delete(e));const s=this.elementMap.get(e);s&&(s.forEach((c,f)=>s.delete(f)),this.elementMap.delete(e))}triggerUpdate(e,i){const s=this.elementMap.get(e);if(s){const c=this.getActivatedValues(s,i);c&&(i?this.updateElement(e,i,c.get(i)):c.forEach((f,v)=>this.updateElement(e,v,f)))}}buildElementKeyMap(e,i){let s=this.elementKeyMap.get(e);s||(s=new Set,this.elementKeyMap.set(e,s)),s.add(i)}watchExtraTriggers(e,i,s){if(s&&s.length){let c=this.watcherMap.get(e);if(c||(c=new Map,this.watcherMap.set(e,c)),!c.get(i)){const v=Ft(...s).subscribe(()=>{const C=this.getValue(e,i);this.updateElement(e,i,C)});c.set(i,v)}}}findByQuery(e){return this.breakpoints.findByQuery(e)}getActivatedValues(e,i){for(let c=0;c<this.activatedBreakpoints.length;c++){const v=e.get(this.activatedBreakpoints[c].alias);if(v&&(void 0===i||v.has(i)&&null!=v.get(i)))return v}if(!this._useFallbacks)return;const s=e.get("");return void 0===i||s&&s.has(i)?s:void 0}observeActivations(){const e=this.breakpoints.items.map(i=>i.mediaQuery);this.hook.registerBeforeAfterPrintHooks(this),this.matchMedia.observe(this.hook.withPrintQuery(e)).pipe(Ir(this.hook.interceptEvents(this)),ui(this.hook.blockPropagation())).subscribe(this.onMediaChange.bind(this))}}return n.\u0275fac=function(e){return new(e||n)(Ce(Q1),Ce(J1),Ce(qU))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function kI(n,t,e,i){var s;if(void 0!==i){const c=null!==(s=n.get(t))&&void 0!==s?s:new Map;c.set(e,i),n.set(t,c)}}let ji=(()=>{class n{constructor(e,i,s,c){this.elementRef=e,this.styleBuilder=i,this.styler=s,this.marshal=c,this.DIRECTIVE_KEY="",this.inputs=[],this.mru={},this.destroySubject=new Nt,this.styleCache=new Map}get parentElement(){return this.elementRef.nativeElement.parentElement}get nativeElement(){return this.elementRef.nativeElement}get activatedValue(){return this.marshal.getValue(this.nativeElement,this.DIRECTIVE_KEY)}set activatedValue(e){this.marshal.setValue(this.nativeElement,this.DIRECTIVE_KEY,e,this.marshal.activatedAlias)}ngOnChanges(e){Object.keys(e).forEach(i=>{if(-1!==this.inputs.indexOf(i)){const s=i.split(".").slice(1).join(".");this.setValue(e[i].currentValue,s)}})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete(),this.marshal.releaseElement(this.nativeElement)}init(e=[]){this.marshal.init(this.elementRef.nativeElement,this.DIRECTIVE_KEY,this.updateWithValue.bind(this),this.clearStyles.bind(this),e)}addStyles(e,i){const s=this.styleBuilder,c=s.shouldCache;let f=this.styleCache.get(e);(!f||!c)&&(f=s.buildStyles(e,i),c&&this.styleCache.set(e,f)),this.mru=Object.assign({},f),this.applyStyleToElement(f),s.sideEffect(e,f,i)}clearStyles(){Object.keys(this.mru).forEach(e=>{this.mru[e]=""}),this.applyStyleToElement(this.mru),this.mru={},this.currentValue=void 0}triggerUpdate(){this.marshal.triggerUpdate(this.nativeElement,this.DIRECTIVE_KEY)}getFlexFlowDirection(e,i=!1){if(e){const[s,c]=this.styler.getFlowDirection(e);if(!c&&i){const f=vI(s);this.styler.applyStyleToElements(f,[e])}return s.trim()}return"row"}hasWrap(e){return this.styler.hasWrap(e)}applyStyleToElement(e,i,s=this.nativeElement){this.styler.applyStyleToElement(s,e,i)}setValue(e,i){this.marshal.setValue(this.nativeElement,this.DIRECTIVE_KEY,e,i)}updateWithValue(e){this.currentValue!==e&&(this.addStyles(e),this.currentValue=e)}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(Qi),se(Ei),se(ki))},n.\u0275dir=je({type:n,features:[Li]}),n})();function FI(n,t="1",e="1"){let i=[t,e,n],s=n.indexOf("calc");if(s>0){i[2]=RI(n.substring(s).trim());let c=n.substr(0,s).trim().split(" ");2==c.length&&(i[0]=c[0],i[1]=c[1])}else if(0==s)i[2]=RI(n.trim());else{let c=n.split(" ");i=3===c.length?c:[t,e,n]}return i}function RI(n){return n.replace(/[\s]/g,"").replace(/[\/\*\+\-]/g," $& ")}function Jx(n,t){if(void 0===t)return n;const e=i=>{const s=+i.slice(0,-"x".length);return n.endsWith("x")&&!isNaN(s)?`${s*t.value}${t.unit}`:n};return n.includes(" ")?n.split(" ").map(e).join(" "):e(n)}let YU=(()=>{class n extends Qi{buildStyles(e,{display:i}){const s=vI(e);return Object.assign(Object.assign({},s),{display:"none"===i?i:s.display})}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wt(n)))(i||n)}}(),n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const QU=["fxLayout","fxLayout.xs","fxLayout.sm","fxLayout.md","fxLayout.lg","fxLayout.xl","fxLayout.lt-sm","fxLayout.lt-md","fxLayout.lt-lg","fxLayout.lt-xl","fxLayout.gt-xs","fxLayout.gt-sm","fxLayout.gt-md","fxLayout.gt-lg"];let JU=(()=>{class n extends ji{constructor(e,i,s,c,f){super(e,s,i,c),this._config=f,this.DIRECTIVE_KEY="layout",this.init()}updateWithValue(e){var i;const c=this._config.detectLayoutDisplay?this.styler.lookupStyle(this.nativeElement,"display"):"";this.styleCache=null!==(i=LI.get(c))&&void 0!==i?i:new Map,LI.set(c,this.styleCache),this.currentValue!==e&&(this.addStyles(e,{display:c}),this.currentValue=e)}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(Ei),se(YU),se(ki),se(Sl))},n.\u0275dir=je({type:n,features:[qe]}),n})(),OI=(()=>{class n extends JU{constructor(){super(...arguments),this.inputs=QU}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wt(n)))(i||n)}}(),n.\u0275dir=je({type:n,selectors:[["","fxLayout",""],["","fxLayout.xs",""],["","fxLayout.sm",""],["","fxLayout.md",""],["","fxLayout.lg",""],["","fxLayout.xl",""],["","fxLayout.lt-sm",""],["","fxLayout.lt-md",""],["","fxLayout.lt-lg",""],["","fxLayout.lt-xl",""],["","fxLayout.gt-xs",""],["","fxLayout.gt-sm",""],["","fxLayout.gt-md",""],["","fxLayout.gt-lg",""]],inputs:{fxLayout:"fxLayout","fxLayout.xs":"fxLayout.xs","fxLayout.sm":"fxLayout.sm","fxLayout.md":"fxLayout.md","fxLayout.lg":"fxLayout.lg","fxLayout.xl":"fxLayout.xl","fxLayout.lt-sm":"fxLayout.lt-sm","fxLayout.lt-md":"fxLayout.lt-md","fxLayout.lt-lg":"fxLayout.lt-lg","fxLayout.lt-xl":"fxLayout.lt-xl","fxLayout.gt-xs":"fxLayout.gt-xs","fxLayout.gt-sm":"fxLayout.gt-sm","fxLayout.gt-md":"fxLayout.gt-md","fxLayout.gt-lg":"fxLayout.gt-lg"},features:[qe]}),n})();const LI=new Map,BI={"margin-left":null,"margin-right":null,"margin-top":null,"margin-bottom":null};let e5=(()=>{class n extends Qi{constructor(e,i){super(),this._styler=e,this._config=i}buildStyles(e,i){return e.endsWith(e0)?function c5(n,t){const[e,i]=n.split(" "),c=S=>`-${S}`;let f="0px",v=c(null!=i?i:e),C="0px";return"rtl"===t?C=c(e):f=c(e),{margin:`0px ${f} ${v} ${C}`}}(e=Jx(e=e.slice(0,e.indexOf(e0)),this._config.multiplier),i.directionality):{}}sideEffect(e,i,s){const c=s.items;if(e.endsWith(e0)){const f=function l5(n,t){const[e,i]=n.split(" ");let c="0px",v="0px";return"rtl"===t?v=e:c=e,{padding:`0px ${c} ${null!=i?i:e} ${v}`}}(e=Jx(e=e.slice(0,e.indexOf(e0)),this._config.multiplier),s.directionality);this._styler.applyStyleToElements(f,s.items)}else{e=Jx(e,this._config.multiplier),e=this.addFallbackUnit(e);const f=c.pop(),v=function u5(n,t){const e=zI(t.directionality,t.layout),i=Object.assign({},BI);return i[e]=n,i}(e,s);this._styler.applyStyleToElements(v,c),this._styler.applyStyleToElements(BI,[f])}}addFallbackUnit(e){return isNaN(+e)?e:`${e}${this._config.defaultUnit}`}}return n.\u0275fac=function(e){return new(e||n)(Ce(Ei),Ce(Sl))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const t5=["fxLayoutGap","fxLayoutGap.xs","fxLayoutGap.sm","fxLayoutGap.md","fxLayoutGap.lg","fxLayoutGap.xl","fxLayoutGap.lt-sm","fxLayoutGap.lt-md","fxLayoutGap.lt-lg","fxLayoutGap.lt-xl","fxLayoutGap.gt-xs","fxLayoutGap.gt-sm","fxLayoutGap.gt-md","fxLayoutGap.gt-lg"];let n5=(()=>{class n extends ji{constructor(e,i,s,c,f,v){super(e,f,c,v),this.zone=i,this.directionality=s,this.styleUtils=c,this.layout="row",this.DIRECTIVE_KEY="layout-gap",this.observerSubject=new Nt;const C=[this.directionality.change,this.observerSubject.asObservable()];this.init(C),this.marshal.trackValue(this.nativeElement,"layout").pipe(Vi(this.destroySubject)).subscribe(this.onLayoutChange.bind(this))}get childrenNodes(){const e=this.nativeElement.children,i=[];for(let s=e.length;s--;)i[s]=e[s];return i}ngAfterContentInit(){this.buildChildObservable(),this.triggerUpdate()}ngOnDestroy(){super.ngOnDestroy(),this.observer&&this.observer.disconnect()}onLayoutChange(e){const s=e.value.split(" ");this.layout=s[0],Qx.find(c=>c===this.layout)||(this.layout="row"),this.triggerUpdate()}updateWithValue(e){const i=this.childrenNodes.filter(s=>1===s.nodeType&&this.willDisplay(s)).sort((s,c)=>{const f=+this.styler.lookupStyle(s,"order"),v=+this.styler.lookupStyle(c,"order");return isNaN(f)||isNaN(v)||f===v?0:f>v?1:-1});if(i.length>0){const s=this.directionality.value,c=this.layout;"row"===c&&"rtl"===s?this.styleCache=r5:"row"===c&&"rtl"!==s?this.styleCache=o5:"column"===c&&"rtl"===s?this.styleCache=s5:"column"===c&&"rtl"!==s&&(this.styleCache=a5),this.addStyles(e,{directionality:s,items:i,layout:c})}}clearStyles(){const e=Object.keys(this.mru).length>0,i=e?"padding":zI(this.directionality.value,this.layout);e&&super.clearStyles(),this.styleUtils.applyStyleToElements({[i]:""},this.childrenNodes)}willDisplay(e){const i=this.marshal.getValue(e,"show-hide");return!0===i||void 0===i&&"none"!==this.styleUtils.lookupStyle(e,"display")}buildChildObservable(){this.zone.runOutsideAngular(()=>{"undefined"!=typeof MutationObserver&&(this.observer=new MutationObserver(e=>{e.some(s=>s.addedNodes&&s.addedNodes.length>0||s.removedNodes&&s.removedNodes.length>0)&&this.observerSubject.next()}),this.observer.observe(this.nativeElement,{childList:!0}))})}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(fn),se(Cf),se(Ei),se(e5),se(ki))},n.\u0275dir=je({type:n,features:[qe]}),n})(),NI=(()=>{class n extends n5{constructor(){super(...arguments),this.inputs=t5}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wt(n)))(i||n)}}(),n.\u0275dir=je({type:n,selectors:[["","fxLayoutGap",""],["","fxLayoutGap.xs",""],["","fxLayoutGap.sm",""],["","fxLayoutGap.md",""],["","fxLayoutGap.lg",""],["","fxLayoutGap.xl",""],["","fxLayoutGap.lt-sm",""],["","fxLayoutGap.lt-md",""],["","fxLayoutGap.lt-lg",""],["","fxLayoutGap.lt-xl",""],["","fxLayoutGap.gt-xs",""],["","fxLayoutGap.gt-sm",""],["","fxLayoutGap.gt-md",""],["","fxLayoutGap.gt-lg",""]],inputs:{fxLayoutGap:"fxLayoutGap","fxLayoutGap.xs":"fxLayoutGap.xs","fxLayoutGap.sm":"fxLayoutGap.sm","fxLayoutGap.md":"fxLayoutGap.md","fxLayoutGap.lg":"fxLayoutGap.lg","fxLayoutGap.xl":"fxLayoutGap.xl","fxLayoutGap.lt-sm":"fxLayoutGap.lt-sm","fxLayoutGap.lt-md":"fxLayoutGap.lt-md","fxLayoutGap.lt-lg":"fxLayoutGap.lt-lg","fxLayoutGap.lt-xl":"fxLayoutGap.lt-xl","fxLayoutGap.gt-xs":"fxLayoutGap.gt-xs","fxLayoutGap.gt-sm":"fxLayoutGap.gt-sm","fxLayoutGap.gt-md":"fxLayoutGap.gt-md","fxLayoutGap.gt-lg":"fxLayoutGap.gt-lg"},features:[qe]}),n})();const r5=new Map,s5=new Map,o5=new Map,a5=new Map,e0=" grid";function zI(n,t){switch(t){case"column":return"margin-bottom";case"column-reverse":return"margin-top";case"row":default:return"rtl"===n?"margin-left":"margin-right";case"row-reverse":return"rtl"===n?"margin-right":"margin-left"}}let d5=(()=>{class n extends Qi{constructor(e){super(),this.layoutConfig=e}buildStyles(e,i){let[s,c,...f]=e.split(" "),v=f.join(" ");const C=i.direction.indexOf("column")>-1?"column":"row",S=j_(C)?"max-width":"max-height",I=j_(C)?"min-width":"min-height",L=String(v).indexOf("calc")>-1,q=L||"auto"===v,X=String(v).indexOf("%")>-1&&!L,ue=String(v).indexOf("px")>-1||String(v).indexOf("rem")>-1||String(v).indexOf("em")>-1||String(v).indexOf("vw")>-1||String(v).indexOf("vh")>-1;let xe=L||ue;s="0"==s?0:s,c="0"==c?0:c;const ke=!s&&!c;let Ie={};const Ee={"max-width":null,"max-height":null,"min-width":null,"min-height":null};switch(v||""){case"":const it=!1!==this.layoutConfig.useColumnBasisZero;v="row"===C?"0%":it?"0.000000001px":"auto";break;case"initial":case"nogrow":s=0,v="auto";break;case"grow":v="100%";break;case"noshrink":c=0,v="auto";break;case"auto":break;case"none":s=0,c=0,v="auto";break;default:!xe&&!X&&!isNaN(v)&&(v+="%"),"0%"===v&&(xe=!0),"0px"===v&&(v="0%"),Ie=zu(Ee,L?{"flex-grow":s,"flex-shrink":c,"flex-basis":xe?v:"100%"}:{flex:`${s} ${c} ${xe?v:"100%"}`})}return Ie.flex||Ie["flex-grow"]||(Ie=zu(Ee,L?{"flex-grow":s,"flex-shrink":c,"flex-basis":v}:{flex:`${s} ${c} ${v}`})),"0%"!==v&&"0px"!==v&&"0.000000001px"!==v&&"auto"!==v&&(Ie[I]=ke||xe&&s?v:null,Ie[S]=ke||!q&&c?v:null),Ie[I]||Ie[S]?i.hasWrap&&(Ie[L?"flex-basis":"flex"]=Ie[S]?L?Ie[S]:`${s} ${c} ${Ie[S]}`:L?Ie[I]:`${s} ${c} ${Ie[I]}`):Ie=zu(Ee,L?{"flex-grow":s,"flex-shrink":c,"flex-basis":v}:{flex:`${s} ${c} ${v}`}),zu(Ie,{"box-sizing":"border-box"})}}return n.\u0275fac=function(e){return new(e||n)(Ce(Sl))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const h5=["fxFlex","fxFlex.xs","fxFlex.sm","fxFlex.md","fxFlex.lg","fxFlex.xl","fxFlex.lt-sm","fxFlex.lt-md","fxFlex.lt-lg","fxFlex.lt-xl","fxFlex.gt-xs","fxFlex.gt-sm","fxFlex.gt-md","fxFlex.gt-lg"];let f5=(()=>{class n extends ji{constructor(e,i,s,c,f){super(e,c,i,f),this.layoutConfig=s,this.marshal=f,this.DIRECTIVE_KEY="flex",this.direction=void 0,this.wrap=void 0,this.flexGrow="1",this.flexShrink="1",this.init()}get shrink(){return this.flexShrink}set shrink(e){this.flexShrink=e||"1",this.triggerReflow()}get grow(){return this.flexGrow}set grow(e){this.flexGrow=e||"1",this.triggerReflow()}ngOnInit(){this.parentElement&&(this.marshal.trackValue(this.parentElement,"layout").pipe(Vi(this.destroySubject)).subscribe(this.onLayoutChange.bind(this)),this.marshal.trackValue(this.nativeElement,"layout-align").pipe(Vi(this.destroySubject)).subscribe(this.triggerReflow.bind(this)))}onLayoutChange(e){const s=e.value.split(" ");this.direction=s[0],this.wrap=void 0!==s[1]&&"wrap"===s[1],this.triggerUpdate()}updateWithValue(e){void 0===this.direction&&(this.direction=this.getFlexFlowDirection(this.parentElement,!1!==this.layoutConfig.addFlexToParent)),void 0===this.wrap&&(this.wrap=this.hasWrap(this.parentElement));const s=this.direction,c=s.startsWith("row"),f=this.wrap;c&&f?this.styleCache=g5:c&&!f?this.styleCache=p5:!c&&f?this.styleCache=_5:!c&&!f&&(this.styleCache=m5);const C=FI(String(e).replace(";",""),this.flexGrow,this.flexShrink);this.addStyles(C.join(" "),{direction:s,hasWrap:f})}triggerReflow(){const e=this.activatedValue;if(void 0!==e){const i=FI(e+"",this.flexGrow,this.flexShrink);this.marshal.updateElement(this.nativeElement,this.DIRECTIVE_KEY,i.join(" "))}}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(Ei),se(Sl),se(d5),se(ki))},n.\u0275dir=je({type:n,inputs:{shrink:["fxShrink","shrink"],grow:["fxGrow","grow"]},features:[qe]}),n})(),VI=(()=>{class n extends f5{constructor(){super(...arguments),this.inputs=h5}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wt(n)))(i||n)}}(),n.\u0275dir=je({type:n,selectors:[["","fxFlex",""],["","fxFlex.xs",""],["","fxFlex.sm",""],["","fxFlex.md",""],["","fxFlex.lg",""],["","fxFlex.xl",""],["","fxFlex.lt-sm",""],["","fxFlex.lt-md",""],["","fxFlex.lt-lg",""],["","fxFlex.lt-xl",""],["","fxFlex.gt-xs",""],["","fxFlex.gt-sm",""],["","fxFlex.gt-md",""],["","fxFlex.gt-lg",""]],inputs:{fxFlex:"fxFlex","fxFlex.xs":"fxFlex.xs","fxFlex.sm":"fxFlex.sm","fxFlex.md":"fxFlex.md","fxFlex.lg":"fxFlex.lg","fxFlex.xl":"fxFlex.xl","fxFlex.lt-sm":"fxFlex.lt-sm","fxFlex.lt-md":"fxFlex.lt-md","fxFlex.lt-lg":"fxFlex.lt-lg","fxFlex.lt-xl":"fxFlex.lt-xl","fxFlex.gt-xs":"fxFlex.gt-xs","fxFlex.gt-sm":"fxFlex.gt-sm","fxFlex.gt-md":"fxFlex.gt-md","fxFlex.gt-lg":"fxFlex.gt-lg"},features:[qe]}),n})();const p5=new Map,m5=new Map,g5=new Map,_5=new Map;let V5=(()=>{class n extends Qi{buildStyles(e,i){const s={},[c,f]=e.split(" ");switch(c){case"center":s["justify-content"]="center";break;case"space-around":s["justify-content"]="space-around";break;case"space-between":s["justify-content"]="space-between";break;case"space-evenly":s["justify-content"]="space-evenly";break;case"end":case"flex-end":s["justify-content"]="flex-end";break;default:s["justify-content"]="flex-start"}switch(f){case"start":case"flex-start":s["align-items"]=s["align-content"]="flex-start";break;case"center":s["align-items"]=s["align-content"]="center";break;case"end":case"flex-end":s["align-items"]=s["align-content"]="flex-end";break;case"space-between":s["align-content"]="space-between",s["align-items"]="stretch";break;case"space-around":s["align-content"]="space-around",s["align-items"]="stretch";break;case"baseline":s["align-content"]="stretch",s["align-items"]="baseline";break;default:s["align-items"]=s["align-content"]="stretch"}return zu(s,{display:i.inline?"inline-flex":"flex","flex-direction":i.layout,"box-sizing":"border-box","max-width":"stretch"===f?j_(i.layout)?null:"100%":null,"max-height":"stretch"===f&&j_(i.layout)?"100%":null})}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wt(n)))(i||n)}}(),n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const j5=["fxLayoutAlign","fxLayoutAlign.xs","fxLayoutAlign.sm","fxLayoutAlign.md","fxLayoutAlign.lg","fxLayoutAlign.xl","fxLayoutAlign.lt-sm","fxLayoutAlign.lt-md","fxLayoutAlign.lt-lg","fxLayoutAlign.lt-xl","fxLayoutAlign.gt-xs","fxLayoutAlign.gt-sm","fxLayoutAlign.gt-md","fxLayoutAlign.gt-lg"];let U5=(()=>{class n extends ji{constructor(e,i,s,c){super(e,s,i,c),this.DIRECTIVE_KEY="layout-align",this.layout="row",this.inline=!1,this.init(),this.marshal.trackValue(this.nativeElement,"layout").pipe(Vi(this.destroySubject)).subscribe(this.onLayoutChange.bind(this))}updateWithValue(e){const i=this.layout||"row",s=this.inline;"row"===i&&s?this.styleCache=W5:"row"!==i||s?"row-reverse"===i&&s?this.styleCache=X5:"row-reverse"!==i||s?"column"===i&&s?this.styleCache=Z5:"column"!==i||s?"column-reverse"===i&&s?this.styleCache=K5:"column-reverse"===i&&!s&&(this.styleCache=q5):this.styleCache=$5:this.styleCache=H5:this.styleCache=G5,this.addStyles(e,{layout:i,inline:s})}onLayoutChange(e){const i=e.value.split(" ");this.layout=i[0],this.inline=e.value.includes("inline"),Qx.find(s=>s===this.layout)||(this.layout="row"),this.triggerUpdate()}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(Ei),se(V5),se(ki))},n.\u0275dir=je({type:n,features:[qe]}),n})(),jI=(()=>{class n extends U5{constructor(){super(...arguments),this.inputs=j5}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wt(n)))(i||n)}}(),n.\u0275dir=je({type:n,selectors:[["","fxLayoutAlign",""],["","fxLayoutAlign.xs",""],["","fxLayoutAlign.sm",""],["","fxLayoutAlign.md",""],["","fxLayoutAlign.lg",""],["","fxLayoutAlign.xl",""],["","fxLayoutAlign.lt-sm",""],["","fxLayoutAlign.lt-md",""],["","fxLayoutAlign.lt-lg",""],["","fxLayoutAlign.lt-xl",""],["","fxLayoutAlign.gt-xs",""],["","fxLayoutAlign.gt-sm",""],["","fxLayoutAlign.gt-md",""],["","fxLayoutAlign.gt-lg",""]],inputs:{fxLayoutAlign:"fxLayoutAlign","fxLayoutAlign.xs":"fxLayoutAlign.xs","fxLayoutAlign.sm":"fxLayoutAlign.sm","fxLayoutAlign.md":"fxLayoutAlign.md","fxLayoutAlign.lg":"fxLayoutAlign.lg","fxLayoutAlign.xl":"fxLayoutAlign.xl","fxLayoutAlign.lt-sm":"fxLayoutAlign.lt-sm","fxLayoutAlign.lt-md":"fxLayoutAlign.lt-md","fxLayoutAlign.lt-lg":"fxLayoutAlign.lt-lg","fxLayoutAlign.lt-xl":"fxLayoutAlign.lt-xl","fxLayoutAlign.gt-xs":"fxLayoutAlign.gt-xs","fxLayoutAlign.gt-sm":"fxLayoutAlign.gt-sm","fxLayoutAlign.gt-md":"fxLayoutAlign.gt-md","fxLayoutAlign.gt-lg":"fxLayoutAlign.gt-lg"},features:[qe]}),n})();const G5=new Map,$5=new Map,H5=new Map,q5=new Map,W5=new Map,Z5=new Map,X5=new Map,K5=new Map;let UI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[X1,dm]]}),n})();const Y5=["*",[["mat-card-footer"]]],Q5=["*","mat-card-footer"],J5=[[["","mat-card-avatar",""],["","matCardAvatar",""]],[["mat-card-title"],["mat-card-subtitle"],["","mat-card-title",""],["","mat-card-subtitle",""],["","matCardTitle",""],["","matCardSubtitle",""]],"*"],e4=["[mat-card-avatar], [matCardAvatar]","mat-card-title, mat-card-subtitle,\n      [mat-card-title], [mat-card-subtitle],\n      [matCardTitle], [matCardSubtitle]","*"];let t4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=je({type:n,selectors:[["mat-card-title"],["","mat-card-title",""],["","matCardTitle",""]],hostAttrs:[1,"mat-card-title"]}),n})(),n4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=je({type:n,selectors:[["mat-card-subtitle"],["","mat-card-subtitle",""],["","matCardSubtitle",""]],hostAttrs:[1,"mat-card-subtitle"]}),n})(),r4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=je({type:n,selectors:[["","mat-card-image",""],["","matCardImage",""]],hostAttrs:[1,"mat-card-image"]}),n})(),s4=(()=>{class n{constructor(e){this._animationMode=e}}return n.\u0275fac=function(e){return new(e||n)(se(Gd,8))},n.\u0275cmp=Un({type:n,selectors:[["mat-card"]],hostAttrs:[1,"mat-card","mat-focus-indicator"],hostVars:2,hostBindings:function(e,i){2&e&&sr("_mat-animation-noopable","NoopAnimations"===i._animationMode)},exportAs:["matCard"],ngContentSelectors:Q5,decls:2,vars:0,template:function(e,i){1&e&&(Os(Y5),_i(0),_i(1,1))},styles:[".mat-card{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);display:block;position:relative;padding:16px;border-radius:4px}._mat-animation-noopable.mat-card{transition:none;animation:none}.mat-card .mat-divider-horizontal{position:absolute;left:0;width:100%}[dir=rtl] .mat-card .mat-divider-horizontal{left:auto;right:0}.mat-card .mat-divider-horizontal.mat-divider-inset{position:static;margin:0}[dir=rtl] .mat-card .mat-divider-horizontal.mat-divider-inset{margin-right:0}.cdk-high-contrast-active .mat-card{outline:solid 1px}.mat-card-actions,.mat-card-subtitle,.mat-card-content{display:block;margin-bottom:16px}.mat-card-title{display:block;margin-bottom:8px}.mat-card-actions{margin-left:-8px;margin-right:-8px;padding:8px 0}.mat-card-actions-align-end{display:flex;justify-content:flex-end}.mat-card-image{width:calc(100% + 32px);margin:0 -16px 16px -16px;display:block;overflow:hidden}.mat-card-image img{width:100%}.mat-card-footer{display:block;margin:0 -16px -16px -16px}.mat-card-actions .mat-button,.mat-card-actions .mat-raised-button,.mat-card-actions .mat-stroked-button{margin:0 8px}.mat-card-header{display:flex;flex-direction:row}.mat-card-header .mat-card-title{margin-bottom:12px}.mat-card-header-text{margin:0 16px}.mat-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;object-fit:cover}.mat-card-title-group{display:flex;justify-content:space-between}.mat-card-sm-image{width:80px;height:80px}.mat-card-md-image{width:112px;height:112px}.mat-card-lg-image{width:152px;height:152px}.mat-card-xl-image{width:240px;height:240px;margin:-8px}.mat-card-title-group>.mat-card-xl-image{margin:-8px 0 8px}@media(max-width: 599px){.mat-card-title-group{margin:0}.mat-card-xl-image{margin-left:0;margin-right:0}}.mat-card>:first-child,.mat-card-content>:first-child{margin-top:0}.mat-card>:last-child:not(.mat-card-footer),.mat-card-content>:last-child:not(.mat-card-footer){margin-bottom:0}.mat-card-image:first-child{margin-top:-16px;border-top-left-radius:inherit;border-top-right-radius:inherit}.mat-card>.mat-card-actions:last-child{margin-bottom:-8px;padding-bottom:0}.mat-card-actions:not(.mat-card-actions-align-end) .mat-button:first-child,.mat-card-actions:not(.mat-card-actions-align-end) .mat-raised-button:first-child,.mat-card-actions:not(.mat-card-actions-align-end) .mat-stroked-button:first-child{margin-left:0;margin-right:0}.mat-card-actions-align-end .mat-button:last-child,.mat-card-actions-align-end .mat-raised-button:last-child,.mat-card-actions-align-end .mat-stroked-button:last-child{margin-left:0;margin-right:0}.mat-card-title:not(:first-child),.mat-card-subtitle:not(:first-child){margin-top:-4px}.mat-card-header .mat-card-subtitle:not(:first-child){margin-top:-8px}.mat-card>.mat-card-xl-image:first-child{margin-top:-8px}.mat-card>.mat-card-xl-image:last-child{margin-bottom:-8px}\n"],encapsulation:2,changeDetection:0}),n})(),o4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Un({type:n,selectors:[["mat-card-header"]],hostAttrs:[1,"mat-card-header"],ngContentSelectors:e4,decls:4,vars:0,consts:[[1,"mat-card-header-text"]],template:function(e,i){1&e&&(Os(J5),_i(0),Jt(1,"div",0),_i(2,1),en(),_i(3,2))},encapsulation:2,changeDetection:0}),n})(),a4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[Ci],Ci]}),n})();function l4(n,t){if(1&n&&(Jt(0,"div",3),Jt(1,"mat-card",4),pr(2,"img",5),Jt(3,"mat-card-header"),Jt(4,"mat-card-title"),Qo(5),en(),Jt(6,"mat-card-subtitle"),Qo(7),en(),en(),en(),en()),2&n){const e=t.$implicit;Zr(2),ps("src",e.img,Uh),Zr(3),Tv(e.nombre),Zr(2),Tv(e.desc)}}let GI=(()=>{class n{constructor(e){this._productoservice=e,this.productos=[]}ngOnInit(){this._productoservice.getProductos().subscribe(e=>this.productos=e)}}return n.\u0275fac=function(e){return new(e||n)(se(VA))},n.\u0275cmp=Un({type:n,selectors:[["app-productos"]],decls:5,vars:1,consts:[[1,"cont"],["fxLayout","row wrap","fxLayout.xs","row wrap","fxLayoutGap","10px","fxLayoutAlign","center center"],["fxFlex","45","fxFlex.lg","15","fxFlex.md","20","fxFlex.sm","45","class","producto-card",4,"ngFor","ngForOf"],["fxFlex","45","fxFlex.lg","15","fxFlex.md","20","fxFlex.sm","45",1,"producto-card"],[1,"example-card"],["mat-card-image","","alt","Iveco",3,"src"]],template:function(e,i){1&e&&(Jt(0,"div",0),pr(1,"mat-divider"),pr(2,"br"),Jt(3,"div",1),mc(4,l4,8,3,"div",2),en(),en()),2&e&&(Zr(4),ps("ngForOf",i.productos))},directives:[EU,OI,NI,jI,xw,VI,s4,r4,o4,t4,n4],styles:[""]}),n})();var eC=Gu(898);class b4{constructor(t,e,i=!0){this.key=t,this.value=e,this.key=i?t.replace(/['"]/g,"").trim():t.trim(),this.value=i?e.replace(/['"]/g,"").trim():e.trim(),this.value=this.value.replace(/;/,"")}}function $I(n){let t=typeof n;return"object"===t?n.constructor===Array?"array":n.constructor===Set?"set":"object":t}function qI(n){const[t,...e]=n.split(":");return new b4(t,e.join(":"))}function WI(n,t){return t.key&&(n[t.key]=t.value),n}let E4=(()=>{class n extends ji{constructor(e,i,s,c,f,v,C,S,I){var L;super(e,null,i,s),this.sanitizer=c,this.ngStyleInstance=C,this.DIRECTIVE_KEY="ngStyle",this.ngStyleInstance||(this.ngStyleInstance=new f_(e,f,v)),this.init();const q=null!==(L=this.nativeElement.getAttribute("style"))&&void 0!==L?L:"";this.fallbackStyles=this.buildStyleMap(q),this.isServer=S&&nm(I)}updateWithValue(e){const i=this.buildStyleMap(e);this.ngStyleInstance.ngStyle=Object.assign(Object.assign({},this.fallbackStyles),i),this.isServer&&this.applyStyleToElement(i),this.ngStyleInstance.ngDoCheck()}clearStyles(){this.ngStyleInstance.ngStyle=this.fallbackStyles,this.ngStyleInstance.ngDoCheck()}buildStyleMap(e){const i=s=>{var c;return null!==(c=this.sanitizer.sanitize(Sn.STYLE,s))&&void 0!==c?c:""};if(e)switch($I(e)){case"string":return ZI(function w4(n,t=";"){return String(n).trim().split(t).map(e=>e.trim()).filter(e=>""!==e)}(e),i);case"array":return ZI(e,i);default:return function HI(n,t){let e=[];return"set"===$I(n)?n.forEach(i=>e.push(i)):Object.keys(n).forEach(i=>{e.push(`${i}:${n[i]}`)}),function C4(n,t){return n.map(qI).filter(i=>!!i).map(i=>(t&&(i.value=t(i.value)),i)).reduce(WI,{})}(e,t)}(e,i)}return{}}ngDoCheck(){this.ngStyleInstance.ngDoCheck()}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(Ei),se(ki),se(ax),se(Bd),se(wl),se(f_,10),se(_m),se(so))},n.\u0275dir=je({type:n,features:[qe]}),n})();const D4=["ngStyle","ngStyle.xs","ngStyle.sm","ngStyle.md","ngStyle.lg","ngStyle.xl","ngStyle.lt-sm","ngStyle.lt-md","ngStyle.lt-lg","ngStyle.lt-xl","ngStyle.gt-xs","ngStyle.gt-sm","ngStyle.gt-md","ngStyle.gt-lg"];let nC=(()=>{class n extends E4{constructor(){super(...arguments),this.inputs=D4}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wt(n)))(i||n)}}(),n.\u0275dir=je({type:n,selectors:[["","ngStyle",""],["","ngStyle.xs",""],["","ngStyle.sm",""],["","ngStyle.md",""],["","ngStyle.lg",""],["","ngStyle.xl",""],["","ngStyle.lt-sm",""],["","ngStyle.lt-md",""],["","ngStyle.lt-lg",""],["","ngStyle.lt-xl",""],["","ngStyle.gt-xs",""],["","ngStyle.gt-sm",""],["","ngStyle.gt-md",""],["","ngStyle.gt-lg",""]],inputs:{ngStyle:"ngStyle","ngStyle.xs":"ngStyle.xs","ngStyle.sm":"ngStyle.sm","ngStyle.md":"ngStyle.md","ngStyle.lg":"ngStyle.lg","ngStyle.xl":"ngStyle.xl","ngStyle.lt-sm":"ngStyle.lt-sm","ngStyle.lt-md":"ngStyle.lt-md","ngStyle.lt-lg":"ngStyle.lt-lg","ngStyle.lt-xl":"ngStyle.lt-xl","ngStyle.gt-xs":"ngStyle.gt-xs","ngStyle.gt-sm":"ngStyle.gt-sm","ngStyle.gt-md":"ngStyle.gt-md","ngStyle.gt-lg":"ngStyle.gt-lg"},features:[qe]}),n})();function ZI(n,t){return n.map(qI).filter(i=>!!i).map(i=>(t&&(i.value=t(i.value)),i)).reduce(WI,{})}let XI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[X1]]}),n})();const M4=["mapa"],S4=function(n){return{"background-color":n}};function A4(n,t){if(1&n){const e=Zg();Jt(0,"li",4),Ki("click",function(){const c=No(e).$implicit;return Pd().irMarcador(c.marker)}),Qo(1),en()}if(2&n){const e=t.$implicit;ps("ngStyle",Nb(2,S4,e.color)),Zr(1),Iv(" ",e.nombre," ")}}const T4=[{path:"",component:GI},{path:"productos",component:GI},{path:"sucursales",component:(()=>{class n{constructor(e){this.productosService=e,this.zoomLevel=15,this.center=[-58.4052924415417,-34.75494439558738],this.marcadores=[]}ngAfterViewInit(){this.productosService.getSucursales().subscribe(e=>{console.log("sucursales",e),e.forEach(i=>{const s=new eC.Marker({draggable:!1,color:i.color}).setLngLat(i.center).addTo(this.map);this.marcadores.push({color:i.color,marker:s,center:i.center,nombre:i.nombre})})}),this.map=new eC.Map({container:this.divMapa.nativeElement,style:"mapbox://styles/mapbox/streets-v11",center:this.center,zoom:this.zoomLevel})}irMarcador(e){this.map.flyTo({center:e.getLngLat()})}}return n.\u0275fac=function(e){return new(e||n)(se(VA))},n.\u0275cmp=Un({type:n,selectors:[["app-sucursales"]],viewQuery:function(e,i){if(1&e&&mf(M4,5),2&e){let s;or(s=ar())&&(i.divMapa=s.first)}},decls:4,vars:1,consts:[[1,"list-group"],["class","list-group-item",3,"ngStyle","click",4,"ngFor","ngForOf"],[1,"map-container"],["mapa",""],[1,"list-group-item",3,"ngStyle","click"]],template:function(e,i){1&e&&(Jt(0,"ul",0),mc(1,A4,2,4,"li",1),en(),pr(2,"div",2,3)),2&e&&(Zr(1),ps("ngForOf",i.marcadores))},directives:[xw,f_,nC],styles:[".map-container[_ngcontent-%COMP%]{width:100vw;height:100vh}ul[_ngcontent-%COMP%]{position:fixed;right:20px;top:70px;border-radius:5px;z-index:9999;padding:0;list-style:none}li[_ngcontent-%COMP%]{cursor:pointer;padding:5px;color:#fff}"]}),n})()},{path:"**",redirectTo:""}];let I4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[BA.forRoot(T4)],BA]}),n})();const k4=function(n){return{left:n}};function F4(n,t){if(1&n&&(Jt(0,"div",1),Jt(1,"div",2),pr(2,"div",3),Jt(3,"div",4),Qo(4,"Aurelia Iveco"),en(),pr(5,"div",5),en(),en()),2&n){const e=Pd();ps("ngStyle",Nb(1,k4,e.windowWidth))}}let R4=(()=>{class n{constructor(){this.showSplash=!0}ngOnInit(){setTimeout(()=>{this.windowWidth="-"+window.innerWidth+"px",setTimeout(()=>{this.showSplash=!this.showSplash},500)},3e3)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Un({type:n,selectors:[["splash-screen"]],decls:1,vars:1,consts:[["class","app-splash-screen",3,"ngStyle",4,"ngIf"],[1,"app-splash-screen",3,"ngStyle"],[1,"app-splash-inner"],[1,"app-logo"],[1,"app-label"],[1,"app-loader"]],template:function(e,i){1&e&&mc(0,F4,6,3,"div",0),2&e&&ps("ngIf",i.showSplash)},directives:[h_,f_,nC],styles:[".app-splash-screen[_ngcontent-%COMP%]{background:#2196f3;position:fixed;inset:0;display:flex;justify-content:center;align-items:center;width:100%;height:100%;z-index:100;transition:left .5s}.app-label[_ngcontent-%COMP%]{margin-top:32px;color:#fff;font-size:2.5em}.app-splash-inner[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.app-logo[_ngcontent-%COMP%]{background:url(frente-de-camion.83acbeb717557d3e.png);background-repeat:no-repeat;max-width:100%;background-position:center;background-size:contain;width:100px;height:100px}.app-loader[_ngcontent-%COMP%]{background:url(three-dots.111df02d12dd0063.svg);background-repeat:no-repeat;max-width:100%;background-position:center;background-size:contain;width:80px;height:80px;margin-top:80px}"]}),n})();const P4=["addListener","removeListener"],O4=["addEventListener","removeEventListener"],L4=["on","off"];function kf(n,t,e,i){if(wn(e)&&(i=e,e=void 0),i)return kf(n,t,e).pipe(Bw(i));const[s,c]=function z4(n){return wn(n.addEventListener)&&wn(n.removeEventListener)}(n)?O4.map(f=>v=>n[f](t,v,e)):function B4(n){return wn(n.addListener)&&wn(n.removeListener)}(n)?P4.map(KI(n,t)):function N4(n){return wn(n.on)&&wn(n.off)}(n)?L4.map(KI(n,t)):[];if(!s&&Ic(n))return me(f=>kf(f,t,e))(Ri(n));if(!s)throw new TypeError("Invalid event target");return new un(f=>{const v=(...C)=>f.next(1<C.length?C:C[0]);return s(v),()=>c(v)})}function KI(n,t){return e=>i=>n[e](t,i)}const G_={schedule(n){let t=requestAnimationFrame,e=cancelAnimationFrame;const{delegate:i}=G_;i&&(t=i.requestAnimationFrame,e=i.cancelAnimationFrame);const s=t(c=>{e=void 0,n(c)});return new Wn(()=>null==e?void 0:e(s))},requestAnimationFrame(...n){const{delegate:t}=G_;return((null==t?void 0:t.requestAnimationFrame)||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:t}=G_;return((null==t?void 0:t.cancelAnimationFrame)||cancelAnimationFrame)(...n)},delegate:void 0};new class j4 extends d1{flush(t){this._active=!0,this._scheduled=void 0;const{actions:e}=this;let i,s=-1;t=t||e.shift();const c=e.length;do{if(i=t.execute(t.state,t.delay))break}while(++s<c&&(t=e.shift()));if(this._active=!1,i){for(;++s<c&&(t=e.shift());)t.unsubscribe();throw i}}}(class V4 extends u1{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=G_.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,e,i=0){if(null!=i&&i>0||null==i&&this.delay>0)return super.recycleAsyncId(t,e,i);0===t.actions.length&&(G_.cancelAnimationFrame(e),t._scheduled=void 0)}});let iC,G4=1;const t0={};function YI(n){return n in t0&&(delete t0[n],!0)}const $4={setImmediate(n){const t=G4++;return t0[t]=!0,iC||(iC=Promise.resolve()),iC.then(()=>YI(t)&&n()),t},clearImmediate(n){YI(n)}},{setImmediate:H4,clearImmediate:q4}=$4,n0={setImmediate(...n){const{delegate:t}=n0;return((null==t?void 0:t.setImmediate)||H4)(...n)},clearImmediate(n){const{delegate:t}=n0;return((null==t?void 0:t.clearImmediate)||q4)(n)},delegate:void 0};new class Z4 extends d1{flush(t){this._active=!0,this._scheduled=void 0;const{actions:e}=this;let i,s=-1;t=t||e.shift();const c=e.length;do{if(i=t.execute(t.state,t.delay))break}while(++s<c&&(t=e.shift()));if(this._active=!1,i){for(;++s<c&&(t=e.shift());)t.unsubscribe();throw i}}}(class W4 extends u1{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=n0.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,e,i=0){if(null!=i&&i>0||null==i&&this.delay>0)return super.recycleAsyncId(t,e,i);0===t.actions.length&&(n0.clearImmediate(e),t._scheduled=void 0)}});function QI(n=0,t,e=YA){let i=-1;return null!=t&&(Je(t)?e=t:i=t),new un(s=>{let c=function Y4(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;c<0&&(c=0);let f=0;return e.schedule(function(){s.closed||(s.next(f++),0<=i?this.schedule(void 0,i):s.complete())},c)})}function JI(n,t=YA){return function K4(n){return Pn((t,e)=>{let i=!1,s=null,c=null,f=!1;const v=()=>{if(null==c||c.unsubscribe(),c=null,i){i=!1;const S=s;s=null,e.next(S)}f&&e.complete()},C=()=>{c=null,f&&e.complete()};t.subscribe(new Cn(e,S=>{i=!0,s=S,c||Ri(n(S)).subscribe(c=new Cn(e,v,C))},()=>{f=!0,(!i||!c||c.closed)&&e.complete()}))})}(()=>QI(n,t))}let r0=(()=>{class n{constructor(e,i,s){this._ngZone=e,this._platform=i,this._scrolled=new Nt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=s}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new un(i=>{this._globalSubscription||this._addGlobalListener();const s=e>0?this._scrolled.pipe(JI(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{s.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Ot()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){const s=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(ui(c=>!c||s.indexOf(c)>-1))}getAncestorScrollContainers(e){const i=[];return this.scrollContainers.forEach((s,c)=>{this._scrollableContainsElement(c,e)&&i.push(c)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,i){let s=um(i),c=e.getElementRef().nativeElement;do{if(s==c)return!0}while(s=s.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>kf(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(e){return new(e||n)(Ce(fn),Ce(ja),Ce(sn,8))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),$_=(()=>{class n{constructor(e,i,s,c){this.elementRef=e,this.scrollDispatcher=i,this.ngZone=s,this.dir=c,this._destroyed=new Nt,this._elementScrolled=new un(f=>this.ngZone.runOutsideAngular(()=>kf(this.elementRef.nativeElement,"scroll").pipe(Vi(this._destroyed)).subscribe(f)))}ngOnInit(){this.scrollDispatcher.register(this)}ngOnDestroy(){this.scrollDispatcher.deregister(this),this._destroyed.next(),this._destroyed.complete()}elementScrolled(){return this._elementScrolled}getElementRef(){return this.elementRef}scrollTo(e){const i=this.elementRef.nativeElement,s=this.dir&&"rtl"==this.dir.value;null==e.left&&(e.left=s?e.end:e.start),null==e.right&&(e.right=s?e.start:e.end),null!=e.bottom&&(e.top=i.scrollHeight-i.clientHeight-e.bottom),s&&0!=k_()?(null!=e.left&&(e.right=i.scrollWidth-i.clientWidth-e.left),2==k_()?e.left=e.right:1==k_()&&(e.left=e.right?-e.right:e.right)):null!=e.right&&(e.left=i.scrollWidth-i.clientWidth-e.right),this._applyScrollToOptions(e)}_applyScrollToOptions(e){const i=this.elementRef.nativeElement;HA()?i.scrollTo(e):(null!=e.top&&(i.scrollTop=e.top),null!=e.left&&(i.scrollLeft=e.left))}measureScrollOffset(e){const i="left",s="right",c=this.elementRef.nativeElement;if("top"==e)return c.scrollTop;if("bottom"==e)return c.scrollHeight-c.clientHeight-c.scrollTop;const f=this.dir&&"rtl"==this.dir.value;return"start"==e?e=f?s:i:"end"==e&&(e=f?i:s),f&&2==k_()?e==i?c.scrollWidth-c.clientWidth-c.scrollLeft:c.scrollLeft:f&&1==k_()?e==i?c.scrollLeft+c.scrollWidth-c.clientWidth:-c.scrollLeft:e==i?c.scrollLeft:c.scrollWidth-c.clientWidth-c.scrollLeft}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(r0),se(fn),se(Cf,8))},n.\u0275dir=je({type:n,selectors:[["","cdk-scrollable",""],["","cdkScrollable",""]]}),n})(),rC=(()=>{class n{constructor(e,i,s){this._platform=e,this._change=new Nt,this._changeListener=c=>{this._change.next(c)},this._document=s,i.runOutsideAngular(()=>{if(e.isBrowser){const c=this._getWindow();c.addEventListener("resize",this._changeListener),c.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:i,height:s}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+s,right:e.left+i,height:s,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,i=this._getWindow(),s=e.documentElement,c=s.getBoundingClientRect();return{top:-c.top||e.body.scrollTop||i.scrollY||s.scrollTop||0,left:-c.left||e.body.scrollLeft||i.scrollX||s.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(JI(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(e){return new(e||n)(Ce(ja),Ce(fn),Ce(sn,8))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),s0=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({}),n})(),ek=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[dm,s0],dm,s0]}),n})();function sC(n){return Tt(()=>n)}const o0=["*"],eG=["content"];function tG(n,t){if(1&n){const e=Zg();Jt(0,"div",2),Ki("click",function(){return No(e),Pd()._onBackdropClicked()}),en()}2&n&&sr("mat-drawer-shown",Pd()._isShowingBackdrop())}function nG(n,t){1&n&&(Jt(0,"mat-drawer-content"),_i(1,2),en())}const iG=[[["mat-drawer"]],[["mat-drawer-content"]],"*"],rG=["mat-drawer","mat-drawer-content","*"];function sG(n,t){if(1&n){const e=Zg();Jt(0,"div",2),Ki("click",function(){return No(e),Pd()._onBackdropClicked()}),en()}2&n&&sr("mat-drawer-shown",Pd()._isShowingBackdrop())}function oG(n,t){1&n&&(Jt(0,"mat-sidenav-content"),_i(1,2),en())}const aG=[[["mat-sidenav"]],[["mat-sidenav-content"]],"*"],lG=["mat-sidenav","mat-sidenav-content","*"],tk={transformDrawer:m1("transform",[O_("open, open-instant",Cc({transform:"none",visibility:"visible"})),O_("void",Cc({"box-shadow":"none",visibility:"hidden"})),L_("void => open-instant",P_("0ms")),L_("void <=> open, open-instant => void",P_("400ms cubic-bezier(0.25, 0.8, 0.25, 1)"))])},uG=new dt("MAT_DRAWER_DEFAULT_AUTOSIZE",{providedIn:"root",factory:function dG(){return!1}}),oC=new dt("MAT_DRAWER_CONTAINER");let a0=(()=>{class n extends $_{constructor(e,i,s,c,f){super(s,c,f),this._changeDetectorRef=e,this._container=i}ngAfterContentInit(){this._container._contentMarginChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})}}return n.\u0275fac=function(e){return new(e||n)(se(vc),se(On(()=>ik)),se(Pt),se(r0),se(fn))},n.\u0275cmp=Un({type:n,selectors:[["mat-drawer-content"]],hostAttrs:[1,"mat-drawer-content"],hostVars:4,hostBindings:function(e,i){2&e&&Kg("margin-left",i._container._contentMargins.left,"px")("margin-right",i._container._contentMargins.right,"px")},features:[ei([{provide:$_,useExisting:n}]),qe],ngContentSelectors:o0,decls:1,vars:0,template:function(e,i){1&e&&(Os(),_i(0))},encapsulation:2,changeDetection:0}),n})(),nk=(()=>{class n{constructor(e,i,s,c,f,v,C,S){this._elementRef=e,this._focusTrapFactory=i,this._focusMonitor=s,this._platform=c,this._ngZone=f,this._interactivityChecker=v,this._doc=C,this._container=S,this._elementFocusedBeforeDrawerWasOpened=null,this._enableAnimations=!1,this._position="start",this._mode="over",this._disableClose=!1,this._opened=!1,this._animationStarted=new Nt,this._animationEnd=new Nt,this._animationState="void",this.openedChange=new ti(!0),this._openedStream=this.openedChange.pipe(ui(I=>I),Tt(()=>{})),this.openedStart=this._animationStarted.pipe(ui(I=>I.fromState!==I.toState&&0===I.toState.indexOf("open")),sC(void 0)),this._closedStream=this.openedChange.pipe(ui(I=>!I),Tt(()=>{})),this.closedStart=this._animationStarted.pipe(ui(I=>I.fromState!==I.toState&&"void"===I.toState),sC(void 0)),this._destroyed=new Nt,this.onPositionChanged=new ti,this._modeChanged=new Nt,this.openedChange.subscribe(I=>{I?(this._doc&&(this._elementFocusedBeforeDrawerWasOpened=this._doc.activeElement),this._takeFocus()):this._isFocusWithinDrawer()&&this._restoreFocus(this._openedVia||"program")}),this._ngZone.runOutsideAngular(()=>{kf(this._elementRef.nativeElement,"keydown").pipe(ui(I=>27===I.keyCode&&!this.disableClose&&!F_(I)),Vi(this._destroyed)).subscribe(I=>this._ngZone.run(()=>{this.close(),I.stopPropagation(),I.preventDefault()}))}),this._animationEnd.pipe(JA((I,L)=>I.fromState===L.fromState&&I.toState===L.toState)).subscribe(I=>{const{fromState:L,toState:q}=I;(0===q.indexOf("open")&&"void"===L||"void"===q&&0===L.indexOf("open"))&&this.openedChange.emit(this._opened)})}get position(){return this._position}set position(e){(e="end"===e?"end":"start")!==this._position&&(this._isAttached&&this._updatePositionInParent(e),this._position=e,this.onPositionChanged.emit())}get mode(){return this._mode}set mode(e){this._mode=e,this._updateFocusTrapState(),this._modeChanged.next()}get disableClose(){return this._disableClose}set disableClose(e){this._disableClose=Ii(e)}get autoFocus(){const e=this._autoFocus;return null==e?"side"===this.mode?"dialog":"first-tabbable":e}set autoFocus(e){("true"===e||"false"===e||null==e)&&(e=Ii(e)),this._autoFocus=e}get opened(){return this._opened}set opened(e){this.toggle(Ii(e))}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const s=()=>{e.removeEventListener("blur",s),e.removeEventListener("mousedown",s),e.removeAttribute("tabindex")};e.addEventListener("blur",s),e.addEventListener("mousedown",s)})),e.focus(i)}_focusByCssSelector(e,i){let s=this._elementRef.nativeElement.querySelector(e);s&&this._forceFocus(s,i)}_takeFocus(){if(!this._focusTrap)return;const e=this._elementRef.nativeElement;switch(this.autoFocus){case!1:case"dialog":return;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{!i&&"function"==typeof this._elementRef.nativeElement.focus&&e.focus()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this.autoFocus)}}_restoreFocus(e){"dialog"!==this.autoFocus&&(this._elementFocusedBeforeDrawerWasOpened?this._focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened,e):this._elementRef.nativeElement.blur(),this._elementFocusedBeforeDrawerWasOpened=null)}_isFocusWithinDrawer(){const e=this._doc.activeElement;return!!e&&this._elementRef.nativeElement.contains(e)}ngAfterViewInit(){this._isAttached=!0,this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._updateFocusTrapState(),"end"===this._position&&this._updatePositionInParent("end")}ngAfterContentChecked(){this._platform.isBrowser&&(this._enableAnimations=!0)}ngOnDestroy(){var e;this._focusTrap&&this._focusTrap.destroy(),null===(e=this._anchor)||void 0===e||e.remove(),this._anchor=null,this._animationStarted.complete(),this._animationEnd.complete(),this._modeChanged.complete(),this._destroyed.next(),this._destroyed.complete()}open(e){return this.toggle(!0,e)}close(){return this.toggle(!1)}_closeViaBackdropClick(){return this._setOpen(!1,!0,"mouse")}toggle(e=!this.opened,i){e&&i&&(this._openedVia=i);const s=this._setOpen(e,!e&&this._isFocusWithinDrawer(),this._openedVia||"program");return e||(this._openedVia=null),s}_setOpen(e,i,s){return this._opened=e,e?this._animationState=this._enableAnimations?"open":"open-instant":(this._animationState="void",i&&this._restoreFocus(s)),this._updateFocusTrapState(),new Promise(c=>{this.openedChange.pipe(jn(1)).subscribe(f=>c(f?"open":"close"))})}_getWidth(){return this._elementRef.nativeElement&&this._elementRef.nativeElement.offsetWidth||0}_updateFocusTrapState(){this._focusTrap&&(this._focusTrap.enabled=this.opened&&"side"!==this.mode)}_updatePositionInParent(e){const i=this._elementRef.nativeElement,s=i.parentNode;"end"===e?(this._anchor||(this._anchor=this._doc.createComment("mat-drawer-anchor"),s.insertBefore(this._anchor,i)),s.appendChild(i)):this._anchor&&this._anchor.parentNode.insertBefore(i,this._anchor)}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(rT),se(Fx),se(ja),se(fn),se(f1),se(sn,8),se(oC,8))},n.\u0275cmp=Un({type:n,selectors:[["mat-drawer"]],viewQuery:function(e,i){if(1&e&&mf(eG,5),2&e){let s;or(s=ar())&&(i._content=s.first)}},hostAttrs:["tabIndex","-1",1,"mat-drawer"],hostVars:12,hostBindings:function(e,i){1&e&&Sv("@transform.start",function(c){return i._animationStarted.next(c)})("@transform.done",function(c){return i._animationEnd.next(c)}),2&e&&(rr("align",null),kv("@transform",i._animationState),sr("mat-drawer-end","end"===i.position)("mat-drawer-over","over"===i.mode)("mat-drawer-push","push"===i.mode)("mat-drawer-side","side"===i.mode)("mat-drawer-opened",i.opened))},inputs:{position:"position",mode:"mode",disableClose:"disableClose",autoFocus:"autoFocus",opened:"opened"},outputs:{openedChange:"openedChange",_openedStream:"opened",openedStart:"openedStart",_closedStream:"closed",closedStart:"closedStart",onPositionChanged:"positionChanged"},exportAs:["matDrawer"],ngContentSelectors:o0,decls:3,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"],["content",""]],template:function(e,i){1&e&&(Os(),Jt(0,"div",0,1),_i(2),en())},directives:[$_],encapsulation:2,data:{animation:[tk.transformDrawer]},changeDetection:0}),n})(),ik=(()=>{class n{constructor(e,i,s,c,f,v=!1,C){this._dir=e,this._element=i,this._ngZone=s,this._changeDetectorRef=c,this._animationMode=C,this._drawers=new Yp,this.backdropClick=new ti,this._destroyed=new Nt,this._doCheckSubject=new Nt,this._contentMargins={left:null,right:null},this._contentMarginChanges=new Nt,e&&e.change.pipe(Vi(this._destroyed)).subscribe(()=>{this._validateDrawers(),this.updateContentMargins()}),f.change().pipe(Vi(this._destroyed)).subscribe(()=>this.updateContentMargins()),this._autosize=v}get start(){return this._start}get end(){return this._end}get autosize(){return this._autosize}set autosize(e){this._autosize=Ii(e)}get hasBackdrop(){return null==this._backdropOverride?!this._start||"side"!==this._start.mode||!this._end||"side"!==this._end.mode:this._backdropOverride}set hasBackdrop(e){this._backdropOverride=null==e?null:Ii(e)}get scrollable(){return this._userContent||this._content}ngAfterContentInit(){this._allDrawers.changes.pipe(rm(this._allDrawers),Vi(this._destroyed)).subscribe(e=>{this._drawers.reset(e.filter(i=>!i._container||i._container===this)),this._drawers.notifyOnChanges()}),this._drawers.changes.pipe(rm(null)).subscribe(()=>{this._validateDrawers(),this._drawers.forEach(e=>{this._watchDrawerToggle(e),this._watchDrawerPosition(e),this._watchDrawerMode(e)}),(!this._drawers.length||this._isDrawerOpen(this._start)||this._isDrawerOpen(this._end))&&this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),this._ngZone.runOutsideAngular(()=>{this._doCheckSubject.pipe(function QA(n,t=h1){return Pn((e,i)=>{let s=null,c=null,f=null;const v=()=>{if(s){s.unsubscribe(),s=null;const S=c;c=null,i.next(S)}};function C(){const S=f+n,I=t.now();if(I<S)return s=this.schedule(void 0,S-I),void i.add(s);v()}e.subscribe(new Cn(i,S=>{c=S,f=t.now(),s||(s=t.schedule(C,n),i.add(s))},()=>{v(),i.complete()},void 0,()=>{c=s=null}))})}(10),Vi(this._destroyed)).subscribe(()=>this.updateContentMargins())})}ngOnDestroy(){this._contentMarginChanges.complete(),this._doCheckSubject.complete(),this._drawers.destroy(),this._destroyed.next(),this._destroyed.complete()}open(){this._drawers.forEach(e=>e.open())}close(){this._drawers.forEach(e=>e.close())}updateContentMargins(){let e=0,i=0;if(this._left&&this._left.opened)if("side"==this._left.mode)e+=this._left._getWidth();else if("push"==this._left.mode){const s=this._left._getWidth();e+=s,i-=s}if(this._right&&this._right.opened)if("side"==this._right.mode)i+=this._right._getWidth();else if("push"==this._right.mode){const s=this._right._getWidth();i+=s,e-=s}e=e||null,i=i||null,(e!==this._contentMargins.left||i!==this._contentMargins.right)&&(this._contentMargins={left:e,right:i},this._ngZone.run(()=>this._contentMarginChanges.next(this._contentMargins)))}ngDoCheck(){this._autosize&&this._isPushed()&&this._ngZone.runOutsideAngular(()=>this._doCheckSubject.next())}_watchDrawerToggle(e){e._animationStarted.pipe(ui(i=>i.fromState!==i.toState),Vi(this._drawers.changes)).subscribe(i=>{"open-instant"!==i.toState&&"NoopAnimations"!==this._animationMode&&this._element.nativeElement.classList.add("mat-drawer-transition"),this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),"side"!==e.mode&&e.openedChange.pipe(Vi(this._drawers.changes)).subscribe(()=>this._setContainerClass(e.opened))}_watchDrawerPosition(e){!e||e.onPositionChanged.pipe(Vi(this._drawers.changes)).subscribe(()=>{this._ngZone.onMicrotaskEmpty.pipe(jn(1)).subscribe(()=>{this._validateDrawers()})})}_watchDrawerMode(e){e&&e._modeChanged.pipe(Vi(Ft(this._drawers.changes,this._destroyed))).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()})}_setContainerClass(e){const i=this._element.nativeElement.classList,s="mat-drawer-container-has-open";e?i.add(s):i.remove(s)}_validateDrawers(){this._start=this._end=null,this._drawers.forEach(e=>{"end"==e.position?this._end=e:this._start=e}),this._right=this._left=null,this._dir&&"rtl"===this._dir.value?(this._left=this._end,this._right=this._start):(this._left=this._start,this._right=this._end)}_isPushed(){return this._isDrawerOpen(this._start)&&"over"!=this._start.mode||this._isDrawerOpen(this._end)&&"over"!=this._end.mode}_onBackdropClicked(){this.backdropClick.emit(),this._closeModalDrawersViaBackdrop()}_closeModalDrawersViaBackdrop(){[this._start,this._end].filter(e=>e&&!e.disableClose&&this._canHaveBackdrop(e)).forEach(e=>e._closeViaBackdropClick())}_isShowingBackdrop(){return this._isDrawerOpen(this._start)&&this._canHaveBackdrop(this._start)||this._isDrawerOpen(this._end)&&this._canHaveBackdrop(this._end)}_canHaveBackdrop(e){return"side"!==e.mode||!!this._backdropOverride}_isDrawerOpen(e){return null!=e&&e.opened}}return n.\u0275fac=function(e){return new(e||n)(se(Cf,8),se(Pt),se(fn),se(vc),se(rC),se(uG),se(Gd,8))},n.\u0275cmp=Un({type:n,selectors:[["mat-drawer-container"]],contentQueries:function(e,i,s){if(1&e&&(io(s,a0,5),io(s,nk,5)),2&e){let c;or(c=ar())&&(i._content=c.first),or(c=ar())&&(i._allDrawers=c)}},viewQuery:function(e,i){if(1&e&&mf(a0,5),2&e){let s;or(s=ar())&&(i._userContent=s.first)}},hostAttrs:[1,"mat-drawer-container"],hostVars:2,hostBindings:function(e,i){2&e&&sr("mat-drawer-container-explicit-backdrop",i._backdropOverride)},inputs:{autosize:"autosize",hasBackdrop:"hasBackdrop"},outputs:{backdropClick:"backdropClick"},exportAs:["matDrawerContainer"],features:[ei([{provide:oC,useExisting:n}])],ngContentSelectors:rG,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],[4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"]],template:function(e,i){1&e&&(Os(iG),mc(0,tG,1,2,"div",0),_i(1),_i(2,1),mc(3,nG,2,0,"mat-drawer-content",1)),2&e&&(ps("ngIf",i.hasBackdrop),Zr(3),ps("ngIf",!i._content))},directives:[a0,h_],styles:['.mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer[style*="visibility: hidden"]{display:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\n'],encapsulation:2,changeDetection:0}),n})(),rk=(()=>{class n extends a0{constructor(e,i,s,c,f){super(e,i,s,c,f)}}return n.\u0275fac=function(e){return new(e||n)(se(vc),se(On(()=>ok)),se(Pt),se(r0),se(fn))},n.\u0275cmp=Un({type:n,selectors:[["mat-sidenav-content"]],hostAttrs:[1,"mat-drawer-content","mat-sidenav-content"],hostVars:4,hostBindings:function(e,i){2&e&&Kg("margin-left",i._container._contentMargins.left,"px")("margin-right",i._container._contentMargins.right,"px")},features:[ei([{provide:$_,useExisting:n}]),qe],ngContentSelectors:o0,decls:1,vars:0,template:function(e,i){1&e&&(Os(),_i(0))},encapsulation:2,changeDetection:0}),n})(),sk=(()=>{class n extends nk{constructor(){super(...arguments),this._fixedInViewport=!1,this._fixedTopGap=0,this._fixedBottomGap=0}get fixedInViewport(){return this._fixedInViewport}set fixedInViewport(e){this._fixedInViewport=Ii(e)}get fixedTopGap(){return this._fixedTopGap}set fixedTopGap(e){this._fixedTopGap=jA(e)}get fixedBottomGap(){return this._fixedBottomGap}set fixedBottomGap(e){this._fixedBottomGap=jA(e)}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wt(n)))(i||n)}}(),n.\u0275cmp=Un({type:n,selectors:[["mat-sidenav"]],hostAttrs:["tabIndex","-1",1,"mat-drawer","mat-sidenav"],hostVars:17,hostBindings:function(e,i){2&e&&(rr("align",null),Kg("top",i.fixedInViewport?i.fixedTopGap:null,"px")("bottom",i.fixedInViewport?i.fixedBottomGap:null,"px"),sr("mat-drawer-end","end"===i.position)("mat-drawer-over","over"===i.mode)("mat-drawer-push","push"===i.mode)("mat-drawer-side","side"===i.mode)("mat-drawer-opened",i.opened)("mat-sidenav-fixed",i.fixedInViewport))},inputs:{fixedInViewport:"fixedInViewport",fixedTopGap:"fixedTopGap",fixedBottomGap:"fixedBottomGap"},exportAs:["matSidenav"],features:[qe],ngContentSelectors:o0,decls:3,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"],["content",""]],template:function(e,i){1&e&&(Os(),Jt(0,"div",0,1),_i(2),en())},directives:[$_],encapsulation:2,data:{animation:[tk.transformDrawer]},changeDetection:0}),n})(),ok=(()=>{class n extends ik{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wt(n)))(i||n)}}(),n.\u0275cmp=Un({type:n,selectors:[["mat-sidenav-container"]],contentQueries:function(e,i,s){if(1&e&&(io(s,rk,5),io(s,sk,5)),2&e){let c;or(c=ar())&&(i._content=c.first),or(c=ar())&&(i._allDrawers=c)}},hostAttrs:[1,"mat-drawer-container","mat-sidenav-container"],hostVars:2,hostBindings:function(e,i){2&e&&sr("mat-drawer-container-explicit-backdrop",i._backdropOverride)},exportAs:["matSidenavContainer"],features:[ei([{provide:oC,useExisting:n}]),qe],ngContentSelectors:lG,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],[4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"]],template:function(e,i){1&e&&(Os(aG),mc(0,sG,1,2,"div",0),_i(1),_i(2,1),mc(3,oG,2,0,"mat-sidenav-content",1)),2&e&&(ps("ngIf",i.hasBackdrop),Zr(3),ps("ngIf",!i._content))},directives:[rk,h_],styles:['.mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer[style*="visibility: hidden"]{display:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\n'],encapsulation:2,changeDetection:0}),n})(),hG=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[tx,Ci,s0],s0,Ci]}),n})();const fG=["*",[["mat-toolbar-row"]]],pG=["*","mat-toolbar-row"],mG=q1(class{constructor(n){this._elementRef=n}});let gG=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=je({type:n,selectors:[["mat-toolbar-row"]],hostAttrs:[1,"mat-toolbar-row"],exportAs:["matToolbarRow"]}),n})(),_G=(()=>{class n extends mG{constructor(e,i,s){super(e),this._platform=i,this._document=s}ngAfterViewInit(){this._platform.isBrowser&&(this._checkToolbarMixedModes(),this._toolbarRows.changes.subscribe(()=>this._checkToolbarMixedModes()))}_checkToolbarMixedModes(){}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(ja),se(sn))},n.\u0275cmp=Un({type:n,selectors:[["mat-toolbar"]],contentQueries:function(e,i,s){if(1&e&&io(s,gG,5),2&e){let c;or(c=ar())&&(i._toolbarRows=c)}},hostAttrs:[1,"mat-toolbar"],hostVars:4,hostBindings:function(e,i){2&e&&sr("mat-toolbar-multiple-rows",i._toolbarRows.length>0)("mat-toolbar-single-row",0===i._toolbarRows.length)},inputs:{color:"color"},exportAs:["matToolbar"],features:[qe],ngContentSelectors:pG,decls:2,vars:0,template:function(e,i){1&e&&(Os(fG),_i(0),_i(1,1))},styles:[".cdk-high-contrast-active .mat-toolbar{outline:solid 1px}.mat-toolbar-row,.mat-toolbar-single-row{display:flex;box-sizing:border-box;padding:0 16px;width:100%;flex-direction:row;align-items:center;white-space:nowrap}.mat-toolbar-multiple-rows{display:flex;box-sizing:border-box;flex-direction:column;width:100%}\n"],encapsulation:2,changeDetection:0}),n})(),yG=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[Ci],Ci]}),n})();const vG=["mat-button",""],xG=["*"],wG=["mat-button","mat-flat-button","mat-icon-button","mat-raised-button","mat-stroked-button","mat-mini-fab","mat-fab"],CG=q1(uI(z_(class{constructor(n){this._elementRef=n}})));let EG=(()=>{class n extends CG{constructor(e,i,s){super(e),this._focusMonitor=i,this._animationMode=s,this.isRoundButton=this._hasHostAttributes("mat-fab","mat-mini-fab"),this.isIconButton=this._hasHostAttributes("mat-icon-button");for(const c of wG)this._hasHostAttributes(c)&&this._getHostElement().classList.add(c);e.nativeElement.classList.add("mat-button-base"),this.isRoundButton&&(this.color="accent")}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,i){e?this._focusMonitor.focusVia(this._getHostElement(),e,i):this._getHostElement().focus(i)}_getHostElement(){return this._elementRef.nativeElement}_isRippleDisabled(){return this.disableRipple||this.disabled}_hasHostAttributes(...e){return e.some(i=>this._getHostElement().hasAttribute(i))}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(Fx),se(Gd,8))},n.\u0275cmp=Un({type:n,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-icon-button",""],["button","mat-fab",""],["button","mat-mini-fab",""],["button","mat-stroked-button",""],["button","mat-flat-button",""]],viewQuery:function(e,i){if(1&e&&mf(Yx,5),2&e){let s;or(s=ar())&&(i.ripple=s.first)}},hostAttrs:[1,"mat-focus-indicator"],hostVars:5,hostBindings:function(e,i){2&e&&(rr("disabled",i.disabled||null),sr("_mat-animation-noopable","NoopAnimations"===i._animationMode)("mat-button-disabled",i.disabled))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[qe],attrs:vG,ngContentSelectors:xG,decls:4,vars:5,consts:[[1,"mat-button-wrapper"],["matRipple","",1,"mat-button-ripple",3,"matRippleDisabled","matRippleCentered","matRippleTrigger"],[1,"mat-button-focus-overlay"]],template:function(e,i){1&e&&(Os(),Jt(0,"span",0),_i(1),en(),pr(2,"span",1),pr(3,"span",2)),2&e&&(Zr(2),sr("mat-button-ripple-round",i.isRoundButton||i.isIconButton),ps("matRippleDisabled",i._isRippleDisabled())("matRippleCentered",i.isIconButton)("matRippleTrigger",i._getHostElement()))},directives:[Yx],styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:.04}@media(hover: none){.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-icon-button,.mat-stroked-button,.mat-flat-button{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-button.mat-button-disabled,.mat-icon-button.mat-button-disabled,.mat-stroked-button.mat-button-disabled,.mat-flat-button.mat-button-disabled{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button.mat-button-disabled{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-ripple.mat-ripple,.mat-stroked-button .mat-button-focus-overlay{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab.mat-button-disabled{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab.mat-button-disabled{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button i,.mat-icon-button .mat-icon{line-height:24px}.mat-button-ripple.mat-ripple,.mat-button-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1),background-color 200ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:inline-flex;justify-content:center;align-items:center;font-size:inherit;width:2.5em;height:2.5em}.cdk-high-contrast-active .mat-button,.cdk-high-contrast-active .mat-flat-button,.cdk-high-contrast-active .mat-raised-button,.cdk-high-contrast-active .mat-icon-button,.cdk-high-contrast-active .mat-fab,.cdk-high-contrast-active .mat-mini-fab{outline:solid 1px}.cdk-high-contrast-active .mat-button-base.cdk-keyboard-focused,.cdk-high-contrast-active .mat-button-base.cdk-program-focused{outline:solid 3px}\n"],encapsulation:2,changeDetection:0}),n})(),DG=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[gI,Ci],Ci]}),n})();function ak(n,t){const e=wn(n)?n:()=>n,i=s=>s.error(e());return new un(t?s=>t.schedule(i,0,s):i)}const MG=["*"];let l0;function H_(n){var t;return(null===(t=function SG(){if(void 0===l0&&(l0=null,"undefined"!=typeof window)){const n=window;void 0!==n.trustedTypes&&(l0=n.trustedTypes.createPolicy("angular#components",{createHTML:t=>t}))}return l0}())||void 0===t?void 0:t.createHTML(n))||n}function ck(n){return Error(`Unable to find icon with the name "${n}"`)}function uk(n){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${n}".`)}function dk(n){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${n}".`)}class Ff{constructor(t,e,i){this.url=t,this.svgText=e,this.options=i}}let c0=(()=>{class n{constructor(e,i,s,c){this._httpClient=e,this._sanitizer=i,this._errorHandler=c,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass="material-icons",this._document=s}addSvgIcon(e,i,s){return this.addSvgIconInNamespace("",e,i,s)}addSvgIconLiteral(e,i,s){return this.addSvgIconLiteralInNamespace("",e,i,s)}addSvgIconInNamespace(e,i,s,c){return this._addSvgIconConfig(e,i,new Ff(s,null,c))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,i,s,c){const f=this._sanitizer.sanitize(Sn.HTML,s);if(!f)throw dk(s);const v=H_(f);return this._addSvgIconConfig(e,i,new Ff("",v,c))}addSvgIconSet(e,i){return this.addSvgIconSetInNamespace("",e,i)}addSvgIconSetLiteral(e,i){return this.addSvgIconSetLiteralInNamespace("",e,i)}addSvgIconSetInNamespace(e,i,s){return this._addSvgIconSetConfig(e,new Ff(i,null,s))}addSvgIconSetLiteralInNamespace(e,i,s){const c=this._sanitizer.sanitize(Sn.HTML,i);if(!c)throw dk(i);const f=H_(c);return this._addSvgIconSetConfig(e,new Ff("",f,s))}registerFontClassAlias(e,i=e){return this._fontCssClassesByAlias.set(e,i),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const i=this._sanitizer.sanitize(Sn.RESOURCE_URL,e);if(!i)throw uk(e);const s=this._cachedIconsByUrl.get(i);return s?Ot(u0(s)):this._loadSvgIconFromConfig(new Ff(e,null)).pipe(Ir(c=>this._cachedIconsByUrl.set(i,c)),Tt(c=>u0(c)))}getNamedSvgIcon(e,i=""){const s=hk(i,e);let c=this._svgIconConfigs.get(s);if(c)return this._getSvgFromConfig(c);if(c=this._getIconConfigFromResolvers(i,e),c)return this._svgIconConfigs.set(s,c),this._getSvgFromConfig(c);const f=this._iconSetConfigs.get(i);return f?this._getSvgFromIconSetConfigs(e,f):ak(ck(s))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?Ot(u0(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(Tt(i=>u0(i)))}_getSvgFromIconSetConfigs(e,i){const s=this._extractIconWithNameFromAnySet(e,i);return s?Ot(s):function lk(...n){const t=xt(n),{args:e,keys:i}=FS(n),s=new un(c=>{const{length:f}=e;if(!f)return void c.complete();const v=new Array(f);let C=f,S=f;for(let I=0;I<f;I++){let L=!1;Ri(e[I]).subscribe(new Cn(c,q=>{L||(L=!0,S--),v[I]=q},()=>C--,void 0,()=>{(!C||!L)&&(S||c.next(i?RS(i,v):v),c.complete())}))}});return t?s.pipe(Bw(t)):s}(i.filter(f=>!f.svgText).map(f=>this._loadSvgIconSetFromConfig(f).pipe(Ou(v=>{const S=`Loading icon set URL: ${this._sanitizer.sanitize(Sn.RESOURCE_URL,f.url)} failed: ${v.message}`;return this._errorHandler.handleError(new Error(S)),Ot(null)})))).pipe(Tt(()=>{const f=this._extractIconWithNameFromAnySet(e,i);if(!f)throw ck(e);return f}))}_extractIconWithNameFromAnySet(e,i){for(let s=i.length-1;s>=0;s--){const c=i[s];if(c.svgText&&c.svgText.toString().indexOf(e)>-1){const f=this._svgElementFromConfig(c),v=this._extractSvgIconFromSet(f,e,c.options);if(v)return v}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(Ir(i=>e.svgText=i),Tt(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?Ot(null):this._fetchIcon(e).pipe(Ir(i=>e.svgText=i))}_extractSvgIconFromSet(e,i,s){const c=e.querySelector(`[id="${i}"]`);if(!c)return null;const f=c.cloneNode(!0);if(f.removeAttribute("id"),"svg"===f.nodeName.toLowerCase())return this._setSvgAttributes(f,s);if("symbol"===f.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(f),s);const v=this._svgElementFromString(H_("<svg></svg>"));return v.appendChild(f),this._setSvgAttributes(v,s)}_svgElementFromString(e){const i=this._document.createElement("DIV");i.innerHTML=e;const s=i.querySelector("svg");if(!s)throw Error("<svg> tag not found");return s}_toSvgElement(e){const i=this._svgElementFromString(H_("<svg></svg>")),s=e.attributes;for(let c=0;c<s.length;c++){const{name:f,value:v}=s[c];"id"!==f&&i.setAttribute(f,v)}for(let c=0;c<e.childNodes.length;c++)e.childNodes[c].nodeType===this._document.ELEMENT_NODE&&i.appendChild(e.childNodes[c].cloneNode(!0));return i}_setSvgAttributes(e,i){return e.setAttribute("fit",""),e.setAttribute("height","100%"),e.setAttribute("width","100%"),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),i&&i.viewBox&&e.setAttribute("viewBox",i.viewBox),e}_fetchIcon(e){var i;const{url:s,options:c}=e,f=null!==(i=null==c?void 0:c.withCredentials)&&void 0!==i&&i;if(!this._httpClient)throw function AG(){return Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==s)throw Error(`Cannot fetch icon from URL "${s}".`);const v=this._sanitizer.sanitize(Sn.RESOURCE_URL,s);if(!v)throw uk(s);const C=this._inProgressUrlFetches.get(v);if(C)return C;const S=this._httpClient.get(v,{responseType:"text",withCredentials:f}).pipe(Tt(I=>H_(I)),VS(()=>this._inProgressUrlFetches.delete(v)),ma());return this._inProgressUrlFetches.set(v,S),S}_addSvgIconConfig(e,i,s){return this._svgIconConfigs.set(hk(e,i),s),this}_addSvgIconSetConfig(e,i){const s=this._iconSetConfigs.get(e);return s?s.push(i):this._iconSetConfigs.set(e,[i]),this}_svgElementFromConfig(e){if(!e.svgElement){const i=this._svgElementFromString(e.svgText);this._setSvgAttributes(i,e.options),e.svgElement=i}return e.svgElement}_getIconConfigFromResolvers(e,i){for(let s=0;s<this._resolvers.length;s++){const c=this._resolvers[s](i,e);if(c)return IG(c)?new Ff(c.url,null,c.options):new Ff(c,null)}}}return n.\u0275fac=function(e){return new(e||n)(Ce(cx,8),Ce(ax),Ce(sn,8),Ce(Ys))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function u0(n){return n.cloneNode(!0)}function hk(n,t){return n+":"+t}function IG(n){return!(!n.url||!n.options)}const kG=q1(class{constructor(n){this._elementRef=n}}),FG=new dt("mat-icon-location",{providedIn:"root",factory:function RG(){const n=md(sn),t=n?n.location:null;return{getPathname:()=>t?t.pathname+t.search:""}}}),fk=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],PG=fk.map(n=>`[${n}]`).join(", "),OG=/^url\(['"]?#(.*?)['"]?\)$/;let LG=(()=>{class n extends kG{constructor(e,i,s,c,f){super(e),this._iconRegistry=i,this._location=c,this._errorHandler=f,this._inline=!1,this._currentIconFetch=Wn.EMPTY,s||e.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(e){this._inline=Ii(e)}get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}get fontSet(){return this._fontSet}set fontSet(e){const i=this._cleanupFontValue(e);i!==this._fontSet&&(this._fontSet=i,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(e){const i=this._cleanupFontValue(e);i!==this._fontIcon&&(this._fontIcon=i,this._updateFontIconClasses())}_splitIconName(e){if(!e)return["",""];const i=e.split(":");switch(i.length){case 1:return["",i[0]];case 2:return i;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const i=this._location.getPathname();i!==this._previousPath&&(this._previousPath=i,this._prependPathToReferences(i))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const i=this._location.getPathname();this._previousPath=i,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(i),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let i=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();i--;){const s=e.childNodes[i];(1!==s.nodeType||"svg"===s.nodeName.toLowerCase())&&s.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,i=this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet):this._iconRegistry.getDefaultFontSetClass();i!=this._previousFontSetClass&&(this._previousFontSetClass&&e.classList.remove(this._previousFontSetClass),i&&e.classList.add(i),this._previousFontSetClass=i),this.fontIcon!=this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const i=this._elementsWithExternalReferences;i&&i.forEach((s,c)=>{s.forEach(f=>{c.setAttribute(f.name,`url('${e}#${f.value}')`)})})}_cacheChildrenWithExternalReferences(e){const i=e.querySelectorAll(PG),s=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let c=0;c<i.length;c++)fk.forEach(f=>{const v=i[c],C=v.getAttribute(f),S=C?C.match(OG):null;if(S){let I=s.get(v);I||(I=[],s.set(v,I)),I.push({name:f,value:S[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[i,s]=this._splitIconName(e);i&&(this._svgNamespace=i),s&&(this._svgName=s),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(s,i).pipe(jn(1)).subscribe(c=>this._setSvgElement(c),c=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${i}:${s}! ${c.message}`))})}}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(c0),$r("aria-hidden"),se(FG),se(Ys))},n.\u0275cmp=Un({type:n,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:7,hostBindings:function(e,i){2&e&&(rr("data-mat-icon-type",i._usingFontIcon()?"font":"svg")("data-mat-icon-name",i._svgName||i.fontIcon)("data-mat-icon-namespace",i._svgNamespace||i.fontSet),sr("mat-icon-inline",i.inline)("mat-icon-no-color","primary"!==i.color&&"accent"!==i.color&&"warn"!==i.color))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],features:[qe],ngContentSelectors:MG,decls:1,vars:0,template:function(e,i){1&e&&(Os(),_i(0))},styles:[".mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}\n"],encapsulation:2,changeDetection:0}),n})(),BG=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[Ci],Ci]}),n})();const vF=["*"],B6=[[["","mat-list-avatar",""],["","mat-list-icon",""],["","matListAvatar",""],["","matListIcon",""]],[["","mat-line",""],["","matLine",""]],"*"],N6=["[mat-list-avatar], [mat-list-icon], [matListAvatar], [matListIcon]","[mat-line], [matLine]","*"],G6=uI(z_(class{})),$6=z_(class{}),H6=new dt("MatList"),xF=new dt("MatNavList");let q6=(()=>{class n extends G6{constructor(){super(...arguments),this._stateChanges=new Nt}ngOnChanges(){this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete()}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wt(n)))(i||n)}}(),n.\u0275cmp=Un({type:n,selectors:[["mat-nav-list"]],hostAttrs:["role","navigation",1,"mat-nav-list","mat-list-base"],inputs:{disableRipple:"disableRipple",disabled:"disabled"},exportAs:["matNavList"],features:[ei([{provide:xF,useExisting:n}]),qe,Li],ngContentSelectors:vF,decls:1,vars:0,template:function(e,i){1&e&&(Os(),_i(0))},styles:['.mat-subheader{display:flex;box-sizing:border-box;padding:16px;align-items:center}.mat-list-base .mat-subheader{margin:0}button.mat-list-item,button.mat-list-option{padding:0;width:100%;background:none;color:inherit;border:none;outline:inherit;-webkit-tap-highlight-color:transparent;text-align:left}[dir=rtl] button.mat-list-item,[dir=rtl] button.mat-list-option{text-align:right}button.mat-list-item::-moz-focus-inner,button.mat-list-option::-moz-focus-inner{border:0}.mat-list-base{padding-top:8px;display:block;-webkit-tap-highlight-color:transparent}.mat-list-base .mat-subheader{height:48px;line-height:16px}.mat-list-base .mat-subheader:first-child{margin-top:-8px}.mat-list-base .mat-list-item,.mat-list-base .mat-list-option{display:block;height:48px;-webkit-tap-highlight-color:transparent;width:100%;padding:0}.mat-list-base .mat-list-item .mat-list-item-content,.mat-list-base .mat-list-option .mat-list-item-content{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;padding:0 16px;position:relative;height:inherit}.mat-list-base .mat-list-item .mat-list-item-content-reverse,.mat-list-base .mat-list-option .mat-list-item-content-reverse{display:flex;align-items:center;padding:0 16px;flex-direction:row-reverse;justify-content:space-around}.mat-list-base .mat-list-item .mat-list-item-ripple,.mat-list-base .mat-list-option .mat-list-item-ripple{display:block;top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-list-base .mat-list-item.mat-list-item-with-avatar,.mat-list-base .mat-list-option.mat-list-item-with-avatar{height:56px}.mat-list-base .mat-list-item.mat-2-line,.mat-list-base .mat-list-option.mat-2-line{height:72px}.mat-list-base .mat-list-item.mat-3-line,.mat-list-base .mat-list-option.mat-3-line{height:88px}.mat-list-base .mat-list-item.mat-multi-line,.mat-list-base .mat-list-option.mat-multi-line{height:auto}.mat-list-base .mat-list-item.mat-multi-line .mat-list-item-content,.mat-list-base .mat-list-option.mat-multi-line .mat-list-item-content{padding-top:16px;padding-bottom:16px}.mat-list-base .mat-list-item .mat-list-text,.mat-list-base .mat-list-option .mat-list-text{display:flex;flex-direction:column;flex:auto;box-sizing:border-box;overflow:hidden;padding:0}.mat-list-base .mat-list-item .mat-list-text>*,.mat-list-base .mat-list-option .mat-list-text>*{margin:0;padding:0;font-weight:normal;font-size:inherit}.mat-list-base .mat-list-item .mat-list-text:empty,.mat-list-base .mat-list-option .mat-list-text:empty{display:none}.mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:0;padding-left:16px}[dir=rtl] .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:0}.mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-left:0;padding-right:16px}[dir=rtl] .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-right:0;padding-left:16px}.mat-list-base .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:16px}.mat-list-base .mat-list-item .mat-list-avatar,.mat-list-base .mat-list-option .mat-list-avatar{flex-shrink:0;width:40px;height:40px;border-radius:50%;object-fit:cover}.mat-list-base .mat-list-item .mat-list-avatar~.mat-divider-inset,.mat-list-base .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:72px;width:calc(100% - 72px)}[dir=rtl] .mat-list-base .mat-list-item .mat-list-avatar~.mat-divider-inset,[dir=rtl] .mat-list-base .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:auto;margin-right:72px}.mat-list-base .mat-list-item .mat-list-icon,.mat-list-base .mat-list-option .mat-list-icon{flex-shrink:0;width:24px;height:24px;font-size:24px;box-sizing:content-box;border-radius:50%;padding:4px}.mat-list-base .mat-list-item .mat-list-icon~.mat-divider-inset,.mat-list-base .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:64px;width:calc(100% - 64px)}[dir=rtl] .mat-list-base .mat-list-item .mat-list-icon~.mat-divider-inset,[dir=rtl] .mat-list-base .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:auto;margin-right:64px}.mat-list-base .mat-list-item .mat-divider,.mat-list-base .mat-list-option .mat-divider{position:absolute;bottom:0;left:0;width:100%;margin:0}[dir=rtl] .mat-list-base .mat-list-item .mat-divider,[dir=rtl] .mat-list-base .mat-list-option .mat-divider{margin-left:auto;margin-right:0}.mat-list-base .mat-list-item .mat-divider.mat-divider-inset,.mat-list-base .mat-list-option .mat-divider.mat-divider-inset{position:absolute}.mat-list-base[dense]{padding-top:4px;display:block}.mat-list-base[dense] .mat-subheader{height:40px;line-height:8px}.mat-list-base[dense] .mat-subheader:first-child{margin-top:-4px}.mat-list-base[dense] .mat-list-item,.mat-list-base[dense] .mat-list-option{display:block;height:40px;-webkit-tap-highlight-color:transparent;width:100%;padding:0}.mat-list-base[dense] .mat-list-item .mat-list-item-content,.mat-list-base[dense] .mat-list-option .mat-list-item-content{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;padding:0 16px;position:relative;height:inherit}.mat-list-base[dense] .mat-list-item .mat-list-item-content-reverse,.mat-list-base[dense] .mat-list-option .mat-list-item-content-reverse{display:flex;align-items:center;padding:0 16px;flex-direction:row-reverse;justify-content:space-around}.mat-list-base[dense] .mat-list-item .mat-list-item-ripple,.mat-list-base[dense] .mat-list-option .mat-list-item-ripple{display:block;top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar{height:48px}.mat-list-base[dense] .mat-list-item.mat-2-line,.mat-list-base[dense] .mat-list-option.mat-2-line{height:60px}.mat-list-base[dense] .mat-list-item.mat-3-line,.mat-list-base[dense] .mat-list-option.mat-3-line{height:76px}.mat-list-base[dense] .mat-list-item.mat-multi-line,.mat-list-base[dense] .mat-list-option.mat-multi-line{height:auto}.mat-list-base[dense] .mat-list-item.mat-multi-line .mat-list-item-content,.mat-list-base[dense] .mat-list-option.mat-multi-line .mat-list-item-content{padding-top:16px;padding-bottom:16px}.mat-list-base[dense] .mat-list-item .mat-list-text,.mat-list-base[dense] .mat-list-option .mat-list-text{display:flex;flex-direction:column;flex:auto;box-sizing:border-box;overflow:hidden;padding:0}.mat-list-base[dense] .mat-list-item .mat-list-text>*,.mat-list-base[dense] .mat-list-option .mat-list-text>*{margin:0;padding:0;font-weight:normal;font-size:inherit}.mat-list-base[dense] .mat-list-item .mat-list-text:empty,.mat-list-base[dense] .mat-list-option .mat-list-text:empty{display:none}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:0;padding-left:16px}[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:0}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-left:0;padding-right:16px}[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-right:0;padding-left:16px}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:16px}.mat-list-base[dense] .mat-list-item .mat-list-avatar,.mat-list-base[dense] .mat-list-option .mat-list-avatar{flex-shrink:0;width:36px;height:36px;border-radius:50%;object-fit:cover}.mat-list-base[dense] .mat-list-item .mat-list-avatar~.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:68px;width:calc(100% - 68px)}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-list-avatar~.mat-divider-inset,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:auto;margin-right:68px}.mat-list-base[dense] .mat-list-item .mat-list-icon,.mat-list-base[dense] .mat-list-option .mat-list-icon{flex-shrink:0;width:20px;height:20px;font-size:20px;box-sizing:content-box;border-radius:50%;padding:4px}.mat-list-base[dense] .mat-list-item .mat-list-icon~.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:60px;width:calc(100% - 60px)}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-list-icon~.mat-divider-inset,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:auto;margin-right:60px}.mat-list-base[dense] .mat-list-item .mat-divider,.mat-list-base[dense] .mat-list-option .mat-divider{position:absolute;bottom:0;left:0;width:100%;margin:0}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-divider,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-divider{margin-left:auto;margin-right:0}.mat-list-base[dense] .mat-list-item .mat-divider.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-divider.mat-divider-inset{position:absolute}.mat-nav-list a{text-decoration:none;color:inherit}.mat-nav-list .mat-list-item{cursor:pointer;outline:none}mat-action-list .mat-list-item{cursor:pointer;outline:inherit}.mat-list-option:not(.mat-list-item-disabled){cursor:pointer;outline:none}.mat-list-item-disabled{pointer-events:none}.cdk-high-contrast-active .mat-list-item-disabled{opacity:.5}.cdk-high-contrast-active :host .mat-list-item-disabled{opacity:.5}.cdk-high-contrast-active .mat-selection-list:focus{outline-style:dotted}.cdk-high-contrast-active .mat-list-option:hover,.cdk-high-contrast-active .mat-list-option:focus,.cdk-high-contrast-active .mat-nav-list .mat-list-item:hover,.cdk-high-contrast-active .mat-nav-list .mat-list-item:focus,.cdk-high-contrast-active mat-action-list .mat-list-item:hover,.cdk-high-contrast-active mat-action-list .mat-list-item:focus{outline:dotted 1px;z-index:1}.cdk-high-contrast-active .mat-list-single-selected-option::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}.cdk-high-contrast-active [dir=rtl] .mat-list-single-selected-option::after{right:auto;left:16px}@media(hover: none){.mat-list-option:not(.mat-list-single-selected-option):not(.mat-list-item-disabled):hover,.mat-nav-list .mat-list-item:not(.mat-list-item-disabled):hover,.mat-action-list .mat-list-item:not(.mat-list-item-disabled):hover{background:none}}\n'],encapsulation:2,changeDetection:0}),n})(),bF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=je({type:n,selectors:[["","mat-list-avatar",""],["","matListAvatar",""]],hostAttrs:[1,"mat-list-avatar"]}),n})(),IC=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=je({type:n,selectors:[["","mat-list-icon",""],["","matListIcon",""]],hostAttrs:[1,"mat-list-icon"]}),n})(),W6=(()=>{class n extends $6{constructor(e,i,s,c){super(),this._element=e,this._isInteractiveList=!1,this._destroyed=new Nt,this._disabled=!1,this._isInteractiveList=!!(s||c&&"action-list"===c._getListType()),this._list=s||c;const f=this._getHostElement();"button"===f.nodeName.toLowerCase()&&!f.hasAttribute("type")&&f.setAttribute("type","button"),this._list&&this._list._stateChanges.pipe(Vi(this._destroyed)).subscribe(()=>{i.markForCheck()})}get disabled(){return this._disabled||!(!this._list||!this._list.disabled)}set disabled(e){this._disabled=Ii(e)}ngAfterContentInit(){!function hI(n,t,e="mat"){n.changes.pipe(rm(n)).subscribe(({length:i})=>{V_(t,`${e}-2-line`,!1),V_(t,`${e}-3-line`,!1),V_(t,`${e}-multi-line`,!1),2===i||3===i?V_(t,`${e}-${i}-line`,!0):i>3&&V_(t,`${e}-multi-line`,!0)})}(this._lines,this._element)}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_isRippleDisabled(){return!this._isInteractiveList||this.disableRipple||!(!this._list||!this._list.disableRipple)}_getHostElement(){return this._element.nativeElement}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(vc),se(xF,8),se(H6,8))},n.\u0275cmp=Un({type:n,selectors:[["mat-list-item"],["a","mat-list-item",""],["button","mat-list-item",""]],contentQueries:function(e,i,s){if(1&e&&(io(s,bF,5),io(s,IC,5),io(s,dI,5)),2&e){let c;or(c=ar())&&(i._avatar=c.first),or(c=ar())&&(i._icon=c.first),or(c=ar())&&(i._lines=c)}},hostAttrs:[1,"mat-list-item","mat-focus-indicator"],hostVars:6,hostBindings:function(e,i){2&e&&sr("mat-list-item-disabled",i.disabled)("mat-list-item-avatar",i._avatar||i._icon)("mat-list-item-with-avatar",i._avatar||i._icon)},inputs:{disableRipple:"disableRipple",disabled:"disabled"},exportAs:["matListItem"],features:[qe],ngContentSelectors:N6,decls:6,vars:2,consts:[[1,"mat-list-item-content"],["mat-ripple","",1,"mat-list-item-ripple",3,"matRippleTrigger","matRippleDisabled"],[1,"mat-list-text"]],template:function(e,i){1&e&&(Os(B6),Jt(0,"span",0),pr(1,"span",1),_i(2),Jt(3,"span",2),_i(4,1),en(),_i(5,2),en()),2&e&&(Zr(1),ps("matRippleTrigger",i._getHostElement())("matRippleDisabled",i._isRippleDisabled()))},directives:[Yx],encapsulation:2,changeDetection:0}),n})(),J6=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[Kx,gI,Ci,_I,tx],Kx,Ci,_I,DU]}),n})(),e$=(()=>{class n{ngOnInit(){eC.accessToken="pk.eyJ1IjoiZmVkZWZhenoiLCJhIjoiY2t6ZnB6eTJ6MDA0dTJubzJ4eTV0YjJsYSJ9.yIlZnjGRGGmsQpvW_6plzA"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Un({type:n,selectors:[["app-root"]],decls:36,vars:0,consts:[["fullscreen",""],["mode","push"],["sidenav",""],["color","primary"],[1,"spacer"],["mat-icon-button","",3,"click"],["routerLink","/productos","mat-list-item","",3,"click"],["color","primary","matListIcon",""],["routerLink","./sucursales","mat-list-item","",3,"click"],["src","../assets/images/logo.png"],["routerLink","","mat-icon-button",""],[1,"container"],["href","https://api.whatsapp.com/send?l=es&phone=541167550598&text=Hola!%20te%20contacto%20desde%20la%20web%20de%20Aurelia"],["src","./assets/images/whatsapp.svg",1,"whatsapp"]],template:function(e,i){if(1&e){const s=Zg();pr(0,"splash-screen"),Jt(1,"mat-sidenav-container",0),Jt(2,"mat-sidenav",1,2),Jt(4,"mat-toolbar",3),Jt(5,"span"),Qo(6,"Menu"),en(),pr(7,"span",4),Jt(8,"button",5),Ki("click",function(){return No(s),Wg(3).toggle()}),Jt(9,"mat-icon"),Qo(10,"close"),en(),en(),en(),Jt(11,"mat-nav-list"),Jt(12,"a",6),Ki("click",function(){return No(s),Wg(3).toggle()}),Jt(13,"mat-icon",7),Qo(14,"directions_bus"),en(),Jt(15,"span"),Qo(16,"Camiones"),en(),en(),Jt(17,"a",8),Ki("click",function(){return No(s),Wg(3).toggle()}),Jt(18,"mat-icon",7),Qo(19,"near_me"),en(),Jt(20,"span"),Qo(21,"Sucursales"),en(),en(),en(),en(),Jt(22,"mat-toolbar",3),Jt(23,"button",5),Ki("click",function(){return No(s),Wg(3).toggle()}),Jt(24,"mat-icon"),Qo(25,"menu"),en(),en(),pr(26,"span",4),pr(27,"img",9),pr(28,"span",4),Jt(29,"button",10),Jt(30,"mat-icon"),Qo(31,"home"),en(),en(),en(),Jt(32,"div",11),pr(33,"router-outlet"),en(),en(),Jt(34,"a",12),pr(35,"img",13),en()}},directives:[R4,ok,sk,_G,EG,LG,q6,Sx,W6,IC,Mx,Yw],styles:[""]}),n})();class kC{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class FC extends kC{constructor(t,e,i,s){super(),this.component=t,this.viewContainerRef=e,this.injector=i,this.componentFactoryResolver=s}}class CF extends kC{constructor(t,e,i){super(),this.templateRef=t,this.viewContainerRef=e,this.context=i}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class t$ extends kC{constructor(t){super(),this.element=t instanceof Pt?t.nativeElement:t}}class RC{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof FC?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof CF?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof t$?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class n$ extends RC{constructor(t,e,i,s,c){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=i,this._defaultInjector=s,this.attachDomPortal=f=>{const v=f.element,C=this._document.createComment("dom-portal");v.parentNode.insertBefore(C,v),this.outletElement.appendChild(v),this._attachedPortal=f,super.setDisposeFn(()=>{C.parentNode&&C.parentNode.replaceChild(v,C)})},this._document=c}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let s;return t.viewContainerRef?(s=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>s.destroy())):(s=i.create(t.injector||this._defaultInjector||ce.NULL),this._appRef.attachView(s.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(s.hostView),s.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(s)),this._attachedPortal=t,s}attachTemplatePortal(t){let e=t.viewContainerRef,i=e.createEmbeddedView(t.templateRef,t.context);return i.rootNodes.forEach(s=>this.outletElement.appendChild(s)),i.detectChanges(),this.setDisposeFn(()=>{let s=e.indexOf(i);-1!==s&&e.remove(s)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let EF=(()=>{class n extends RC{constructor(e,i,s){super(),this._componentFactoryResolver=e,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new ti,this.attachDomPortal=c=>{const f=c.element,v=this._document.createComment("dom-portal");c.setAttachedHost(this),f.parentNode.insertBefore(v,f),this._getRootNode().appendChild(f),this._attachedPortal=c,super.setDisposeFn(()=>{v.parentNode&&v.parentNode.replaceChild(f,v)})},this._document=s}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(e){e.setAttachedHost(this);const i=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,c=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),f=i.createComponent(c,i.length,e.injector||i.injector);return i!==this._viewContainerRef&&this._getRootNode().appendChild(f.hostView.rootNodes[0]),super.setDisposeFn(()=>f.destroy()),this._attachedPortal=e,this._attachedRef=f,this.attached.emit(f),f}attachTemplatePortal(e){e.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context);return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}}return n.\u0275fac=function(e){return new(e||n)(se(Od),se(Ba),se(sn))},n.\u0275dir=je({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[qe]}),n})(),DF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({}),n})();const MF=HA();class i${constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=yr(-this._previousScrollPosition.left),t.style.top=yr(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,s=this._document.body.style,c=i.scrollBehavior||"",f=s.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),MF&&(i.scrollBehavior=s.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),MF&&(i.scrollBehavior=c,s.scrollBehavior=f)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}}class r${constructor(t,e,i,s){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=s,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class SF{enable(){}disable(){}attach(){}}function PC(n,t){return t.some(e=>n.bottom<e.top||n.top>e.bottom||n.right<e.left||n.left>e.right)}function AF(n,t){return t.some(e=>n.top<e.top||n.bottom>e.bottom||n.left<e.left||n.right>e.right)}class s${constructor(t,e,i,s){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=s,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:s}=this._viewportRuler.getViewportSize();PC(e,[{width:i,height:s,bottom:s,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let o$=(()=>{class n{constructor(e,i,s,c){this._scrollDispatcher=e,this._viewportRuler=i,this._ngZone=s,this.noop=()=>new SF,this.close=f=>new r$(this._scrollDispatcher,this._ngZone,this._viewportRuler,f),this.block=()=>new i$(this._viewportRuler,this._document),this.reposition=f=>new s$(this._scrollDispatcher,this._viewportRuler,this._ngZone,f),this._document=c}}return n.\u0275fac=function(e){return new(e||n)(Ce(r0),Ce(rC),Ce(fn),Ce(sn))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class TF{constructor(t){if(this.scrollStrategy=new SF,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const i of e)void 0!==t[i]&&(this[i]=t[i])}}}class a${constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}class l${constructor(t,e,i,s,c,f,v,C,S){this._portalOutlet=t,this._host=e,this._pane=i,this._config=s,this._ngZone=c,this._keyboardDispatcher=f,this._document=v,this._location=C,this._outsideClickDispatcher=S,this._backdropElement=null,this._backdropClick=new Nt,this._attachments=new Nt,this._detachments=new Nt,this._locationChanges=Wn.EMPTY,this._backdropClickHandler=I=>this._backdropClick.next(I),this._backdropTransitionendHandler=I=>{this._disposeBackdrop(I.target)},this._keydownEvents=new Nt,this._outsidePointerEvents=new Nt,s.scrollStrategy&&(this._scrollStrategy=s.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=s.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){let e=this._portalOutlet.attach(t);return!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host),this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(jn(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){var t;const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),null===(t=this._host)||void 0===t||t.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign(Object.assign({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Object.assign(Object.assign({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=yr(this._config.width),t.height=yr(this._config.height),t.minWidth=yr(this._config.minWidth),t.minHeight=yr(this._config.minHeight),t.maxWidth=yr(this._config.maxWidth),t.maxHeight=yr(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),"undefined"!=typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;!t||(t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500)))}_toggleClasses(t,e,i){const s=UA(e||[]).filter(c=>!!c);s.length&&(i?t.classList.add(...s):t.classList.remove(...s))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Vi(Ft(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}let OC=(()=>{class n{constructor(e,i){this._platform=i,this._document=e}ngOnDestroy(){var e;null===(e=this._containerElement)||void 0===e||e.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||c1()){const s=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let c=0;c<s.length;c++)s[c].remove()}const i=this._document.createElement("div");i.classList.add(e),c1()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return n.\u0275fac=function(e){return new(e||n)(Ce(sn),Ce(ja))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const IF="cdk-overlay-connected-position-bounding-box",c$=/([A-Za-z%]+)$/;class u${constructor(t,e,i,s,c){this._viewportRuler=e,this._document=i,this._platform=s,this._overlayContainer=c,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Nt,this._resizeSubscription=Wn.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){this._validatePositions(),t.hostElement.classList.add(IF),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,e=this._overlayRect,i=this._viewportRect,s=this._containerRect,c=[];let f;for(let v of this._preferredPositions){let C=this._getOriginPoint(t,s,v),S=this._getOverlayPoint(C,e,v),I=this._getOverlayFit(S,e,i,v);if(I.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(v,C);this._canFitWithFlexibleDimensions(I,S,i)?c.push({position:v,origin:C,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(C,v)}):(!f||f.overlayFit.visibleArea<I.visibleArea)&&(f={overlayFit:I,overlayPoint:S,originPoint:C,position:v,overlayRect:e})}if(c.length){let v=null,C=-1;for(const S of c){const I=S.boundingBoxRect.width*S.boundingBoxRect.height*(S.position.weight||1);I>C&&(C=I,v=S)}return this._isPushed=!1,void this._applyPosition(v.position,v.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(f.position,f.originPoint);this._applyPosition(f.position,f.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Pf(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(IF),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,i){let s,c;if("center"==i.originX)s=t.left+t.width/2;else{const f=this._isRtl()?t.right:t.left,v=this._isRtl()?t.left:t.right;s="start"==i.originX?f:v}return e.left<0&&(s-=e.left),c="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,e.top<0&&(c-=e.top),{x:s,y:c}}_getOverlayPoint(t,e,i){let s,c;return s="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,c="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:t.x+s,y:t.y+c}}_getOverlayFit(t,e,i,s){const c=FF(e);let{x:f,y:v}=t,C=this._getOffset(s,"x"),S=this._getOffset(s,"y");C&&(f+=C),S&&(v+=S);let q=0-v,X=v+c.height-i.height,ue=this._subtractOverflows(c.width,0-f,f+c.width-i.width),xe=this._subtractOverflows(c.height,q,X),ke=ue*xe;return{visibleArea:ke,isCompletelyWithinViewport:c.width*c.height===ke,fitsInViewportVertically:xe===c.height,fitsInViewportHorizontally:ue==c.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){const s=i.bottom-e.y,c=i.right-e.x,f=kF(this._overlayRef.getConfig().minHeight),v=kF(this._overlayRef.getConfig().minWidth),S=t.fitsInViewportHorizontally||null!=v&&v<=c;return(t.fitsInViewportVertically||null!=f&&f<=s)&&S}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const s=FF(e),c=this._viewportRect,f=Math.max(t.x+s.width-c.width,0),v=Math.max(t.y+s.height-c.height,0),C=Math.max(c.top-i.top-t.y,0),S=Math.max(c.left-i.left-t.x,0);let I=0,L=0;return I=s.width<=c.width?S||-f:t.x<this._viewportMargin?c.left-i.left-t.x:0,L=s.height<=c.height?C||-v:t.y<this._viewportMargin?c.top-i.top-t.y:0,this._previousPushAmount={x:I,y:L},{x:t.x+I,y:t.y+L}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const i=this._getScrollVisibility(),s=new a$(t,i);this._positionChanges.next(s)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,s=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let c=0;c<e.length;c++)e[c].style.transformOrigin=`${i} ${s}`}_calculateBoundingBoxRect(t,e){const i=this._viewportRect,s=this._isRtl();let c,f,v,I,L,q;if("top"===e.overlayY)f=t.y,c=i.height-f+this._viewportMargin;else if("bottom"===e.overlayY)v=i.height-t.y+2*this._viewportMargin,c=i.height-v+this._viewportMargin;else{const X=Math.min(i.bottom-t.y+i.top,t.y),ue=this._lastBoundingBoxSize.height;c=2*X,f=t.y-X,c>ue&&!this._isInitialRender&&!this._growAfterOpen&&(f=t.y-ue/2)}if("end"===e.overlayX&&!s||"start"===e.overlayX&&s)q=i.width-t.x+this._viewportMargin,I=t.x-this._viewportMargin;else if("start"===e.overlayX&&!s||"end"===e.overlayX&&s)L=t.x,I=i.right-t.x;else{const X=Math.min(i.right-t.x+i.left,t.x),ue=this._lastBoundingBoxSize.width;I=2*X,L=t.x-X,I>ue&&!this._isInitialRender&&!this._growAfterOpen&&(L=t.x-ue/2)}return{top:f,left:L,bottom:v,right:q,width:I,height:c}}_setBoundingBoxStyles(t,e){const i=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const s={};if(this._hasExactPosition())s.top=s.left="0",s.bottom=s.right=s.maxHeight=s.maxWidth="",s.width=s.height="100%";else{const c=this._overlayRef.getConfig().maxHeight,f=this._overlayRef.getConfig().maxWidth;s.height=yr(i.height),s.top=yr(i.top),s.bottom=yr(i.bottom),s.width=yr(i.width),s.left=yr(i.left),s.right=yr(i.right),s.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",s.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",c&&(s.maxHeight=yr(c)),f&&(s.maxWidth=yr(f))}this._lastBoundingBoxSize=i,Pf(this._boundingBox.style,s)}_resetBoundingBoxStyles(){Pf(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Pf(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const i={},s=this._hasExactPosition(),c=this._hasFlexibleDimensions,f=this._overlayRef.getConfig();if(s){const I=this._viewportRuler.getViewportScrollPosition();Pf(i,this._getExactOverlayY(e,t,I)),Pf(i,this._getExactOverlayX(e,t,I))}else i.position="static";let v="",C=this._getOffset(e,"x"),S=this._getOffset(e,"y");C&&(v+=`translateX(${C}px) `),S&&(v+=`translateY(${S}px)`),i.transform=v.trim(),f.maxHeight&&(s?i.maxHeight=yr(f.maxHeight):c&&(i.maxHeight="")),f.maxWidth&&(s?i.maxWidth=yr(f.maxWidth):c&&(i.maxWidth="")),Pf(this._pane.style,i)}_getExactOverlayY(t,e,i){let s={top:"",bottom:""},c=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(c=this._pushOverlayOnScreen(c,this._overlayRect,i)),"bottom"===t.overlayY?s.bottom=this._document.documentElement.clientHeight-(c.y+this._overlayRect.height)+"px":s.top=yr(c.y),s}_getExactOverlayX(t,e,i){let f,s={left:"",right:""},c=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(c=this._pushOverlayOnScreen(c,this._overlayRect,i)),f=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===f?s.right=this._document.documentElement.clientWidth-(c.x+this._overlayRect.width)+"px":s.left=yr(c.x),s}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(s=>s.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:AF(t,i),isOriginOutsideView:PC(t,i),isOverlayClipped:AF(e,i),isOverlayOutsideView:PC(e,i)}}_subtractOverflows(t,...e){return e.reduce((i,s)=>i-Math.max(s,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&UA(t).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof Pt)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}}function Pf(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function kF(n){if("number"!=typeof n&&null!=n){const[t,e]=n.split(c$);return e&&"px"!==e?null:parseFloat(t)}return n||null}function FF(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}const RF="cdk-global-overlay-wrapper";class d${constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._leftOffset="",this._rightOffset="",this._alignItems="",this._justifyContent="",this._width="",this._height=""}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(RF),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._rightOffset="",this._leftOffset=t,this._justifyContent="flex-start",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._leftOffset="",this._rightOffset=t,this._justifyContent="flex-end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._justifyContent="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:s,height:c,maxWidth:f,maxHeight:v}=i,C=!("100%"!==s&&"100vw"!==s||f&&"100%"!==f&&"100vw"!==f),S=!("100%"!==c&&"100vh"!==c||v&&"100%"!==v&&"100vh"!==v);t.position=this._cssPosition,t.marginLeft=C?"0":this._leftOffset,t.marginTop=S?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=this._rightOffset,C?e.justifyContent="flex-start":"center"===this._justifyContent?e.justifyContent="center":"rtl"===this._overlayRef.getConfig().direction?"flex-start"===this._justifyContent?e.justifyContent="flex-end":"flex-end"===this._justifyContent&&(e.justifyContent="flex-start"):e.justifyContent=this._justifyContent,e.alignItems=S?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(RF),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let h$=(()=>{class n{constructor(e,i,s,c){this._viewportRuler=e,this._document=i,this._platform=s,this._overlayContainer=c}global(){return new d$}flexibleConnectedTo(e){return new u$(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(e){return new(e||n)(Ce(rC),Ce(sn),Ce(ja),Ce(OC))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),PF=(()=>{class n{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(e){return new(e||n)(Ce(sn))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),f$=(()=>{class n extends PF{constructor(e,i){super(e),this._ngZone=i,this._keydownListener=s=>{const c=this._attachedOverlays;for(let f=c.length-1;f>-1;f--)if(c[f]._keydownEvents.observers.length>0){const v=c[f]._keydownEvents;this._ngZone?this._ngZone.run(()=>v.next(s)):v.next(s);break}}}add(e){super.add(e),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(e){return new(e||n)(Ce(sn),Ce(fn,8))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),p$=(()=>{class n extends PF{constructor(e,i,s){super(e),this._platform=i,this._ngZone=s,this._cursorStyleIsSet=!1,this._pointerDownListener=c=>{this._pointerDownEventTarget=Df(c)},this._clickListener=c=>{const f=Df(c),v="click"===c.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:f;this._pointerDownEventTarget=null;const C=this._attachedOverlays.slice();for(let S=C.length-1;S>-1;S--){const I=C[S];if(I._outsidePointerEvents.observers.length<1||!I.hasAttached())continue;if(I.overlayElement.contains(f)||I.overlayElement.contains(v))break;const L=I._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>L.next(c)):L.next(c)}}}add(e){if(super.add(e),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}}return n.\u0275fac=function(e){return new(e||n)(Ce(sn),Ce(ja),Ce(fn,8))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),m$=0,v0=(()=>{class n{constructor(e,i,s,c,f,v,C,S,I,L,q){this.scrollStrategies=e,this._overlayContainer=i,this._componentFactoryResolver=s,this._positionBuilder=c,this._keyboardDispatcher=f,this._injector=v,this._ngZone=C,this._document=S,this._directionality=I,this._location=L,this._outsideClickDispatcher=q}create(e){const i=this._createHostElement(),s=this._createPaneElement(i),c=this._createPortalOutlet(s),f=new TF(e);return f.direction=f.direction||this._directionality.value,new l$(c,i,s,f,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher)}position(){return this._positionBuilder}_createPaneElement(e){const i=this._document.createElement("div");return i.id="cdk-overlay-"+m$++,i.classList.add("cdk-overlay-pane"),e.appendChild(i),i}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(gf)),new n$(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(e){return new(e||n)(Ce(o$),Ce(OC),Ce(Od),Ce(h$),Ce(f$),Ce(ce),Ce(fn),Ce(sn),Ce(Cf),Ce(c_),Ce(p$))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();const y$={provide:new dt("cdk-connected-overlay-scroll-strategy"),deps:[v0],useFactory:function _$(n){return()=>n.scrollStrategies.reposition()}};let v$=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({providers:[v0,y$],imports:[[dm,DF,ek],ek]}),n})();function x$(n,t){}class LC{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}}const b$={dialogContainer:m1("dialogContainer",[O_("void, exit",Cc({opacity:0,transform:"scale(0.7)"})),O_("enter",Cc({transform:"none"})),L_("* => enter",dT([P_("150ms cubic-bezier(0, 0, 0.2, 1)",Cc({transform:"none",opacity:1})),pT("@*",fT(),{optional:!0})])),L_("* => void, * => exit",dT([P_("75ms cubic-bezier(0.4, 0.0, 0.2, 1)",Cc({opacity:0})),pT("@*",fT(),{optional:!0})]))])};let w$=(()=>{class n extends RC{constructor(e,i,s,c,f,v,C,S){super(),this._elementRef=e,this._focusTrapFactory=i,this._changeDetectorRef=s,this._config=f,this._interactivityChecker=v,this._ngZone=C,this._focusMonitor=S,this._animationStateChanged=new ti,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=I=>(this._portalOutlet.hasAttached(),this._portalOutlet.attachDomPortal(I)),this._ariaLabelledBy=f.ariaLabelledBy||null,this._document=c}_initializeWithAttachedContent(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=l1())}attachComponentPortal(e){return this._portalOutlet.hasAttached(),this._portalOutlet.attachComponentPortal(e)}attachTemplatePortal(e){return this._portalOutlet.hasAttached(),this._portalOutlet.attachTemplatePortal(e)}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const s=()=>{e.removeEventListener("blur",s),e.removeEventListener("mousedown",s),e.removeAttribute("tabindex")};e.addEventListener("blur",s),e.addEventListener("mousedown",s)})),e.focus(i)}_focusByCssSelector(e,i){let s=this._elementRef.nativeElement.querySelector(e);s&&this._forceFocus(s,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._elementFocusedBeforeDialogWasOpened;if(this._config.restoreFocus&&e&&"function"==typeof e.focus){const i=l1(),s=this._elementRef.nativeElement;(!i||i===this._document.body||i===s||s.contains(i))&&(this._focusMonitor?(this._focusMonitor.focusVia(e,this._closeInteractionType),this._closeInteractionType=null):e.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=l1();return e===i||e.contains(i)}}return n.\u0275fac=function(e){return new(e||n)(se(Pt),se(rT),se(vc),se(sn,8),se(LC),se(f1),se(fn),se(Fx))},n.\u0275dir=je({type:n,viewQuery:function(e,i){if(1&e&&mf(EF,7),2&e){let s;or(s=ar())&&(i._portalOutlet=s.first)}},features:[qe]}),n})(),C$=(()=>{class n extends w${constructor(){super(...arguments),this._state="enter"}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?(this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})):"exit"===e&&(this._restoreFocus(),this._animationStateChanged.next({state:"closed",totalTime:i}))}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}_initializeWithAttachedContent(){super._initializeWithAttachedContent(),this._config.delayFocusTrap||this._trapFocus()}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wt(n)))(i||n)}}(),n.\u0275cmp=Un({type:n,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"mat-dialog-container"],hostVars:6,hostBindings:function(e,i){1&e&&Sv("@dialogContainer.start",function(c){return i._onAnimationStart(c)})("@dialogContainer.done",function(c){return i._onAnimationDone(c)}),2&e&&(Ab("id",i._id),rr("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),kv("@dialogContainer",i._state))},features:[qe],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&mc(0,x$,0,0,"ng-template",0)},directives:[EF],styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .mat-dialog-container{outline:solid 1px}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;box-sizing:content-box;margin-bottom:-24px}.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions .mat-button-base+.mat-button-base,.mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}\n"],encapsulation:2,data:{animation:[b$.dialogContainer]}}),n})(),E$=0;class D${constructor(t,e,i="mat-dialog-"+E$++){this._overlayRef=t,this._containerInstance=e,this.id=i,this.disableClose=this._containerInstance._config.disableClose,this._afterOpened=new Nt,this._afterClosed=new Nt,this._beforeClosed=new Nt,this._state=0,e._id=i,e._animationStateChanged.pipe(ui(s=>"opened"===s.state),jn(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),e._animationStateChanged.pipe(ui(s=>"closed"===s.state),jn(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),t.keydownEvents().pipe(ui(s=>27===s.keyCode&&!this.disableClose&&!F_(s))).subscribe(s=>{s.preventDefault(),OF(this,"keyboard")}),t.backdropClick().subscribe(()=>{this.disableClose?this._containerInstance._recaptureFocus():OF(this,"mouse")})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(ui(e=>"closing"===e.state),jn(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this._overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._afterClosed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}updatePosition(t){let e=this._getPositionStrategy();return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this._overlayRef.updatePosition(),this}updateSize(t="",e=""){return this._overlayRef.updateSize({width:t,height:e}),this._overlayRef.updatePosition(),this}addPanelClass(t){return this._overlayRef.addPanelClass(t),this}removePanelClass(t){return this._overlayRef.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._overlayRef.dispose()}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}function OF(n,t,e){return void 0!==n._containerInstance&&(n._containerInstance._closeInteractionType=t),n.close(e)}const M$=new dt("MatDialogData"),S$=new dt("mat-dialog-default-options"),LF=new dt("mat-dialog-scroll-strategy"),T$={provide:LF,deps:[v0],useFactory:function A$(n){return()=>n.scrollStrategies.block()}};let I$=(()=>{class n{constructor(e,i,s,c,f,v,C,S,I,L){this._overlay=e,this._injector=i,this._defaultOptions=s,this._parentDialog=c,this._overlayContainer=f,this._dialogRefConstructor=C,this._dialogContainerType=S,this._dialogDataToken=I,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Nt,this._afterOpenedAtThisLevel=new Nt,this._ariaHiddenElements=new Map,this.afterAllClosed=y_(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(rm(void 0))),this._scrollStrategy=v}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,i){i=function F$(n,t){return Object.assign(Object.assign({},t),n)}(i,this._defaultOptions||new LC),i.id&&this.getDialogById(i.id);const s=this._createOverlay(i),c=this._attachDialogContainer(s,i),f=this._attachDialogContent(e,c,s,i);return this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(f),f.afterClosed().subscribe(()=>this._removeOpenDialog(f)),this.afterOpened.next(f),c._initializeWithAttachedContent(),f}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_createOverlay(e){const i=this._getOverlayConfig(e);return this._overlay.create(i)}_getOverlayConfig(e){const i=new TF({positionStrategy:this._overlay.position().global(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachDialogContainer(e,i){const c=ce.create({parent:i&&i.viewContainerRef&&i.viewContainerRef.injector||this._injector,providers:[{provide:LC,useValue:i}]}),f=new FC(this._dialogContainerType,i.viewContainerRef,c,i.componentFactoryResolver);return e.attach(f).instance}_attachDialogContent(e,i,s,c){const f=new this._dialogRefConstructor(s,i,c.id);if(e instanceof yc)i.attachTemplatePortal(new CF(e,null,{$implicit:c.data,dialogRef:f}));else{const v=this._createInjector(c,f,i),C=i.attachComponentPortal(new FC(e,c.viewContainerRef,v,c.componentFactoryResolver));f.componentInstance=C.instance}return f.updateSize(c.width,c.height).updatePosition(c.position),f}_createInjector(e,i,s){const c=e&&e.viewContainerRef&&e.viewContainerRef.injector,f=[{provide:this._dialogContainerType,useValue:s},{provide:this._dialogDataToken,useValue:e.data},{provide:this._dialogRefConstructor,useValue:i}];return e.direction&&(!c||!c.get(Cf,null,Gt.Optional))&&f.push({provide:Cf,useValue:{value:e.direction,change:Ot()}}),ce.create({parent:c||this._injector,providers:f})}_removeOpenDialog(e){const i=this.openDialogs.indexOf(e);i>-1&&(this.openDialogs.splice(i,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,c)=>{s?c.setAttribute("aria-hidden",s):c.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let s=i.length-1;s>-1;s--){let c=i[s];c!==e&&"SCRIPT"!==c.nodeName&&"STYLE"!==c.nodeName&&!c.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(c,c.getAttribute("aria-hidden")),c.setAttribute("aria-hidden","true"))}}}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}}return n.\u0275fac=function(e){Mv()},n.\u0275dir=je({type:n}),n})(),k$=(()=>{class n extends I${constructor(e,i,s,c,f,v,C,S){super(e,i,c,v,C,f,D$,C$,M$,S)}}return n.\u0275fac=function(e){return new(e||n)(Ce(v0),Ce(ce),Ce(c_,8),Ce(S$,8),Ce(LF),Ce(n,12),Ce(OC),Ce(Gd,8))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})(),R$=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({providers:[k$,T$],imports:[[v$,DF,Ci],Ci]}),n})(),P$=(()=>{class n{create(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),O$=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({providers:[P$]}),n})(),V$=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[tx,Ci,O$],Ci]}),n})(),G$=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[Kx,Ci],Kx,Ci]}),n})(),$$=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[yG,hG,J6,DG,a4,R$,V$,G$,BG]}),n})(),HF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[X1]]}),n})(),h8=(()=>{class n{constructor(e,i){nm(i)&&!e&&console.warn("Warning: Flex Layout loaded on the server without FlexLayoutServerModule")}static withConfig(e,i=[]){return{ngModule:n,providers:e.serverLoaded?[{provide:Sl,useValue:Object.assign(Object.assign({},K1),e)},{provide:Y1,useValue:i,multi:!0},{provide:_m,useValue:!0}]:[{provide:Sl,useValue:Object.assign(Object.assign({},K1),e)},{provide:Y1,useValue:i,multi:!0}]}}}return n.\u0275fac=function(e){return new(e||n)(Ce(_m),Ce(so))},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({imports:[[UI,XI,HF],UI,XI,HF]}),n})();const Wd=new un(Jr),p8={connector:()=>new Nt};function qF(n,t=p8){const{connector:e}=t;return Pn((i,s)=>{const c=e();Mt(n(function f8(n){return new un(t=>n.subscribe(t))}(c))).subscribe(s),s.add(i.subscribe(c))})}function WF(n,t){return t?e=>__(t.pipe(jn(1),function _8(){return Pn((n,t)=>{n.subscribe(new Cn(t,Jr))})}()),e.pipe(WF(n))):me((e,i)=>n(e,i).pipe(jn(1),sC(e)))}const Q_="Service workers are disabled or not supported by this browser";class x0{constructor(t){if(this.serviceWorker=t,t){const i=kf(t,"controllerchange").pipe(Tt(()=>t.controller)),c=__(y_(()=>Ot(t.controller)),i);this.worker=c.pipe(ui(I=>!!I)),this.registration=this.worker.pipe(Ml(()=>t.getRegistration()));const S=kf(t,"message").pipe(Tt(I=>I.data)).pipe(ui(I=>I&&I.type)).pipe(function g8(n){return n?t=>qF(n)(t):t=>function m8(n,t){const e=wn(n)?n:()=>n;return wn(t)?qF(t,{connector:e}):i=>new LS(i,e)}(new Nt)(t)}());S.connect(),this.events=S}else this.worker=this.events=this.registration=function v8(n){return y_(()=>ak(new Error(n)))}(Q_)}postMessage(t,e){return this.worker.pipe(jn(1),Ir(i=>{i.postMessage(Object.assign({action:t},e))})).toPromise().then(()=>{})}postMessageWithOperation(t,e,i){const s=this.waitForOperationCompleted(i),c=this.postMessage(t,e);return Promise.all([c,s]).then(([,f])=>f)}generateNonce(){return Math.round(1e7*Math.random())}eventsOfType(t){let e;return e="string"==typeof t?i=>i.type===t:i=>t.includes(i.type),this.events.pipe(ui(e))}nextEventOfType(t){return this.eventsOfType(t).pipe(jn(1))}waitForOperationCompleted(t){return this.eventsOfType("OPERATION_COMPLETED").pipe(ui(e=>e.nonce===t),jn(1),Tt(e=>{if(void 0!==e.result)return e.result;throw new Error(e.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}}let x8=(()=>{class n{constructor(e){if(this.sw=e,this.subscriptionChanges=new Nt,!e.isEnabled)return this.messages=Wd,this.notificationClicks=Wd,void(this.subscription=Wd);this.messages=this.sw.eventsOfType("PUSH").pipe(Tt(s=>s.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(Tt(s=>s.data)),this.pushManager=this.sw.registration.pipe(Tt(s=>s.pushManager));const i=this.pushManager.pipe(Ml(s=>s.getSubscription()));this.subscription=Ft(i,this.subscriptionChanges)}get isEnabled(){return this.sw.isEnabled}requestSubscription(e){if(!this.sw.isEnabled)return Promise.reject(new Error(Q_));const i={userVisibleOnly:!0};let s=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),c=new Uint8Array(new ArrayBuffer(s.length));for(let f=0;f<s.length;f++)c[f]=s.charCodeAt(f);return i.applicationServerKey=c,this.pushManager.pipe(Ml(f=>f.subscribe(i)),jn(1)).toPromise().then(f=>(this.subscriptionChanges.next(f),f))}unsubscribe(){return this.sw.isEnabled?this.subscription.pipe(jn(1),Ml(i=>{if(null===i)throw new Error("Not subscribed to push notifications.");return i.unsubscribe().then(s=>{if(!s)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})})).toPromise():Promise.reject(new Error(Q_))}decodeBase64(e){return atob(e)}}return n.\u0275fac=function(e){return new(e||n)(Ce(x0))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})(),b8=(()=>{class n{constructor(e){if(this.sw=e,!e.isEnabled)return this.versionUpdates=Wd,this.available=Wd,this.activated=Wd,void(this.unrecoverable=Wd);this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY"]),this.available=this.versionUpdates.pipe(ui(i=>"VERSION_READY"===i.type),Tt(i=>({type:"UPDATE_AVAILABLE",current:i.currentVersion,available:i.latestVersion}))),this.activated=this.sw.eventsOfType("UPDATE_ACTIVATED"),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}get isEnabled(){return this.sw.isEnabled}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(Q_));const e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(Q_));const e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}}return n.\u0275fac=function(e){return new(e||n)(Ce(x0))},n.\u0275prov=Ke({token:n,factory:n.\u0275fac}),n})();class BC{}const ZF=new dt("NGSW_REGISTER_SCRIPT");function w8(n,t,e,i){return()=>{if(!Ru(i)||!("serviceWorker"in navigator)||!1===e.enabled)return;let c;if(navigator.serviceWorker.addEventListener("controllerchange",()=>{null!==navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})}),"function"==typeof e.registrationStrategy)c=e.registrationStrategy();else{const[v,...C]=(e.registrationStrategy||"registerWhenStable:30000").split(":");switch(v){case"registerImmediately":c=Ot(null);break;case"registerWithDelay":c=XF(+C[0]||0);break;case"registerWhenStable":c=C[0]?Ft(KF(n),XF(+C[0])):KF(n);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${e.registrationStrategy}`)}}n.get(fn).runOutsideAngular(()=>c.pipe(jn(1)).subscribe(()=>navigator.serviceWorker.register(t,{scope:e.scope}).catch(v=>console.error("Service worker registration failed with:",v))))}}function XF(n){return Ot(null).pipe(function y8(n,t=h1){const e=QI(n,t);return WF(()=>e)}(n))}function KF(n){return n.get(gf).isStable.pipe(ui(e=>e))}function C8(n,t){return new x0(Ru(t)&&!1!==n.enabled?navigator.serviceWorker:void 0)}let E8=(()=>{class n{static register(e,i={}){return{ngModule:n,providers:[{provide:ZF,useValue:e},{provide:BC,useValue:i},{provide:x0,useFactory:C8,deps:[BC,so]},{provide:a_,useFactory:w8,deps:[ce,ZF,BC,so],multi:!0}]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n}),n.\u0275inj=tn({providers:[x8,b8]}),n})(),D8=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Kt({type:n,bootstrap:[e$]}),n.\u0275inj=tn({providers:[],imports:[[gS,I4,fU,$$,TN,h8,E8.register("ngsw-worker.js",{enabled:true,registrationStrategy:"registerWhenStable:30000"})]]}),n})();(function zO(){MM=!1})(),rN().bootstrapModule(D8).catch(n=>console.error(n))},898:function(Cm){Cm.exports=function(){"use strict";var Uu,Gu,wn;function Kd(p,Wn){if(Uu)if(Gu){var Do="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Uu+")(sharedChunk); ("+Gu+")(sharedChunk); self.onerror = null;",kr={};Uu(kr),wn=Wn(kr),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(wn.workerUrl=window.URL.createObjectURL(new Blob([Do],{type:"text/javascript"})))}else Gu=Wn;else Uu=Wn}return Kd(0,function(p){var Do=kr;function kr(a,r,l,u){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=l,this.p2y=u}kr.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},kr.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},kr.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},kr.prototype.solveCurveX=function(a,r){var l,u,h,g,y;for(void 0===r&&(r=1e-6),h=a,y=0;y<8;y++){if(g=this.sampleCurveX(h)-a,Math.abs(g)<r)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=g/x}if((h=a)<(l=0))return l;if(h>(u=1))return u;for(;l<u;){if(g=this.sampleCurveX(h),Math.abs(g-a)<r)return h;a>g?l=h:u=h,h=.5*(u-l)+l}return h},kr.prototype.solve=function(a,r){return this.sampleCurveY(this.solveCurveX(a,r))};var Be=Bt;function Bt(a,r){this.x=a,this.y=r}Bt.prototype={clone:function(){return new Bt(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,r){return this.clone()._rotateAround(a,r)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var r=a.x-this.x,l=a.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult:function(a){var r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var r=Math.cos(a),l=Math.sin(a),u=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=u,this},_rotateAround:function(a,r){var l=Math.cos(a),u=Math.sin(a),h=r.y+u*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-u*(this.y-r.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Bt.convert=function(a){return a instanceof Bt?a:Array.isArray(a)?new Bt(a[0],a[1]):a};var gt="undefined"!=typeof self?self:{};const Bs=Math.PI/180,Jr=180/Math.PI;function cn(a){return a*Bs}function Fr(a){return a*Jr}const $u=[[0,0],[1,0],[1,1],[0,1]];function Mo(a){if(a<=0)return 0;if(a>=1)return 1;const r=a*a,l=r*a;return 4*(a<.5?l:3*(a-r)+l-.75)}function es(a,r,l,u){const h=new Do(a,r,l,u);return function(g){return h.solve(g)}}const ts=es(.25,.1,.25,1);function on(a,r,l){return Math.min(l,Math.max(r,a))}function $a(a,r,l){return(l=on((l-a)/(r-a),0,1))*l*(3-2*l)}function gs(a,r,l){const u=l-r,h=((a-r)%u+u)%u+r;return h===r?l:h}function aa(a,r,l){if(!a.length)return l(null,[]);let u=a.length;const h=new Array(a.length);let g=null;a.forEach((y,x)=>{r(y,(E,M)=>{E&&(g=E),h[x]=M,0==--u&&l(g,h)})})}function Il(a){const r=[];for(const l in a)r.push(a[l]);return r}function bi(a,...r){for(const l of r)for(const u in l)a[u]=l[u];return a}let Mc=1;function la(){return Mc++}function Ns(){return function a(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Yd(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function ca(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function un(a,r){a.forEach(l=>{r[l]&&(r[l]=r[l].bind(r))})}function zs(a,r){return-1!==a.indexOf(r,a.length-r.length)}function ua(a,r,l){const u={};for(const h in a)u[h]=r.call(l||this,a[h],h,a);return u}function Sc(a,r,l){const u={};for(const h in a)r.call(l||this,a[h],h,a)&&(u[h]=a[h]);return u}function _s(a){return Array.isArray(a)?a.map(_s):"object"==typeof a&&a?ua(a,_s):a}const Nt={};function Rn(a){Nt[a]||("undefined"!=typeof console&&console.warn(a),Nt[a]=!0)}function Ji(a,r,l){return(l.y-a.y)*(r.x-a.x)>(r.y-a.y)*(l.x-a.x)}function Pn(a){let r=0;for(let l,u,h=0,g=a.length,y=g-1;h<g;y=h++)l=a[h],u=a[y],r+=(u.x-l.x)*(l.y+u.y);return r}function Cn(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Tt(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,u,h,g)=>{const y=h||g;return r[u]=!y||y.toLowerCase(),""}),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r}let lo,Hu,da,So,an=null;function Ha(a){if(null==an){const r=a.navigator?a.navigator.userAgent:null;an=!!a.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return an}function Qd(a){try{const r=gt[a];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(r){return!1}}const Rr={now:()=>void 0!==da?da:gt.performance.now(),setNow(a){da=a},restoreNow(){da=void 0},frame(a){const r=gt.requestAnimationFrame(a);return{cancel:()=>gt.cancelAnimationFrame(r)}},getImageData(a,r=0){const{width:l,height:u}=a;So||(So=gt.document.createElement("canvas"));const h=So.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return(l>So.width||u>So.height)&&(So.width=l,So.height=u),h.clearRect(-r,-r,l+2*r,u+2*r),h.drawImage(a,0,0,l,u),h.getImageData(-r,-r,l+2*r,u+2*r)},resolveURL:a=>(lo||(lo=gt.document.createElement("a")),lo.href=a,lo.href),get devicePixelRatio(){return gt.devicePixelRatio},get prefersReducedMotion(){return!!gt.matchMedia&&(null==Hu&&(Hu=gt.matchMedia("(prefers-reduced-motion: reduce)")),Hu.matches)}};let kl;const mn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==kl){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{kl=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch(r){kl=a}}return kl},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},qa={supported:!1,testSupport:function(a){!Fl&&ys&&(Ac?qu(a):ha=a)}};let ha,ys,Fl=!1,Ac=!1;function qu(a){const r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,ys),a.isContextLost())return;qa.supported=!0}catch(l){}a.deleteTexture(r),Fl=!0}gt.document&&(ys=gt.document.createElement("img"),ys.onload=function(){ha&&qu(ha),ha=null,Ac=!0},ys.onerror=function(){Fl=!0,ha=null},ys.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const vs="01",Wa="NO_ACCESS_TOKEN";function co(a){return 0===a.indexOf("mapbox:")}function Za(a){return mn.API_URL_REGEX.test(a)}const uo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Vs(a){const r=a.match(uo);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Xa(a){const r=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${r}`}function Wu(a){if(!a)return null;const r=a.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(gt.atob(r[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(l){return null}}class Rl{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const l=Wu(mn.ACCESS_TOKEN);let u="";return u=l&&l.u?gt.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(h,g)=>String.fromCharCode(Number("0x"+g)))):mn.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const r=Qd("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(r)try{const h=gt.localStorage.getItem(l);h&&(this.eventData=JSON.parse(h));const g=gt.localStorage.getItem(u);g&&(this.anonId=g)}catch(h){Rn("Unable to read from LocalStorage")}}saveEventData(){const r=Qd("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(r)try{gt.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&gt.localStorage.setItem(l,JSON.stringify(this.eventData))}catch(h){Rn("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,l,u,h){if(!mn.EVENTS_URL)return;const g=Vs(mn.EVENTS_URL);g.params.push(`access_token=${h||mn.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(r).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.8.2",skuId:vs,userId:this.anonId},x=l?bi(y,l):y,E={url:Xa(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=de(E,M=>{this.pendingRequest=null,u(M),this.saveEventData(),this.processRequests(h)})}queueRequest(r,l){this.queue.push(r),this.processRequests(l)}}const Tc=new class extends Rl{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,r){mn.EVENTS_URL&&mn.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>co(l)||Za(l))&&this.queueRequest(Date.now(),r)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Wu(mn.ACCESS_TOKEN),l=r?r.u:mn.ACCESS_TOKEN;let u=l!==this.eventData.tokenU;ca(this.anonId)||(this.anonId=Ns(),u=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),y=new Date(h),x=(h-this.eventData.lastSuccess)/864e5;u=u||x>=1||x<-1||g.getDate()!==y.getDate()}else u=!0;u?this.postEvent(h,{"enabled.telemetry":!1},g=>{g||(this.eventData.lastSuccess=h,this.eventData.tokenU=l)},a):this.processRequests()}},Ic=Tc.postTurnstileEvent.bind(Tc),kc=new class extends Rl{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,r,l,u){this.skuToken=r,this.errorCb=u,mn.EVENTS_URL&&(l||mn.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Wa)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),ca(this.anonId)||(this.anonId=Ns()),this.postEvent(l,{skuToken:this.skuToken},u=>{u?this.errorCb(u):r&&(this.success[r]=!0)},a))}},Fc=kc.postMapLoadEvent.bind(kc),Ka=new class extends Rl{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,r,l,u){if(!mn.API_URL||!mn.SESSION_PATH)return;const h=Vs(mn.API_URL+mn.SESSION_PATH);h.params.push(`sku=${r||""}`),h.params.push(`access_token=${u||mn.ACCESS_TOKEN||""}`);const g={url:Xa(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=me(g,y=>{this.pendingRequest=null,l(y),this.saveEventData(),this.processRequests(u)})}getSessionAPI(a,r,l,u){this.skuToken=r,this.errorCb=u,mn.SESSION_PATH&&mn.API_URL&&(l||mn.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Wa)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||this.getSession(l,this.skuToken,u=>{u?this.errorCb(u):r&&(this.success[r]=!0)},a)}},Rc=Ka.getSessionAPI.bind(Ka),Ya=new Set,Pc="mapbox-tiles";let xs,Ao,fa=500,Ri=50;function Pl(){gt.caches&&!xs&&(xs=gt.caches.open(Pc))}function Oc(a){const r=a.indexOf("?");return r<0?a:a.slice(0,r)}let Ol=1/0;const J={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(J);class N extends Error{constructor(r,l,u){401===l&&Za(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(r),this.status=l,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const j=Cn()?()=>self.worker&&self.worker.referrer:()=>("blob:"===gt.location.protocol?gt.parent:gt).location.href,K=function(a,r){if(!(/^file:/.test(l=a.url)||/^file:/.test(j())&&!/^\w+:/.test(l))){if(gt.fetch&&gt.Request&&gt.AbortController&&gt.Request.prototype.hasOwnProperty("signal"))return function(u,h){const g=new gt.AbortController,y=new gt.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:j(),signal:g.signal});let x=!1,E=!1;const M=(T=y.url).indexOf("sku=")>0&&Za(T);var T;"json"===u.type&&y.headers.set("Accept","application/json");const k=(B,V,$)=>{if(E)return;if(B&&"SecurityError"!==B.message&&Rn(B),V&&$)return R(V);const W=Date.now();gt.fetch(y).then(Q=>{if(Q.ok){const le=M?Q.clone():null;return R(Q,le,W)}return h(new N(Q.statusText,Q.status,u.url))}).catch(Q=>{20!==Q.code&&h(new Error(Q.message))})},R=(B,V,$)=>{("arrayBuffer"===u.type?B.arrayBuffer():"json"===u.type?B.json():B.text()).then(W=>{E||(V&&$&&function(Q,le,ce){if(Pl(),!xs)return;const fe={status:le.status,statusText:le.statusText,headers:new gt.Headers};le.headers.forEach((Se,Ae)=>fe.headers.set(Ae,Se));const pe=Tt(le.headers.get("Cache-Control")||"");if(pe["no-store"])return;pe["max-age"]&&fe.headers.set("Expires",new Date(ce+1e3*pe["max-age"]).toUTCString());const ge=fe.headers.get("Expires");ge&&(new Date(ge).getTime()-ce<42e4||function(Se,Ae){if(void 0===Ao)try{new Response(new ReadableStream),Ao=!0}catch(Oe){Ao=!1}Ao?Ae(Se.body):Se.blob().then(Ae)}(le,Se=>{const Ae=new gt.Response(Se,fe);Pl(),xs&&xs.then(Oe=>Oe.put(Oc(Q.url),Ae)).catch(Oe=>Rn(Oe.message))}))}(y,V,$),x=!0,h(null,W,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(W=>{E||h(new Error(W.message))})};return M?function(B,V){if(Pl(),!xs)return V(null);const $=Oc(B.url);xs.then(W=>{W.match($).then(Q=>{const le=function(ce){if(!ce)return!1;const fe=new Date(ce.headers.get("Expires")||0),pe=Tt(ce.headers.get("Cache-Control")||"");return fe>Date.now()&&!pe["no-cache"]}(Q);W.delete($),le&&W.put($,Q.clone()),V(null,Q,le)}).catch(V)}).catch(V)}(y,k):k(null,null),{cancel:()=>{E=!0,x||g.abort()}}}(a,r);if(Cn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r,void 0,!0)}var l;return function(u,h){const g=new gt.XMLHttpRequest;g.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(g.responseType="arraybuffer");for(const y in u.headers)g.setRequestHeader(y,u.headers[y]);return"json"===u.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===u.credentials,g.onerror=()=>{h(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let y=g.response;if("json"===u.type)try{y=JSON.parse(g.response)}catch(x){return h(x)}h(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else h(new N(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(a,r)},re=function(a,r){return K(bi(a,{type:"arrayBuffer"}),r)},de=function(a,r){return K(bi(a,{method:"POST"}),r)},me=function(a,r){return K(bi(a,{method:"GET"}),r)};function _e(a){const r=gt.document.createElement("a");return r.href=a,r.protocol===gt.document.location.protocol&&r.host===gt.document.location.host}const he="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let be,Le;be=[],Le=0;const Je=function(a,r){if(qa.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Le>=mn.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return be.push(g),g}Le++;let l=!1;const u=()=>{if(!l)for(l=!0,Le--;be.length&&Le<mn.MAX_PARALLEL_IMAGE_REQUESTS;){const g=be.shift(),{requestParameters:y,callback:x,cancelled:E}=g;E||(g.cancel=Je(y,x).cancel)}},h=re(a,(g,y,x,E)=>{u(),g?r(g):y&&(gt.createImageBitmap?function(M,T){const k=new gt.Blob([new Uint8Array(M)],{type:"image/png"});gt.createImageBitmap(k).then(R=>{T(null,R)}).catch(R=>{T(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(M,T)=>r(M,T,x,E)):function(M,T){const k=new gt.Image,R=gt.URL;k.onload=()=>{T(null,k),R.revokeObjectURL(k.src),k.onload=null,gt.requestAnimationFrame(()=>{k.src=he})},k.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new gt.Blob([new Uint8Array(M)],{type:"image/png"});k.src=M.byteLength?R.createObjectURL(B):he}(y,(M,T)=>r(M,T,x,E)))});return{cancel:()=>{h.cancel(),u()}}};function ze(a,r,l){l[a]&&-1!==l[a].indexOf(r)||(l[a]=l[a]||[],l[a].push(r))}function xt(a,r,l){if(l&&l[a]){const u=l[a].indexOf(r);-1!==u&&l[a].splice(u,1)}}class pt{constructor(r,l={}){bi(this,l),this.type=r}}class _t extends pt{constructor(r,l={}){super("error",bi({error:r},l))}}class Et{on(r,l){return this._listeners=this._listeners||{},ze(r,l,this._listeners),this}off(r,l){return xt(r,l,this._listeners),xt(r,l,this._oneTimeListeners),this}once(r,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},ze(r,l,this._oneTimeListeners),this):new Promise(u=>this.once(r,u))}fire(r,l){"string"==typeof r&&(r=new pt(r,l||{}));const u=r.type;if(this.listens(u)){r.target=this;const h=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const x of h)x.call(this,r);const g=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const x of g)xt(u,x,this._oneTimeListeners),x.call(this,r);const y=this._eventedParent;y&&(bi(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(r))}else r instanceof _t&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}var we=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function vn(a,...r){for(const l of r)for(const u in l)a[u]=l[u];return a}function lt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function gn(a){if(Array.isArray(a))return a.map(gn);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const l in a)r[l]=gn(a[l]);return r}return lt(a)}class xn extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}class pa{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[u,h]of l)this.bindings[u]=h}concat(r){return new pa(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const To={kind:"null"},Qe={kind:"number"},Mt={kind:"string"},Ft={kind:"boolean"},jn={kind:"color"},ma={kind:"object"},Ht={kind:"value"},Mn={kind:"collator"},ga={kind:"formatted"},Wt={kind:"resolvedImage"};function Pr(a,r){return{kind:"array",itemType:a,N:r}}function ni(a){if("array"===a.kind){const r=ni(a.itemType);return"number"==typeof a.N?`array<${r}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${r}>`}return a.kind}const On=[To,Qe,Mt,Ft,jn,ga,ma,Pr(Ht),Wt];function Ut(a,r){if("error"===r.kind)return null;if("array"===a.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!Ut(a.itemType,r.itemType))&&("number"!=typeof a.N||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if("value"===a.kind)for(const l of On)if(!Ut(l,r))return null}return`Expected ${ni(a)} but found ${ni(r)} instead.`}function Lc(a,r){return r.some(l=>l.kind===a.kind)}function Bc(a,r){return r.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}function dn(a){var r={exports:{}};return a(r,r.exports),r.exports}var Nc=dn(function(a,r){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function u(x){return(x=Math.round(x))<0?0:x>255?255:x}function h(x){return u("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function g(x){return(E="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:E>1?1:E;var E}function y(x,E,M){return M<0?M+=1:M>1&&(M-=1),6*M<1?x+(E-x)*M*6:2*M<1?E:3*M<2?x+(E-x)*(2/3-M)*6:x}try{r.parseCSSColor=function(x){var E,M=x.replace(/ /g,"").toLowerCase();if(M in l)return l[M].slice();if("#"===M[0])return 4===M.length?(E=parseInt(M.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:7===M.length&&(E=parseInt(M.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var T=M.indexOf("("),k=M.indexOf(")");if(-1!==T&&k+1===M.length){var R=M.substr(0,T),B=M.substr(T+1,k-(T+1)).split(","),V=1;switch(R){case"rgba":if(4!==B.length)return null;V=g(B.pop());case"rgb":return 3!==B.length?null:[h(B[0]),h(B[1]),h(B[2]),V];case"hsla":if(4!==B.length)return null;V=g(B.pop());case"hsl":if(3!==B.length)return null;var $=(parseFloat(B[0])%360+360)%360/360,W=g(B[1]),Q=g(B[2]),le=Q<=.5?Q*(W+1):Q+W-Q*W,ce=2*Q-le;return[u(255*y(ce,le,$+1/3)),u(255*y(ce,le,$)),u(255*y(ce,le,$-1/3)),V];default:return null}}return null}}catch(x){}});class ot{constructor(r,l,u,h=1){this.r=r,this.g=l,this.b=u,this.a=h}static parse(r){if(!r)return;if(r instanceof ot)return r;if("string"!=typeof r)return;const l=Nc.parseCSSColor(r);return l?new ot(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[r,l,u,h]=this.toArray();return`rgba(${Math.round(r)},${Math.round(l)},${Math.round(u)},${h})`}toArray(){const{r,g:l,b:u,a:h}=this;return 0===h?[0,0,0,0]:[255*r/h,255*l/h,255*u/h,h]}}ot.black=new ot(0,0,0,1),ot.white=new ot(1,1,1,1),ot.transparent=new ot(0,0,0,0),ot.red=new ot(1,0,0,1),ot.blue=new ot(0,0,1,1);class Di{constructor(r,l,u){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Jd{constructor(r,l,u,h,g){this.text=r.normalize?r.normalize():r,this.image=l,this.scale=u,this.fontStack=h,this.textColor=g}}class Pi{constructor(r){this.sections=r}static fromString(r){return new Pi([new Jd(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof Pi?r:Pi.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const l of this.sections){if(l.image){r.push(["image",l.image.name]);continue}r.push(l.text);const u={};l.fontStack&&(u["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(u["font-scale"]=l.scale),l.textColor&&(u["text-color"]=["rgba"].concat(l.textColor.toArray())),r.push(u)}return r}}class bs{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new bs({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Or(a,r,l,u){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[a,r,l,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[a,r,l,u]:[a,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cr(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof ot||a instanceof Di||a instanceof Pi||a instanceof bs)return!0;if(Array.isArray(a)){for(const r of a)if(!cr(r))return!1;return!0}if("object"==typeof a){for(const r in a)if(!cr(a[r]))return!1;return!0}return!1}function Mi(a){if(null===a)return To;if("string"==typeof a)return Mt;if("boolean"==typeof a)return Ft;if("number"==typeof a)return Qe;if(a instanceof ot)return jn;if(a instanceof Di)return Mn;if(a instanceof Pi)return ga;if(a instanceof bs)return Wt;if(Array.isArray(a)){const r=a.length;let l;for(const u of a){const h=Mi(u);if(l){if(l===h)continue;l=Ht;break}l=h}return Pr(l||Ht,r)}return ma}function Io(a){const r=typeof a;return null===a?"":"string"===r||"number"===r||"boolean"===r?String(a):a instanceof ot||a instanceof Pi||a instanceof bs?a.toString():JSON.stringify(a)}class _a{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(2!==r.length)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!cr(r[1]))return l.error("invalid value");const u=r[1];let h=Mi(u);const g=l.expectedType;return"array"!==h.kind||0!==h.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(h=g),new _a(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ot?["rgba"].concat(this.value.toArray()):this.value instanceof Pi?this.value.serialize():this.value}}class ii{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const Nf={string:Mt,number:Qe,boolean:Ft,object:ma};class ho{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let u,h=1;const g=r[0];if("array"===g){let x,E;if(r.length>2){const M=r[1];if("string"!=typeof M||!(M in Nf)||"object"===M)return l.error('The item type argument of "array" must be one of string, number, boolean',1);x=Nf[M],h++}else x=Ht;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);E=r[2],h++}u=Pr(x,E)}else u=Nf[g];const y=[];for(;h<r.length;h++){const x=l.parse(r[h],h,Ht);if(!x)return null;y.push(x)}return new ho(u,y)}evaluate(r){for(let l=0;l<this.args.length;l++){const u=this.args[l].evaluate(r);if(!Ut(this.type,Mi(u)))return u;if(l===this.args.length-1)throw new ii(`Expected value to be of type ${ni(this.type)}, but found ${ni(Mi(u))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,l=[r.kind];if("array"===r.kind){const u=r.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){l.push(u.kind);const h=r.N;("number"==typeof h||this.args.length>1)&&l.push(h)}}return l.concat(this.args.map(u=>u.serialize()))}}class zc{constructor(r){this.type=ga,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&"object"==typeof u)return l.error("First argument must be an image or text section.");const h=[];let g=!1;for(let y=1;y<=r.length-1;++y){const x=r[y];if(g&&"object"==typeof x&&!Array.isArray(x)){g=!1;let E=null;if(x["font-scale"]&&(E=l.parse(x["font-scale"],1,Qe),!E))return null;let M=null;if(x["text-font"]&&(M=l.parse(x["text-font"],1,Pr(Mt)),!M))return null;let T=null;if(x["text-color"]&&(T=l.parse(x["text-color"],1,jn),!T))return null;const k=h[h.length-1];k.scale=E,k.font=M,k.textColor=T}else{const E=l.parse(r[y],1,Ht);if(!E)return null;const M=E.type.kind;if("string"!==M&&"value"!==M&&"null"!==M&&"resolvedImage"!==M)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:E,scale:null,font:null,textColor:null})}}return new zc(h)}evaluate(r){return new Pi(this.sections.map(l=>{const u=l.content.evaluate(r);return Mi(u)===Wt?new Jd("",u,null,null,null):new Jd(Io(u),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)}))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const l of this.sections){r.push(l.content.serialize());const u={};l.scale&&(u["font-scale"]=l.scale.serialize()),l.font&&(u["text-font"]=l.font.serialize()),l.textColor&&(u["text-color"]=l.textColor.serialize()),r.push(u)}return r}}class Vc{constructor(r){this.type=Wt,this.input=r}static parse(r,l){if(2!==r.length)return l.error("Expected two arguments.");const u=l.parse(r[1],1,Mt);return u?new Vc(u):l.error("No image name provided.")}evaluate(r){const l=this.input.evaluate(r),u=bs.fromString(l);return u&&r.availableImages&&(u.available=r.availableImages.indexOf(l)>-1),u}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Dm={"to-boolean":Ft,"to-color":jn,"to-number":Qe,"to-string":Mt};class fo{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const u=r[0];if(("to-boolean"===u||"to-string"===u)&&2!==r.length)return l.error("Expected one argument.");const h=Dm[u],g=[];for(let y=1;y<r.length;y++){const x=l.parse(r[y],y,Ht);if(!x)return null;g.push(x)}return new fo(h,g)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let l,u;for(const h of this.args){if(l=h.evaluate(r),u=null,l instanceof ot)return l;if("string"==typeof l){const g=r.parseColor(l);if(g)return g}else if(Array.isArray(l)&&(u=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Or(l[0],l[1],l[2],l[3]),!u))return new ot(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new ii(u||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const u of this.args){if(l=u.evaluate(r),null===l)return 0;const h=Number(l);if(!isNaN(h))return h}throw new ii(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?Pi.fromString(Io(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?bs.fromString(Io(this.args[0].evaluate(r))):Io(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new zc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Vc(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(l=>{r.push(l.serialize())}),r}}const Mm=["Unknown","Point","LineString","Polygon"];class Sm{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Mm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*l-r[0])+this.featureDistanceData.bearing[1]*(h*l-r[1])}return 0}parseColor(r){let l=this._parseColorCache[r];return l||(l=this._parseColorCache[r]=ot.parse(r)),l}}class ri{constructor(r,l,u,h){this.name=r,this.type=l,this._evaluate=u,this.args=h}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,l){const u=r[0],h=ri.definitions[u];if(!h)return l.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=y.filter(([M])=>!Array.isArray(M)||M.length===r.length-1);let E=null;for(const[M,T]of x){E=new vr(l.registry,l.path,null,l.scope);const k=[];let R=!1;for(let B=1;B<r.length;B++){const V=r[B],$=Array.isArray(M)?M[B-1]:M.type,W=E.parse(V,1+k.length,$);if(!W){R=!0;break}k.push(W)}if(!R)if(Array.isArray(M)&&M.length!==k.length)E.error(`Expected ${M.length} arguments, but found ${k.length} instead.`);else{for(let B=0;B<k.length;B++){const V=Array.isArray(M)?M[B]:M.type,$=k[B];E.concat(B+1).checkSubtype(V,$.type)}if(0===E.errors.length)return new ri(u,g,T,k)}}if(1===x.length)l.errors.push(...E.errors);else{const M=(x.length?x:y).map(([k])=>{return R=k,Array.isArray(R)?`(${R.map(ni).join(", ")})`:`(${ni(R.type)}...)`;var R}).join(" | "),T=[];for(let k=1;k<r.length;k++){const R=l.parse(r[k],1+T.length);if(!R)return null;T.push(ni(R.type))}l.error(`Expected arguments of type ${M}, but found (${T.join(", ")}) instead.`)}return null}static register(r,l){ri.definitions=l;for(const u in l)r[u]=ri}}class Zn{constructor(r,l,u){this.type=Mn,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(2!==r.length)return l.error("Expected one argument.");const u=r[1];if("object"!=typeof u||Array.isArray(u))return l.error("Collator options argument must be an object.");const h=l.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,Ft);if(!h)return null;const g=l.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,Ft);if(!g)return null;let y=null;return u.locale&&(y=l.parse(u.locale,1,Mt),!y)?null:new Zn(h,g,y)}evaluate(r){return new Di(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const Qa=8192;function zf(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function eh(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function Ke(a,r){const l=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,h=Math.pow(2,r.z);return[Math.round(l*h*Qa),Math.round(u*h*Qa)]}function th(a,r,l){const u=a[0]-r[0],h=a[1]-r[1],g=a[0]-l[0],y=a[1]-l[1];return u*y-g*h==0&&u*g<=0&&h*y<=0}function tn(a,r){let l=!1;for(let y=0,x=r.length;y<x;y++){const E=r[y];for(let M=0,T=E.length;M<T-1;M++){if(th(a,E[M],E[M+1]))return!1;(h=E[M])[1]>(u=a)[1]!=(g=E[M+1])[1]>u[1]&&u[0]<(g[0]-h[0])*(u[1]-h[1])/(g[1]-h[1])+h[0]&&(l=!l)}}var u,h,g;return l}function nh(a,r){for(let l=0;l<r.length;l++)if(tn(a,r[l]))return!0;return!1}function ih(a,r,l,u){const h=u[0]-l[0],g=u[1]-l[1],y=(a[0]-l[0])*g-h*(a[1]-l[1]),x=(r[0]-l[0])*g-h*(r[1]-l[1]);return y>0&&x<0||y<0&&x>0}function Am(a,r,l){for(const M of l)for(let T=0;T<M.length-1;++T)if((x=[(y=M[T+1])[0]-(g=M[T])[0],y[1]-g[1]])[0]*(E=[(h=r)[0]-(u=a)[0],h[1]-u[1]])[1]-x[1]*E[0]!=0&&ih(u,h,g,y)&&ih(g,y,u,h))return!0;var u,h,g,y,x,E;return!1}function Vf(a,r){for(let l=0;l<a.length;++l)if(!tn(a[l],r))return!1;for(let l=0;l<a.length-1;++l)if(Am(a[l],a[l+1],r))return!1;return!0}function jf(a,r){for(let l=0;l<r.length;l++)if(Vf(a,r[l]))return!0;return!1}function Ja(a,r,l){const u=[];for(let h=0;h<a.length;h++){const g=[];for(let y=0;y<a[h].length;y++){const x=Ke(a[h][y],l);zf(r,x),g.push(x)}u.push(g)}return u}function el(a,r,l){const u=[];for(let h=0;h<a.length;h++){const g=Ja(a[h],r,l);u.push(g)}return u}function rh(a,r,l,u){if(a[0]<l[0]||a[0]>l[2]){const h=.5*u;let g=a[0]-l[0]>h?-u:l[0]-a[0]>h?u:0;0===g&&(g=a[0]-l[2]>h?-u:l[2]-a[0]>h?u:0),a[0]+=g}zf(r,a)}function Uf(a,r,l,u){const h=Math.pow(2,u.z)*Qa,g=[u.x*Qa,u.y*Qa],y=[];if(!a)return y;for(const x of a)for(const E of x){const M=[E.x+g[0],E.y+g[1]];rh(M,r,l,h),y.push(M)}return y}function Gt(a,r,l,u){const h=Math.pow(2,u.z)*Qa,g=[u.x*Qa,u.y*Qa],y=[];if(!a)return y;for(const E of a){const M=[];for(const T of E){const k=[T.x+g[0],T.y+g[1]];zf(r,k),M.push(k)}y.push(M)}if(r[2]-r[0]<=h/2){(x=r)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of y)for(const M of E)rh(M,r,l,h)}var x;return y}class ko{constructor(r,l){this.type=Ft,this.geojson=r,this.geometries=l}static parse(r,l){if(2!==r.length)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(cr(r[1])){const u=r[1];if("FeatureCollection"===u.type)for(let h=0;h<u.features.length;++h){const g=u.features[h].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new ko(u,u.features[h].geometry)}else if("Feature"===u.type){const h=u.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new ko(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new ko(u,u)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(l,u){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if("Polygon"===u.type){const x=Ja(u.coordinates,g,y),E=Uf(l.geometry(),h,g,y);if(!eh(h,g))return!1;for(const M of E)if(!tn(M,x))return!1}if("MultiPolygon"===u.type){const x=el(u.coordinates,g,y),E=Uf(l.geometry(),h,g,y);if(!eh(h,g))return!1;for(const M of E)if(!nh(M,x))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(l,u){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if("Polygon"===u.type){const x=Ja(u.coordinates,g,y),E=Gt(l.geometry(),h,g,y);if(!eh(h,g))return!1;for(const M of E)if(!Vf(M,x))return!1}if("MultiPolygon"===u.type){const x=el(u.coordinates,g,y),E=Gt(l.geometry(),h,g,y);if(!eh(h,g))return!1;for(const M of E)if(!jf(M,x))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Lr(a){if(a instanceof ri&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof ko)return!1;let r=!0;return a.eachChild(l=>{r&&!Lr(l)&&(r=!1)}),r}function ws(a){if(a instanceof ri&&"feature-state"===a.name)return!1;let r=!0;return a.eachChild(l=>{r&&!ws(l)&&(r=!1)}),r}function Ll(a,r){if(a instanceof ri&&r.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(u=>{l&&!Ll(u,r)&&(l=!1)}),l}class Bl{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(2!==r.length||"string"!=typeof r[1])return l.error("'var' expression requires exactly one string literal argument.");const u=r[1];return l.scope.has(u)?new Bl(u,l.scope.get(u)):l.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class vr{constructor(r,l=[],u,h=new pa,g=[]){this.registry=r,this.path=l,this.key=l.map(y=>`[${y}]`).join(""),this.scope=h,this.errors=g,this.expectedType=u}parse(r,l,u,h,g={}){return l?this.concat(l,u,h)._parse(r,g):this._parse(r,g)}_parse(r,l){function u(h,g,y){return"assert"===y?new ho(g,[h]):"coerce"===y?new fo(g,[h]):h}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=r[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let y=g.parse(r,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,E=y.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==E.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(x,E))return null}else y=u(y,x,l.typeAnnotation||"coerce");else y=u(y,x,l.typeAnnotation||"assert")}if(!(y instanceof _a)&&"resolvedImage"!==y.type.kind&&Br(y)){const x=new Sm;try{y=new _a(y.type,y.evaluate(x))}catch(E){return this.error(E.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,u){const h="number"==typeof r?this.path.concat(r):this.path,g=u?this.scope.concat(u):this.scope;return new vr(this.registry,h,l||null,g,this.errors)}error(r,...l){const u=`${this.key}${l.map(h=>`[${h}]`).join("")}`;this.errors.push(new xn(u,r))}checkSubtype(r,l){const u=Ut(r,l);return u&&this.error(u),u}}function Br(a){if(a instanceof Bl)return Br(a.boundExpression);if(a instanceof ri&&"error"===a.name||a instanceof Zn||a instanceof ko)return!1;const r=a instanceof fo||a instanceof ho;let l=!0;return a.eachChild(u=>{l=r?l&&Br(u):l&&u instanceof _a}),!!l&&Lr(a)&&Ll(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Zu(a,r){const l=a.length-1;let u,h,g=0,y=l,x=0;for(;g<=y;)if(x=Math.floor((g+y)/2),u=a[x],h=a[x+1],u<=r){if(x===l||r<h)return x;g=x+1}else{if(!(u>r))throw new ii("Input is not a number.");y=x-1}return 0}class Xu{constructor(r,l,u){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[h,g]of u)this.labels.push(h),this.outputs.push(g)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const u=l.parse(r[1],1,Qe);if(!u)return null;const h=[];let g=null;l.expectedType&&"value"!==l.expectedType.kind&&(g=l.expectedType);for(let y=1;y<r.length;y+=2){const x=1===y?-1/0:r[y],E=r[y+1],M=y,T=y+1;if("number"!=typeof x)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(h.length&&h[h.length-1][0]>=x)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const k=l.parse(E,T,g);if(!k)return null;g=g||k.type,h.push([x,k])}return new Xu(g,u,h)}evaluate(r){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(r);const h=this.input.evaluate(r);if(h<=l[0])return u[0].evaluate(r);const g=l.length;return h>=l[g-1]?u[g-1].evaluate(r):u[Zu(l,h)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&r.push(this.labels[l]),r.push(this.outputs[l].serialize());return r}}function ct(a,r,l){return a*(1-l)+r*l}var Ku=Object.freeze({__proto__:null,number:ct,color:function(a,r,l){return new ot(ct(a.r,r.r,l),ct(a.g,r.g,l),ct(a.b,r.b,l),ct(a.a,r.a,l))},array:function(a,r,l){return a.map((u,h)=>ct(u,r[h],l))}});const Hf=4/29,Ln=6/29,qf=3*Ln*Ln,Tm=Math.PI/180,tl=180/Math.PI;function Bn(a){return a>.008856451679035631?Math.pow(a,1/3):a/qf+Hf}function js(a){return a>Ln?a*a*a:qf*(a-Hf)}function ya(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function jc(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Uc(a){const r=jc(a.r),l=jc(a.g),u=jc(a.b),h=Bn((.4124564*r+.3575761*l+.1804375*u)/.95047),g=Bn((.2126729*r+.7151522*l+.072175*u)/1);return{l:116*g-16,a:500*(h-g),b:200*(g-Bn((.0193339*r+.119192*l+.9503041*u)/1.08883)),alpha:a.a}}function Us(a){let r=(a.l+16)/116,l=isNaN(a.a)?r:r+a.a/500,u=isNaN(a.b)?r:r-a.b/200;return r=1*js(r),l=.95047*js(l),u=1.08883*js(u),new ot(ya(3.2404542*l-1.5371385*r-.4985314*u),ya(-.969266*l+1.8760108*r+.041556*u),ya(.0556434*l-.2040259*r+1.0572252*u),a.alpha)}function Gc(a,r,l){const u=r-a;return a+l*(u>180||u<-180?u-360*Math.round(u/360):u)}const $c={forward:Uc,reverse:Us,interpolate:function(a,r,l){return{l:ct(a.l,r.l,l),a:ct(a.a,r.a,l),b:ct(a.b,r.b,l),alpha:ct(a.alpha,r.alpha,l)}}},Un={forward:function(a){const{l:r,a:l,b:u}=Uc(a),h=Math.atan2(u,l)*tl;return{h:h<0?h+360:h,c:Math.sqrt(l*l+u*u),l:r,alpha:a.a}},reverse:function(a){const r=a.h*Tm,l=a.c;return Us({l:a.l,a:Math.cos(r)*l,b:Math.sin(r)*l,alpha:a.alpha})},interpolate:function(a,r,l){return{h:Gc(a.h,r.h,l),c:ct(a.c,r.c,l),l:ct(a.l,r.l,l),alpha:ct(a.alpha,r.alpha,l)}}};var sh=Object.freeze({__proto__:null,lab:$c,hcl:Un});class Nr{constructor(r,l,u,h,g){this.type=r,this.operator=l,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[y,x]of g)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(r,l,u,h){let g=0;if("exponential"===r.name)g=Hc(l,r.base,u,h);else if("linear"===r.name)g=Hc(l,1,u,h);else if("cubic-bezier"===r.name){const y=r.controlPoints;g=new Do(y[0],y[1],y[2],y[3]).solve(Hc(l,1,u,h))}return g}static parse(r,l){let[u,h,g,...y]=r;if(!Array.isArray(h)||0===h.length)return l.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const M=h[1];if("number"!=typeof M)return l.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:M}}else{if("cubic-bezier"!==h[0])return l.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const M=h.slice(1);if(4!==M.length||M.some(T=>"number"!=typeof T||T<0||T>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(g=l.parse(g,2,Qe),!g)return null;const x=[];let E=null;"interpolate-hcl"===u||"interpolate-lab"===u?E=jn:l.expectedType&&"value"!==l.expectedType.kind&&(E=l.expectedType);for(let M=0;M<y.length;M+=2){const T=y[M],k=y[M+1],R=M+3,B=M+4;if("number"!=typeof T)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(x.length&&x[x.length-1][0]>=T)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const V=l.parse(k,B,E);if(!V)return null;E=E||V.type,x.push([T,V])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Nr(E,u,h,g,x):l.error(`Type ${ni(E)} is not interpolatable.`)}evaluate(r){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(r);const h=this.input.evaluate(r);if(h<=l[0])return u[0].evaluate(r);const g=l.length;if(h>=l[g-1])return u[g-1].evaluate(r);const y=Zu(l,h),x=Nr.interpolationFactor(this.interpolation,h,l[y],l[y+1]),E=u[y].evaluate(r),M=u[y+1].evaluate(r);return"interpolate"===this.operator?Ku[this.type.kind.toLowerCase()](E,M,x):"interpolate-hcl"===this.operator?Un.reverse(Un.interpolate(Un.forward(E),Un.forward(M),x)):$c.reverse($c.interpolate($c.forward(E),$c.forward(M),x))}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)l.push(this.labels[u],this.outputs[u].serialize());return l}}function Hc(a,r,l,u){const h=u-l,g=a-l;return 0===h?0:1===r?g/h:(Math.pow(r,g)-1)/(Math.pow(r,h)-1)}class Nl{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let u=null;const h=l.expectedType;h&&"value"!==h.kind&&(u=h);const g=[];for(const x of r.slice(1)){const E=l.parse(x,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,g.push(E)}const y=h&&g.some(x=>Ut(h,x.type));return new Nl(y?Ht:u,g)}evaluate(r){let l,u=null,h=0;for(const g of this.args){if(h++,u=g.evaluate(r),u&&u instanceof bs&&!u.available&&(l||(l=u),u=null,h===this.args.length))return l;if(null!==u)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(l=>{r.push(l.serialize())}),r}}class Kt{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let g=1;g<r.length-1;g+=2){const y=r[g];if("string"!=typeof y)return l.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return l.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=l.parse(r[g+1],g+1);if(!x)return null;u.push([y,x])}const h=l.parse(r[r.length-1],r.length-1,l.expectedType,u);return h?new Kt(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[l,u]of this.bindings)r.push(l,u.serialize());return r.push(this.result.serialize()),r}}class oh{constructor(r,l,u){this.type=r,this.index=l,this.input=u}static parse(r,l){if(3!==r.length)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,Qe),h=l.parse(r[2],2,Pr(l.expectedType||Ht));return u&&h?new oh(h.type.itemType,u,h):null}evaluate(r){const l=this.index.evaluate(r),u=this.input.evaluate(r);if(l<0)throw new ii(`Array index out of bounds: ${l} < 0.`);if(l>=u.length)throw new ii(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l!==Math.floor(l))throw new ii(`Array index must be an integer, but found ${l} instead.`);return u[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class qc{constructor(r,l){this.type=Ft,this.needle=r,this.haystack=l}static parse(r,l){if(3!==r.length)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,Ht),h=l.parse(r[2],2,Ht);return u&&h?Lc(u.type,[Ft,Mt,Qe,To,Ht])?new qc(u,h):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ni(u.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(null==u)return!1;if(!Bc(l,["boolean","string","number","null"]))throw new ii(`Expected first argument to be of type boolean, string, number or null, but found ${ni(Mi(l))} instead.`);if(!Bc(u,["string","array"]))throw new ii(`Expected second argument to be of type array or string, but found ${ni(Mi(u))} instead.`);return u.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class je{constructor(r,l,u){this.type=Qe,this.needle=r,this.haystack=l,this.fromIndex=u}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,Ht),h=l.parse(r[2],2,Ht);if(!u||!h)return null;if(!Lc(u.type,[Ft,Mt,Qe,To,Ht]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ni(u.type)} instead`);if(4===r.length){const g=l.parse(r[3],3,Qe);return g?new je(u,h,g):null}return new je(u,h)}evaluate(r){const l=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!Bc(l,["boolean","string","number","null"]))throw new ii(`Expected first argument to be of type boolean, string, number or null, but found ${ni(Mi(l))} instead.`);if(!Bc(u,["string","array"]))throw new ii(`Expected second argument to be of type array or string, but found ${ni(Mi(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(r);return u.indexOf(l,h)}return u.indexOf(l)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class er{constructor(r,l,u,h,g,y){this.inputType=r,this.type=l,this.input=u,this.cases=h,this.outputs=g,this.otherwise=y}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let u,h;l.expectedType&&"value"!==l.expectedType.kind&&(h=l.expectedType);const g={},y=[];for(let M=2;M<r.length-1;M+=2){let T=r[M];const k=r[M+1];Array.isArray(T)||(T=[T]);const R=l.concat(M);if(0===T.length)return R.error("Expected at least one branch label.");for(const V of T){if("number"!=typeof V&&"string"!=typeof V)return R.error("Branch labels must be numbers or strings.");if("number"==typeof V&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof V&&Math.floor(V)!==V)return R.error("Numeric branch labels must be integer values.");if(u){if(R.checkSubtype(u,Mi(V)))return null}else u=Mi(V);if(void 0!==g[String(V)])return R.error("Branch labels must be unique.");g[String(V)]=y.length}const B=l.parse(k,M,h);if(!B)return null;h=h||B.type,y.push(B)}const x=l.parse(r[1],1,Ht);if(!x)return null;const E=l.parse(r[r.length-1],r.length-1,h);return E?"value"!==x.type.kind&&l.concat(1).checkSubtype(u,x.type)?null:new er(u,h,x,g,y,E):null}evaluate(r){const l=this.input.evaluate(r);return(Mi(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),u=[],h={};for(const y of l){const x=h[this.cases[y]];void 0===x?(h[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[x][1].push(y)}const g=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,x]of u)r.push(1===x.length?g(x[0]):x.map(g)),r.push(this.outputs[y].serialize());return r.push(this.otherwise.serialize()),r}}class Oi{constructor(r,l,u){this.type=r,this.branches=l,this.otherwise=u}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let u;l.expectedType&&"value"!==l.expectedType.kind&&(u=l.expectedType);const h=[];for(let y=1;y<r.length-1;y+=2){const x=l.parse(r[y],y,Ft);if(!x)return null;const E=l.parse(r[y+1],y+1,u);if(!E)return null;h.push([x,E]),u=u||E.type}const g=l.parse(r[r.length-1],r.length-1,u);return g?new Oi(u,h,g):null}evaluate(r){for(const[l,u]of this.branches)if(l.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,u]of this.branches)r(l),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(l=>{r.push(l.serialize())}),r}}class Gs{constructor(r,l,u,h){this.type=r,this.input=l,this.beginIndex=u,this.endIndex=h}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,Ht),h=l.parse(r[2],2,Qe);if(!u||!h)return null;if(!Lc(u.type,[Pr(Ht),Mt,Ht]))return l.error(`Expected first argument to be of type array or string, but found ${ni(u.type)} instead`);if(4===r.length){const g=l.parse(r[3],3,Qe);return g?new Gs(u.type,u,h,g):null}return new Gs(u.type,u,h)}evaluate(r){const l=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!Bc(l,["string","array"]))throw new ii(`Expected first argument to be of type array or string, but found ${ni(Mi(l))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(r);return l.slice(u,h)}return l.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function va(a,r){return"=="===a||"!="===a?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function ns(a,r,l,u){return 0===u.compare(r,l)}function Fo(a,r,l){const u="=="!==a&&"!="!==a;return class QF{constructor(g,y,x){this.type=Ft,this.lhs=g,this.rhs=y,this.collator=x,this.hasUntypedArgument="value"===g.type.kind||"value"===y.type.kind}static parse(g,y){if(3!==g.length&&4!==g.length)return y.error("Expected two or three arguments.");const x=g[0];let E=y.parse(g[1],1,Ht);if(!E)return null;if(!va(x,E.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${ni(E.type)}'.`);let M=y.parse(g[2],2,Ht);if(!M)return null;if(!va(x,M.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${ni(M.type)}'.`);if(E.type.kind!==M.type.kind&&"value"!==E.type.kind&&"value"!==M.type.kind)return y.error(`Cannot compare types '${ni(E.type)}' and '${ni(M.type)}'.`);u&&("value"===E.type.kind&&"value"!==M.type.kind?E=new ho(M.type,[E]):"value"!==E.type.kind&&"value"===M.type.kind&&(M=new ho(E.type,[M])));let T=null;if(4===g.length){if("string"!==E.type.kind&&"string"!==M.type.kind&&"value"!==E.type.kind&&"value"!==M.type.kind)return y.error("Cannot use collator to compare non-string types.");if(T=y.parse(g[3],3,Mn),!T)return null}return new QF(E,M,T)}evaluate(g){const y=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const E=Mi(y),M=Mi(x);if(E.kind!==M.kind||"string"!==E.kind&&"number"!==E.kind)throw new ii(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${E.kind}, ${M.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=Mi(y),M=Mi(x);if("string"!==E.kind||"string"!==M.kind)return r(g,y,x)}return this.collator?l(g,y,x,this.collator.evaluate(g)):r(g,y,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const ah=Fo("==",function(a,r,l){return r===l},ns),Wc=Fo("!=",function(a,r,l){return r!==l},function(a,r,l,u){return!ns(0,r,l,u)}),Zc=Fo("<",function(a,r,l){return r<l},function(a,r,l,u){return u.compare(r,l)<0}),nl=Fo(">",function(a,r,l){return r>l},function(a,r,l,u){return u.compare(r,l)>0}),ur=Fo("<=",function(a,r,l){return r<=l},function(a,r,l,u){return u.compare(r,l)<=0}),Im=Fo(">=",function(a,r,l){return r>=l},function(a,r,l,u){return u.compare(r,l)>=0});class zr{constructor(r,l,u,h,g){this.type=Mt,this.number=r,this.locale=l,this.currency=u,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(r,l){if(3!==r.length)return l.error("Expected two arguments.");const u=l.parse(r[1],1,Qe);if(!u)return null;const h=r[2];if("object"!=typeof h||Array.isArray(h))return l.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=l.parse(h.locale,1,Mt),!g))return null;let y=null;if(h.currency&&(y=l.parse(h.currency,1,Mt),!y))return null;let x=null;if(h["min-fraction-digits"]&&(x=l.parse(h["min-fraction-digits"],1,Qe),!x))return null;let E=null;return h["max-fraction-digits"]&&(E=l.parse(h["max-fraction-digits"],1,Qe),!E)?null:new zr(u,g,y,x,E)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class ut{constructor(r){this.type=Qe,this.input=r}static parse(r,l){if(2!==r.length)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=l.parse(r[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?l.error(`Expected argument of type string or array, but found ${ni(u.type)} instead.`):new ut(u):null}evaluate(r){const l=this.input.evaluate(r);if("string"==typeof l||Array.isArray(l))return l.length;throw new ii(`Expected value to be of type string or array, but found ${ni(Mi(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(l=>{r.push(l.serialize())}),r}}const qt={"==":ah,"!=":Wc,">":nl,"<":Zc,">=":Im,"<=":ur,array:ho,at:oh,boolean:ho,case:Oi,coalesce:Nl,collator:Zn,format:zc,image:Vc,in:qc,"index-of":je,interpolate:Nr,"interpolate-hcl":Nr,"interpolate-lab":Nr,length:ut,let:Kt,literal:_a,match:er,number:ho,"number-format":zr,object:ho,slice:Gs,step:Xu,string:ho,"to-boolean":fo,"to-color":fo,"to-number":fo,"to-string":fo,var:Bl,within:ko};function Qn(a,[r,l,u,h]){r=r.evaluate(a),l=l.evaluate(a),u=u.evaluate(a);const g=h?h.evaluate(a):1,y=Or(r,l,u,g);if(y)throw new ii(y);return new ot(r/255*g,l/255*g,u/255*g,g)}function Vr(a,r){return a in r}function Ro(a,r){const l=r[a];return void 0===l?null:l}function si(a){return{type:a}}function Po(a){return{result:"success",value:a}}function Xn(a){return{result:"error",value:a}}function po(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]}function il(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Zt(a){return!!a.expression&&a.expression.interpolated}function hn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function Cs(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function Yu(a){return a}function xa(a,r){const l="color"===r.type,u=a.stops&&"object"==typeof a.stops[0][0],h=u||!(u||void 0!==a.property),g=a.type||(Zt(r)?"exponential":"interval");if(l&&((a=vn({},a)).stops&&(a.stops=a.stops.map(M=>[M[0],ot.parse(M[1])])),a.default=ot.parse(a.default?a.default:r.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!sh[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let y,x,E;if("exponential"===g)y=is;else if("interval"===g)y=zl;else if("categorical"===g){y=Xc,x=Object.create(null);for(const M of a.stops)x[M[0]]=M[1];E=typeof a.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);y=Kn}if(u){const M={},T=[];for(let B=0;B<a.stops.length;B++){const V=a.stops[B],$=V[0].zoom;void 0===M[$]&&(M[$]={zoom:$,type:a.type,property:a.property,default:a.default,stops:[]},T.push($)),M[$].stops.push([V[0].value,V[1]])}const k=[];for(const B of T)k.push([M[B].zoom,xa(M[B],r)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Nr.interpolationFactor.bind(void 0,R),zoomStops:k.map(B=>B[0]),evaluate:({zoom:B},V)=>is({stops:k,base:a.base},r,B).evaluate(B,V)}}if(h){const M="exponential"===g?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Nr.interpolationFactor.bind(void 0,M),zoomStops:a.stops.map(T=>T[0]),evaluate:({zoom:T})=>y(a,r,T,x,E)}}return{kind:"source",evaluate(M,T){const k=T&&T.properties?T.properties[a.property]:void 0;return void 0===k?$i(a.default,r.default):y(a,r,k,x,E)}}}function $i(a,r,l){return void 0!==a?a:void 0!==r?r:void 0!==l?l:void 0}function Xc(a,r,l,u,h){return $i(typeof l===h?u[l]:void 0,a.default,r.default)}function zl(a,r,l){if("number"!==hn(l))return $i(a.default,r.default);const u=a.stops.length;if(1===u||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[u-1][0])return a.stops[u-1][1];const h=Zu(a.stops.map(g=>g[0]),l);return a.stops[h][1]}function is(a,r,l){const u=void 0!==a.base?a.base:1;if("number"!==hn(l))return $i(a.default,r.default);const h=a.stops.length;if(1===h||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[h-1][0])return a.stops[h-1][1];const g=Zu(a.stops.map(T=>T[0]),l),y=function(T,k,R,B){const V=B-R,$=T-R;return 0===V?0:1===k?$/V:(Math.pow(k,$)-1)/(Math.pow(k,V)-1)}(l,u,a.stops[g][0],a.stops[g+1][0]),x=a.stops[g][1],E=a.stops[g+1][1];let M=Ku[r.type]||Yu;if(a.colorSpace&&"rgb"!==a.colorSpace){const T=sh[a.colorSpace];M=(k,R)=>T.reverse(T.interpolate(T.forward(k),T.forward(R),y))}return"function"==typeof x.evaluate?{evaluate(...T){const k=x.evaluate.apply(void 0,T),R=E.evaluate.apply(void 0,T);if(void 0!==k&&void 0!==R)return M(k,R,y)}}:M(x,E,y)}function Kn(a,r,l){return"color"===r.type?l=ot.parse(l):"formatted"===r.type?l=Pi.fromString(l.toString()):"resolvedImage"===r.type?l=bs.fromString(l.toString()):hn(l)===r.type||"enum"===r.type&&r.values[l]||(l=void 0),$i(l,a.default,r.default)}ri.register(qt,{error:[{kind:"error"},[Mt],(a,[r])=>{throw new ii(r.evaluate(a))}],typeof:[Mt,[Ht],(a,[r])=>ni(Mi(r.evaluate(a)))],"to-rgba":[Pr(Qe,4),[jn],(a,[r])=>r.evaluate(a).toArray()],rgb:[jn,[Qe,Qe,Qe],Qn],rgba:[jn,[Qe,Qe,Qe,Qe],Qn],has:{type:Ft,overloads:[[[Mt],(a,[r])=>Vr(r.evaluate(a),a.properties())],[[Mt,ma],(a,[r,l])=>Vr(r.evaluate(a),l.evaluate(a))]]},get:{type:Ht,overloads:[[[Mt],(a,[r])=>Ro(r.evaluate(a),a.properties())],[[Mt,ma],(a,[r,l])=>Ro(r.evaluate(a),l.evaluate(a))]]},"feature-state":[Ht,[Mt],(a,[r])=>Ro(r.evaluate(a),a.featureState||{})],properties:[ma,[],a=>a.properties()],"geometry-type":[Mt,[],a=>a.geometryType()],id:[Ht,[],a=>a.id()],zoom:[Qe,[],a=>a.globals.zoom],pitch:[Qe,[],a=>a.globals.pitch||0],"distance-from-center":[Qe,[],a=>a.distanceFromCenter()],"heatmap-density":[Qe,[],a=>a.globals.heatmapDensity||0],"line-progress":[Qe,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[Qe,[],a=>a.globals.skyRadialProgress||0],accumulated:[Ht,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[Qe,si(Qe),(a,r)=>{let l=0;for(const u of r)l+=u.evaluate(a);return l}],"*":[Qe,si(Qe),(a,r)=>{let l=1;for(const u of r)l*=u.evaluate(a);return l}],"-":{type:Qe,overloads:[[[Qe,Qe],(a,[r,l])=>r.evaluate(a)-l.evaluate(a)],[[Qe],(a,[r])=>-r.evaluate(a)]]},"/":[Qe,[Qe,Qe],(a,[r,l])=>r.evaluate(a)/l.evaluate(a)],"%":[Qe,[Qe,Qe],(a,[r,l])=>r.evaluate(a)%l.evaluate(a)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(a,[r,l])=>Math.pow(r.evaluate(a),l.evaluate(a))],sqrt:[Qe,[Qe],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[Qe,[Qe],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[Qe,[Qe],(a,[r])=>Math.log(r.evaluate(a))],log2:[Qe,[Qe],(a,[r])=>Math.log(r.evaluate(a))/Math.LN2],sin:[Qe,[Qe],(a,[r])=>Math.sin(r.evaluate(a))],cos:[Qe,[Qe],(a,[r])=>Math.cos(r.evaluate(a))],tan:[Qe,[Qe],(a,[r])=>Math.tan(r.evaluate(a))],asin:[Qe,[Qe],(a,[r])=>Math.asin(r.evaluate(a))],acos:[Qe,[Qe],(a,[r])=>Math.acos(r.evaluate(a))],atan:[Qe,[Qe],(a,[r])=>Math.atan(r.evaluate(a))],min:[Qe,si(Qe),(a,r)=>Math.min(...r.map(l=>l.evaluate(a)))],max:[Qe,si(Qe),(a,r)=>Math.max(...r.map(l=>l.evaluate(a)))],abs:[Qe,[Qe],(a,[r])=>Math.abs(r.evaluate(a))],round:[Qe,[Qe],(a,[r])=>{const l=r.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[Qe,[Qe],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[Qe,[Qe],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[Ft,[Mt,Ht],(a,[r,l])=>a.properties()[r.value]===l.value],"filter-id-==":[Ft,[Ht],(a,[r])=>a.id()===r.value],"filter-type-==":[Ft,[Mt],(a,[r])=>a.geometryType()===r.value],"filter-<":[Ft,[Mt,Ht],(a,[r,l])=>{const u=a.properties()[r.value],h=l.value;return typeof u==typeof h&&u<h}],"filter-id-<":[Ft,[Ht],(a,[r])=>{const l=a.id(),u=r.value;return typeof l==typeof u&&l<u}],"filter->":[Ft,[Mt,Ht],(a,[r,l])=>{const u=a.properties()[r.value],h=l.value;return typeof u==typeof h&&u>h}],"filter-id->":[Ft,[Ht],(a,[r])=>{const l=a.id(),u=r.value;return typeof l==typeof u&&l>u}],"filter-<=":[Ft,[Mt,Ht],(a,[r,l])=>{const u=a.properties()[r.value],h=l.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[Ft,[Ht],(a,[r])=>{const l=a.id(),u=r.value;return typeof l==typeof u&&l<=u}],"filter->=":[Ft,[Mt,Ht],(a,[r,l])=>{const u=a.properties()[r.value],h=l.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[Ft,[Ht],(a,[r])=>{const l=a.id(),u=r.value;return typeof l==typeof u&&l>=u}],"filter-has":[Ft,[Ht],(a,[r])=>r.value in a.properties()],"filter-has-id":[Ft,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Ft,[Pr(Mt)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[Ft,[Pr(Ht)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[Ft,[Mt,Pr(Ht)],(a,[r,l])=>l.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[Ft,[Mt,Pr(Ht)],(a,[r,l])=>function(u,h,g,y){for(;g<=y;){const x=g+y>>1;if(h[x]===u)return!0;h[x]>u?y=x-1:g=x+1}return!1}(a.properties()[r.value],l.value,0,l.value.length-1)],all:{type:Ft,overloads:[[[Ft,Ft],(a,[r,l])=>r.evaluate(a)&&l.evaluate(a)],[si(Ft),(a,r)=>{for(const l of r)if(!l.evaluate(a))return!1;return!0}]]},any:{type:Ft,overloads:[[[Ft,Ft],(a,[r,l])=>r.evaluate(a)||l.evaluate(a)],[si(Ft),(a,r)=>{for(const l of r)if(l.evaluate(a))return!0;return!1}]]},"!":[Ft,[Ft],(a,[r])=>!r.evaluate(a)],"is-supported-script":[Ft,[Mt],(a,[r])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(r.evaluate(a))}],upcase:[Mt,[Mt],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[Mt,[Mt],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[Mt,si(Ht),(a,r)=>r.map(l=>Io(l.evaluate(a))).join("")],"resolved-locale":[Mt,[Mn],(a,[r])=>r.evaluate(a).resolvedLocale()]});class Qu{constructor(r,l){var u;this.expression=r,this._warningHistory={},this._evaluator=new Sm,this._defaultValue=l?"color"===(u=l).type&&Cs(u.default)?new ot(0,0,0,0):"color"===u.type?ot.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(r,l,u,h,g,y,x,E){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(r,l,u,h,g,y,x,E){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{const M=this.expression.evaluate(this._evaluator);if(null==M||"number"==typeof M&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new ii(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,"undefined"!=typeof console&&console.warn(M.message)),this._defaultValue}}}function Vl(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in qt}function jr(a,r){const l=new vr(qt,[],r?function(h){const g={color:jn,string:Mt,number:Qe,enum:Mt,boolean:Ft,formatted:ga,resolvedImage:Wt};return"array"===h.type?Pr(g[h.value]||Ht,h.length):g[h.type]}(r):void 0),u=l.parse(a,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return u?Po(new Qu(u,r)):Xn(l.errors)}class rs{constructor(r,l){this.kind=r,this._styleExpression=l,this.isStateDependent="constant"!==r&&!ws(l.expression)}evaluateWithoutErrorHandling(r,l,u,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,l,u,h,g,y)}evaluate(r,l,u,h,g,y){return this._styleExpression.evaluate(r,l,u,h,g,y)}}class Kc{constructor(r,l,u,h){this.kind=r,this.zoomStops=u,this._styleExpression=l,this.isStateDependent="camera"!==r&&!ws(l.expression),this.interpolationType=h}evaluateWithoutErrorHandling(r,l,u,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,l,u,h,g,y)}evaluate(r,l,u,h,g,y){return this._styleExpression.evaluate(r,l,u,h,g,y)}interpolationFactor(r,l,u){return this.interpolationType?Nr.interpolationFactor(this.interpolationType,r,l,u):0}}function Yc(a,r){if("error"===(a=jr(a,r)).result)return a;const l=a.value.expression,u=Lr(l);if(!u&&!po(r))return Xn([new xn("","data expressions not supported")]);const h=Ll(l,["zoom","pitch","distance-from-center"]);if(!h&&!il(r))return Xn([new xn("","zoom expressions not supported")]);const g=Ur(l);return g||h?g instanceof xn?Xn([g]):g instanceof Nr&&!Zt(r)?Xn([new xn("",'"interpolate" expressions cannot be used with this property')]):Po(g?new Kc(u?"camera":"composite",a.value,g.labels,g instanceof Nr?g.interpolation:void 0):new rs(u?"constant":"source",a.value)):Xn([new xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rl{constructor(r,l){this._parameters=r,this._specification=l,vn(this,xa(this._parameters,this._specification))}static deserialize(r){return new rl(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Ur(a){let r=null;if(a instanceof Kt)r=Ur(a.result);else if(a instanceof Nl){for(const l of a.args)if(r=Ur(l),r)break}else(a instanceof Xu||a instanceof Nr)&&a.input instanceof ri&&"zoom"===a.input.name&&(r=a);return r instanceof xn||a.eachChild(l=>{const u=Ur(l);u instanceof xn?r=u:!r&&u?r=new xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&u&&r!==u&&(r=new xn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class et{constructor(r,l,u,h){this.message=(r?`${r}: `:"")+u,h&&(this.identifier=h),null!=l&&l.__line__&&(this.line=l.__line__)}}function $s(a){const r=a.key,l=a.value,u=a.valueSpec||{},h=a.objectElementValidators||{},g=a.style,y=a.styleSpec;let x=[];const E=hn(l);if("object"!==E)return[new et(r,l,`object expected, ${E} found`)];for(const M in l){const T=M.split(".")[0],k=u[T]||u["*"];let R;h[T]?R=h[T]:u[T]?R=Nn:h["*"]?R=h["*"]:u["*"]&&(R=Nn),R?x=x.concat(R({key:(r&&`${r}.`)+M,value:l[M],valueSpec:k,style:g,styleSpec:y,object:l,objectKey:M},l)):x.push(new et(r,l[M],`unknown property "${M}"`))}for(const M in u)h[M]||u[M].required&&void 0===u[M].default&&void 0===l[M]&&x.push(new et(r,l,`missing required property "${M}"`));return x}function Qc(a){const r=a.value,l=a.valueSpec,u=a.style,h=a.styleSpec,g=a.key,y=a.arrayElementValidator||Nn;if("array"!==hn(r))return[new et(g,r,`array expected, ${hn(r)} found`)];if(l.length&&r.length!==l.length)return[new et(g,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new et(g,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let x={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};h.$version<7&&(x.function=l.function),"object"===hn(l.value)&&(x=l.value);let E=[];for(let M=0;M<r.length;M++)E=E.concat(y({array:r,arrayIndex:M,value:r[M],valueSpec:x,style:u,styleSpec:h,key:`${g}[${M}]`}));return E}function Wf(a){const r=a.key,l=a.value,u=a.valueSpec;let h=hn(l);if("number"===h&&l!=l&&(h="NaN"),"number"!==h)return[new et(r,l,`number expected, ${h} found`)];if("minimum"in u){let g=u.minimum;if("array"===hn(u.minimum)&&(g=u.minimum[a.arrayIndex]),l<g)return[new et(r,l,`${l} is less than the minimum value ${g}`)]}if("maximum"in u){let g=u.maximum;if("array"===hn(u.maximum)&&(g=u.maximum[a.arrayIndex]),l>g)return[new et(r,l,`${l} is greater than the maximum value ${g}`)]}return[]}function km(a){const r=a.valueSpec,l=lt(a.value.type);let u,h,g,y={};const x="categorical"!==l&&void 0===a.value.property,E=!x,M="array"===hn(a.value.stops)&&"array"===hn(a.value.stops[0])&&"object"===hn(a.value.stops[0][0]),T=$s({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(B){if("identity"===l)return[new et(B.key,B.value,'identity function may not have a "stops" property')];let V=[];const $=B.value;return V=V.concat(Qc({key:B.key,value:$,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:k})),"array"===hn($)&&0===$.length&&V.push(new et(B.key,$,"array must have at least one stop")),V},default:function(B){return Nn({key:B.key,value:B.value,valueSpec:r,style:B.style,styleSpec:B.styleSpec})}}});return"identity"===l&&x&&T.push(new et(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||T.push(new et(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!Zt(a.valueSpec)&&T.push(new et(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(E&&!po(a.valueSpec)?T.push(new et(a.key,a.value,"property functions not supported")):x&&!il(a.valueSpec)&&T.push(new et(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!M||void 0!==a.value.property||T.push(new et(a.key,a.value,'"property" property is required')),T;function k(B){let V=[];const $=B.value,W=B.key;if("array"!==hn($))return[new et(W,$,`array expected, ${hn($)} found`)];if(2!==$.length)return[new et(W,$,`array length 2 expected, length ${$.length} found`)];if(M){if("object"!==hn($[0]))return[new et(W,$,`object expected, ${hn($[0])} found`)];if(void 0===$[0].zoom)return[new et(W,$,"object stop key must have zoom")];if(void 0===$[0].value)return[new et(W,$,"object stop key must have value")];const Q=lt($[0].zoom);if("number"!=typeof Q)return[new et(W,$[0].zoom,"stop zoom values must be numbers")];if(g&&g>Q)return[new et(W,$[0].zoom,"stop zoom values must appear in ascending order")];Q!==g&&(g=Q,h=void 0,y={}),V=V.concat($s({key:`${W}[0]`,value:$[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Wf,value:R}}))}else V=V.concat(R({key:`${W}[0]`,value:$[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},$));return Vl(gn($[1]))?V.concat([new et(`${W}[1]`,$[1],"expressions are not allowed in function stops.")]):V.concat(Nn({key:`${W}[1]`,value:$[1],valueSpec:r,style:B.style,styleSpec:B.styleSpec}))}function R(B,V){const $=hn(B.value),W=lt(B.value),Q=null!==B.value?B.value:V;if(u){if($!==u)return[new et(B.key,Q,`${$} stop domain type must match previous stop domain type ${u}`)]}else u=$;if("number"!==$&&"string"!==$&&"boolean"!==$&&"number"!=typeof W&&"string"!=typeof W&&"boolean"!=typeof W)return[new et(B.key,Q,"stop domain value must be a number, string, or boolean")];if("number"!==$&&"categorical"!==l){let le=`number expected, ${$} found`;return po(r)&&void 0===l&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new et(B.key,Q,le)]}return"categorical"!==l||"number"!==$||"number"==typeof W&&isFinite(W)&&Math.floor(W)===W?"categorical"!==l&&"number"===$&&"number"==typeof W&&"number"==typeof h&&void 0!==h&&W<h?[new et(B.key,Q,"stop domain values must appear in ascending order")]:(h=W,"categorical"===l&&W in y?[new et(B.key,Q,"stop domain values must be unique")]:(y[W]=!0,[])):[new et(B.key,Q,`integer expected, found ${String(W)}`)]}}function Jc(a){const r=("property"===a.expressionContext?Yc:jr)(gn(a.value),a.valueSpec);if("error"===r.result)return r.value.map(u=>new et(`${a.key}${u.key}`,a.value,u.message));const l=r.value.expression||r.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new et(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!ws(l))return[new et(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return ba(l,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!Ll(l,["zoom","feature-state"]))return[new et(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!Lr(l))return[new et(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ba(a,r){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const h of r.valueSpec.expression.parameters)l.delete(h);if(0===l.size)return[];const u=[];return a instanceof ri&&l.has(a.name)?[new et(r.key,r.value,`["${a.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(a.eachChild(h=>{u.push(...ba(h,r))}),u)}function Ju(a){const r=a.key,l=a.value,u=a.valueSpec,h=[];return Array.isArray(u.values)?-1===u.values.indexOf(lt(l))&&h.push(new et(r,l,`expected one of [${u.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(u.values).indexOf(lt(l))&&h.push(new et(r,l,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(l)} found`)),h}function sl(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!sl(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function ol(a,r="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};sl(a)||(a=ed(a));const l=a;let u=!0;try{u=function(M){if(!al(M))return M;let T=gn(M);return Fm(T),T=Zf(T),T}(l)}catch(M){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const h=we[`filter_${r}`],g=jr(u,h);let y=null;if("error"===g.result)throw new Error(g.value.map(M=>`${M.key}: ${M.message}`).join(", "));y=(M,T,k)=>g.value.evaluate(M,T,{},k);let x=null,E=null;if(u!==l){const M=jr(l,h);if("error"===M.result)throw new Error(M.value.map(T=>`${T.key}: ${T.message}`).join(", "));x=(T,k,R,B,V)=>M.value.evaluate(T,k,{},R,void 0,void 0,B,V),E=!Lr(M.value.expression)}return y=y,{filter:y,dynamicFilter:x||void 0,needGeometry:lh(u),needFeature:!!E}}function Zf(a){if(!Array.isArray(a))return a;const r=function(l){if(Rm.has(l[0]))for(let u=1;u<l.length;u++)if(al(l[u]))return!0;return l}(a);return!0===r?r:r.map(l=>Zf(l))}function Fm(a){let r=!1;const l=[];if("case"===a[0]){for(let u=1;u<a.length-1;u+=2)r=r||al(a[u]),l.push(a[u+1]);l.push(a[a.length-1])}else if("match"===a[0]){r=r||al(a[1]);for(let u=2;u<a.length-1;u+=2)l.push(a[u+1]);l.push(a[a.length-1])}else if("step"===a[0]){r=r||al(a[1]);for(let u=1;u<a.length-1;u+=2)l.push(a[u+1])}r&&(a.length=0,a.push("any",...l));for(let u=1;u<a.length;u++)Fm(a[u])}function al(a){if(!Array.isArray(a))return!1;if("pitch"===(r=a[0])||"distance-from-center"===r)return!0;var r;for(let l=1;l<a.length;l++)if(al(a[l]))return!0;return!1}const Rm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Xf(a,r){return a<r?-1:a>r?1:0}function lh(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let r=1;r<a.length;r++)if(lh(a[r]))return!0;return!1}function ed(a){if(!a)return!0;const r=a[0];return a.length<=1?"any"!==r:"=="===r?td(a[1],a[2],"=="):"!="===r?id(td(a[1],a[2],"==")):"<"===r||">"===r||"<="===r||">="===r?td(a[1],a[2],r):"any"===r?(l=a.slice(1),["any"].concat(l.map(ed))):"all"===r?["all"].concat(a.slice(1).map(ed)):"none"===r?["all"].concat(a.slice(1).map(ed).map(id)):"in"===r?nd(a[1],a.slice(2)):"!in"===r?id(nd(a[1],a.slice(2))):"has"===r?eu(a[1]):"!has"===r?id(eu(a[1])):"within"!==r||a;var l}function td(a,r,l){switch(a){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,a,r]}}function nd(a,r){if(0===r.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(l=>typeof l!=typeof r[0])?["filter-in-large",a,["literal",r.sort(Xf)]]:["filter-in-small",a,["literal",r]]}}function eu(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function id(a){return["!",a]}function ll(a){return sl(gn(a.value))?Jc(vn({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):Kf(a)}function Kf(a){const r=a.value,l=a.key;if("array"!==hn(r))return[new et(l,r,`array expected, ${hn(r)} found`)];const u=a.styleSpec;let h,g=[];if(r.length<1)return[new et(l,r,"filter array must have at least 1 element")];switch(g=g.concat(Ju({key:`${l}[0]`,value:r[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),lt(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===lt(r[1])&&g.push(new et(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&g.push(new et(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(h=hn(r[1]),"string"!==h&&g.push(new et(`${l}[1]`,r[1],`string expected, ${h} found`)));for(let y=2;y<r.length;y++)h=hn(r[y]),"$type"===lt(r[1])?g=g.concat(Ju({key:`${l}[${y}]`,value:r[y],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&g.push(new et(`${l}[${y}]`,r[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<r.length;y++)g=g.concat(Kf({key:`${l}[${y}]`,value:r[y],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":h=hn(r[1]),2!==r.length?g.push(new et(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==h&&g.push(new et(`${l}[1]`,r[1],`string expected, ${h} found`));break;case"within":h=hn(r[1]),2!==r.length?g.push(new et(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==h&&g.push(new et(`${l}[1]`,r[1],`object expected, ${h} found`))}return g}function Oo(a,r){const l=a.key,u=a.style,h=a.styleSpec,g=a.value,y=a.objectKey,x=h[`${r}_${a.layerType}`];if(!x)return[];const E=y.match(/^(.*)-transition$/);if("paint"===r&&E&&x[E[1]]&&x[E[1]].transition)return Nn({key:l,value:g,valueSpec:h.transition,style:u,styleSpec:h});const M=a.valueSpec||x[y];if(!M)return[new et(l,g,`unknown property "${y}"`)];let T;if("string"===hn(g)&&po(M)&&!M.tokens&&(T=/^{([^}]+)}$/.exec(g)))return[new et(l,g,`"${y}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];const k=[];return"symbol"===a.layerType&&("text-field"===y&&u&&!u.glyphs&&k.push(new et(l,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&Cs(gn(g))&&"identity"===lt(g.type)&&k.push(new et(l,g,'"text-font" does not support identity functions'))),k.concat(Nn({key:a.key,value:g,valueSpec:M,style:u,styleSpec:h,expressionContext:"property",propertyType:r,propertyKey:y}))}function rd(a){return Oo(a,"paint")}function Li(a){return Oo(a,"layout")}function ch(a){let r=[];const l=a.value,u=a.key,h=a.style,g=a.styleSpec;l.type||l.ref||r.push(new et(u,l,'either "type" or "ref" is required'));let y=lt(l.type);const x=lt(l.ref);if(l.id){const E=lt(l.id);for(let M=0;M<a.arrayIndex;M++){const T=h.layers[M];lt(T.id)===E&&r.push(new et(u,l.id,`duplicate layer id "${l.id}", previously used at line ${T.id.__line__}`))}}if("ref"in l){let E;["type","source","source-layer","filter","layout"].forEach(M=>{M in l&&r.push(new et(u,l[M],`"${M}" is prohibited for ref layers`))}),h.layers.forEach(M=>{lt(M.id)===x&&(E=M)}),E?E.ref?r.push(new et(u,l.ref,"ref cannot reference another ref layer")):y=lt(E.type):"string"==typeof x&&r.push(new et(u,l.ref,`ref layer "${x}" not found`))}else if("background"!==y&&"sky"!==y)if(l.source){const E=h.sources&&h.sources[l.source],M=E&&lt(E.type);E?"vector"===M&&"raster"===y?r.push(new et(u,l.source,`layer "${l.id}" requires a raster source`)):"raster"===M&&"raster"!==y?r.push(new et(u,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==M||l["source-layer"]?"raster-dem"===M&&"hillshade"!==y?r.push(new et(u,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!l.paint||!l.paint["line-gradient"]||"geojson"===M&&E.lineMetrics||r.push(new et(u,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new et(u,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new et(u,l.source,`source "${l.source}" not found`))}else r.push(new et(u,l,'missing required property "source"'));return r=r.concat($s({key:u,value:l,valueSpec:g.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Nn({key:`${u}.type`,value:l.type,valueSpec:g.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:E=>ll(vn({layerType:y},E)),layout:E=>$s({layer:l,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":M=>Li(vn({layerType:y},M))}}),paint:E=>$s({layer:l,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":M=>rd(vn({layerType:y},M))}})}})),r}function Lo(a){const r=a.value,l=a.key,u=hn(r);return"string"!==u?[new et(l,r,`string expected, ${u} found`)]:[]}const Yf={promoteId:function({key:a,value:r}){if("string"===hn(r))return Lo({key:a,value:r});{const l=[];for(const u in r)l.push(...Lo({key:`${a}.${u}`,value:r[u]}));return l}}};function uh(a){const r=a.value,l=a.key,u=a.styleSpec,h=a.style;if(!r.type)return[new et(l,r,'"type" is required')];const g=lt(r.type);let y;switch(g){case"vector":case"raster":case"raster-dem":return y=$s({key:l,value:r,valueSpec:u[`source_${g.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:Yf}),y;case"geojson":if(y=$s({key:l,value:r,valueSpec:u.source_geojson,style:h,styleSpec:u,objectElementValidators:Yf}),r.cluster)for(const x in r.clusterProperties){const[E,M]=r.clusterProperties[x],T="string"==typeof E?[E,["accumulated"],["get",x]]:E;y.push(...Jc({key:`${l}.${x}.map`,value:M,expressionContext:"cluster-map"})),y.push(...Jc({key:`${l}.${x}.reduce`,value:T,expressionContext:"cluster-reduce"}))}return y;case"video":return $s({key:l,value:r,valueSpec:u.source_video,style:h,styleSpec:u});case"image":return $s({key:l,value:r,valueSpec:u.source_image,style:h,styleSpec:u});case"canvas":return[new et(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ju({key:`${l}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:u})}}function dh(a){const r=a.value,l=a.styleSpec,u=l.light,h=a.style;let g=[];const y=hn(r);if(void 0===r)return g;if("object"!==y)return g=g.concat([new et("light",r,`object expected, ${y} found`)]),g;for(const x in r){const E=x.match(/^(.*)-transition$/);g=g.concat(E&&u[E[1]]&&u[E[1]].transition?Nn({key:x,value:r[x],valueSpec:l.transition,style:h,styleSpec:l}):u[x]?Nn({key:x,value:r[x],valueSpec:u[x],style:h,styleSpec:l}):[new et(x,r[x],`unknown property "${x}"`)])}return g}function Qf(a){const r=a.value,l=a.key,u=a.style,h=a.styleSpec,g=h.terrain;let y=[];const x=hn(r);if(void 0===r)return y;if("object"!==x)return y=y.concat([new et("terrain",r,`object expected, ${x} found`)]),y;for(const E in r){const M=E.match(/^(.*)-transition$/);y=y.concat(M&&g[M[1]]&&g[M[1]].transition?Nn({key:E,value:r[E],valueSpec:h.transition,style:u,styleSpec:h}):g[E]?Nn({key:E,value:r[E],valueSpec:g[E],style:u,styleSpec:h}):[new et(E,r[E],`unknown property "${E}"`)])}if(r.source){const E=u.sources&&u.sources[r.source],M=E&&lt(E.type);E?"raster-dem"!==M&&y.push(new et(l,r.source,`terrain cannot be used with a source of type ${String(M)}, it only be used with a "raster-dem" source type`)):y.push(new et(l,r.source,`source "${r.source}" not found`))}else y.push(new et(l,r,'terrain is missing required property "source"'));return y}function sd(a){const r=a.value,l=a.style,u=a.styleSpec,h=u.fog;let g=[];const y=hn(r);if(void 0===r)return g;if("object"!==y)return g=g.concat([new et("fog",r,`object expected, ${y} found`)]),g;for(const x in r){const E=x.match(/^(.*)-transition$/);g=g.concat(E&&h[E[1]]&&h[E[1]].transition?Nn({key:x,value:r[x],valueSpec:u.transition,style:l,styleSpec:u}):h[x]?Nn({key:x,value:r[x],valueSpec:h[x],style:l,styleSpec:u}):[new et(x,r[x],`unknown property "${x}"`)])}return g}const tu={"*":()=>[],array:Qc,boolean:function(a){const r=a.value,l=a.key,u=hn(r);return"boolean"!==u?[new et(l,r,`boolean expected, ${u} found`)]:[]},number:Wf,color:function(a){const r=a.key,l=a.value,u=hn(l);return"string"!==u?[new et(r,l,`color expected, ${u} found`)]:null===Nc.parseCSSColor(l)?[new et(r,l,`color expected, "${l}" found`)]:[]},enum:Ju,filter:ll,function:km,layer:ch,object:$s,source:uh,light:dh,terrain:Qf,fog:sd,string:Lo,formatted:function(a){return 0===Lo(a).length?[]:Jc(a)},resolvedImage:function(a){return 0===Lo(a).length?[]:Jc(a)},projection:function(a){const r=a.value,l=a.styleSpec,u=l.projection,h=a.style;let g=[];const y=hn(r);if("object"===y)for(const x in r)g=g.concat(Nn({key:x,value:r[x],valueSpec:u[x],style:h,styleSpec:l}));else"string"!==y&&(g=g.concat([new et("projection",r,`object or string expected, ${y} found`)]));return g}};function Nn(a){const r=a.value,l=a.valueSpec,u=a.styleSpec;return l.expression&&Cs(lt(r))?km(a):l.expression&&Vl(gn(r))?Jc(a):l.type&&tu[l.type]?tu[l.type](a):$s(vn({},a,{valueSpec:l.type?u[l.type]:l}))}function Gr(a){const r=a.value,l=a.key,u=Lo(a);return u.length||(-1===r.indexOf("{fontstack}")&&u.push(new et(l,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&u.push(new et(l,r,'"glyphs" url must include a "{range}" token'))),u}function jl(a,r=we){return Hs(Nn({key:"",value:a,valueSpec:r.$root,styleSpec:r,style:a,objectElementValidators:{glyphs:Gr,"*":()=>[]}}))}const hh=a=>Hs(rd(a)),Pm=a=>Hs(Li(a));function Hs(a){return a.slice().sort((r,l)=>r.line&&l.line?r.line-l.line:0)}function Om(a,r){let l=!1;if(r&&r.length)for(const u of r)a.fire(new _t(new Error(u.message))),l=!0;return l}var Gn=qs;function qs(a,r,l){var u=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var h=new Int32Array(this.arrayBuffer);a=h[0],this.d=(r=h[1])+2*(l=h[2]);for(var g=0;g<this.d*this.d;g++){var y=h[3+g],x=h[3+g+1];u.push(y===x?null:h.subarray(y,x))}var E=h[3+u.length+1];this.keys=h.subarray(h[3+u.length],E),this.bboxes=h.subarray(E),this.insert=this._insertReadonly}else{this.d=r+2*l;for(var M=0;M<this.d*this.d;M++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=a,this.padding=l,this.scale=r/a,this.uid=0;var T=l/r*a;this.min=-T,this.max=a+T}qs.prototype.insert=function(a,r,l,u,h){this._forEachCell(r,l,u,h,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(h)},qs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},qs.prototype._insertCell=function(a,r,l,u,h,g){this.cells[h].push(g)},qs.prototype.query=function(a,r,l,u,h){var g=this.min,y=this.max;if(a<=g&&r<=g&&y<=l&&y<=u&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(a,r,l,u,this._queryCell,x,{},h),x},qs.prototype._queryCell=function(a,r,l,u,h,g,y,x){var E=this.cells[h];if(null!==E)for(var M=this.keys,T=this.bboxes,k=0;k<E.length;k++){var R=E[k];if(void 0===y[R]){var B=4*R;(x?x(T[B+0],T[B+1],T[B+2],T[B+3]):a<=T[B+2]&&r<=T[B+3]&&l>=T[B+0]&&u>=T[B+1])?(y[R]=!0,g.push(M[R])):y[R]=!1}}},qs.prototype._forEachCell=function(a,r,l,u,h,g,y,x){for(var E=this._convertToCellCoord(a),M=this._convertToCellCoord(r),T=this._convertToCellCoord(l),k=this._convertToCellCoord(u),R=E;R<=T;R++)for(var B=M;B<=k;B++){var V=this.d*B+R;if((!x||x(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&h.call(this,a,r,l,u,V,g,y,x))return}},qs.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},qs.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},qs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,r=3+this.cells.length+1+1,l=0,u=0;u<this.cells.length;u++)l+=this.cells[u].length;var h=new Int32Array(r+l+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var g=r,y=0;y<a.length;y++){var x=a[y];h[3+y]=g,h.set(x,g),g+=x.length}return h[3+a.length]=g,h.set(this.keys,g),h[3+a.length+1]=g+=this.keys.length,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer};const Ul={};function We(a,r,l={}){Object.defineProperty(a,"_classRegistryKey",{value:r,writeable:!1}),Ul[r]={klass:a,omit:l.omit||[]}}We(Object,"Object"),Gn.serialize=function(a,r){const l=a.toArrayBuffer();return r&&r.push(l),{buffer:l}},Gn.deserialize=function(a){return new Gn(a.buffer)},Object.defineProperty(Gn,"name",{value:"Grid"}),We(Gn,"Grid"),We(ot,"Color"),We(Error,"Error"),We(N,"AJAXError"),We(bs,"ResolvedImage"),We(rl,"StylePropertyFunction"),We(Qu,"StyleExpression",{omit:["_evaluator"]}),We(Kc,"ZoomDependentExpression"),We(rs,"ZoomConstantExpression"),We(ri,"CompoundExpression",{omit:["_evaluate"]});for(const a in qt)Ul[qt[a]._classRegistryKey]||We(qt[a],`Expression${a}`);function Jf(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function fh(a){return gt.ImageBitmap&&a instanceof gt.ImageBitmap}function wa(a,r){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Jf(a)||fh(a))return r&&r.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return r&&r.push(l.buffer),l}if(a instanceof gt.ImageData)return r&&r.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const u of a)l.push(wa(u,r));return l}if("object"==typeof a){const l=a.constructor,u=l._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const h=l.serialize?l.serialize(a,r):{};if(!l.serialize){for(const g in a)a.hasOwnProperty(g)&&(Ul[u].omit.indexOf(g)>=0||(h[g]=wa(a[g],r)));a instanceof Error&&(h.message=a.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof a)}function tr(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Jf(a)||fh(a)||ArrayBuffer.isView(a)||a instanceof gt.ImageData)return a;if(Array.isArray(a))return a.map(tr);if("object"==typeof a){const r=a.$name||"Object",{klass:l}=Ul[r];if(!l)throw new Error(`can't deserialize unregistered class ${r}`);if(l.deserialize)return l.deserialize(a);const u=Object.create(l.prototype);for(const h of Object.keys(a))"$name"!==h&&(u[h]=tr(a[h]));return u}throw new Error("can't deserialize object of type "+typeof a)}class ph{constructor(){this.first=!0}update(r,l){const u=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=l),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=u,!0))}}const od=a=>a>=1536&&a<=1791,Bo=a=>a>=1872&&a<=1919,nr=a=>a>=2208&&a<=2303,ad=a=>a>=11904&&a<=12031,ld=a=>a>=12032&&a<=12255,mh=a=>a>=12272&&a<=12287,Ws=a=>a>=12288&&a<=12351,Gl=a=>a>=12352&&a<=12447,$l=a=>a>=12448&&a<=12543,zt=a=>a>=12544&&a<=12591,Lm=a=>a>=12704&&a<=12735,ep=a=>a>=12736&&a<=12783,gh=a=>a>=12784&&a<=12799,tp=a=>a>=12800&&a<=13055,_h=a=>a>=13056&&a<=13311,np=a=>a>=13312&&a<=19903,yh=a=>a>=19968&&a<=40959,$e=a=>a>=40960&&a<=42127,bn=a=>a>=42128&&a<=42191,No=a=>a>=44032&&a<=55215,mi=a=>a>=63744&&a<=64255,cd=a=>a>=64336&&a<=65023,Hl=a=>a>=65040&&a<=65055,xr=a=>a>=65072&&a<=65103,ud=a=>a>=65104&&a<=65135,ql=a=>a>=65136&&a<=65279,ip=a=>a>=65280&&a<=65519;function dd(a){for(const r of a)if(Hi(r.charCodeAt(0)))return!0;return!1}function nu(a){for(const r of a)if(!iu(r.charCodeAt(0)))return!1;return!0}function iu(a){return!(od(a)||Bo(a)||nr(a)||cd(a)||ql(a))}function Hi(a){return!(746!==a&&747!==a&&(a<4352||!(Lm(a)||zt(a)||xr(a)&&!(a>=65097&&a<=65103)||mi(a)||_h(a)||ad(a)||ep(a)||!(!Ws(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||np(a)||yh(a)||tp(a)||(r=a,r>=12592&&r<=12687)||(r=>r>=43360&&r<=43391)(a)||(r=>r>=55216&&r<=55295)(a)||(r=>r>=4352&&r<=4607)(a)||No(a)||Gl(a)||mh(a)||(r=>r>=12688&&r<=12703)(a)||ld(a)||gh(a)||$l(a)&&12540!==a||!(!ip(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!ud(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(r=>r>=5120&&r<=5759)(a)||(r=>r>=6320&&r<=6399)(a)||Hl(a)||(r=>r>=19904&&r<=19967)(a)||$e(a)||bn(a))));var r}function Es(a){return!(Hi(a)||(r=a,(l=r)>=128&&l<=255&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||(l=>l>=8192&&l<=8303)(r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||(l=>l>=8448&&l<=8527)(r)||(l=>l>=8528&&l<=8591)(r)||(l=>l>=8960&&l<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||(l=>l>=9216&&l<=9279)(r)&&9251!==r||(l=>l>=9280&&l<=9311)(r)||(l=>l>=9312&&l<=9471)(r)||(l=>l>=9632&&l<=9727)(r)||(l=>l>=9728&&l<=9983)(r)&&!(r>=9754&&r<=9759)||(l=>l>=11008&&l<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Ws(r)||$l(r)||(l=>l>=57344&&l<=63743)(r)||xr(r)||ud(r)||ip(r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r,l}function ru(a){return a>=1424&&a<=2303||cd(a)||ql(a)}function Wl(a,r){return!(!r&&ru(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(l=a,l>=6016&&l<=6143));var l}function zo(a){for(const r of a)if(ru(r.charCodeAt(0)))return!0;return!1}const vh="deferred",Zl="loading",xh="loaded";let bh=null,dr="unavailable",br=null;const Xl=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(dr="error"),bh&&bh(a)};function Vo(){wh.fire(new pt("pluginStateChange",{pluginStatus:dr,pluginURL:br}))}const wh=new Et,su=function(){return dr},jo=function(){if(dr!==vh||!br)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");dr=Zl,Vo(),br&&re({url:br},a=>{a?Xl(a):(dr=xh,Vo())})},ss={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>dr===xh||null!=ss.applyArabicShaping,isLoading:()=>dr===Zl,setState(a){dr=a.pluginStatus,br=a.pluginURL},isParsed:()=>null!=ss.applyArabicShaping&&null!=ss.processBidirectionalText&&null!=ss.processStyledBidirectionalText,getPluginURL:()=>br};class $n{constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ph,this.transition={},this.pitch=0)}isSupportedScript(r){return function(l,u){for(const h of l)if(!Wl(h.charCodeAt(0),u))return!1;return!0}(r,ss.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,l=r-Math.floor(r),u=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*l}}}class Kl{constructor(r,l){this.property=r,this.value=l,this.expression=function(u,h){if(Cs(u))return new rl(u,h);if(Vl(u)){const g=Yc(u,h);if("error"===g.result)throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=u;return"string"==typeof u&&"color"===h.type&&(g=ot.parse(u)),{kind:"constant",evaluate:()=>g}}}(void 0===l?r.specification.default:l,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,l,u){return this.property.possiblyEvaluate(this,r,l,u)}}class cl{constructor(r){this.property=r,this.value=new Kl(r,void 0)}transitioned(r,l){return new o(this.property,this.value,l,bi({},r.transition,this.transition),r.now)}untransitioned(){return new o(this.property,this.value,null,{},0)}}class m{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return _s(this._values[r].value.value)}setValue(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new cl(this._values[r].property)),this._values[r].value=new Kl(this._values[r].property,null===l?void 0:_s(l))}getTransition(r){return _s(this._values[r].transition)}setTransition(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new cl(this._values[r].property)),this._values[r].transition=_s(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(r[l]=u);const h=this.getTransition(l);void 0!==h&&(r[`${l}-transition`]=h)}return r}transitioned(r,l){const u=new d(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(r,l._values[h]);return u}untransitioned(){const r=new d(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class o{constructor(r,l,u,h,g){const y=h.delay||0,x=h.duration||0;g=g||0,this.property=r,this.value=l,this.begin=g+y,this.end=this.begin+x,r.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(r,l,u){const h=r.now||0,g=this.value.possiblyEvaluate(r,l,u),y=this.prior;if(y){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return y.possiblyEvaluate(r,l,u);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(r,l,u),g,Mo(x))}}return g}}class d{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,u){const h=new w(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(r,l,u);return h}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class _{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return _s(this._values[r].value)}setValue(r,l){this._values[r]=new Kl(this._values[r].property,null===l?void 0:_s(l))}serialize(){const r={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(r[l]=u)}return r}possiblyEvaluate(r,l,u){const h=new w(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(r,l,u);return h}}class b{constructor(r,l,u){this.property=r,this.value=l,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,l,u,h){return this.property.evaluate(this.value,this.parameters,r,l,u,h)}}class w{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class D{constructor(r){this.specification=r}possiblyEvaluate(r,l){return r.expression.evaluate(l)}interpolate(r,l,u){const h=Ku[this.specification.type];return h?h(r,l,u):r}}class A{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,u,h){return new b(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(l,null,{},u,h)}:r.expression,l)}interpolate(r,l,u){if("constant"!==r.value.kind||"constant"!==l.value.kind)return r;if(void 0===r.value.value||void 0===l.value.value)return new b(this,{kind:"constant",value:void 0},r.parameters);const h=Ku[this.specification.type];return h?new b(this,{kind:"constant",value:h(r.value.value,l.value.value,u)},r.parameters):r}evaluate(r,l,u,h,g,y){return"constant"===r.kind?r.value:r.evaluate(l,u,h,g,y)}}class F extends A{possiblyEvaluate(r,l,u,h){if(void 0===r.value)return new b(this,{kind:"constant",value:void 0},l);if("constant"===r.expression.kind){const g=r.expression.evaluate(l,null,{},u,h),y="resolvedImage"===r.property.specification.type&&"string"!=typeof g?g.name:g,x=this._calculate(y,y,y,l);return new b(this,{kind:"constant",value:x},l)}if("camera"===r.expression.kind){const g=this._calculate(r.expression.evaluate({zoom:l.zoom-1}),r.expression.evaluate({zoom:l.zoom}),r.expression.evaluate({zoom:l.zoom+1}),l);return new b(this,{kind:"constant",value:g},l)}return new b(this,r.expression,l)}evaluate(r,l,u,h,g,y){if("source"===r.kind){const x=r.evaluate(l,u,h,g,y);return this._calculate(x,x,x,l)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(l.zoom)-1},u,h),r.evaluate({zoom:Math.floor(l.zoom)},u,h),r.evaluate({zoom:Math.floor(l.zoom)+1},u,h),l):r.value}_calculate(r,l,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:l,other:u}:{from:u,to:l,other:r}}interpolate(r){return r}}class P{constructor(r){this.specification=r}possiblyEvaluate(r,l,u,h){if(void 0!==r.value){if("constant"===r.expression.kind){const g=r.expression.evaluate(l,null,{},u,h);return this._calculate(g,g,g,l)}return this._calculate(r.expression.evaluate(new $n(Math.floor(l.zoom-1),l)),r.expression.evaluate(new $n(Math.floor(l.zoom),l)),r.expression.evaluate(new $n(Math.floor(l.zoom+1),l)),l)}}_calculate(r,l,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:l}:{from:u,to:l}}interpolate(r){return r}}class O{constructor(r){this.specification=r}possiblyEvaluate(r,l,u,h){return!!r.expression.evaluate(l,null,{},u,h)}interpolate(){return!1}}class z{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in r){const u=r[l];u.specification.overridable&&this.overridableProperties.push(l);const h=this.defaultPropertyValues[l]=new Kl(u,void 0),g=this.defaultTransitionablePropertyValues[l]=new cl(u);this.defaultTransitioningPropertyValues[l]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=h.possiblyEvaluate({})}}}function G(a,r){return 256*(a=on(Math.floor(a),0,255))+on(Math.floor(r),0,255)}We(A,"DataDrivenProperty"),We(D,"DataConstantProperty"),We(F,"CrossFadedDataDrivenProperty"),We(P,"CrossFadedProperty"),We(O,"ColorRampProperty");const Z={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class H{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class U{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&(r.isTransferred=!0,l.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ie(a,r=1){let l=0,u=0;return{members:a.map(h=>{const g=Z[h.type].BYTES_PER_ELEMENT,y=l=Y(l,Math.max(r,g)),x=h.components||1;return u=Math.max(u,g),l+=g*x,{name:h.name,type:h.type,components:x,offset:y}}),size:Y(l,Math.max(u,r)),alignment:r}}function Y(a,r){return Math.ceil(a/r)*r}class te extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const u=this.length;return this.resize(u+1),this.emplace(u,r,l)}emplace(r,l,u){const h=2*r;return this.int16[h+0]=l,this.int16[h+1]=u,r}}te.prototype.bytesPerElement=4,We(te,"StructArrayLayout2i4");class ne extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,l,u)}emplace(r,l,u,h){const g=3*r;return this.int16[g+0]=l,this.int16[g+1]=u,this.int16[g+2]=h,r}}ne.prototype.bytesPerElement=6,We(ne,"StructArrayLayout3i6");class oe extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,u,h)}emplace(r,l,u,h,g){const y=4*r;return this.int16[y+0]=l,this.int16[y+1]=u,this.int16[y+2]=h,this.int16[y+3]=g,r}}oe.prototype.bytesPerElement=8,We(oe,"StructArrayLayout4i8");class ee extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,l,u,h,g,y,x)}emplace(r,l,u,h,g,y,x,E){const M=6*r,T=12*r,k=3*r;return this.int16[M+0]=l,this.int16[M+1]=u,this.uint8[T+4]=h,this.uint8[T+5]=g,this.uint8[T+6]=y,this.uint8[T+7]=x,this.float32[k+2]=E,r}}ee.prototype.bytesPerElement=12,We(ee,"StructArrayLayout2i4ub1f12");class ae extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,u,h)}emplace(r,l,u,h,g){const y=4*r;return this.float32[y+0]=l,this.float32[y+1]=u,this.float32[y+2]=h,this.float32[y+3]=g,r}}ae.prototype.bytesPerElement=16,We(ae,"StructArrayLayout4f16");class ve extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,y,x,E,M,T){const k=this.length;return this.resize(k+1),this.emplace(k,r,l,u,h,g,y,x,E,M,T)}emplace(r,l,u,h,g,y,x,E,M,T,k){const R=10*r;return this.uint16[R+0]=l,this.uint16[R+1]=u,this.uint16[R+2]=h,this.uint16[R+3]=g,this.uint16[R+4]=y,this.uint16[R+5]=x,this.uint16[R+6]=E,this.uint16[R+7]=M,this.uint16[R+8]=T,this.uint16[R+9]=k,r}}ve.prototype.bytesPerElement=20,We(ve,"StructArrayLayout10ui20");class Me extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,y,x,E){const M=this.length;return this.resize(M+1),this.emplace(M,r,l,u,h,g,y,x,E)}emplace(r,l,u,h,g,y,x,E,M){const T=8*r;return this.uint16[T+0]=l,this.uint16[T+1]=u,this.uint16[T+2]=h,this.uint16[T+3]=g,this.uint16[T+4]=y,this.uint16[T+5]=x,this.uint16[T+6]=E,this.uint16[T+7]=M,r}}Me.prototype.bytesPerElement=16,We(Me,"StructArrayLayout8ui16");class Fe extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,u,h,g,y)}emplace(r,l,u,h,g,y,x){const E=6*r;return this.int16[E+0]=l,this.int16[E+1]=u,this.int16[E+2]=h,this.int16[E+3]=g,this.int16[E+4]=y,this.int16[E+5]=x,r}}Fe.prototype.bytesPerElement=12,We(Fe,"StructArrayLayout6i12");class Te extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,y,x,E,M,T,k,R,B,V,$,W){const Q=this.length;return this.resize(Q+1),this.emplace(Q,r,l,u,h,g,y,x,E,M,T,k,R,B,V,$,W)}emplace(r,l,u,h,g,y,x,E,M,T,k,R,B,V,$,W,Q){const le=16*r;return this.int16[le+0]=l,this.int16[le+1]=u,this.int16[le+2]=h,this.int16[le+3]=g,this.uint16[le+4]=y,this.uint16[le+5]=x,this.uint16[le+6]=E,this.uint16[le+7]=M,this.int16[le+8]=T,this.int16[le+9]=k,this.int16[le+10]=R,this.int16[le+11]=B,this.int16[le+12]=V,this.int16[le+13]=$,this.int16[le+14]=W,this.int16[le+15]=Q,r}}Te.prototype.bytesPerElement=32,We(Te,"StructArrayLayout4i4ui4i4i32");class Ze extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,l,u)}emplace(r,l,u,h){const g=3*r;return this.float32[g+0]=l,this.float32[g+1]=u,this.float32[g+2]=h,r}}Ze.prototype.bytesPerElement=12,We(Ze,"StructArrayLayout3f12");class ye extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}ye.prototype.bytesPerElement=4,We(ye,"StructArrayLayout1ul4");class He extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,y,x,E,M,T,k,R,B){const V=this.length;return this.resize(V+1),this.emplace(V,r,l,u,h,g,y,x,E,M,T,k,R,B)}emplace(r,l,u,h,g,y,x,E,M,T,k,R,B,V){const $=20*r,W=10*r;return this.int16[$+0]=l,this.int16[$+1]=u,this.int16[$+2]=h,this.int16[$+3]=g,this.int16[$+4]=y,this.float32[W+3]=x,this.float32[W+4]=E,this.float32[W+5]=M,this.float32[W+6]=T,this.int16[$+14]=k,this.uint32[W+8]=R,this.uint16[$+18]=B,this.uint16[$+19]=V,r}}He.prototype.bytesPerElement=40,We(He,"StructArrayLayout5i4f1i1ul2ui40");class Ue extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,l,u,h,g,y,x)}emplace(r,l,u,h,g,y,x,E){const M=8*r;return this.int16[M+0]=l,this.int16[M+1]=u,this.int16[M+2]=h,this.int16[M+4]=g,this.int16[M+5]=y,this.int16[M+6]=x,this.int16[M+7]=E,r}}Ue.prototype.bytesPerElement=16,We(Ue,"StructArrayLayout3i2i2i16");class rt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,l,u,h,g)}emplace(r,l,u,h,g,y){const x=4*r,E=8*r;return this.float32[x+0]=l,this.float32[x+1]=u,this.float32[x+2]=h,this.int16[E+6]=g,this.int16[E+7]=y,r}}rt.prototype.bytesPerElement=16,We(rt,"StructArrayLayout2f1f2i16");class Re extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,u,h)}emplace(r,l,u,h,g){const y=12*r,x=3*r;return this.uint8[y+0]=l,this.uint8[y+1]=u,this.float32[x+1]=h,this.float32[x+2]=g,r}}Re.prototype.bytesPerElement=12,We(Re,"StructArrayLayout2ub2f12");class st extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,l,u)}emplace(r,l,u,h){const g=3*r;return this.uint16[g+0]=l,this.uint16[g+1]=u,this.uint16[g+2]=h,r}}st.prototype.bytesPerElement=6,We(st,"StructArrayLayout3ui6");class ft extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,y,x,E,M,T,k,R,B,V,$,W,Q,le,ce,fe,pe){const ge=this.length;return this.resize(ge+1),this.emplace(ge,r,l,u,h,g,y,x,E,M,T,k,R,B,V,$,W,Q,le,ce,fe,pe)}emplace(r,l,u,h,g,y,x,E,M,T,k,R,B,V,$,W,Q,le,ce,fe,pe,ge){const Se=30*r,Ae=15*r,Oe=60*r;return this.int16[Se+0]=l,this.int16[Se+1]=u,this.int16[Se+2]=h,this.float32[Ae+2]=g,this.float32[Ae+3]=y,this.uint16[Se+8]=x,this.uint16[Se+9]=E,this.uint32[Ae+5]=M,this.uint32[Ae+6]=T,this.uint32[Ae+7]=k,this.uint16[Se+16]=R,this.uint16[Se+17]=B,this.uint16[Se+18]=V,this.float32[Ae+10]=$,this.float32[Ae+11]=W,this.uint8[Oe+48]=Q,this.uint8[Oe+49]=le,this.uint8[Oe+50]=ce,this.uint32[Ae+13]=fe,this.int16[Se+28]=pe,this.uint8[Oe+58]=ge,r}}ft.prototype.bytesPerElement=60,We(ft,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class at extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,y,x,E,M,T,k,R,B,V,$,W,Q,le,ce,fe,pe,ge,Se,Ae,Oe,Ne,De,Pe,Ve,Ye){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,r,l,u,h,g,y,x,E,M,T,k,R,B,V,$,W,Q,le,ce,fe,pe,ge,Se,Ae,Oe,Ne,De,Pe,Ve,Ye)}emplace(r,l,u,h,g,y,x,E,M,T,k,R,B,V,$,W,Q,le,ce,fe,pe,ge,Se,Ae,Oe,Ne,De,Pe,Ve,Ye,Ge){const Xe=38*r,St=19*r;return this.int16[Xe+0]=l,this.int16[Xe+1]=u,this.int16[Xe+2]=h,this.float32[St+2]=g,this.float32[St+3]=y,this.int16[Xe+8]=x,this.int16[Xe+9]=E,this.int16[Xe+10]=M,this.int16[Xe+11]=T,this.int16[Xe+12]=k,this.int16[Xe+13]=R,this.uint16[Xe+14]=B,this.uint16[Xe+15]=V,this.uint16[Xe+16]=$,this.uint16[Xe+17]=W,this.uint16[Xe+18]=Q,this.uint16[Xe+19]=le,this.uint16[Xe+20]=ce,this.uint16[Xe+21]=fe,this.uint16[Xe+22]=pe,this.uint16[Xe+23]=ge,this.uint16[Xe+24]=Se,this.uint16[Xe+25]=Ae,this.uint16[Xe+26]=Oe,this.uint16[Xe+27]=Ne,this.uint16[Xe+28]=De,this.uint32[St+15]=Pe,this.float32[St+16]=Ve,this.float32[St+17]=Ye,this.float32[St+18]=Ge,r}}at.prototype.bytesPerElement=76,We(at,"StructArrayLayout3i2f6i15ui1ul3f76");class nt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}nt.prototype.bytesPerElement=4,We(nt,"StructArrayLayout1f4");class vt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,l,u,h,g,y,x)}emplace(r,l,u,h,g,y,x,E){const M=7*r;return this.float32[M+0]=l,this.float32[M+1]=u,this.float32[M+2]=h,this.float32[M+3]=g,this.float32[M+4]=y,this.float32[M+5]=x,this.float32[M+6]=E,r}}vt.prototype.bytesPerElement=28,We(vt,"StructArrayLayout7f28");class It extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,l,u,h,g)}emplace(r,l,u,h,g,y){const x=5*r;return this.float32[x+0]=l,this.float32[x+1]=u,this.float32[x+2]=h,this.float32[x+3]=g,this.float32[x+4]=y,r}}It.prototype.bytesPerElement=20,We(It,"StructArrayLayout5f20");class yt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,u,h)}emplace(r,l,u,h,g){const y=6*r;return this.uint32[3*r+0]=l,this.uint16[y+2]=u,this.uint16[y+3]=h,this.uint16[y+4]=g,r}}yt.prototype.bytesPerElement=12,We(yt,"StructArrayLayout1ul3ui12");class Dt extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const u=this.length;return this.resize(u+1),this.emplace(u,r,l)}emplace(r,l,u){const h=2*r;return this.uint16[h+0]=l,this.uint16[h+1]=u,r}}Dt.prototype.bytesPerElement=4,We(Dt,"StructArrayLayout2ui4");class rn extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}rn.prototype.bytesPerElement=2,We(rn,"StructArrayLayout1ui2");class oi extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const u=this.length;return this.resize(u+1),this.emplace(u,r,l)}emplace(r,l,u){const h=2*r;return this.float32[h+0]=l,this.float32[h+1]=u,r}}oi.prototype.bytesPerElement=8,We(oi,"StructArrayLayout2f8");class hr extends U{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,h,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,l,u,h,g,y,x)}emplace(r,l,u,h,g,y,x,E){const M=8*r,T=4*r;return this.int16[M+0]=l,this.int16[M+1]=u,this.int16[M+2]=h,this.int16[M+3]=g,this.int16[M+4]=y,this.int16[M+5]=x,this.float32[T+3]=E,r}}hr.prototype.bytesPerElement=16,We(hr,"StructArrayLayout6i1f16");class Si extends H{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Si.prototype.size=12;class wr extends Fe{get(r){return new Si(this,r)}}We(wr,"FillExtrusionExtArray");class os extends H{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}os.prototype.size=40;class Ds extends He{get(r){return new os(this,r)}}We(Ds,"CollisionBoxArray");class Zs extends H{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}Zs.prototype.size=60;class Uo extends ft{get(r){return new Zs(this,r)}}We(Uo,"PlacedSymbolArray");class ai extends H{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ai.prototype.size=76;class di extends at{get(r){return new ai(this,r)}}We(di,"SymbolInstanceArray");class _n extends nt{getoffsetX(r){return this.float32[1*r+0]}}We(_n,"GlyphOffsetArray");class yi extends ne{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}We(yi,"SymbolLineVertexArray");class as extends H{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}as.prototype.size=12;class li extends yt{get(r){return new as(this,r)}}We(li,"FeatureIndexArray");class Cr extends H{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Cr.prototype.size=4;class Go extends Dt{get(r){return new Cr(this,r)}}We(Go,"FillExtrusionCentroidArray");class ls extends H{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}ls.prototype.size=16;class Ca extends hr{get(r){return new ls(this,r)}}We(Ca,"CircleGlobeExtArray");const Ch=ie([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Ea=ie([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var wt=dn(function(a){a.exports=function(r,l){var u,h,g,y,x,E,M,T;for(h=r.length-(u=3&r.length),g=l,x=3432918353,E=461845907,T=0;T<h;)M=255&r.charCodeAt(T)|(255&r.charCodeAt(++T))<<8|(255&r.charCodeAt(++T))<<16|(255&r.charCodeAt(++T))<<24,++T,g=27492+(65535&(y=5*(65535&(g=(g^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*E+(((M>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(M=0,u){case 3:M^=(255&r.charCodeAt(T+2))<<16;case 2:M^=(255&r.charCodeAt(T+1))<<8;case 1:g^=M=(65535&(M=(M=(65535&(M^=255&r.charCodeAt(T)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*E+(((M>>>16)*E&65535)<<16)&4294967295}return g^=r.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),Eh=dn(function(a){a.exports=function(r,l){for(var u,h=r.length,g=l^h,y=0;h>=4;)u=1540483477*(65535&(u=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),h-=4,++y;switch(h){case 3:g^=(255&r.charCodeAt(y+2))<<16;case 2:g^=(255&r.charCodeAt(y+1))<<8;case 1:g=1540483477*(65535&(g^=255&r.charCodeAt(y)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),$r=wt,Da=Eh;$r.murmur3=wt,$r.murmur2=Da;class ul{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,l,u,h){this.ids.push(ou(r)),this.positions.push(l,u,h)}getPositions(r){const l=ou(r);let u=0,h=this.ids.length-1;for(;u<h;){const y=u+h>>1;this.ids[y]>=l?h=y:u=y+1}const g=[];for(;this.ids[u]===l;)g.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return g}static serialize(r,l){const u=new Float64Array(r.ids),h=new Uint32Array(r.positions);return rp(u,h,0,u.length-1),l&&l.push(u.buffer,h.buffer),{ids:u,positions:h}}static deserialize(r){const l=new ul;return l.ids=r.ids,l.positions=r.positions,l.indexed=!0,l}}function ou(a){const r=+a;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:$r(String(a))}function rp(a,r,l,u){for(;l<u;){const h=a[l+u>>1];let g=l-1,y=u+1;for(;;){do{g++}while(a[g]<h);do{y--}while(a[y]>h);if(g>=y)break;hd(a,g,y),hd(r,3*g,3*y),hd(r,3*g+1,3*y+1),hd(r,3*g+2,3*y+2)}y-l<u-y?(rp(a,r,l,y),l=y+1):(rp(a,r,y+1,u),u=y)}}function hd(a,r,l){const u=a[r];a[r]=a[l],a[l]=u}We(ul,"FeaturePositionMap");class Ms{constructor(r,l){this.gl=r.gl,this.location=l}}class Bm extends Ms{constructor(r,l){super(r,l),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class J_ extends Ms{constructor(r,l){super(r,l),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class dt extends Ms{constructor(r,l){super(r,l),this.current=ot.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const b0=new Float32Array(16),zC=new Float32Array(9),VC=new Float32Array(4);function ey(a){return[G(255*a.r,255*a.g),G(255*a.b,255*a.a)]}class sp{constructor(r,l,u){this.value=r,this.uniformNames=l.map(h=>`u_${h}`),this.type=u}setUniform(r,l,u){r.set(u.constantOr(this.value))}getBinding(r,l,u){return"color"===this.type?new dt(r,l):new Bm(r,l)}}class Dh{constructor(r,l){this.uniformNames=l.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,l){this.pixelRatioFrom=l.pixelRatio||1,this.pixelRatioTo=r.pixelRatio||1,this.patternFrom=l.tl.concat(l.br),this.patternTo=r.tl.concat(r.br)}setUniform(r,l,u,h){const g="u_pattern_to"===h||"u_dash_to"===h?this.patternTo:"u_pattern_from"===h||"u_dash_from"===h?this.patternFrom:"u_pixel_ratio_to"===h?this.pixelRatioTo:"u_pixel_ratio_from"===h?this.pixelRatioFrom:null;g&&r.set(g)}getBinding(r,l,u){return"u_pattern_from"===u||"u_pattern_to"===u||"u_dash_from"===u||"u_dash_to"===u?new J_(r,l):new Bm(r,l)}}class Yl{constructor(r,l,u,h){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=l.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(r,l,u,h,g,y){const x=this.paintVertexArray.length,E=this.expression.evaluate(new $n(0),l,{},g,h,y);this.paintVertexArray.resize(r),this._setPaintValue(x,r,E)}updatePaintArray(r,l,u,h,g){const y=this.expression.evaluate({zoom:0},u,h,void 0,g);this._setPaintValue(r,l,y)}_setPaintValue(r,l,u){if("color"===this.type){const h=ey(u);for(let g=r;g<l;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=r;h<l;h++)this.paintVertexArray.emplace(h,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cs{constructor(r,l,u,h,g,y){this.expression=r,this.uniformNames=l.map(x=>`u_${x}_t`),this.type=u,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=l.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(r,l,u,h,g,y){const x=this.expression.evaluate(new $n(this.zoom),l,{},g,h,y),E=this.expression.evaluate(new $n(this.zoom+1),l,{},g,h,y),M=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(M,r,x,E)}updatePaintArray(r,l,u,h,g){const y=this.expression.evaluate({zoom:this.zoom},u,h,void 0,g),x=this.expression.evaluate({zoom:this.zoom+1},u,h,void 0,g);this._setPaintValue(r,l,y,x)}_setPaintValue(r,l,u,h){if("color"===this.type){const g=ey(u),y=ey(h);for(let x=r;x<l;x++)this.paintVertexArray.emplace(x,g[0],g[1],y[0],y[1])}else{for(let g=r;g<l;g++)this.paintVertexArray.emplace(g,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l){const u=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,h=on(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);r.set(h)}getBinding(r,l,u){return new Bm(r,l)}}class au{constructor(r,l,u,h,g,y,x){this.expression=r,this.type=u,this.useIntegerZoom=h,this.zoom=g,this.layerId=x,this.paintVertexAttributes=("array"===u?Ea:Ch).members;for(let E=0;E<l.length;++E);this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(r,l,u){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(h,r,l.patterns&&l.patterns[this.layerId],u)}updatePaintArray(r,l,u,h,g,y){this._setPaintValues(r,l,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(r,l,u,h){if(!h||!u)return;const{min:g,mid:y,max:x}=u,E=h[g],M=h[y],T=h[x];if(E&&M&&T)for(let k=r;k<l;k++)this._setPaintValue(this.zoomInPaintVertexArray,k,M,E),this._setPaintValue(this.zoomOutPaintVertexArray,k,M,T)}_setPaintValue(r,l,u,h){r.emplace(l,u.tl[0],u.tl[1],u.br[0],u.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],u.pixelRatio,h.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class hi{constructor(r,l,u=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const g in r.paint._values){if(!u(g))continue;const y=r.paint.get(g);if(!(y instanceof b&&po(y.property.specification)))continue;const x=jC(g,r.type),E=y.value,M=y.property.specification.type,T=y.property.useIntegerZoom,k=y.property.specification["property-type"],R="cross-faded"===k||"cross-faded-data-driven"===k,B="line-dasharray"===String(g)&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==E.kind||B)if("source"===E.kind||B||R){const V=$o(g,M,"source");this.binders[g]=R?new au(E,x,M,T,l,V,r.id):new Yl(E,x,M,V),h.push(`/a_${g}`)}else{const V=$o(g,M,"composite");this.binders[g]=new cs(E,x,M,T,l,V),h.push(`/z_${g}`)}else this.binders[g]=R?new Dh(E.value,x):new sp(E.value,x,M),h.push(`/u_${g}`)}this.cacheKey=h.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof Yl||l instanceof cs?l.maxValue:0}populatePaintArrays(r,l,u,h,g,y){for(const x in this.binders){const E=this.binders[x];(E instanceof Yl||E instanceof cs||E instanceof au)&&E.populatePaintArray(r,l,u,h,g,y)}}setConstantPatternPositions(r,l){for(const u in this.binders){const h=this.binders[u];h instanceof Dh&&h.setConstantPatternPositions(r,l)}}updatePaintArrays(r,l,u,h,g,y){let x=!1;for(const E in r){const M=l.getPositions(E);for(const T of M){const k=u.feature(T.index);for(const R in this.binders){const B=this.binders[R];if((B instanceof Yl||B instanceof cs||B instanceof au)&&!0===B.expression.isStateDependent){const V=h.paint.get(R);B.expression=V.value,B.updatePaintArray(T.start,T.end,k,r[E],g,y),x=!0}}}}return x}defines(){const r=[];for(const l in this.binders){const u=this.binders[l];(u instanceof sp||u instanceof Dh)&&r.push(...u.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Yl||u instanceof cs||u instanceof au)for(let h=0;h<u.paintVertexAttributes.length;h++)r.push(u.paintVertexAttributes[h].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof sp||u instanceof Dh||u instanceof cs)for(const h of u.uniformNames)r.push(h)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,l){const u=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof sp||g instanceof Dh||g instanceof cs)for(const y of g.uniformNames)if(l[y]){const x=g.getBinding(r,l[y],y);u.push({name:y,property:h,binding:x})}}return u}setUniforms(r,l,u,h){for(const{name:g,property:y,binding:x}of l)this.binders[y].setUniform(x,h,u.get(y),g)}updatePaintBuffers(r){this._buffers=[];for(const l in this.binders){const u=this.binders[l];if(r&&u instanceof au){const h=2===r.fromScale?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(u instanceof Yl||u instanceof cs)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(r){for(const l in this.binders){const u=this.binders[l];(u instanceof Yl||u instanceof cs||u instanceof au)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof Yl||l instanceof cs||l instanceof au)&&l.destroy()}}}class dl{constructor(r,l,u=(()=>!0)){this.programConfigurations={};for(const h of r)this.programConfigurations[h.id]=new hi(h,l,u);this.needsUpload=!1,this._featureMap=new ul,this._bufferOffset=0}populatePaintArrays(r,l,u,h,g,y,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(r,l,h,g,y,x);void 0!==l.id&&this._featureMap.add(l.id,u,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,u,h,g){for(const y of u)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(r,this._featureMap,l,y,h,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const Mh={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function jC(a,r){return Mh[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}const w0={"line-pattern":{source:ve,composite:ve},"fill-pattern":{source:ve,composite:ve},"fill-extrusion-pattern":{source:ve,composite:ve},"line-dasharray":{source:Me,composite:Me}},mo={color:{source:oi,composite:ae},number:{source:nt,composite:oi}};function $o(a,r,l){const u=w0[a];return u&&u[l]||mo[r][l]}We(sp,"ConstantBinder"),We(Dh,"CrossFadedConstantBinder"),We(Yl,"SourceExpressionBinder"),We(au,"CrossFadedCompositeBinder"),We(cs,"CompositeExpressionBinder"),We(hi,"ProgramConfiguration",{omit:["_buffers"]}),We(dl,"ProgramConfigurationSet");const Sh="-transition";class Ss extends Et{constructor(r,l){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new _(l.layout)),l.paint)){this._transitionablePaint=new m(l.paint);for(const u in r.paint)this.setPaintProperty(u,r.paint[u],{validate:!1});for(const u in r.layout)this.setLayoutProperty(u,r.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new w(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l,u={}){null!=l&&this._validate(Pm,`layers.${this.id}.layout.${r}`,r,l,u)||("visibility"!==r?this._unevaluatedLayout.setValue(r,l):this.visibility=l)}getPaintProperty(r){return zs(r,Sh)?this._transitionablePaint.getTransition(r.slice(0,-Sh.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l,u={}){if(null!=l&&this._validate(hh,`layers.${this.id}.paint.${r}`,r,l,u))return!1;if(zs(r,Sh))return this._transitionablePaint.setTransition(r.slice(0,-Sh.length),l||void 0),!1;{const h=this._transitionablePaint._values[r],g="cross-faded-data-driven"===h.property.specification["property-type"],y=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);const E=this._transitionablePaint._values[r].value;return E.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(r,x,E)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,l,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Sc(r,(l,u)=>!(void 0===l||"layout"===u&&!Object.keys(l).length||"paint"===u&&!Object.keys(l).length))}_validate(r,l,u,h,g={}){return(!g||!1!==g.validate)&&Om(this,r.call(jl,{key:l,layerType:this.type,objectKey:u,value:h,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof b&&po(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ol(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Ah=ie([{name:"a_pos",components:2,type:"Int16"}],4),ty=ie([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class gi{constructor(r=[]){this.segments=r}prepareSegment(r,l,u,h){let g=this.segments[this.segments.length-1];return r>gi.MAX_VERTEX_ARRAY_LENGTH&&Rn(`Max vertices per segment is ${gi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!g||g.vertexLength+r>gi.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:l.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==h&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,u,h){return new gi([{vertexOffset:r,primitiveOffset:l,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}gi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,We(gi,"SegmentVector");var Rt=8192;class lu{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Tn?new Tn(r.lng,r.lat):Tn.convert(r),this}setSouthWest(r){return this._sw=r instanceof Tn?new Tn(r.lng,r.lat):Tn.convert(r),this}extend(r){const l=this._sw,u=this._ne;let h,g;if(r instanceof Tn)h=r,g=r;else{if(!(r instanceof lu))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(lu.convert(r)):this.extend(Tn.convert(r)):this;if(h=r._sw,g=r._ne,!h||!g)return this}return l||u?(l.lng=Math.min(h.lng,l.lng),l.lat=Math.min(h.lat,l.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new Tn(h.lng,h.lat),this._ne=new Tn(g.lng,g.lat)),this}getCenter(){return new Tn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Tn(this.getWest(),this.getNorth())}getSouthEast(){return new Tn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:u}=Tn.convert(r);let h=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(r){return!r||r instanceof lu?r:new lu(r)}}const ny=6371008.8;class Tn{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Tn(gs(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,u=this.lat*l,h=r.lat*l,g=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((r.lng-this.lng)*l);return ny*Math.acos(Math.min(g,1))}toBounds(r=0){const l=360*r/40075017,u=l/Math.cos(Math.PI/180*this.lat);return new lu(new Tn(this.lng-u,this.lat-l),new Tn(this.lng+u,this.lat+l))}static convert(r){if(r instanceof Tn)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new Tn(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new Tn(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const As=2*Math.PI*ny;function Th(a){return As*Math.cos(a*Math.PI/180)}function Ma(a){return(180+a)/360}function Ih(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function cu(a,r){return a/Th(r)}function go(a){return 360*a-180}function fr(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function iy(a,r){return a*Th(fr(r))}const Sa=85.051129;class op{constructor(r,l,u=0){this.x=+r,this.y=+l,this.z=+u}static fromLngLat(r,l=0){const u=Tn.convert(r);return new op(Ma(u.lng),Ih(u.lat),cu(l,u.lat))}toLngLat(){return new Tn(go(this.x),fr(this.y))}toAltitude(){return iy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/As*(r=fr(this.y),1/Math.cos(r*Math.PI/180));var r}}function ap(a,r,l,u,h,g,y,x,E){const M=(r+u)/2,T=(l+h)/2,k=new Be(M,T);x(k),function(R,B,V,$,W,Q){const le=V-W,ce=$-Q;return Math.abs(($-B)*le-(V-R)*ce)/Math.hypot(le,ce)}(k.x,k.y,g.x,g.y,y.x,y.y)>=E?(ap(a,r,l,M,T,g,k,x,E),ap(a,M,T,u,h,k,y,x,E)):a.push(y)}function Nm(a,r,l){let u=a[0],h=u.x,g=u.y;r(u);const y=[u];for(let x=1;x<a.length;x++){const E=a[x],{x:M,y:T}=E;r(E),ap(y,h,g,M,T,u,E,r,l),h=M,g=T,u=E}return y}const fd=Math.pow(2,14)-1,C0=-fd-1;function kh(a,r){const l=Math.round(a.x*r),u=Math.round(a.y*r);return a.x=on(l,C0,fd),a.y=on(u,C0,fd),(l<a.x||l>a.x+1||u<a.y||u>a.y+1)&&Rn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Ho(a,r,l){const u=a.loadGeometry(),h=a.extent,g=Rt/h;if(r&&l&&l.projection.isReprojectedInTileSpace){const y=1<<r.z,{scale:x,x:E,y:M,projection:T}=l,k=R=>{const B=go((r.x+R.x/h)/y),V=fr((r.y+R.y/h)/y),$=T.project(B,V);R.x=($.x*x-E)*h,R.y=($.y*x-M)*h};for(let R=0;R<u.length;R++)if(1!==a.type)u[R]=Nm(u[R],k,1);else{const B=[];for(const V of u[R])V.x<0||V.x>=h||V.y<0||V.y>=h||(k(V),B.push(V));u[R]=B}}for(const y of u)for(const x of y)kh(x,g);return u}function Aa(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?Ho(a):[]}}function lp(a,r,l,u,h){a.emplaceBack(2*r+(u+1)/2,2*l+(h+1)/2)}function cp(a,r,l,u){a.emplaceBack(r.x,r.y,r.z,16384*l[0],16384*l[1],16384*l[2],u)}class zm{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new te,this.indexArray=new st,this.segments=new gi,this.programConfigurations=new dl(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,u,h){const g=this.layers[0],y=[];let x=null;"circle"===g.type&&(x=g.layout.get("circle-sort-key"));for(const{feature:M,id:T,index:k,sourceLayerIndex:R}of r){const B=this.layers[0]._featureFilter.needGeometry,V=Aa(M,B);if(!this.layers[0]._featureFilter.filter(new $n(this.zoom),V,u))continue;const $=x?x.evaluate(V,{},u):void 0,W={id:T,properties:M.properties,type:M.type,sourceLayerIndex:R,index:k,geometry:B?V.geometry:Ho(M,u,h),patterns:{},sortKey:$};y.push(W)}x&&y.sort((M,T)=>M.sortKey-T.sortKey);let E=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new Ca,E=h.projection);for(const M of y){const{geometry:T,index:k,sourceLayerIndex:R}=M,B=r[k].feature;this.addFeature(M,T,k,l.availableImages,u,E),l.featureIndex.insert(B,T,k,R,this.index)}}update(r,l,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,u,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ah.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,ty.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,l,u,h,g,y){for(const x of l)for(const E of x){const M=E.x,T=E.y;if(M<0||M>=Rt||T<0||T>=Rt)continue;if(y){const B=y.projectTilePoint(M,T,g),V=y.upVector(g,M,T),$=fr((T/Rt+g.y)/(1<<g.z)),W=y.pixelsPerMeter($,1)/cu(1,$),Q=this.globeExtVertexArray;cp(Q,B,V,W),cp(Q,B,V,W),cp(Q,B,V,W),cp(Q,B,V,W)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),R=k.vertexLength;lp(this.layoutVertexArray,M,T,-1,-1),lp(this.layoutVertexArray,M,T,1,-1),lp(this.layoutVertexArray,M,T,1,1),lp(this.layoutVertexArray,M,T,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+3,R+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},h,g)}}function Vm(a,r){for(let l=0;l<a.length;l++)if(Ta(r,a[l]))return!0;for(let l=0;l<r.length;l++)if(Ta(a,r[l]))return!0;return!!jm(a,r)}function E0(a,r,l){return!!Ta(a,r)||!!up(r,a,l)}function pd(a,r){if(1===a.length)return dp(r,a[0]);for(let l=0;l<r.length;l++){const u=r[l];for(let h=0;h<u.length;h++)if(Ta(a,u[h]))return!0}for(let l=0;l<a.length;l++)if(dp(r,a[l]))return!0;for(let l=0;l<r.length;l++)if(jm(a,r[l]))return!0;return!1}function ry(a,r,l){if(a.length>1){if(jm(a,r))return!0;for(let u=0;u<r.length;u++)if(up(r[u],a,l))return!0}for(let u=0;u<a.length;u++)if(up(a[u],r,l))return!0;return!1}function jm(a,r){if(0===a.length||0===r.length)return!1;for(let l=0;l<a.length-1;l++){const u=a[l],h=a[l+1];for(let g=0;g<r.length-1;g++)if(Ce(u,h,r[g],r[g+1]))return!0}return!1}function Ce(a,r,l,u){return Ji(a,l,u)!==Ji(r,l,u)&&Ji(a,r,l)!==Ji(a,r,u)}function up(a,r,l){const u=l*l;if(1===r.length)return a.distSqr(r[0])<u;for(let h=1;h<r.length;h++)if(md(a,r[h-1],r[h])<u)return!0;return!1}function md(a,r,l){const u=r.distSqr(l);if(0===u)return a.distSqr(r);const h=((a.x-r.x)*(l.x-r.x)+(a.y-r.y)*(l.y-r.y))/u;return a.distSqr(h<0?r:h>1?l:l.sub(r)._mult(h)._add(r))}function dp(a,r){let l,u,h,g=!1;for(let y=0;y<a.length;y++){l=a[y];for(let x=0,E=l.length-1;x<l.length;E=x++)u=l[x],h=l[E],u.y>r.y!=h.y>r.y&&r.x<(h.x-u.x)*(r.y-u.y)/(h.y-u.y)+u.x&&(g=!g)}return g}function Ta(a,r){let l=!1;for(let u=0,h=a.length-1;u<a.length;h=u++){const g=a[u],y=a[h];g.y>r.y!=y.y>r.y&&r.x<(y.x-g.x)*(r.y-g.y)/(y.y-g.y)+g.x&&(l=!l)}return l}function sy(a,r,l,u,h){for(const y of a)if(r<=y.x&&l<=y.y&&u>=y.x&&h>=y.y)return!0;const g=[new Be(r,l),new Be(r,h),new Be(u,h),new Be(u,l)];if(a.length>2)for(const y of g)if(Ta(a,y))return!0;for(let y=0;y<a.length-1;y++)if(D0(a[y],a[y+1],g))return!0;return!1}function D0(a,r,l){const u=l[0],h=l[2];if(a.x<u.x&&r.x<u.x||a.x>h.x&&r.x>h.x||a.y<u.y&&r.y<u.y||a.y>h.y&&r.y>h.y)return!1;const g=Ji(a,r,l[0]);return g!==Ji(a,r,l[1])||g!==Ji(a,r,l[2])||g!==Ji(a,r,l[3])}function gd(a,r,l){const u=r.paint.get(a).value;return"constant"===u.kind?u.value:l.programConfigurations.get(r.id).getMaxValue(a)}function Ql(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Ts(a,r,l,u,h){if(!r[0]&&!r[1])return a;const g=Be.convert(r)._mult(h);"viewport"===l&&g._rotate(-u);const y=[];for(let x=0;x<a.length;x++)y.push(a[x].sub(g));return y}function Um(a,r,l,u){const h=Be.convert(a)._mult(u);return"viewport"===r&&h._rotate(-l),h}We(zm,"CircleBucket",{omit:["layers"]});const uu=new z({"circle-sort-key":new A(we.layout_circle["circle-sort-key"])});var M0={paint:new z({"circle-radius":new A(we.paint_circle["circle-radius"]),"circle-color":new A(we.paint_circle["circle-color"]),"circle-blur":new A(we.paint_circle["circle-blur"]),"circle-opacity":new A(we.paint_circle["circle-opacity"]),"circle-translate":new D(we.paint_circle["circle-translate"]),"circle-translate-anchor":new D(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new D(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new D(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new A(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new A(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new A(we.paint_circle["circle-stroke-opacity"])}),layout:uu},hp=1e-6,Hr="undefined"!=typeof Float32Array?Float32Array:Array;function Fh(){var a=new Hr(9);return Hr!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function qo(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Gm(a,r,l){var u=r[0],h=r[1],g=r[2],y=r[3],x=r[4],E=r[5],M=r[6],T=r[7],k=r[8],R=r[9],B=r[10],V=r[11],$=r[12],W=r[13],Q=r[14],le=r[15],ce=l[0],fe=l[1],pe=l[2],ge=l[3];return a[0]=ce*u+fe*x+pe*k+ge*$,a[1]=ce*h+fe*E+pe*R+ge*W,a[2]=ce*g+fe*M+pe*B+ge*Q,a[3]=ce*y+fe*T+pe*V+ge*le,a[4]=(ce=l[4])*u+(fe=l[5])*x+(pe=l[6])*k+(ge=l[7])*$,a[5]=ce*h+fe*E+pe*R+ge*W,a[6]=ce*g+fe*M+pe*B+ge*Q,a[7]=ce*y+fe*T+pe*V+ge*le,a[8]=(ce=l[8])*u+(fe=l[9])*x+(pe=l[10])*k+(ge=l[11])*$,a[9]=ce*h+fe*E+pe*R+ge*W,a[10]=ce*g+fe*M+pe*B+ge*Q,a[11]=ce*y+fe*T+pe*V+ge*le,a[12]=(ce=l[12])*u+(fe=l[13])*x+(pe=l[14])*k+(ge=l[15])*$,a[13]=ce*h+fe*E+pe*R+ge*W,a[14]=ce*g+fe*M+pe*B+ge*Q,a[15]=ce*y+fe*T+pe*V+ge*le,a}function du(a,r,l){var u,h,g,y,x,E,M,T,k,R,B,V,$=l[0],W=l[1],Q=l[2];return r===a?(a[12]=r[0]*$+r[4]*W+r[8]*Q+r[12],a[13]=r[1]*$+r[5]*W+r[9]*Q+r[13],a[14]=r[2]*$+r[6]*W+r[10]*Q+r[14],a[15]=r[3]*$+r[7]*W+r[11]*Q+r[15]):(h=r[1],g=r[2],y=r[3],x=r[4],E=r[5],M=r[6],T=r[7],k=r[8],R=r[9],B=r[10],V=r[11],a[0]=u=r[0],a[1]=h,a[2]=g,a[3]=y,a[4]=x,a[5]=E,a[6]=M,a[7]=T,a[8]=k,a[9]=R,a[10]=B,a[11]=V,a[12]=u*$+x*W+k*Q+r[12],a[13]=h*$+E*W+R*Q+r[13],a[14]=g*$+M*W+B*Q+r[14],a[15]=y*$+T*W+V*Q+r[15]),a}function Xs(a,r,l){var u=l[0],h=l[1],g=l[2];return a[0]=r[0]*u,a[1]=r[1]*u,a[2]=r[2]*u,a[3]=r[3]*u,a[4]=r[4]*h,a[5]=r[5]*h,a[6]=r[6]*h,a[7]=r[7]*h,a[8]=r[8]*g,a[9]=r[9]*g,a[10]=r[10]*g,a[11]=r[11]*g,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a}function hu(a,r,l){var u=Math.sin(l),h=Math.cos(l),g=r[4],y=r[5],x=r[6],E=r[7],M=r[8],T=r[9],k=r[10],R=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=g*h+M*u,a[5]=y*h+T*u,a[6]=x*h+k*u,a[7]=E*h+R*u,a[8]=M*h-g*u,a[9]=T*h-y*u,a[10]=k*h-x*u,a[11]=R*h-E*u,a}function $m(a,r,l){var u=Math.sin(l),h=Math.cos(l),g=r[0],y=r[1],x=r[2],E=r[3],M=r[8],T=r[9],k=r[10],R=r[11];return r!==a&&(a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=g*h-M*u,a[1]=y*h-T*u,a[2]=x*h-k*u,a[3]=E*h-R*u,a[8]=g*u+M*h,a[9]=y*u+T*h,a[10]=x*u+k*h,a[11]=E*u+R*h,a}Math.hypot||(Math.hypot=function(){for(var a=0,r=arguments.length;r--;)a+=arguments[r]*arguments[r];return Math.sqrt(a)});var UC=Gm;function fp(){var a=new Hr(3);return Hr!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function oy(a){var r=new Hr(3);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r}function S0(a){return Math.hypot(a[0],a[1],a[2])}function Rh(a,r,l){var u=new Hr(3);return u[0]=a,u[1]=r,u[2]=l,u}function ay(a,r,l){return a[0]=r[0]+l[0],a[1]=r[1]+l[1],a[2]=r[2]+l[2],a}function ly(a,r,l){return a[0]=r[0]-l[0],a[1]=r[1]-l[1],a[2]=r[2]-l[2],a}function Ph(a,r,l){return a[0]=r[0]*l[0],a[1]=r[1]*l[1],a[2]=r[2]*l[2],a}function Oh(a,r,l){return a[0]=Math.min(r[0],l[0]),a[1]=Math.min(r[1],l[1]),a[2]=Math.min(r[2],l[2]),a}function Jl(a,r,l){return a[0]=Math.max(r[0],l[0]),a[1]=Math.max(r[1],l[1]),a[2]=Math.max(r[2],l[2]),a}function Lh(a,r,l){return a[0]=r[0]*l,a[1]=r[1]*l,a[2]=r[2]*l,a}function Hm(a,r,l,u){return a[0]=r[0]+l[0]*u,a[1]=r[1]+l[1]*u,a[2]=r[2]+l[2]*u,a}function pp(a,r){var l=r[0],u=r[1],h=r[2],g=l*l+u*u+h*h;return g>0&&(g=1/Math.sqrt(g)),a[0]=r[0]*g,a[1]=r[1]*g,a[2]=r[2]*g,a}function ec(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]}function mp(a,r,l){var u=r[0],h=r[1],g=r[2],y=l[0],x=l[1],E=l[2];return a[0]=h*E-g*x,a[1]=g*y-u*E,a[2]=u*x-h*y,a}function tc(a,r,l){var u=r[0],h=r[1],g=r[2],y=l[3]*u+l[7]*h+l[11]*g+l[15];return a[0]=(l[0]*u+l[4]*h+l[8]*g+l[12])/(y=y||1),a[1]=(l[1]*u+l[5]*h+l[9]*g+l[13])/y,a[2]=(l[2]*u+l[6]*h+l[10]*g+l[14])/y,a}function qm(a,r,l){var u=l[0],h=l[1],g=l[2],y=r[0],x=r[1],E=r[2],M=h*E-g*x,T=g*y-u*E,k=u*x-h*y,R=h*k-g*T,B=g*M-u*k,V=u*T-h*M,$=2*l[3];return T*=$,k*=$,B*=2,V*=2,a[0]=y+(M*=$)+(R*=2),a[1]=x+T+B,a[2]=E+k+V,a}var _d,_o=ly,A0=Ph,T0=S0;function yd(a,r,l){var u=r[0],h=r[1],g=r[2],y=r[3];return a[0]=l[0]*u+l[4]*h+l[8]*g+l[12]*y,a[1]=l[1]*u+l[5]*h+l[9]*g+l[13]*y,a[2]=l[2]*u+l[6]*h+l[10]*g+l[14]*y,a[3]=l[3]*u+l[7]*h+l[11]*g+l[15]*y,a}function cy(){var a=new Hr(4);return Hr!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function uy(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Is(a,r,l){l*=.5;var u=r[0],h=r[1],g=r[2],y=r[3],x=Math.sin(l),E=Math.cos(l);return a[0]=u*E+y*x,a[1]=h*E+g*x,a[2]=g*E-h*x,a[3]=y*E-u*x,a}fp(),_d=new Hr(4),Hr!=Float32Array&&(_d[0]=0,_d[1]=0,_d[2]=0,_d[3]=0),fp(),Rh(1,0,0),Rh(0,1,0),cy(),cy(),Fh();class yo{constructor(r,l){this.points=r,this.planes=l}static fromInvProjectionMatrix(r,l,u,h){const g=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const M=yd([],E,r),T=1/M[3]/l*g;return(k=M)[0]=(R=M)[0]*(B=[T,T,h?1/M[3]:T,T])[0],k[1]=R[1]*B[1],k[2]=R[2]*B[2],k[3]=R[3]*B[3],k;var k,R,B}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const M=pp([],mp([],_o([],y[E[0]],y[E[1]]),_o([],y[E[2]],y[E[1]]))),T=-ec(M,y[E[1]]);return M.concat(T)});return new yo(y,x)}}class ks{constructor(r,l){this.min=r,this.max=l,this.center=Lh([],ay([],this.min,this.max),.5)}quadrant(r){const l=[r%2==0,r<2],u=oy(this.min),h=oy(this.max);for(let g=0;g<l.length;g++)u[g]=l[g]?this.min[g]:this.center[g],h[g]=l[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new ks(u,h)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,l=this.max;return[[r[0],r[1],r[2]],[l[0],r[1],r[2]],[l[0],l[1],r[2]],[r[0],l[1],r[2]],[r[0],r[1],l[2]],[l[0],r[1],l[2]],[l[0],l[1],l[2]],[r[0],l[1],l[2]]]}intersects(r){const l=this.getCorners();let u=!0;for(let h=0;h<r.planes.length;h++){const g=r.planes[h];let y=0;for(let x=0;x<l.length;x++)y+=ec(g,l[x])+g[3]>=0;if(0===y)return 0;y!==l.length&&(u=!1)}if(u)return 2;for(let h=0;h<3;h++){let g=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let x=0;x<r.points.length;x++){const E=r.points[x][h]-this.min[h];g=Math.min(g,E),y=Math.max(y,E)}if(y<0||g>this.max[h]-this.min[h])return 0}return 1}}function dy(a,r,l,u,h,g,y,x,E){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(E*=a.pixelToTileUnitsFactor);for(const M of r)for(const T of M){const k=T.add(x),R=h&&l.elevation?l.elevation.exaggeration()*h.getElevationAt(k.x,k.y,!0):0,B=g?k:I0(k,R,u),V=g?a.tilespaceRays.map(W=>F0(W,R)):a.queryGeometry.screenGeometry,$=yd([],[T.x,T.y,R,1],u);if(!y&&g?E*=$[3]/l.cameraToCenterDistance:y&&!g&&(E*=l.cameraToCenterDistance/$[3]),E0(V,B,E))return!0}return!1}function I0(a,r,l){const u=yd([],[a.x,a.y,r,1],l);return new Be(u[0]/u[3],u[1]/u[3])}const hy=Rh(0,0,0),k0=Rh(0,0,1);function F0(a,r){const l=fp();return hy[2]=r,a.intersectsPlane(hy,k0,l),new Be(l[0],l[1])}class Wm extends zm{}function fy(a,{width:r,height:l},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==r*l*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(r*l*u);return a.width=r,a.height=l,a.data=h,a}function py(a,r,l){const{width:u,height:h}=r;u===a.width&&h===a.height||(Zm(a,r,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,h)},l),a.width=u,a.height=h,a.data=r.data)}function Zm(a,r,l,u,h,g){if(0===h.width||0===h.height)return r;if(h.width>a.width||h.height>a.height||l.x>a.width-h.width||l.y>a.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>r.width||h.height>r.height||u.x>r.width-h.width||u.y>r.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=a.data,x=r.data;for(let E=0;E<h.height;E++){const M=((l.y+E)*a.width+l.x)*g,T=((u.y+E)*r.width+u.x)*g;for(let k=0;k<h.width*g;k++)x[T+k]=y[M+k]}return r}We(Wm,"HeatmapBucket",{omit:["layers"]});class hl{constructor(r,l){fy(this,r,1,l)}resize(r){py(this,new hl(r),1)}clone(){return new hl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,u,h,g){Zm(r,l,u,h,g,1)}}class Ks{constructor(r,l){fy(this,r,4,l)}resize(r){py(this,new Ks(r),4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Ks({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,u,h,g){Zm(r,l,u,h,g,4)}}We(hl,"AlphaImage"),We(Ks,"RGBAImage");var R0={paint:new z({"heatmap-radius":new A(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new A(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new D(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new O(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new D(we.paint_heatmap["heatmap-opacity"])})};function fu(a){const r={},l=a.resolution||256,u=a.clips?a.clips.length:1,h=a.image||new Ks({width:l,height:u}),g=(y,x,E)=>{r[a.evaluationKey]=E;const M=a.expression.evaluate(r);h.data[y+x+0]=Math.floor(255*M.r/M.a),h.data[y+x+1]=Math.floor(255*M.g/M.a),h.data[y+x+2]=Math.floor(255*M.b/M.a),h.data[y+x+3]=Math.floor(255*M.a)};if(a.clips)for(let y=0,x=0;y<u;++y,x+=4*l)for(let E=0,M=0;E<l;E++,M+=4){const T=E/(l-1),{start:k,end:R}=a.clips[y];g(x,M,k*(1-T)+R*T)}else for(let y=0,x=0;y<l;y++,x+=4)g(0,x,y/(l-1));return h}var my={paint:new z({"hillshade-illumination-direction":new D(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new D(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new D(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new D(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new D(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new D(we.paint_hillshade["hillshade-accent-color"])})};const Ia=ie([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bh}=Ia;var Nh=zh,gy=zh;function zh(a,r,l){l=l||2;var u,h,g,y,x,E,M,T=r&&r.length,k=T?r[0]*l:a.length,R=P0(a,0,k,l,!0),B=[];if(!R||R.next===R.prev)return B;if(T&&(R=function($,W,Q,le){var ce,fe,pe,ge=[];for(ce=0,fe=W.length;ce<fe;ce++)(pe=P0($,W[ce]*le,ce<fe-1?W[ce+1]*le:$.length,le,!1))===pe.next&&(pe.steiner=!0),ge.push(L0(pe));for(ge.sort($C),ce=0;ce<ge.length;ce++)Q=pu(Q=_y(ge[ce],Q),Q.next);return Q}(a,r,R,l)),a.length>80*l){u=g=a[0],h=y=a[1];for(var V=l;V<k;V+=l)(x=a[V])<u&&(u=x),(E=a[V+1])<h&&(h=E),x>g&&(g=x),E>y&&(y=E);M=0!==(M=Math.max(g-u,y-h))?1/M:0}return gp(R,B,l,u,h,M),B}function P0(a,r,l,u,h){var g,y;if(h===eg(a,r,l,u)>0)for(g=r;g<l;g+=u)y=Uh(g,a[g],a[g+1],y);else for(g=l-u;g>=r;g-=u)y=Uh(g,a[g],a[g+1],y);return y&&Vh(y,y.next)&&(xd(y),y=y.next),y}function pu(a,r){if(!a)return a;r||(r=a);var l,u=a;do{if(l=!1,u.steiner||!Vh(u,u.next)&&0!==fi(u.prev,u,u.next))u=u.next;else{if(xd(u),(u=r=u.prev)===u.next)break;l=!0}}while(l||u!==r);return r}function gp(a,r,l,u,h,g,y){if(a){!y&&g&&function(T,k,R,B){var V=T;do{null===V.z&&(V.z=Qm(V.x,V.y,k,R,B)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next}while(V!==T);V.prevZ.nextZ=null,V.prevZ=null,function($){var W,Q,le,ce,fe,pe,ge,Se,Ae=1;do{for(Q=$,$=null,fe=null,pe=0;Q;){for(pe++,le=Q,ge=0,W=0;W<Ae&&(ge++,le=le.nextZ);W++);for(Se=Ae;ge>0||Se>0&&le;)0!==ge&&(0===Se||!le||Q.z<=le.z)?(ce=Q,Q=Q.nextZ,ge--):(ce=le,le=le.nextZ,Se--),fe?fe.nextZ=ce:$=ce,ce.prevZ=fe,fe=ce;Q=le}fe.nextZ=null,Ae*=2}while(pe>1)}(V)}(a,u,h,g);for(var x,E,M=a;a.prev!==a.next;)if(x=a.prev,E=a.next,g?Km(a,u,h,g):Xm(a))r.push(x.i/l),r.push(a.i/l),r.push(E.i/l),xd(a),a=E.next,M=E.next;else if((a=E)===M){y?1===y?gp(a=Ym(pu(a),r,l),r,l,u,h,g,2):2===y&&GC(a,r,l,u,h,g):gp(pu(a),r,l,u,h,g,1);break}}}function Xm(a){var r=a.prev,l=a,u=a.next;if(fi(r,l,u)>=0)return!1;for(var h=a.next.next;h!==a.prev;){if(vd(r.x,r.y,l.x,l.y,u.x,u.y,h.x,h.y)&&fi(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function Km(a,r,l,u){var h=a.prev,g=a,y=a.next;if(fi(h,g,y)>=0)return!1;for(var x=h.x>g.x?h.x>y.x?h.x:y.x:g.x>y.x?g.x:y.x,E=h.y>g.y?h.y>y.y?h.y:y.y:g.y>y.y?g.y:y.y,M=Qm(h.x<g.x?h.x<y.x?h.x:y.x:g.x<y.x?g.x:y.x,h.y<g.y?h.y<y.y?h.y:y.y:g.y<y.y?g.y:y.y,r,l,u),T=Qm(x,E,r,l,u),k=a.prevZ,R=a.nextZ;k&&k.z>=M&&R&&R.z<=T;){if(k!==a.prev&&k!==a.next&&vd(h.x,h.y,g.x,g.y,y.x,y.y,k.x,k.y)&&fi(k.prev,k,k.next)>=0||(k=k.prevZ,R!==a.prev&&R!==a.next&&vd(h.x,h.y,g.x,g.y,y.x,y.y,R.x,R.y)&&fi(R.prev,R,R.next)>=0))return!1;R=R.nextZ}for(;k&&k.z>=M;){if(k!==a.prev&&k!==a.next&&vd(h.x,h.y,g.x,g.y,y.x,y.y,k.x,k.y)&&fi(k.prev,k,k.next)>=0)return!1;k=k.prevZ}for(;R&&R.z<=T;){if(R!==a.prev&&R!==a.next&&vd(h.x,h.y,g.x,g.y,y.x,y.y,R.x,R.y)&&fi(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function Ym(a,r,l){var u=a;do{var h=u.prev,g=u.next.next;!Vh(h,g)&&_p(h,u,u.next,g)&&jh(h,g)&&jh(g,h)&&(r.push(h.i/l),r.push(u.i/l),r.push(g.i/l),xd(u),xd(u.next),u=a=g),u=u.next}while(u!==a);return pu(u)}function GC(a,r,l,u,h,g){var y=a;do{for(var x=y.next.next;x!==y.prev;){if(y.i!==x.i&&yy(y,x)){var E=vy(y,x);return y=pu(y,y.next),E=pu(E,E.next),gp(y,r,l,u,h,g),void gp(E,r,l,u,h,g)}x=x.next}y=y.next}while(y!==a)}function $C(a,r){return a.x-r.x}function _y(a,r){var l=function(g,y){var x,E=y,M=g.x,T=g.y,k=-1/0;do{if(T<=E.y&&T>=E.next.y&&E.next.y!==E.y){var R=E.x+(T-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(R<=M&&R>k){if(k=R,R===M){if(T===E.y)return E;if(T===E.next.y)return E.next}x=E.x<E.next.x?E:E.next}}E=E.next}while(E!==y);if(!x)return null;if(M===k)return x;var B,V=x,$=x.x,W=x.y,Q=1/0;E=x;do{M>=E.x&&E.x>=$&&M!==E.x&&vd(T<W?M:k,T,$,W,T<W?k:M,T,E.x,E.y)&&(B=Math.abs(T-E.y)/(M-E.x),jh(E,g)&&(B<Q||B===Q&&(E.x>x.x||E.x===x.x&&O0(x,E)))&&(x=E,Q=B)),E=E.next}while(E!==V);return x}(a,r);if(!l)return r;var u=vy(l,a),h=pu(l,l.next);return pu(u,u.next),r===l?h:r}function O0(a,r){return fi(a.prev,a,r.prev)<0&&fi(r.next,a,a.next)<0}function Qm(a,r,l,u,h){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-l)*h)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-u)*h)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function L0(a){var r=a,l=a;do{(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next}while(r!==a);return l}function vd(a,r,l,u,h,g,y,x){return(h-y)*(r-x)-(a-y)*(g-x)>=0&&(a-y)*(u-x)-(l-y)*(r-x)>=0&&(l-y)*(g-x)-(h-y)*(u-x)>=0}function yy(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(l,u){var h=l;do{if(h.i!==l.i&&h.next.i!==l.i&&h.i!==u.i&&h.next.i!==u.i&&_p(h,h.next,l,u))return!0;h=h.next}while(h!==l);return!1}(a,r)&&(jh(a,r)&&jh(r,a)&&function(l,u){var h=l,g=!1,y=(l.x+u.x)/2,x=(l.y+u.y)/2;do{h.y>x!=h.next.y>x&&h.next.y!==h.y&&y<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next}while(h!==l);return g}(a,r)&&(fi(a.prev,a,r.prev)||fi(a,r.prev,r))||Vh(a,r)&&fi(a.prev,a,a.next)>0&&fi(r.prev,r,r.next)>0)}function fi(a,r,l){return(r.y-a.y)*(l.x-r.x)-(r.x-a.x)*(l.y-r.y)}function Vh(a,r){return a.x===r.x&&a.y===r.y}function _p(a,r,l,u){var h=Sn(fi(a,r,l)),g=Sn(fi(a,r,u)),y=Sn(fi(l,u,a)),x=Sn(fi(l,u,r));return h!==g&&y!==x||!(0!==h||!yp(a,l,r))||!(0!==g||!yp(a,u,r))||!(0!==y||!yp(l,a,u))||!(0!==x||!yp(l,r,u))}function yp(a,r,l){return r.x<=Math.max(a.x,l.x)&&r.x>=Math.min(a.x,l.x)&&r.y<=Math.max(a.y,l.y)&&r.y>=Math.min(a.y,l.y)}function Sn(a){return a>0?1:a<0?-1:0}function jh(a,r){return fi(a.prev,a,a.next)<0?fi(a,r,a.next)>=0&&fi(a,a.prev,r)>=0:fi(a,r,a.prev)<0||fi(a,a.next,r)<0}function vy(a,r){var l=new Jm(a.i,a.x,a.y),u=new Jm(r.i,r.x,r.y),h=a.next,g=r.prev;return a.next=r,r.prev=a,l.next=h,h.prev=l,u.next=l,l.prev=u,g.next=u,u.prev=g,u}function Uh(a,r,l,u){var h=new Jm(a,r,l);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function xd(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Jm(a,r,l){this.i=a,this.x=r,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function eg(a,r,l,u){for(var h=0,g=r,y=l-u;g<l;g+=u)h+=(a[y]-a[g])*(a[g+1]+a[y+1]),y=g;return h}function B0(a,r,l,u,h){xy(a,r,l||0,u||a.length-1,h||HC)}function xy(a,r,l,u,h){for(;u>l;){if(u-l>600){var g=u-l+1,y=r-l+1,x=Math.log(g),E=.5*Math.exp(2*x/3),M=.5*Math.sqrt(x*E*(g-E)/g)*(y-g/2<0?-1:1);xy(a,r,Math.max(l,Math.floor(r-y*E/g+M)),Math.min(u,Math.floor(r+(g-y)*E/g+M)),h)}var T=a[r],k=l,R=u;for(Gh(a,l,r),h(a[u],T)>0&&Gh(a,l,u);k<R;){for(Gh(a,k,R),k++,R--;h(a[k],T)<0;)k++;for(;h(a[R],T)>0;)R--}0===h(a[l],T)?Gh(a,l,R):Gh(a,++R,u),R<=r&&(l=R+1),r<=R&&(u=R-1)}}function Gh(a,r,l){var u=a[r];a[r]=a[l],a[l]=u}function HC(a,r){return a<r?-1:a>r?1:0}function by(a,r){const l=a.length;if(l<=1)return[a];const u=[];let h,g;for(let y=0;y<l;y++){const x=Pn(a[y]);0!==x&&(a[y].area=Math.abs(x),void 0===g&&(g=x<0),g===x<0?(h&&u.push(h),h=[a[y]]):h.push(a[y]))}if(h&&u.push(h),r>1)for(let y=0;y<u.length;y++)u[y].length<=r||(B0(u[y],r,1,u[y].length-1,$h),u[y]=u[y].slice(0,r));return u}function $h(a,r){return r.area-a.area}function Er(a,r,l){const u=l.patternDependencies;let h=!1;for(const g of r){const y=g.paint.get(`${a}-pattern`);y.isConstant()||(h=!0);const x=y.constantOr(null);x&&(h=!0,u[x.to]=!0,u[x.from]=!0)}return h}function Hh(a,r,l,u,h){const g=h.patternDependencies;for(const y of r){const x=y.paint.get(`${a}-pattern`).value;if("constant"!==x.kind){let E=x.evaluate({zoom:u-1},l,{},h.availableImages),M=x.evaluate({zoom:u},l,{},h.availableImages),T=x.evaluate({zoom:u+1},l,{},h.availableImages);E=E&&E.name?E.name:E,M=M&&M.name?M.name:M,T=T&&T.name?T.name:T,g[E]=!0,g[M]=!0,g[T]=!0,l.patterns[y.id]={min:E,mid:M,max:T}}}return l}zh.deviation=function(a,r,l,u){var h=r&&r.length,g=Math.abs(eg(a,0,h?r[0]*l:a.length,l));if(h)for(var y=0,x=r.length;y<x;y++)g-=Math.abs(eg(a,r[y]*l,y<x-1?r[y+1]*l:a.length,l));var E=0;for(y=0;y<u.length;y+=3){var M=u[y]*l,T=u[y+1]*l,k=u[y+2]*l;E+=Math.abs((a[M]-a[k])*(a[T+1]-a[M+1])-(a[M]-a[T])*(a[k+1]-a[M+1]))}return 0===g&&0===E?0:Math.abs((E-g)/g)},zh.flatten=function(a){for(var r=a[0][0].length,l={vertices:[],holes:[],dimensions:r},u=0,h=0;h<a.length;h++){for(var g=0;g<a[h].length;g++)for(var y=0;y<r;y++)l.vertices.push(a[h][g][y]);h>0&&l.holes.push(u+=a[h-1].length)}return l},Nh.default=gy;class qh{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new te,this.indexArray=new st,this.indexArray2=new Dt,this.programConfigurations=new dl(r.layers,r.zoom),this.segments=new gi,this.segments2=new gi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=r.projection}populate(r,l,u,h){this.hasPattern=Er("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:x,id:E,index:M,sourceLayerIndex:T}of r){const k=this.layers[0]._featureFilter.needGeometry,R=Aa(x,k);if(!this.layers[0]._featureFilter.filter(new $n(this.zoom),R,u))continue;const B=g?g.evaluate(R,{},u,l.availableImages):void 0,V={id:E,properties:x.properties,type:x.type,sourceLayerIndex:T,index:M,geometry:k?R.geometry:Ho(x,u,h),patterns:{},sortKey:B};y.push(V)}g&&y.sort((x,E)=>x.sortKey-E.sortKey);for(const x of y){const{geometry:E,index:M,sourceLayerIndex:T}=x;if(this.hasPattern){const k=Hh("fill",this.layers,x,this.zoom,l);this.patternFeatures.push(k)}else this.addFeature(x,E,M,u,{},l.availableImages);l.featureIndex.insert(r[M].feature,E,M,T,this.index)}}update(r,l,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,u,h)}addFeatures(r,l,u,h,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,l,u,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Bh),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,l,u,h,g,y=[]){for(const x of by(l,500)){let E=0;for(const V of x)E+=V.length;const M=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),T=M.vertexLength,k=[],R=[];for(const V of x){if(0===V.length)continue;V!==x[0]&&R.push(k.length/2);const $=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),W=$.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(W+V.length-1,W),k.push(V[0].x),k.push(V[0].y);for(let Q=1;Q<V.length;Q++)this.layoutVertexArray.emplaceBack(V[Q].x,V[Q].y),this.indexArray2.emplaceBack(W+Q-1,W+Q),k.push(V[Q].x),k.push(V[Q].y);$.vertexLength+=V.length,$.primitiveLength+=V.length}const B=Nh(k,R);for(let V=0;V<B.length;V+=3)this.indexArray.emplaceBack(T+B[V],T+B[V+1],T+B[V+2]);M.vertexLength+=E,M.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,y,h)}}We(qh,"FillBucket",{omit:["layers","patternFeatures"]});const wy=new z({"fill-sort-key":new A(we.layout_fill["fill-sort-key"])});var qr={paint:new z({"fill-antialias":new D(we.paint_fill["fill-antialias"]),"fill-opacity":new A(we.paint_fill["fill-opacity"]),"fill-color":new A(we.paint_fill["fill-color"]),"fill-outline-color":new A(we.paint_fill["fill-outline-color"]),"fill-translate":new D(we.paint_fill["fill-translate"]),"fill-translate-anchor":new D(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new F(we.paint_fill["fill-pattern"])}),layout:wy};const Wh=ie([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),tg=ie([{name:"a_centroid_pos",components:2,type:"Uint16"}]),N0=ie([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:z0}=Wh;var ng=bd;function bd(a,r,l,u,h){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=u,this._values=h,a.readFields(Cy,this,r)}function Cy(a,r,l){1==a?r.id=l.readVarint():2==a?function(u,h){for(var g=u.readVarint()+u.pos;u.pos<g;){var y=h._keys[u.readVarint()],x=h._values[u.readVarint()];h.properties[y]=x}}(l,r):3==a?r.type=l.readVarint():4==a&&(r._geometry=l.pos)}function V0(a){for(var r,l,u=0,h=0,g=a.length,y=g-1;h<g;y=h++)u+=((l=a[y]).x-(r=a[h]).x)*(r.y+l.y);return u}bd.types=["Unknown","Point","LineString","Polygon"],bd.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var r,l=a.readVarint()+a.pos,u=1,h=0,g=0,y=0,x=[];a.pos<l;){if(h<=0){var E=a.readVarint();u=7&E,h=E>>3}if(h--,1===u||2===u)g+=a.readSVarint(),y+=a.readSVarint(),1===u&&(r&&x.push(r),r=[]),r.push(new Be(g,y));else{if(7!==u)throw new Error("unknown command "+u);r&&r.push(r[0].clone())}}return r&&x.push(r),x},bd.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var r=a.readVarint()+a.pos,l=1,u=0,h=0,g=0,y=1/0,x=-1/0,E=1/0,M=-1/0;a.pos<r;){if(u<=0){var T=a.readVarint();l=7&T,u=T>>3}if(u--,1===l||2===l)(h+=a.readSVarint())<y&&(y=h),h>x&&(x=h),(g+=a.readSVarint())<E&&(E=g),g>M&&(M=g);else if(7!==l)throw new Error("unknown command "+l)}return[y,E,x,M]},bd.prototype.toGeoJSON=function(a,r,l){var u,h,g=this.extent*Math.pow(2,l),y=this.extent*a,x=this.extent*r,E=this.loadGeometry(),M=bd.types[this.type];function T(B){for(var V=0;V<B.length;V++){var $=B[V];B[V]=[360*($.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+x)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(u=0;u<E.length;u++)k[u]=E[u][0];T(E=k);break;case 2:for(u=0;u<E.length;u++)T(E[u]);break;case 3:for(E=function(B){var V=B.length;if(V<=1)return[B];for(var $,W,Q=[],le=0;le<V;le++){var ce=V0(B[le]);0!==ce&&(void 0===W&&(W=ce<0),W===ce<0?($&&Q.push($),$=[B[le]]):$.push(B[le]))}return $&&Q.push($),Q}(E),u=0;u<E.length;u++)for(h=0;h<E[u].length;h++)T(E[u][h])}1===E.length?E=E[0]:M="Multi"+M;var R={type:"Feature",geometry:{type:M,coordinates:E},properties:this.properties};return"id"in this&&(R.id=this.id),R};var ig=Ey;function Ey(a,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(j0,this,r),this.length=this._features.length}function j0(a,r,l){15===a?r.version=l.readVarint():1===a?r.name=l.readString():5===a?r.extent=l.readVarint():2===a?r._features.push(l.pos):3===a?r._keys.push(l.readString()):4===a&&r._values.push(function(u){for(var h=null,g=u.readVarint()+u.pos;u.pos<g;){var y=u.readVarint()>>3;h=1===y?u.readString():2===y?u.readFloat():3===y?u.readDouble():4===y?u.readVarint64():5===y?u.readVarint():6===y?u.readSVarint():7===y?u.readBoolean():null}return h}(l))}function rg(a,r,l){if(3===a){var u=new ig(l,l.readVarint()+l.pos);u.length&&(r[u.name]=u)}}Ey.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var r=this._pbf.readVarint()+this._pbf.pos;return new ng(this._pbf,r,this.extent,this._keys,this._values)};var mu={VectorTile:function(a,r){this.layers=a.readFields(rg,{},r)},VectorTileFeature:ng,VectorTileLayer:ig};function vp(a,r,l,u){const h=[],g=0===u?(y,x,E,M,T,k)=>{y.push(new Be(k,E+(k-x)/(M-x)*(T-E)))}:(y,x,E,M,T,k)=>{y.push(new Be(x+(k-E)/(T-E)*(M-x),k))};for(const y of a){const x=[];for(const E of y){if(E.length<=2)continue;const M=[];for(let R=0;R<E.length-1;R++){const B=E[R].x,V=E[R].y,$=E[R+1].x,W=E[R+1].y,Q=0===u?B:V,le=0===u?$:W;Q<r?le>r&&g(M,B,V,$,W,r):Q>l?le<l&&g(M,B,V,$,W,l):M.push(E[R]),le<r&&Q>=r&&g(M,B,V,$,W,r),le>l&&Q<=l&&g(M,B,V,$,W,l)}let T=E[E.length-1];const k=0===u?T.x:T.y;k>=r&&k<=l&&M.push(T),M.length&&(T=M[M.length-1],M[0].x===T.x&&M[0].y===T.y||M.push(M[0]),x.push(M))}x.length&&h.push(x)}return h}const sg=mu.VectorTileFeature.types,U0=Math.pow(2,13);function Zh(a,r,l,u,h,g,y,x){a.emplaceBack((r<<1)+y,(l<<1)+g,(Math.floor(u*U0)<<1)+h,Math.round(x))}function Ys(a,r,l){a.emplaceBack(r.x,r.y,r.z,16384*l[0],16384*l[1],16384*l[2])}class Dy{constructor(){this.acc=new Be(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Be(r.x,r.y),this.max=new Be(r.x,r.y))}append(r,l){this.currentPolyCount.edges++,this.acc._add(r);const u=this.min,h=this.max;r.x<u.x?u.x=r.x:r.x>h.x&&(h.x=r.x),r.y<u.y?u.y=r.y:r.y>h.y&&(h.y=r.y),((0===r.x||r.x===Rt)&&r.x===l.x)!=((0===r.y||r.y===Rt)&&r.y===l.y)&&this.processBorderOverlap(r,l),l.x<0!=r.x<0&&this.addBorderIntersection(0,ct(l.y,r.y,(0-l.x)/(r.x-l.x))),l.x>Rt!=r.x>Rt&&this.addBorderIntersection(1,ct(l.y,r.y,(Rt-l.x)/(r.x-l.x))),l.y<0!=r.y<0&&this.addBorderIntersection(2,ct(l.x,r.x,(0-l.y)/(r.y-l.y))),l.y>Rt!=r.y>Rt&&this.addBorderIntersection(3,ct(l.x,r.x,(Rt-l.y)/(r.y-l.y)))}addBorderIntersection(r,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];l<u[0]&&(u[0]=l),l>u[1]&&(u[1]=l)}processBorderOverlap(r,l){if(r.x===l.x){if(r.y===l.y)return;const u=0===r.x?0:1;this.addBorderIntersection(u,l.y),this.addBorderIntersection(u,r.y)}else{const u=0===r.y?2:3;this.addBorderIntersection(u,l.x),this.addBorderIntersection(u,r.x)}}centroid(){const r=this.polyCount.reduce((l,u)=>l+u.edges,0);return 0!==r?this.acc.div(r)._round():new Be(0,0)}span(){return new Be(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,l)=>r+ +(l[0]!==Number.MAX_VALUE),0)}}class Xh{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new oe,this.centroidVertexArray=new Go,this.indexArray=new st,this.programConfigurations=new dl(r.layers,r.zoom),this.segments=new gi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=r.enableTerrain}populate(r,l,u,h){this.features=[],this.hasPattern=Er("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const y=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*y/(y*y+1)/Rt/(1<<g.z)}(u);for(const{feature:g,id:y,index:x,sourceLayerIndex:E}of r){const M=this.layers[0]._featureFilter.needGeometry,T=Aa(g,M);if(!this.layers[0]._featureFilter.filter(new $n(this.zoom),T,u))continue;const k={id:y,sourceLayerIndex:E,index:x,geometry:M?T.geometry:Ho(g,u,h),properties:g.properties,type:g.type,patterns:{}},R=this.layoutVertexArray.length;this.hasPattern?this.features.push(Hh("fill-extrusion",this.layers,k,this.zoom,l)):this.addFeature(k,k.geometry,x,u,{},l.availableImages,h),l.featureIndex.insert(g,k.geometry,x,E,this.index,R)}this.sortBorders()}addFeatures(r,l,u,h,g){for(const y of this.features){const{geometry:x}=y;this.addFeature(y,x,y.index,l,u,h,g)}this.sortBorders()}update(r,l,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,u,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,z0),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,N0.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,tg.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,u,h,g,y,x){const E=[new Be(0,0),new Be(Rt,Rt)],M=x.projection,T="globe"===M.name,k=this.enableTerrain&&!T?new Dy:null;T&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new wr);const R=by(l,500);for(let $=R.length-1;$>=0;$--){const W=R[$];(0===W.length||(B=W[0]).every(Q=>Q.x<=0)||B.every(Q=>Q.x>=Rt)||B.every(Q=>Q.y<=0)||B.every(Q=>Q.y>=Rt))&&R.splice($,1)}var B;let V;if(T){const W=1<<h.z,Q=go(h.x/W),le=go((h.x+1)/W),ce=fr(h.y/W),fe=fr((h.y+1)/W);V=function(pe,ge,Se,Ae,Oe=0,Ne){const De=[];if(!pe.length||!Se||!Ae)return De;const Pe=(At,kt)=>{for(const ht of At)De.push({polygon:ht,bounds:kt})},Ve=Math.ceil(Math.log2(Se)),Ye=Math.ceil(Math.log2(Ae)),Ge=Ve-Ye,Xe=[];for(let At=0;At<Math.abs(Ge);At++)Xe.push(Ge>0?0:1);for(let At=0;At<Math.min(Ve,Ye);At++)Xe.push(0),Xe.push(1);let St=pe;if(St=vp(St,ge[0].y-Oe,ge[1].y+Oe,1),St=vp(St,ge[0].x-Oe,ge[1].x+Oe,0),!St.length)return De;const Yt=[];for(Xe.length?Yt.push({polygons:St,bounds:ge,depth:0}):Pe(St,ge);Yt.length;){const At=Yt.pop(),kt=At.depth,ht=Xe[kt],tt=At.bounds[0],Qt=At.bounds[1],En=0===ht?tt.x:tt.y,zn=0===ht?Qt.x:Qt.y,Yn=Ne?Ne(ht,En,zn):.5*(En+zn),Bi=vp(At.polygons,En-Oe,Yn+Oe,ht),yn=vp(At.polygons,Yn-Oe,zn+Oe,ht);if(Bi.length){const nn=[tt,new Be(0===ht?Yn:Qt.x,1===ht?Yn:Qt.y)];Xe.length>kt+1?Yt.push({polygons:Bi,bounds:nn,depth:kt+1}):Pe(Bi,nn)}if(yn.length){const nn=[new Be(0===ht?Yn:tt.x,1===ht?Yn:tt.y),Qt];Xe.length>kt+1?Yt.push({polygons:yn,bounds:nn,depth:kt+1}):Pe(yn,nn)}}return De}(R,E,Math.ceil((le-Q)/11.25),Math.ceil((ce-fe)/11.25),1,(pe,ge,Se)=>{if(0===pe)return.5*(ge+Se);{const Ae=fr((h.y+ge/Rt)/W);return(Ih(.5*(fr((h.y+Se/Rt)/W)+Ae))*W-h.y)*Rt}})}else{V=[];for(const $ of R)V.push({polygon:$,bounds:E})}for(const $ of V){const W=$.polygon;let Q=0,le=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Se=0;Se<W.length;Se++){const Ae=W[Se];if(0===Ae.length)continue;Q+=Ae.length;let Oe=0;k&&k.startRing(Ae[0]);for(let Ne=0;Ne<Ae.length;Ne++){const De=Ae[Ne];if(Ne>=1){const Pe=Ae[Ne-1];if(!G0(De,Pe,$.bounds)){k&&k.append(De,Pe),le.vertexLength+4>gi.MAX_VERTEX_ARRAY_LENGTH&&(le=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ve=De.sub(Pe)._perp(),Ye=Ve.x/(Math.abs(Ve.x)+Math.abs(Ve.y)),Ge=Ve.y>0?1:0,Xe=Pe.dist(De);Oe+Xe>32768&&(Oe=0),Zh(this.layoutVertexArray,De.x,De.y,Ye,Ge,0,0,Oe),Zh(this.layoutVertexArray,De.x,De.y,Ye,Ge,0,1,Oe),Oe+=Xe,Zh(this.layoutVertexArray,Pe.x,Pe.y,Ye,Ge,0,0,Oe),Zh(this.layoutVertexArray,Pe.x,Pe.y,Ye,Ge,0,1,Oe);const St=le.vertexLength;if(this.indexArray.emplaceBack(St,St+2,St+1),this.indexArray.emplaceBack(St+1,St+2,St+3),le.vertexLength+=4,le.primitiveLength+=2,T){const Yt=this.layoutVertexExtArray,At=M.projectTilePoint(De.x,De.y,h),kt=M.projectTilePoint(Pe.x,Pe.y,h),ht=M.upVector(h,De.x,De.y),tt=M.upVector(h,Pe.x,Pe.y);Ys(Yt,At,ht),Ys(Yt,At,ht),Ys(Yt,kt,tt),Ys(Yt,kt,tt)}}}}}if(le.vertexLength+Q>gi.MAX_VERTEX_ARRAY_LENGTH&&(le=this.segments.prepareSegment(Q,this.layoutVertexArray,this.indexArray)),"Polygon"!==sg[r.type])continue;const ce=[],fe=[],pe=le.vertexLength;for(let Se=0;Se<W.length;Se++){const Ae=W[Se];if(0!==Ae.length){Ae!==W[0]&&fe.push(ce.length/2);for(let Oe=0;Oe<Ae.length;Oe++){const Ne=Ae[Oe];Zh(this.layoutVertexArray,Ne.x,Ne.y,0,0,1,1,0),ce.push(Ne.x),ce.push(Ne.y),k&&k.currentPolyCount.top++,T&&Ys(this.layoutVertexExtArray,M.projectTilePoint(Ne.x,Ne.y,h),M.upVector(h,Ne.x,Ne.y))}}}const ge=Nh(ce,fe);for(let Se=0;Se<ge.length;Se+=3)this.indexArray.emplaceBack(pe+ge[Se],pe+ge[Se+2],pe+ge[Se+1]);le.primitiveLength+=ge.length/3,le.vertexLength+=Q}if(k&&k.polyCount.length>0){if(k.borders){k.vertexArrayOffset=this.centroidVertexArray.length;const $=k.borders,W=this.featuresOnBorder.push(k)-1;for(let Q=0;Q<4;Q++)$[Q][0]!==Number.MAX_VALUE&&this.borders[Q].push(W)}this.encodeCentroid(k.borders?void 0:k.centroid(),k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,y,h)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((l,u)=>this.featuresOnBorder[l].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}encodeCentroid(r,l,u=!0){let h,g;if(r)if(0!==r.y){const x=l.span()._mult(this.tileToMeter);h=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(x.x/10)),g=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else h=Math.ceil(7*(r.x+450)),g=0;else h=0,g=+u;let y=u?this.centroidVertexArray.length:l.vertexArrayOffset;for(const x of l.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let E=0;E<2*x.edges;E++)this.centroidVertexArray.emplace(y++,0,g),this.centroidVertexArray.emplace(y++,h,g);for(let E=0;E<x.top;E++)this.centroidVertexArray.emplace(y++,h,g)}}}function G0(a,r,l){return a.x===r.x&&(a.x<l[0].x||a.x>l[1].x)||a.y===r.y&&(a.y<l[0].y||a.y>l[1].y)}We(Xh,"FillExtrusionBucket",{omit:["layers","features"]}),We(Dy,"PartMetadata");var $0={paint:new z({"fill-extrusion-opacity":new D(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new A(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new D(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new D(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new F(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new A(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new A(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new D(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Kh(a,r){return a.x*r.x+a.y*r.y}function og(a,r){if(1===a.length){let l=0;const u=r[l++];let h;for(;!h||u.equals(h);)if(h=r[l++],!h)return 1/0;for(;l<r.length;l++){const g=r[l],y=a[0],x=h.sub(u),E=g.sub(u),M=y.sub(u),T=Kh(x,x),k=Kh(x,E),R=Kh(E,E),B=Kh(M,x),V=Kh(M,E),$=T*R-k*k,W=(R*B-k*V)/$,Q=(T*V-k*B)/$,le=u.z*(1-W-Q)+h.z*W+g.z*Q;if(isFinite(le))return le}return 1/0}{let l=1/0;for(const u of r)l=Math.min(l,u.z);return l}}function My(a){const r=new Be(a[0],a[1]);return r.z=a[2],r}function H0(a,r,l,u,h,g,y,x){const E=y*h.getElevationAt(a,r,!0,!0),M=0!==g[0],T=M?0===g[1]?y*(g[0]/7-450):y*function(k,R,B){const V=Math.floor(R[0]/8),$=Math.floor(R[1]/8),W=10*(R[0]-8*V),Q=10*(R[1]-8*$),le=k.getElevationAt(V,$,!0,!0),ce=k.getMeterToDEM(B),fe=Math.floor(.5*(W*ce-1)),pe=Math.floor(.5*(Q*ce-1)),ge=k.tileCoordToPixel(V,$),Se=2*fe+1,Ae=2*pe+1,Oe=(Yt=Se,At=Ae,[(Ge=k).getElevationAtPixel(Xe=ge.x-fe,St=ge.y-pe,!0),Ge.getElevationAtPixel(Xe+At,St,!0),Ge.getElevationAtPixel(Xe,St+At,!0),Ge.getElevationAtPixel(Xe+Yt,St+At,!0)]),Ne=Math.abs(Oe[0]-Oe[1]),De=Math.abs(Oe[2]-Oe[3]),Pe=Math.abs(Oe[0]-Oe[2])+Math.abs(Oe[1]-Oe[3]),Ve=Math.min(.25,.5*ce*(Ne+De)/Se),Ye=Math.min(.25,.5*ce*Pe/Ae);var Ge,Xe,St,Yt,At;return le+Math.max(Ve*W,Ye*Q)}(h,g,x):E;return{base:E+(0===l)?-1:l,top:M?Math.max(T+u,E+l+2):E+u}}const q0=ie([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:W0}=q0,Sy=ie([{name:"a_packed",components:3,type:"Float32"}]),{members:Z0}=Sy,X0=mu.VectorTileFeature.types,K0=Math.cos(Math.PI/180*37.5);class fl{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new ee,this.layoutVertexArray2=new Ze,this.indexArray=new st,this.programConfigurations=new dl(r.layers,r.zoom),this.segments=new gi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,u,h){this.hasPattern=Er("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:T,id:k,index:R,sourceLayerIndex:B}of r){const V=this.layers[0]._featureFilter.needGeometry,$=Aa(T,V);if(!this.layers[0]._featureFilter.filter(new $n(this.zoom),$,u))continue;const W=g?g.evaluate($,{},u):void 0,Q={id:k,properties:T.properties,type:T.type,sourceLayerIndex:B,index:R,geometry:V?$.geometry:Ho(T,u,h),patterns:{},sortKey:W};y.push(Q)}g&&y.sort((T,k)=>T.sortKey-k.sortKey);const{lineAtlas:x,featureIndex:E}=l,M=this.addConstantDashes(x);for(const T of y){const{geometry:k,index:R,sourceLayerIndex:B}=T;if(M&&this.addFeatureDashes(T,x),this.hasPattern){const V=Hh("line",this.layers,T,this.zoom,l);this.patternFeatures.push(V)}else this.addFeature(T,k,R,u,x.positions,l.availableImages);E.insert(r[R].feature,k,R,B,this.index)}}addConstantDashes(r){let l=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==g.kind)l=!0;else{const y=g.value,x=h.value;if(!x)continue;r.addDash(x.from,y),r.addDash(x.to,y),x.other&&r.addDash(x.other,y)}}return l}addFeatureDashes(r,l){const u=this.zoom;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,y=h.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===y.kind)continue;let x,E,M,T,k,R;if("constant"===g.kind){const W=g.value;if(!W)continue;x=W.other||W.to,E=W.to,M=W.from}else x=g.evaluate({zoom:u-1},r),E=g.evaluate({zoom:u},r),M=g.evaluate({zoom:u+1},r);"constant"===y.kind?T=k=R=y.value:(T=y.evaluate({zoom:u-1},r),k=y.evaluate({zoom:u},r),R=y.evaluate({zoom:u+1},r)),l.addDash(x,T),l.addDash(E,k),l.addDash(M,R);const B=l.getKey(x,T),V=l.getKey(E,k),$=l.getKey(M,R);r.patterns[h.id]={min:B,mid:V,max:$}}}update(r,l,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,u,h)}addFeatures(r,l,u,h,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,l,u,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Z0)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,W0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,u,h,g,y){const x=this.layers[0].layout,E=x.get("line-join").evaluate(r,{}),M=x.get("line-cap").evaluate(r,{}),T=x.get("line-miter-limit"),k=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const R of l)this.addLine(R,r,E,M,T,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,y,h)}addLine(r,l,u,h,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<r.length-1;Q++)this.totalDistance+=r[Q].dist(r[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===X0[l.type];let E=r.length;for(;E>=2&&r[E-1].equals(r[E-2]);)E--;let M=0;for(;M<E-1&&r[M].equals(r[M+1]);)M++;if(E<(x?3:2))return;"bevel"===u&&(g=1.05);const T=this.overscaling<=16?122880/(512*this.overscaling):0,k=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let R,B,V,$,W;this.e1=this.e2=-1,x&&(R=r[E-2],W=r[M].sub(R)._unit()._perp());for(let Q=M;Q<E;Q++){if(V=Q===E-1?x?r[M+1]:void 0:r[Q+1],V&&r[Q].equals(V))continue;W&&($=W),R&&(B=R),R=r[Q],W=V?V.sub(R)._unit()._perp():$,$=$||W;let le=$.add(W);0===le.x&&0===le.y||le._unit();const ce=$.x*W.x+$.y*W.y,fe=le.x*W.x+le.y*W.y,pe=0!==fe?1/fe:1/0,ge=2*Math.sqrt(2-2*fe),Se=fe<K0&&B&&V,Ae=$.x*W.y-$.y*W.x>0;if(Se&&Q>M){const De=R.dist(B);if(De>2*T){const Pe=R.sub(R.sub(B)._mult(T/De)._round());this.updateDistance(B,Pe),this.addCurrentVertex(Pe,$,0,0,k),B=Pe}}const Oe=B&&V;let Ne=Oe?u:x?"butt":h;if(Oe&&"round"===Ne&&(pe<y?Ne="miter":pe<=2&&(Ne="fakeround")),"miter"===Ne&&pe>g&&(Ne="bevel"),"bevel"===Ne&&(pe>2&&(Ne="flipbevel"),pe<g&&(Ne="miter")),B&&this.updateDistance(B,R),"miter"===Ne)le._mult(pe),this.addCurrentVertex(R,le,0,0,k);else if("flipbevel"===Ne){if(pe>100)le=W.mult(-1);else{const De=pe*$.add(W).mag()/$.sub(W).mag();le._perp()._mult(De*(Ae?-1:1))}this.addCurrentVertex(R,le,0,0,k),this.addCurrentVertex(R,le.mult(-1),0,0,k)}else if("bevel"===Ne||"fakeround"===Ne){const De=-Math.sqrt(pe*pe-1),Pe=Ae?De:0,Ve=Ae?0:De;if(B&&this.addCurrentVertex(R,$,Pe,Ve,k),"fakeround"===Ne){const Ye=Math.round(180*ge/Math.PI/20);for(let Ge=1;Ge<Ye;Ge++){let Xe=Ge/Ye;if(.5!==Xe){const Yt=Xe-.5;Xe+=Xe*Yt*(Xe-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*Yt*Yt+(.848013+ce*(.215638*ce-1.06021)))}const St=W.sub($)._mult(Xe)._add($)._unit()._mult(Ae?-1:1);this.addHalfVertex(R,St.x,St.y,!1,Ae,0,k)}}V&&this.addCurrentVertex(R,W,-Pe,-Ve,k)}else if("butt"===Ne)this.addCurrentVertex(R,le,0,0,k);else if("square"===Ne){const De=B?1:-1;B||this.addCurrentVertex(R,le,De,De,k),this.addCurrentVertex(R,le,0,0,k),B&&this.addCurrentVertex(R,le,De,De,k)}else"round"===Ne&&(B&&(this.addCurrentVertex(R,$,0,0,k),this.addCurrentVertex(R,$,1,1,k,!0)),V&&(this.addCurrentVertex(R,W,-1,-1,k,!0),this.addCurrentVertex(R,W,0,0,k)));if(Se&&Q<E-1){const De=R.dist(V);if(De>2*T){const Pe=R.add(V.sub(R)._mult(T/De)._round());this.updateDistance(R,Pe),this.addCurrentVertex(Pe,W,0,0,k),R=Pe}}}}addCurrentVertex(r,l,u,h,g,y=!1){const x=l.y*h-l.x,E=-l.y-l.x*h;this.addHalfVertex(r,l.x+l.y*u,l.y-l.x*u,y,!1,u,g),this.addHalfVertex(r,x,E,y,!0,-h,g)}addHalfVertex({x:r,y:l},u,h,g,y,x,E){this.layoutVertexArray.emplaceBack((r<<1)+(g?1:0),(l<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const M=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),E.primitiveLength++),y?this.e2=M:this.e1=M}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,l){this.distance+=r.dist(l),this.updateScaledDistance()}}We(fl,"LineBucket",{omit:["layers","patternFeatures"]});const ka=new z({"line-cap":new A(we.layout_line["line-cap"]),"line-join":new A(we.layout_line["line-join"]),"line-miter-limit":new D(we.layout_line["line-miter-limit"]),"line-round-limit":new D(we.layout_line["line-round-limit"]),"line-sort-key":new A(we.layout_line["line-sort-key"])});var Y0={paint:new z({"line-opacity":new A(we.paint_line["line-opacity"]),"line-color":new A(we.paint_line["line-color"]),"line-translate":new D(we.paint_line["line-translate"]),"line-translate-anchor":new D(we.paint_line["line-translate-anchor"]),"line-width":new A(we.paint_line["line-width"]),"line-gap-width":new A(we.paint_line["line-gap-width"]),"line-offset":new A(we.paint_line["line-offset"]),"line-blur":new A(we.paint_line["line-blur"]),"line-dasharray":new F(we.paint_line["line-dasharray"]),"line-pattern":new F(we.paint_line["line-pattern"]),"line-gradient":new O(we.paint_line["line-gradient"])}),layout:ka};const Q0=new class extends A{possiblyEvaluate(a,r){return r=new $n(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(a,r)}evaluate(a,r,l,u){return r=bi({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(a,r,l,u)}}(Y0.paint.properties["line-width"].specification);function ag(a,r){return r>0?r+2*a:a}Q0.useIntegerZoom=!0;const qC=ie([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Qs=ie([{name:"a_projected_pos",components:3,type:"Float32"}],4);ie([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lg=ie([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),cg=ie([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ay=ie([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ty=ie([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ie([{name:"triangle",components:3,type:"Uint16"}]),ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ie([{type:"Float32",name:"offsetX"}]),ie([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Wo=128;function xp(a,r){const{expression:l}=r;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new $n(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:h}=l;let g=0;for(;g<u.length&&u[g]<=a;)g++;g=Math.max(0,g-1);let y=g;for(;y<u.length&&u[y]<a+1;)y++;y=Math.min(u.length-1,y);const x=u[g],E=u[y];return"composite"===l.kind?{kind:"composite",minZoom:x,maxZoom:E,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:E,minSize:l.evaluate(new $n(x)),maxSize:l.evaluate(new $n(E)),interpolationType:h}}}function wd(a,{uSize:r,uSizeT:l},{lowerSize:u,upperSize:h}){return"source"===a.kind?u/Wo:"composite"===a.kind?ct(u/Wo,h/Wo,l):r}function nc(a,r){let l=0,u=0;if("constant"===a.kind)u=a.layoutSize;else if("source"!==a.kind){const{interpolationType:h,minZoom:g,maxZoom:y}=a,x=h?on(Nr.interpolationFactor(h,r,g,y),0,1):0;"camera"===a.kind?u=ct(a.minSize,a.maxSize,x):l=x}return{uSizeT:l,uSize:u}}var Iy=Object.freeze({__proto__:null,getSizeData:xp,evaluateSizeForFeature:wd,evaluateSizeForZoom:nc,SIZE_PACK_FACTOR:Wo});function WC(a,r,l){return a.sections.forEach(u=>{u.text=function(h,g,y){const x=g.layout.get("text-transform").evaluate(y,{});return"uppercase"===x?h=h.toLocaleUpperCase():"lowercase"===x&&(h=h.toLocaleLowerCase()),ss.applyArabicShaping&&(h=ss.applyArabicShaping(h)),h}(u.text,r,l)}),a}const Fa={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function ug(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function ky(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var Fy=function(a,r,l,u,h){var g,y,x=8*h-u-1,E=(1<<x)-1,M=E>>1,T=-7,k=l?h-1:0,R=l?-1:1,B=a[r+k];for(k+=R,g=B&(1<<-T)-1,B>>=-T,T+=x;T>0;g=256*g+a[r+k],k+=R,T-=8);for(y=g&(1<<-T)-1,g>>=-T,T+=u;T>0;y=256*y+a[r+k],k+=R,T-=8);if(0===g)g=1-M;else{if(g===E)return y?NaN:1/0*(B?-1:1);y+=Math.pow(2,u),g-=M}return(B?-1:1)*y*Math.pow(2,g-u)},bp=function(a,r,l,u,h,g){var y,x,E,M=8*g-h-1,T=(1<<M)-1,k=T>>1,R=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,B=u?0:g-1,V=u?1:-1,$=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(x=isNaN(r)?1:0,y=T):(y=Math.floor(Math.log(r)/Math.LN2),r*(E=Math.pow(2,-y))<1&&(y--,E*=2),(r+=y+k>=1?R/E:R*Math.pow(2,1-k))*E>=2&&(y++,E/=2),y+k>=T?(x=0,y=T):y+k>=1?(x=(r*E-1)*Math.pow(2,h),y+=k):(x=r*Math.pow(2,k-1)*Math.pow(2,h),y=0));h>=8;a[l+B]=255&x,B+=V,x/=256,h-=8);for(y=y<<h|x,M+=h;M>0;a[l+B]=255&y,B+=V,y/=256,M-=8);a[l+B-V]|=128*$},Yh=Hn;function Hn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Hn.Varint=0,Hn.Fixed64=1,Hn.Bytes=2,Hn.Fixed32=5;var dg=4294967296,Ry=1/dg,Py="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function pl(a){return a.type===Hn.Bytes?a.readVarint()+a.pos:a.pos+1}function wp(a,r,l){var u=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));l.realloc(u);for(var h=l.pos-1;h>=a;h--)l.buf[h+u]=l.buf[h]}function Oy(a,r){for(var l=0;l<a.length;l++)r.writeVarint(a[l])}function hg(a,r){for(var l=0;l<a.length;l++)r.writeSVarint(a[l])}function J0(a,r){for(var l=0;l<a.length;l++)r.writeFloat(a[l])}function eb(a,r){for(var l=0;l<a.length;l++)r.writeDouble(a[l])}function Ly(a,r){for(var l=0;l<a.length;l++)r.writeBoolean(a[l])}function By(a,r){for(var l=0;l<a.length;l++)r.writeFixed32(a[l])}function _u(a,r){for(var l=0;l<a.length;l++)r.writeSFixed32(a[l])}function Ny(a,r){for(var l=0;l<a.length;l++)r.writeFixed64(a[l])}function zy(a,r){for(var l=0;l<a.length;l++)r.writeSFixed64(a[l])}function Cp(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+16777216*a[r+3]}function ml(a,r,l){a[l]=r,a[l+1]=r>>>8,a[l+2]=r>>>16,a[l+3]=r>>>24}function Vy(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+(a[r+3]<<24)}function jy(a,r,l){r.glyphs=[],1===a&&l.readMessage(Uy,r)}function Uy(a,r,l){if(3===a){const{id:u,bitmap:h,width:g,height:y,left:x,top:E,advance:M}=l.readMessage(Gy,{});r.glyphs.push({id:u,bitmap:new hl({width:g+6,height:y+6},h),metrics:{width:g,height:y,left:x,top:E,advance:M}})}else 4===a?r.ascender=l.readSVarint():5===a&&(r.descender=l.readSVarint())}function Gy(a,r,l){1===a?r.id=l.readVarint():2===a?r.bitmap=l.readBytes():3===a?r.width=l.readVarint():4===a?r.height=l.readVarint():5===a?r.left=l.readSVarint():6===a?r.top=l.readSVarint():7===a&&(r.advance=l.readVarint())}function Qh(a){let r=0,l=0;for(const y of a)r+=y.w*y.h,l=Math.max(l,y.w);a.sort((y,x)=>x.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let h=0,g=0;for(const y of a)for(let x=u.length-1;x>=0;x--){const E=u[x];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,g=Math.max(g,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===E.w&&y.h===E.h){const M=u.pop();x<u.length&&(u[x]=M)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(u.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:h,h:g,fill:r/(h*g)||0}}Hn.prototype={destroy:function(){this.buf=null},readFields:function(a,r,l){for(l=l||this.length;this.pos<l;){var u=this.readVarint(),h=u>>3,g=this.pos;this.type=7&u,a(h,r,this),this.pos===g&&this.skip(u)}return r},readMessage:function(a,r){return this.readFields(a,r,this.readVarint()+this.pos)},readFixed32:function(){var a=Cp(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Vy(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Cp(this.buf,this.pos)+Cp(this.buf,this.pos+4)*dg;return this.pos+=8,a},readSFixed64:function(){var a=Cp(this.buf,this.pos)+Vy(this.buf,this.pos+4)*dg;return this.pos+=8,a},readFloat:function(){var a=Fy(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Fy(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var r,l,u=this.buf;return r=127&(l=u[this.pos++]),l<128?r:(r|=(127&(l=u[this.pos++]))<<7,l<128?r:(r|=(127&(l=u[this.pos++]))<<14,l<128?r:(r|=(127&(l=u[this.pos++]))<<21,l<128?r:function(h,g,y){var x,E,M=y.buf;if(x=(112&(E=M[y.pos++]))>>4,E<128||(x|=(127&(E=M[y.pos++]))<<3,E<128)||(x|=(127&(E=M[y.pos++]))<<10,E<128)||(x|=(127&(E=M[y.pos++]))<<17,E<128)||(x|=(127&(E=M[y.pos++]))<<24,E<128)||(x|=(1&(E=M[y.pos++]))<<31,E<128))return function gu(a,r,l){return l?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}(h,x,g);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(l=u[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&Py?Py.decode(this.buf.subarray(r,a)):function(l,u,h){for(var g="",y=u;y<h;){var x,E,M,T=l[y],k=null,R=T>239?4:T>223?3:T>191?2:1;if(y+R>h)break;1===R?T<128&&(k=T):2===R?128==(192&(x=l[y+1]))&&(k=(31&T)<<6|63&x)<=127&&(k=null):3===R?(E=l[y+2],128==(192&(x=l[y+1]))&&128==(192&E)&&((k=(15&T)<<12|(63&x)<<6|63&E)<=2047||k>=55296&&k<=57343)&&(k=null)):4===R&&(E=l[y+2],M=l[y+3],128==(192&(x=l[y+1]))&&128==(192&E)&&128==(192&M)&&((k=(15&T)<<18|(63&x)<<12|(63&E)<<6|63&M)<=65535||k>=1114112)&&(k=null)),null===k?(k=65533,R=1):k>65535&&(k-=65536,g+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),g+=String.fromCharCode(k),y+=R}return g}(this.buf,r,a)},readBytes:function(){var a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r},readPackedVarint:function(a,r){if(this.type!==Hn.Bytes)return a.push(this.readVarint(r));var l=pl(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(r));return a},readPackedSVarint:function(a){if(this.type!==Hn.Bytes)return a.push(this.readSVarint());var r=pl(this);for(a=a||[];this.pos<r;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Hn.Bytes)return a.push(this.readBoolean());var r=pl(this);for(a=a||[];this.pos<r;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Hn.Bytes)return a.push(this.readFloat());var r=pl(this);for(a=a||[];this.pos<r;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Hn.Bytes)return a.push(this.readDouble());var r=pl(this);for(a=a||[];this.pos<r;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Hn.Bytes)return a.push(this.readFixed32());var r=pl(this);for(a=a||[];this.pos<r;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Hn.Bytes)return a.push(this.readSFixed32());var r=pl(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Hn.Bytes)return a.push(this.readFixed64());var r=pl(this);for(a=a||[];this.pos<r;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Hn.Bytes)return a.push(this.readSFixed64());var r=pl(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed64());return a},skip:function(a){var r=7&a;if(r===Hn.Varint)for(;this.buf[this.pos++]>127;);else if(r===Hn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Hn.Fixed32)this.pos+=4;else{if(r!==Hn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(a,r){this.writeVarint(a<<3|r)},realloc:function(a){for(var r=this.length||16;r<this.pos+a;)r*=2;if(r!==this.length){var l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),ml(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),ml(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),ml(this.buf,-1&a,this.pos),ml(this.buf,Math.floor(a*Ry),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),ml(this.buf,-1&a,this.pos),ml(this.buf,Math.floor(a*Ry),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(r,l){var u,h,g,x;if(r>=0?(u=r%4294967296|0,h=r/4294967296|0):(h=~(-r/4294967296),4294967295^(u=~(-r%4294967296))?u=u+1|0:(u=0,h=h+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),g=u,(x=l).buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,x.buf[x.pos]=127&(g>>>=7),function(g,y){var x=(7&g)<<4;y.buf[y.pos++]|=x|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(h,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var r=this.pos;this.pos=function(u,h,g){for(var y,x,E=0;E<h.length;E++){if((y=h.charCodeAt(E))>55295&&y<57344){if(!x){y>56319||E+1===h.length?(u[g++]=239,u[g++]=191,u[g++]=189):x=y;continue}if(y<56320){u[g++]=239,u[g++]=191,u[g++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(u[g++]=239,u[g++]=191,u[g++]=189,x=null);y<128?u[g++]=y:(y<2048?u[g++]=y>>6|192:(y<65536?u[g++]=y>>12|224:(u[g++]=y>>18|240,u[g++]=y>>12&63|128),u[g++]=y>>6&63|128),u[g++]=63&y|128)}return g}(this.buf,a,this.pos);var l=this.pos-r;l>=128&&wp(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),bp(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),bp(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var r=a.length;this.writeVarint(r),this.realloc(r);for(var l=0;l<r;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,r){this.pos++;var l=this.pos;a(r,this);var u=this.pos-l;u>=128&&wp(l,u,this),this.pos=l-1,this.writeVarint(u),this.pos+=u},writeMessage:function(a,r,l){this.writeTag(a,Hn.Bytes),this.writeRawMessage(r,l)},writePackedVarint:function(a,r){r.length&&this.writeMessage(a,Oy,r)},writePackedSVarint:function(a,r){r.length&&this.writeMessage(a,hg,r)},writePackedBoolean:function(a,r){r.length&&this.writeMessage(a,Ly,r)},writePackedFloat:function(a,r){r.length&&this.writeMessage(a,J0,r)},writePackedDouble:function(a,r){r.length&&this.writeMessage(a,eb,r)},writePackedFixed32:function(a,r){r.length&&this.writeMessage(a,By,r)},writePackedSFixed32:function(a,r){r.length&&this.writeMessage(a,_u,r)},writePackedFixed64:function(a,r){r.length&&this.writeMessage(a,Ny,r)},writePackedSFixed64:function(a,r){r.length&&this.writeMessage(a,zy,r)},writeBytesField:function(a,r){this.writeTag(a,Hn.Bytes),this.writeBytes(r)},writeFixed32Field:function(a,r){this.writeTag(a,Hn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(a,r){this.writeTag(a,Hn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(a,r){this.writeTag(a,Hn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(a,r){this.writeTag(a,Hn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(a,r){this.writeTag(a,Hn.Varint),this.writeVarint(r)},writeSVarintField:function(a,r){this.writeTag(a,Hn.Varint),this.writeSVarint(r)},writeStringField:function(a,r){this.writeTag(a,Hn.Bytes),this.writeString(r)},writeFloatField:function(a,r){this.writeTag(a,Hn.Fixed32),this.writeFloat(r)},writeDoubleField:function(a,r){this.writeTag(a,Hn.Fixed64),this.writeDouble(r)},writeBooleanField:function(a,r){this.writeVarintField(a,Boolean(r))}};class Ep{constructor(r,{pixelRatio:l,version:u,stretchX:h,stretchY:g,content:y}){this.paddedRect=r,this.pixelRatio=l,this.stretchX=h,this.stretchY=g,this.content=y,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Jh{constructor(r,l){const u={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(r,u,g),this.addImages(l,h,g);const{w:y,h:x}=Qh(g),E=new Ks({width:y||1,height:x||1});for(const M in r){const T=r[M],k=u[M].paddedRect;Ks.copy(T.data,E,{x:0,y:0},{x:k.x+1,y:k.y+1},T.data)}for(const M in l){const T=l[M],k=h[M].paddedRect,R=k.x+1,B=k.y+1,V=T.data.width,$=T.data.height;Ks.copy(T.data,E,{x:0,y:0},{x:R,y:B},T.data),Ks.copy(T.data,E,{x:0,y:$-1},{x:R,y:B-1},{width:V,height:1}),Ks.copy(T.data,E,{x:0,y:0},{x:R,y:B+$},{width:V,height:1}),Ks.copy(T.data,E,{x:V-1,y:0},{x:R-1,y:B},{width:1,height:$}),Ks.copy(T.data,E,{x:0,y:0},{x:R+V,y:B},{width:1,height:$})}this.image=E,this.iconPositions=u,this.patternPositions=h}addImages(r,l,u){for(const h in r){const g=r[h],y={x:0,y:0,w:g.data.width+2,h:g.data.height+2};u.push(y),l[h]=new Ep(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(r,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>r.hasImage(u)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in r.updatedImages)this.patchUpdatedImage(this.iconPositions[u],r.getImage(u),l),this.patchUpdatedImage(this.patternPositions[u],r.getImage(u),l)}patchUpdatedImage(r,l,u){if(!r||!l||r.version===l.version)return;r.version=l.version;const[h,g]=r.tl;u.update(l.data,void 0,{x:h,y:g})}}We(Ep,"ImagePosition"),We(Jh,"ImageAtlas");const Wr={horizontal:1,vertical:2,horizontalOnly:3};class Cd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,l){const u=new Cd;return u.scale=r||1,u.fontStack=l,u}static forImage(r){const l=new Cd;return l.imageName=r,l}}class ic{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l){const u=new ic;for(let h=0;h<r.sections.length;h++){const g=r.sections[h];g.image?u.addImageSection(g):u.addTextSection(g,l)}return u}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(l,u){let h="";for(let g=0;g<l.length;g++){const y=l.charCodeAt(g+1)||null,x=l.charCodeAt(g-1)||null;h+=!u&&(y&&Es(y)&&!Fa[l[g+1]]||x&&Es(x)&&!Fa[l[g-1]])||!Fa[l[g]]?l[g]:Fa[l[g]]}return h}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&Ed[this.text.charCodeAt(u)];u++)r++;let l=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&Ed[this.text.charCodeAt(u)];u--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const u=new ic;return u.text=this.text.substring(r,l),u.sectionIndex=this.sectionIndex.slice(r,l),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,l)=>Math.max(r,this.sections[l].scale),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(Cd.forText(r.scale,r.fontStack||l));const u=this.sections.length-1;for(let h=0;h<r.text.length;++h)this.sectionIndex.push(u)}addImageSection(r){const l=r.image?r.image.name:"";if(0===l.length)return void Rn("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Cd.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Rn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Dp(a,r,l,u,h,g,y,x,E,M,T,k,R,B,V,$){const W=ic.fromFeature(a,h);let Q;k===Wr.vertical&&W.verticalizePunctuation(R);const{processBidirectionalText:le,processStyledBidirectionalText:ce}=ss;if(le&&1===W.sections.length){Q=[];const ge=le(W.toString(),tf(W,M,g,r,u,B,V));for(const Se of ge){const Ae=new ic;Ae.text=Se,Ae.sections=W.sections;for(let Oe=0;Oe<Se.length;Oe++)Ae.sectionIndex.push(0);Q.push(Ae)}}else if(ce){Q=[];const ge=ce(W.text,W.sectionIndex,tf(W,M,g,r,u,B,V));for(const Se of ge){const Ae=new ic;Ae.text=Se[0],Ae.sectionIndex=Se[1],Ae.sections=W.sections,Q.push(Ae)}}else Q=function(ge,Se){const Ae=[],Oe=ge.text;let Ne=0;for(const De of Se)Ae.push(ge.substring(Ne,De)),Ne=De;return Ne<Oe.length&&Ae.push(ge.substring(Ne,Oe.length)),Ae}(W,tf(W,M,g,r,u,B,V));const fe=[],pe={positionedLines:fe,text:W.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ge,Se,Ae,Oe,Ne,De,Pe,Ve,Ye,Ge,Xe,St){let Yt=0,At=0,kt=0;const ht="right"===Ve?1:"left"===Ve?0:.5;let tt=!1;for(const yn of Ne){const nn=yn.getSections();for(const In of nn){if(In.imageName)continue;const pi=Se[In.fontStack];if(pi&&(tt=void 0!==pi.ascender&&void 0!==pi.descender,!tt))break}if(!tt)break}let Qt=0;for(const yn of Ne){yn.trim();const nn=yn.getMaxScale(),In=24*(nn-1),pi={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Qt]=pi;const vi=pi.positionedGlyphs;let wi=0;if(!yn.length()){At+=De,++Qt;continue}let qe=0,Rs=0;for(let Vn=0;Vn<yn.length();Vn++){const Xr=yn.getSection(Vn),Ps=yn.getSectionIndex(Vn),ir=yn.getCharCode(Vn);let Wi=Xr.scale,Jn=null,Fn=null,Zi=null,Kr=24,ci=0;const Yr=!(Ye===Wr.horizontal||!Xe&&!Hi(ir)||Xe&&(Ed[ir]||(En=ir,od(En)||Bo(En)||nr(En)||cd(En)||ql(En))));if(Xr.imageName){const Sr=Oe[Xr.imageName];if(!Sr)continue;Zi=Xr.imageName,ge.iconsInText=ge.iconsInText||!0,Fn=Sr.paddedRect;const Ti=Sr.displaySize;Wi=24*Wi/St,Jn={width:Ti[0],height:Ti[1],left:1,top:-3,advance:Yr?Ti[1]:Ti[0],localGlyph:!1},ci=tt?-Jn.height*Wi:24*nn-17-Ti[1]*Wi,Kr=Jn.advance;const Ni=(Yr?Ti[0]:Ti[1])*Wi-24*nn;Ni>0&&Ni>wi&&(wi=Ni)}else{const Sr=Ae[Xr.fontStack];if(!Sr)continue;Sr[ir]&&(Fn=Sr[ir]);const Ti=Se[Xr.fontStack];if(!Ti)continue;const Ni=Ti.glyphs[ir];if(!Ni)continue;if(Jn=Ni.metrics,Kr=8203!==ir?24:0,tt){const Co=void 0!==Ti.ascender?Math.abs(Ti.ascender):0,Xi=void 0!==Ti.descender?Math.abs(Ti.descender):0,Yo=(Co+Xi)*Wi;qe<Yo&&(qe=Yo,Rs=(Co-Xi)/2*Wi),ci=-Co*Wi}else ci=24*(nn-Wi)-17}Yr?(ge.verticalizable=!0,vi.push({glyph:ir,imageName:Zi,x:Yt,y:At+ci,vertical:Yr,scale:Wi,localGlyph:Jn.localGlyph,fontStack:Xr.fontStack,sectionIndex:Ps,metrics:Jn,rect:Fn}),Yt+=Kr*Wi+Ge):(vi.push({glyph:ir,imageName:Zi,x:Yt,y:At+ci,vertical:Yr,scale:Wi,localGlyph:Jn.localGlyph,fontStack:Xr.fontStack,sectionIndex:Ps,metrics:Jn,rect:Fn}),Yt+=Jn.advance*Wi+Ge)}0!==vi.length&&(kt=Math.max(Yt-Ge,kt),tt?nb(vi,ht,wi,Rs,De*nn/2):nb(vi,ht,wi,0,De/2)),Yt=0;const Mr=De*nn+wi;pi.lineOffset=Math.max(wi,In),At+=Mr,++Qt}var En;const zn=At,{horizontalAlign:Yn,verticalAlign:Bi}=Mp(Pe);(function(yn,nn,In,pi,vi,wi){const qe=(nn-In)*vi,Rs=-wi*pi;for(const Mr of yn)for(const Vn of Mr.positionedGlyphs)Vn.x+=qe,Vn.y+=Rs})(ge.positionedLines,ht,Yn,Bi,kt,zn),ge.top+=-Bi*zn,ge.bottom=ge.top+zn,ge.left+=-Yn*kt,ge.right=ge.left+kt,ge.hasBaseline=tt}(pe,r,l,u,Q,y,x,E,k,M,R,$),!function(ge){for(const Se of ge)if(0!==Se.positionedGlyphs.length)return!1;return!0}(fe)&&pe}const Ed={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ef={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function $y(a,r,l,u,h,g){if(r.imageName){const y=u[r.imageName];return y?y.displaySize[0]*r.scale*24/g+h:0}{const y=l[r.fontStack],x=y&&y.glyphs[a];return x?x.metrics.advance*r.scale+h:0}}function fg(a,r,l,u){const h=Math.pow(a-r,2);return u?a<r?h/2:2*h:h+Math.abs(l)*l}function tb(a,r,l){let u=0;return 10===a&&(u-=1e4),l&&(u+=150),40!==a&&65288!==a||(u+=50),41!==r&&65289!==r||(u+=50),u}function Hy(a,r,l,u,h,g){let y=null,x=fg(r,l,h,g);for(const E of u){const M=fg(r-E.x,l,h,g)+E.badness;M<=x&&(y=E,x=M)}return{index:a,x:r,priorBreak:y,badness:x}}function pg(a){return a?pg(a.priorBreak).concat(a.index):[]}function tf(a,r,l,u,h,g,y){if("point"!==g)return[];if(!a)return[];const x=[],E=function(R,B,V,$,W,Q){let le=0;for(let ce=0;ce<R.length();ce++){const fe=R.getSection(ce);le+=$y(R.getCharCode(ce),fe,$,W,B,Q)}return le/Math.max(1,Math.ceil(le/V))}(a,r,l,u,h,y),M=a.text.indexOf("\u200b")>=0;let T=0;for(let R=0;R<a.length();R++){const B=a.getSection(R),V=a.getCharCode(R);if(Ed[V]||(T+=$y(V,B,u,h,r,y)),R<a.length()-1){const $=!((k=V)<11904||!(Lm(k)||zt(k)||xr(k)||mi(k)||_h(k)||ad(k)||ep(k)||Ws(k)||np(k)||yh(k)||tp(k)||ip(k)||Gl(k)||mh(k)||ld(k)||gh(k)||$l(k)||Hl(k)||bn(k)||$e(k)));(ef[V]||$||B.imageName)&&x.push(Hy(R+1,T,E,x,tb(V,a.getCharCode(R+1),$&&M),!1))}}var k;return pg(Hy(a.length(),T,E,x,0,!0))}function Mp(a){let r=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function nb(a,r,l,u,h){if(!(r||l||u||h))return;const g=a.length-1,y=a[g],x=(y.x+y.metrics.advance*y.scale)*r;for(let E=0;E<=g;E++)a[E].x-=x,a[E].y+=l+u+h}function qy(a,r,l){const{horizontalAlign:u,verticalAlign:h}=Mp(l),g=r[0]-a.displaySize[0]*u,y=r[1]-a.displaySize[1]*h;return{image:a,top:y,bottom:y+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function Wy(a,r,l,u,h,g){const y=a.image;let x;if(y.content){const W=y.content,Q=y.pixelRatio||1;x=[W[0]/Q,W[1]/Q,y.displaySize[0]-W[2]/Q,y.displaySize[1]-W[3]/Q]}const E=r.left*g,M=r.right*g;let T,k,R,B;"width"===l||"both"===l?(B=h[0]+E-u[3],k=h[0]+M+u[1]):(B=h[0]+(E+M-y.displaySize[0])/2,k=B+y.displaySize[0]);const V=r.top*g,$=r.bottom*g;return"height"===l||"both"===l?(T=h[1]+V-u[0],R=h[1]+$+u[2]):(T=h[1]+(V+$-y.displaySize[1])/2,R=T+y.displaySize[1]),{image:y,top:T,right:k,bottom:R,left:B,collisionPadding:x}}class Ra extends Be{constructor(r,l,u,h,g){super(r,l),this.angle=h,this.z=u,void 0!==g&&(this.segment=g)}clone(){return new Ra(this.x,this.y,this.z,this.angle,this.segment)}}function Zy(a,r,l,u,h){if(void 0===r.segment)return!0;let g=r,y=r.segment+1,x=0;for(;x>-l/2;){if(y--,y<0)return!1;x-=a[y].dist(g),g=a[y]}x+=a[y].dist(a[y+1]),y++;const E=[];let M=0;for(;x<l/2;){const T=a[y],k=a[y+1];if(!k)return!1;let R=a[y-1].angleTo(T)-T.angleTo(k);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:R}),M+=R;x-E[0].distance>u;)M-=E.shift().angleDelta;if(M>h)return!1;y++,x+=T.dist(k)}return!0}function Xy(a){let r=0;for(let l=0;l<a.length-1;l++)r+=a[l].dist(a[l+1]);return r}function vo(a,r,l){return a?.6*r*l:0}function Ky(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function Yy(a,r,l,u,h,g){const y=vo(l,h,g),x=Ky(l,u)*g;let E=0;const M=Xy(a)/2;for(let T=0;T<a.length-1;T++){const k=a[T],R=a[T+1],B=k.dist(R);if(E+B>M){const V=(M-E)/B,$=ct(k.x,R.x,V),W=ct(k.y,R.y,V),Q=new Ra($,W,0,R.angleTo(k),T);return!y||Zy(a,Q,x,y,r)?Q:void 0}E+=B}}function ib(a,r,l,u,h,g,y,x,E){const M=vo(u,g,y),T=Ky(u,h),k=T*y,R=0===a[0].x||a[0].x===E||0===a[0].y||a[0].y===E;return r-k<r/4&&(r=k+r/4),Qy(a,R?r/2*x%r:(T/2+2*g)*y*x%r,r,M,l,k,R,!1,E)}function Qy(a,r,l,u,h,g,y,x,E){const M=g/2,T=Xy(a);let k=0,R=r-l,B=[];for(let V=0;V<a.length-1;V++){const $=a[V],W=a[V+1],Q=$.dist(W),le=W.angleTo($);for(;R+l<k+Q;){R+=l;const ce=(R-k)/Q,fe=ct($.x,W.x,ce),pe=ct($.y,W.y,ce);if(fe>=0&&fe<E&&pe>=0&&pe<E&&R-M>=0&&R+M<=T){const ge=new Ra(fe,pe,0,le,V);ge._round(),u&&!Zy(a,ge,g,u,h)||B.push(ge)}}k+=Q}return x||B.length||y||(B=Qy(a,k/2,l,u,h,g,y,!0,E)),B}function Jy(a,r,l,u,h){const g=[];for(let y=0;y<a.length;y++){const x=a[y];let E;for(let M=0;M<x.length-1;M++){let T=x[M],k=x[M+1];T.x<r&&k.x<r||(T.x<r?T=new Be(r,T.y+(r-T.x)/(k.x-T.x)*(k.y-T.y))._round():k.x<r&&(k=new Be(r,T.y+(r-T.x)/(k.x-T.x)*(k.y-T.y))._round()),T.y<l&&k.y<l||(T.y<l?T=new Be(T.x+(l-T.y)/(k.y-T.y)*(k.x-T.x),l)._round():k.y<l&&(k=new Be(T.x+(l-T.y)/(k.y-T.y)*(k.x-T.x),l)._round()),T.x>=u&&k.x>=u||(T.x>=u?T=new Be(u,T.y+(u-T.x)/(k.x-T.x)*(k.y-T.y))._round():k.x>=u&&(k=new Be(u,T.y+(u-T.x)/(k.x-T.x)*(k.y-T.y))._round()),T.y>=h&&k.y>=h||(T.y>=h?T=new Be(T.x+(h-T.y)/(k.y-T.y)*(k.x-T.x),h)._round():k.y>=h&&(k=new Be(T.x+(h-T.y)/(k.y-T.y)*(k.x-T.x),h)._round()),E&&T.equals(E[E.length-1])||(E=[T],g.push(E)),E.push(k)))))}}return g}We(Ra,"Anchor");const nf=1e20;function mg(a,r,l,u,h,g,y,x,E){for(let M=r;M<r+u;M++)ev(a,l*g+M,g,h,y,x,E);for(let M=l;M<l+h;M++)ev(a,M*g+r,1,u,y,x,E)}function ev(a,r,l,u,h,g,y){g[0]=0,y[0]=-nf,y[1]=nf,h[0]=a[r];for(let x=1,E=0,M=0;x<u;x++){h[x]=a[r+x*l];const T=x*x;do{const k=g[E];M=(h[x]-h[k]+T-k*k)/(x-k)/2}while(M<=y[E]&&--E>-1);E++,g[E]=x,y[E]=M,y[E+1]=nf}for(let x=0,E=0;x<u;x++){for(;y[E+1]<x;)E++;const M=g[E],T=x-M;a[r+x*l]=h[M]+T*T}}const gg={none:0,ideographs:1,all:2};class Dd{constructor(r,l,u){this.requestManager=r,this.localGlyphMode=l,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,l){const u=[];for(const h in r)for(const g of r[h])u.push({stack:h,id:g});aa(u,({stack:h,id:g},y)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[g];if(void 0!==E)return void y(null,{stack:h,id:g,glyph:E});if(E=this._tinySDF(x,h,g),E)return x.glyphs[g]=E,void y(null,{stack:h,id:g,glyph:E});const M=Math.floor(g/256);if(256*M>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[M])return void y(null,{stack:h,id:g,glyph:E});let T=x.requests[M];T||(T=x.requests[M]=[],Dd.loadGlyphRange(h,M,this.url,this.requestManager,(k,R)=>{if(R){x.ascender=R.ascender,x.descender=R.descender;for(const B in R.glyphs)this._doesCharSupportLocalGlyph(+B)||(x.glyphs[+B]=R.glyphs[+B]);x.ranges[M]=!0}for(const B of T)B(k,R);delete x.requests[M]})),T.push((k,R)=>{k?y(k):R&&y(null,{stack:h,id:g,glyph:R.glyphs[g]||null})})},(h,g)=>{if(h)l(h);else if(g){const y={};for(const{stack:x,id:E,glyph:M}of g)void 0===y[x]&&(y[x]={}),void 0===y[x].glyphs&&(y[x].glyphs={}),y[x].glyphs[E]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;l(null,y)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==gg.none&&(this.localGlyphMode===gg.all?!!this.localFontFamily:!!this.localFontFamily&&(yh(r)||No(r)||Gl(r)||$l(r)||Ws(r)))}_tinySDF(r,l,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let g=r.tinySDF;if(!g){let $="400";/bold/i.test(l)?$="900":/medium/i.test(l)?$="500":/light/i.test(l)&&($="200"),g=r.tinySDF=new Dd.TinySDF({fontFamily:h,fontWeight:$,fontSize:48,buffer:6,radius:16}),g.fontWeight=$}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const y=String.fromCharCode(u),{data:x,width:E,height:M,glyphWidth:T,glyphHeight:k,glyphLeft:R,glyphTop:B,glyphAdvance:V}=g.draw(y);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new hl({width:E,height:M},x),metrics:{width:T/2,height:k/2,left:R/2,top:B/2-27,advance:V/2,localGlyph:!0}}}}function Xt(a,r,l,u){const h=[],g=a.image,y=g.pixelRatio,x=g.paddedRect.w-2,E=g.paddedRect.h-2,M=a.right-a.left,T=a.bottom-a.top,k=g.stretchX||[[0,x]],R=g.stretchY||[[0,E]],B=(De,Pe)=>De+Pe[1]-Pe[0],V=k.reduce(B,0),$=R.reduce(B,0),W=x-V,Q=E-$;let le=0,ce=V,fe=0,pe=$,ge=0,Se=W,Ae=0,Oe=Q;if(g.content&&u){const De=g.content;le=Zr(k,0,De[0]),fe=Zr(R,0,De[1]),ce=Zr(k,De[0],De[2]),pe=Zr(R,De[1],De[3]),ge=De[0]-le,Ae=De[1]-fe,Se=De[2]-De[0]-ce,Oe=De[3]-De[1]-pe}const Ne=(De,Pe,Ve,Ye)=>{const Ge=rf(De.stretch-le,ce,M,a.left),Xe=yu(De.fixed-ge,Se,De.stretch,V),St=rf(Pe.stretch-fe,pe,T,a.top),Yt=yu(Pe.fixed-Ae,Oe,Pe.stretch,$),At=rf(Ve.stretch-le,ce,M,a.left),kt=yu(Ve.fixed-ge,Se,Ve.stretch,V),ht=rf(Ye.stretch-fe,pe,T,a.top),tt=yu(Ye.fixed-Ae,Oe,Ye.stretch,$),Qt=new Be(Ge,St),En=new Be(At,St),zn=new Be(At,ht),Yn=new Be(Ge,ht),Bi=new Be(Xe/y,Yt/y),yn=new Be(kt/y,tt/y),nn=r*Math.PI/180;if(nn){const vi=Math.sin(nn),wi=Math.cos(nn),qe=[wi,-vi,vi,wi];Qt._matMult(qe),En._matMult(qe),Yn._matMult(qe),zn._matMult(qe)}const In=De.stretch+De.fixed,pi=Pe.stretch+Pe.fixed;return{tl:Qt,tr:En,bl:Yn,br:zn,tex:{x:g.paddedRect.x+1+In,y:g.paddedRect.y+1+pi,w:Ve.stretch+Ve.fixed-In,h:Ye.stretch+Ye.fixed-pi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Bi,pixelOffsetBR:yn,minFontScaleX:Se/y/M,minFontScaleY:Oe/y/T,isSDF:l}};if(u&&(g.stretchX||g.stretchY)){const De=_g(k,W,V),Pe=_g(R,Q,$);for(let Ve=0;Ve<De.length-1;Ve++){const Ye=De[Ve],Ge=De[Ve+1];for(let Xe=0;Xe<Pe.length-1;Xe++)h.push(Ne(Ye,Pe[Xe],Ge,Pe[Xe+1]))}}else h.push(Ne({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:E+1}));return h}function Zr(a,r,l){let u=0;for(const h of a)u+=Math.max(r,Math.min(l,h[1]))-Math.max(r,Math.min(l,h[0]));return u}function _g(a,r,l){const u=[{fixed:-1,stretch:0}];for(const[h,g]of a){const y=u[u.length-1];u.push({fixed:h-y.stretch,stretch:y.stretch}),u.push({fixed:h-y.stretch,stretch:y.stretch+(g-h)})}return u.push({fixed:r+1,stretch:l}),u}function rf(a,r,l,u){return a/r*l+u}function yu(a,r,l,u){return a-r*l/u}function Zo(a,r,l,u){const h=r+a.positionedLines[u].lineOffset;return 0===u?l+h/2:l+(h+(r+a.positionedLines[u-1].lineOffset))/2}Dd.loadGlyphRange=function(a,r,l,u,h){const g=256*r,y=g+255,x=u.transformRequest(u.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${g}-${y}`),J.Glyphs);re(x,(E,M)=>{if(E)h(E);else if(M){const T={},k=new Yh(M).readFields(jy,{});for(const R of k.glyphs)T[R.id]=R;h(null,{glyphs:T,ascender:k.ascender,descender:k.descender})}})},Dd.TinySDF=class{constructor({fontSize:a=24,buffer:r=3,radius:l=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:y="normal"}){this.buffer=r,this.cutoff=u,this.radius=l;const x=this.size=a+4*r,E=this._createCanvas(x),M=this.ctx=E.getContext("2d",{willReadFrequently:!0});M.font=`${y} ${g} ${a}px ${h}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(a){const r=document.createElement("canvas");return r.width=r.height=a,r}draw(a){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(a),y=Math.floor(l),x=Math.min(this.size-this.buffer,Math.ceil(g-h)),E=Math.min(this.size-this.buffer,Math.ceil(l)+Math.ceil(u)),M=x+2*this.buffer,T=E+2*this.buffer,k=M*T,R=new Uint8ClampedArray(k),B={data:R,width:M,height:T,glyphWidth:x,glyphHeight:E,glyphTop:y,glyphLeft:0,glyphAdvance:r};if(0===x||0===E)return B;const{ctx:V,buffer:$,gridInner:W,gridOuter:Q}=this;V.clearRect($,$,x,E),V.fillText(a,$,$+y+1);const le=V.getImageData($,$,x,E);Q.fill(nf,0,k),W.fill(0,0,k);for(let ce=0;ce<E;ce++)for(let fe=0;fe<x;fe++){const pe=le.data[4*(ce*x+fe)+3]/255;if(0===pe)continue;const ge=(ce+$)*M+fe+$;if(1===pe)Q[ge]=0,W[ge]=nf;else{const Se=.5-pe;Q[ge]=Se>0?Se*Se:0,W[ge]=Se<0?Se*Se:0}}mg(Q,0,0,M,T,M,this.f,this.v,this.z),mg(W,$,$,x,E,M,this.f,this.v,this.z);for(let ce=0;ce<k;ce++){const fe=Math.sqrt(Q[ce])-Math.sqrt(W[ce]);R[ce]=Math.round(255-255*(fe/this.radius+this.cutoff))}return B}};class tv{constructor(r=[],l=rb){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:u}=this,h=l[r];for(;r>0;){const g=r-1>>1,y=l[g];if(u(h,y)>=0)break;l[r]=y,r=g}l[r]=h}_down(r){const{data:l,compare:u}=this,h=this.length>>1,g=l[r];for(;r<h;){let y=1+(r<<1),x=l[y];const E=y+1;if(E<this.length&&u(l[E],x)<0&&(y=E,x=l[E]),u(x,g)>=0)break;l[r]=x,r=y}l[r]=g}}function rb(a,r){return a<r?-1:a>r?1:0}function yg(a,r=1,l=!1){let u=1/0,h=1/0,g=-1/0,y=-1/0;const x=a[0];for(let B=0;B<x.length;B++){const V=x[B];(!B||V.x<u)&&(u=V.x),(!B||V.y<h)&&(h=V.y),(!B||V.x>g)&&(g=V.x),(!B||V.y>y)&&(y=V.y)}const E=Math.min(g-u,y-h);let M=E/2;const T=new tv([],gl);if(0===E)return new Be(u,h);for(let B=u;B<g;B+=E)for(let V=h;V<y;V+=E)T.push(new rc(B+M,V+M,M,a));let k=function(B){let V=0,$=0,W=0;const Q=B[0];for(let le=0,ce=Q.length,fe=ce-1;le<ce;fe=le++){const pe=Q[le],ge=Q[fe],Se=pe.x*ge.y-ge.x*pe.y;$+=(pe.x+ge.x)*Se,W+=(pe.y+ge.y)*Se,V+=3*Se}return new rc($/V,W/V,0,B)}(a),R=T.length;for(;T.length;){const B=T.pop();(B.d>k.d||!k.d)&&(k=B,l&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,R)),B.max-k.d<=r||(M=B.h/2,T.push(new rc(B.p.x-M,B.p.y-M,M,a)),T.push(new rc(B.p.x+M,B.p.y-M,M,a)),T.push(new rc(B.p.x-M,B.p.y+M,M,a)),T.push(new rc(B.p.x+M,B.p.y+M,M,a)),R+=4)}return l&&(console.log(`num probes: ${R}`),console.log(`best distance: ${k.d}`)),k.p}function gl(a,r){return r.max-a.max}function rc(a,r,l,u){this.p=new Be(a,r),this.h=l,this.d=function(h,g){let y=!1,x=1/0;for(let E=0;E<g.length;E++){const M=g[E];for(let T=0,k=M.length,R=k-1;T<k;R=T++){const B=M[T],V=M[R];B.y>h.y!=V.y>h.y&&h.x<(V.x-B.x)*(h.y-B.y)/(V.y-B.y)+B.x&&(y=!y),x=Math.min(x,md(h,B,V))}}return(y?1:-1)*Math.sqrt(x)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const Sp=Number.POSITIVE_INFINITY,vg=Math.sqrt(2);function sb(a,r){return r[1]!==Sp?function(l,u,h){let g=0,y=0;switch(u=Math.abs(u),h=Math.abs(h),l){case"top-right":case"top-left":case"top":y=h-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-h}switch(l){case"top-right":case"bottom-right":case"right":g=-u;break;case"top-left":case"bottom-left":case"left":g=u}return[g,y]}(a,r[0],r[1]):function(l,u){let h=0,g=0;u<0&&(u=0);const y=u/vg;switch(l){case"top-right":case"top-left":g=y-7;break;case"bottom-right":case"bottom-left":g=7-y;break;case"bottom":g=7-u;break;case"top":g=u-7}switch(l){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=u;break;case"right":h=-u}return[h,g]}(a,r[0])}function nv(a,r,l,u,h,g,y,x,E,M){a.createArrays(),a.tilePixelRatio=Rt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const T=a.layers[0].layout,k=a.layers[0]._unevaluatedLayout._values,R={};if("composite"===a.textSizeData.kind){const{minZoom:$,maxZoom:W}=a.textSizeData;R.compositeTextSizes=[k["text-size"].possiblyEvaluate(new $n($),x),k["text-size"].possiblyEvaluate(new $n(W),x)]}if("composite"===a.iconSizeData.kind){const{minZoom:$,maxZoom:W}=a.iconSizeData;R.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new $n($),x),k["icon-size"].possiblyEvaluate(new $n(W),x)]}R.layoutTextSize=k["text-size"].possiblyEvaluate(new $n(E+1),x),R.layoutIconSize=k["icon-size"].possiblyEvaluate(new $n(E+1),x),R.textMaxSize=k["text-size"].possiblyEvaluate(new $n(18),x);const B="map"===T.get("text-rotation-alignment")&&"point"!==T.get("symbol-placement"),V=T.get("text-size");for(const $ of a.features){const W=T.get("text-font").evaluate($,{},x).join(","),Q=V.evaluate($,{},x),le=R.layoutTextSize.evaluate($,{},x),ce=(R.layoutIconSize.evaluate($,{},x),{horizontal:{},vertical:void 0}),fe=$.text;let pe,ge=[0,0];if(fe){const Oe=fe.toString(),Ne=24*T.get("text-letter-spacing").evaluate($,{},x),De=24*T.get("text-line-height").evaluate($,{},x),Pe=nu(Oe)?Ne:0,Ve=T.get("text-anchor").evaluate($,{},x),Ye=T.get("text-variable-anchor");if(!Ye){const kt=T.get("text-radial-offset").evaluate($,{},x);ge=kt?sb(Ve,[24*kt,Sp]):T.get("text-offset").evaluate($,{},x).map(ht=>24*ht)}let Ge=B?"center":T.get("text-justify").evaluate($,{},x);const Xe=T.get("symbol-placement"),St="point"===Xe,Yt="point"===Xe?24*T.get("text-max-width").evaluate($,{},x):0,At=kt=>{a.allowVerticalPlacement&&dd(Oe)&&(ce.vertical=Dp(fe,r,l,h,W,Yt,De,Ve,kt,Pe,ge,Wr.vertical,!0,Xe,le,Q))};if(!B&&Ye){const kt="auto"===Ge?Ye.map(tt=>iv(tt)):[Ge];let ht=!1;for(let tt=0;tt<kt.length;tt++){const Qt=kt[tt];if(!ce.horizontal[Qt])if(ht)ce.horizontal[Qt]=ce.horizontal[0];else{const En=Dp(fe,r,l,h,W,Yt,De,"center",Qt,Pe,ge,Wr.horizontal,!1,Xe,le,Q);En&&(ce.horizontal[Qt]=En,ht=1===En.positionedLines.length)}}At("left")}else{if("auto"===Ge&&(Ge=iv(Ve)),St||T.get("text-writing-mode").indexOf("horizontal")>=0||!dd(Oe)){const kt=Dp(fe,r,l,h,W,Yt,De,Ve,Ge,Pe,ge,Wr.horizontal,!1,Xe,le,Q);kt&&(ce.horizontal[Ge]=kt)}At("point"===Xe?"left":Ge)}}let Se=!1;if($.icon&&$.icon.name){const Oe=u[$.icon.name];Oe&&(pe=qy(h[$.icon.name],T.get("icon-offset").evaluate($,{},x),T.get("icon-anchor").evaluate($,{},x)),Se=Oe.sdf,void 0===a.sdfIcons?a.sdfIcons=Oe.sdf:a.sdfIcons!==Oe.sdf&&Rn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==a.pixelRatio||0!==T.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const Ae=Ip(ce.horizontal)||ce.vertical;a.iconsInText||(a.iconsInText=!!Ae&&Ae.iconsInText),(Ae||pe)&&Ap(a,$,ce,pe,u,R,le,0,ge,Se,y,x,M)}g&&a.generateCollisionDebugBuffers(E,a.collisionBoxArray)}function iv(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ap(a,r,l,u,h,g,y,x,E,M,T,k,R){let B=g.textMaxSize.evaluate(r,{},k);void 0===B&&(B=y);const V=a.layers[0].layout,$=V.get("icon-offset").evaluate(r,{},k),W=Ip(l.horizontal)||l.vertical,Q=y/24,le=a.tilePixelRatio*B/24,ce=(De=a.overscaling,a.zoom>18&&De>2&&(De>>=1),Math.max(Rt/(512*De),1)*V.get("symbol-spacing")),fe=V.get("text-padding")*a.tilePixelRatio,pe=V.get("icon-padding")*a.tilePixelRatio,ge=cn(V.get("text-max-angle")),Se="map"===V.get("text-rotation-alignment")&&"point"!==V.get("symbol-placement"),Ae="map"===V.get("icon-rotation-alignment")&&"point"!==V.get("symbol-placement"),Oe=V.get("symbol-placement"),Ne=ce/2;var De;const Pe=V.get("icon-text-fit");let Ve;u&&"none"!==Pe&&(a.allowVerticalPlacement&&l.vertical&&(Ve=Wy(u,l.vertical,Pe,V.get("icon-text-fit-padding"),$,Q)),W&&(u=Wy(u,W,Pe,V.get("icon-text-fit-padding"),$,Q)));const Ye=(Ge,Xe,St)=>{if(Xe.x<0||Xe.x>=Rt||Xe.y<0||Xe.y>=Rt)return;const{x:Yt,y:At,z:kt}=R.projectTilePoint(Xe.x,Xe.y,St),ht=new Ra(Yt,At,kt,0,void 0);!function(tt,Qt,En,zn,Yn,Bi,yn,nn,In,pi,vi,wi,qe,Rs,Mr,Vn,Xr,Ps,ir,Wi,Jn,Fn,Zi,Kr,ci){const Yr=tt.addToLineVertexArray(Qt,zn);let Sr,Ti,Ni,Co,Xi,Yo,ff,eo=0,rr=0,Mu=0,Su=0,uc=-1,dc=-1;const ds={};let Au=$r(""),hc=0,fc=0;if(void 0===In._unevaluatedLayout.getValue("text-radial-offset")?[hc,fc]=In.layout.get("text-offset").evaluate(Jn,{},ci).map(hs=>24*hs):(hc=24*In.layout.get("text-radial-offset").evaluate(Jn,{},ci),fc=Sp),tt.allowVerticalPlacement&&Yn.vertical){const hs=Yn.vertical;if(Mr)Yo=rv(hs),nn&&(ff=rv(nn));else{const fs=In.layout.get("text-rotate").evaluate(Jn,{},ci)+90;Ni=Md(pi,En,Qt,vi,wi,qe,hs,Rs,fs,Vn),nn&&(Co=Md(pi,En,Qt,vi,wi,qe,nn,Ps,fs))}}if(Bi){const hs=In.layout.get("icon-rotate").evaluate(Jn,{},ci),fs="none"!==In.layout.get("icon-text-fit"),Rd=Xt(Bi,hs,Zi,fs),$p=nn?Xt(nn,hs,Zi,fs):void 0;Ti=Md(pi,En,Qt,vi,wi,qe,Bi,Ps,hs),eo=4*Rd.length;const qg=tt.iconSizeData;let pc=null;"source"===qg.kind?(pc=[Wo*In.layout.get("icon-size").evaluate(Jn,{},ci)],pc[0]>Xo&&Rn(`${tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===qg.kind&&(pc=[Wo*Fn.compositeIconSizes[0].evaluate(Jn,{},ci),Wo*Fn.compositeIconSizes[1].evaluate(Jn,{},ci)],(pc[0]>Xo||pc[1]>Xo)&&Rn(`${tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),tt.addSymbols(tt.icon,Rd,pc,Wi,ir,Jn,!1,En,Qt,Yr.lineStartIndex,Yr.lineLength,-1,Kr,ci),uc=tt.icon.placedSymbolArray.length-1,$p&&(rr=4*$p.length,tt.addSymbols(tt.icon,$p,pc,Wi,ir,Jn,Wr.vertical,En,Qt,Yr.lineStartIndex,Yr.lineLength,-1,Kr,ci),dc=tt.icon.placedSymbolArray.length-1)}for(const hs in Yn.horizontal){const fs=Yn.horizontal[hs];Sr||(Au=$r(fs.text),Mr?Xi=rv(fs):Sr=Md(pi,En,Qt,vi,wi,qe,fs,Rs,In.layout.get("text-rotate").evaluate(Jn,{},ci),Vn));const Rd=1===fs.positionedLines.length;if(Mu+=Tp(tt,En,Qt,fs,yn,In,Mr,Jn,Vn,Yr,Yn.vertical?Wr.horizontal:Wr.horizontalOnly,Rd?Object.keys(Yn.horizontal):[hs],ds,uc,Fn,Kr,ci),Rd)break}Yn.vertical&&(Su+=Tp(tt,En,Qt,Yn.vertical,yn,In,Mr,Jn,Vn,Yr,Wr.vertical,["vertical"],ds,dc,Fn,Kr,ci));let to=-1;const Gp=(hs,fs)=>hs?Math.max(hs,fs):fs;to=Gp(Xi,to),to=Gp(Yo,to),to=Gp(ff,to);const Ev=to>-1?1:0;tt.glyphOffsetArray.length>=_l.MAX_GLYPHS&&Rn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Jn.sortKey&&tt.addToSortKeyRanges(tt.symbolInstances.length,Jn.sortKey),tt.symbolInstances.emplaceBack(En.x,En.y,En.z,Qt.x,Qt.y,ds.right>=0?ds.right:-1,ds.center>=0?ds.center:-1,ds.left>=0?ds.left:-1,ds.vertical>=0?ds.vertical:-1,uc,dc,Au,void 0!==Sr?Sr:tt.collisionBoxArray.length,void 0!==Sr?Sr+1:tt.collisionBoxArray.length,void 0!==Ni?Ni:tt.collisionBoxArray.length,void 0!==Ni?Ni+1:tt.collisionBoxArray.length,void 0!==Ti?Ti:tt.collisionBoxArray.length,void 0!==Ti?Ti+1:tt.collisionBoxArray.length,Co||tt.collisionBoxArray.length,Co?Co+1:tt.collisionBoxArray.length,vi,Mu,Su,eo,rr,Ev,0,hc,fc,to)}(a,Xe,ht,Ge,l,u,h,Ve,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,fe,Se,E,0,pe,Ae,$,r,g,M,T,k)};if("line"===Oe)for(const Ge of Jy(r.geometry,0,0,Rt,Rt)){const Xe=ib(Ge,ce,ge,l.vertical||W,u,24,le,a.overscaling,Rt);for(const St of Xe){const Yt=W;Yt&&ob(a,Yt.text,Ne,St)||Ye(Ge,St,k)}}else if("line-center"===Oe){for(const Ge of r.geometry)if(Ge.length>1){const Xe=Yy(Ge,ge,l.vertical||W,u,24,le);Xe&&Ye(Ge,Xe,k)}}else if("Polygon"===r.type)for(const Ge of by(r.geometry,0)){const Xe=yg(Ge,16);Ye(Ge[0],new Ra(Xe.x,Xe.y,0,0,void 0),k)}else if("LineString"===r.type)for(const Ge of r.geometry)Ye(Ge,new Ra(Ge[0].x,Ge[0].y,0,0,void 0),k);else if("Point"===r.type)for(const Ge of r.geometry)for(const Xe of Ge)Ye([Xe],new Ra(Xe.x,Xe.y,0,0,void 0),k)}const Xo=32640;function Tp(a,r,l,u,h,g,y,x,E,M,T,k,R,B,V,$,W){const Q=function(fe,pe,ge,Se,Ae,Oe,Ne,De){const Pe=[];if(0===pe.positionedLines.length)return Pe;const Ve=Se.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,Ye=function(At){const kt=At[0],ht=At[1],tt=kt*ht;return tt>0?[kt,-ht]:tt<0?[-kt,ht]:0===kt?[ht,kt]:[ht,-kt]}(ge);let Ge=Math.abs(pe.top-pe.bottom);for(const At of pe.positionedLines)Ge-=At.lineOffset;const Xe=pe.positionedLines.length,St=Ge/Xe;let Yt=pe.top-ge[1];for(let At=0;At<Xe;++At){const kt=pe.positionedLines[At];Yt=Zo(pe,St,Yt,At);for(const ht of kt.positionedGlyphs){if(!ht.rect)continue;const tt=ht.rect||{};let Qt=4,En=!0,zn=1,Yn=0;if(ht.imageName){const Fn=Ne[ht.imageName];if(!Fn)continue;if(Fn.sdf){Rn("SDF images are not supported in formatted text and will be ignored.");continue}En=!1,zn=Fn.pixelRatio,Qt=1/zn}const Bi=(Ae||De)&&ht.vertical,yn=ht.metrics.advance*ht.scale/2,nn=ht.metrics,In=ht.rect;if(null===In)continue;De&&pe.verticalizable&&(Yn=ht.imageName?yn-ht.metrics.width*ht.scale/2:0);const pi=Ae?[ht.x+yn,ht.y]:[0,0];let vi=[0,0],wi=[0,0],qe=!1;Ae||(Bi?(wi=[ht.x+yn+Ye[0],ht.y+Ye[1]-Yn],qe=!0):vi=[ht.x+yn+ge[0],ht.y+ge[1]-Yn]);const Rs=In.w*ht.scale/(zn*(ht.localGlyph?2:1)),Mr=In.h*ht.scale/(zn*(ht.localGlyph?2:1));let Vn,Xr,Ps,ir;if(Bi){const Fn=ht.y-Yt,Zi=new Be(-yn,yn-Fn),Kr=-Math.PI/2,ci=new Be(...wi);Vn=new Be(-yn+vi[0],vi[1]),Vn._rotateAround(Kr,Zi)._add(ci),Vn.x+=-Fn+yn,Vn.y-=(nn.left-Qt)*ht.scale;const Yr=ht.imageName?nn.advance*ht.scale:24*ht.scale,Sr=String.fromCharCode(ht.glyph);ug(Sr)?Vn.x+=(1-Qt)*ht.scale:ky(Sr)?Vn.x+=Yr-nn.height*ht.scale+(-Qt-1)*ht.scale:Vn.x+=ht.imageName||nn.width+2*Qt===In.w&&nn.height+2*Qt===In.h?(Yr-Mr)/2:(Yr-(nn.height+2*Qt)*ht.scale)/2,Xr=new Be(Vn.x,Vn.y-Rs),Ps=new Be(Vn.x+Mr,Vn.y),ir=new Be(Vn.x+Mr,Vn.y-Rs)}else{const Fn=(nn.left-Qt)*ht.scale-yn+vi[0],Zi=(-nn.top-Qt)*ht.scale+vi[1],Kr=Fn+Rs,ci=Zi+Mr;Vn=new Be(Fn,Zi),Xr=new Be(Kr,Zi),Ps=new Be(Fn,ci),ir=new Be(Kr,ci)}if(Ve){let Fn;Fn=Ae?new Be(0,0):qe?new Be(Ye[0],Ye[1]):new Be(ge[0],ge[1]),Vn._rotateAround(Ve,Fn),Xr._rotateAround(Ve,Fn),Ps._rotateAround(Ve,Fn),ir._rotateAround(Ve,Fn)}const Wi=new Be(0,0),Jn=new Be(0,0);Pe.push({tl:Vn,tr:Xr,bl:Ps,br:ir,tex:tt,writingMode:pe.writingMode,glyphOffset:pi,sectionIndex:ht.sectionIndex,isSDF:En,pixelOffsetTL:Wi,pixelOffsetBR:Jn,minFontScaleX:0,minFontScaleY:0})}}return Pe}(0,u,E,g,y,x,h,a.allowVerticalPlacement),le=a.textSizeData;let ce=null;"source"===le.kind?(ce=[Wo*g.layout.get("text-size").evaluate(x,{},W)],ce[0]>Xo&&Rn(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===le.kind&&(ce=[Wo*V.compositeTextSizes[0].evaluate(x,{},W),Wo*V.compositeTextSizes[1].evaluate(x,{},W)],(ce[0]>Xo||ce[1]>Xo)&&Rn(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,Q,ce,E,y,x,T,r,l,M.lineStartIndex,M.lineLength,B,$,W);for(const fe of k)R[fe]=a.text.placedSymbolArray.length-1;return 4*Q.length}function Ip(a){for(const r in a)return a[r];return null}function Md(a,r,l,u,h,g,y,x,E,M){let T=y.top,k=y.bottom,R=y.left,B=y.right;const V=y.collisionPadding;if(V&&(R-=V[0],T-=V[1],B+=V[2],k+=V[3]),E){const $=new Be(R,T),W=new Be(B,T),Q=new Be(R,k),le=new Be(B,k),ce=cn(E);let fe=new Be(0,0);M&&(fe=new Be(M[0],M[1])),$._rotateAround(ce,fe),W._rotateAround(ce,fe),Q._rotateAround(ce,fe),le._rotateAround(ce,fe),R=Math.min($.x,W.x,Q.x,le.x),B=Math.max($.x,W.x,Q.x,le.x),T=Math.min($.y,W.y,Q.y,le.y),k=Math.max($.y,W.y,Q.y,le.y)}return a.emplaceBack(r.x,r.y,r.z,l.x,l.y,R,T,B,k,x,u,h,g),a.length-1}function rv(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const r=a.bottom-a.top;return r>0?Math.max(10,r):null}function ob(a,r,l,u){const h=a.compareText;if(r in h){const g=h[r];for(let y=g.length-1;y>=0;y--)if(u.dist(g[y])<l)return!0}else h[r]=[];return h[r].push(u),!1}const ab=mu.VectorTileFeature.types,lb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function kp(a,r,l,u,h,g,y,x,E,M,T,k,R,B,V,$){const W=T?Math.min(Xo,Math.round(T[0])):0,Q=T?Math.min(Xo,Math.round(T[1])):0;a.emplaceBack(r,l,Math.round(32*y),Math.round(32*x),E,M,(W<<1)+(k?1:0),Q,16*R,16*B,256*V,256*$,u,h,g,0)}function Fp(a,r,l){a.emplaceBack(r.x,r.y,l),a.emplaceBack(r.x,r.y,l),a.emplaceBack(r.x,r.y,l),a.emplaceBack(r.x,r.y,l)}function ZC(a){for(const r of a.sections)if(zo(r.text))return!0;return!1}class xg{constructor(r){this.layoutVertexArray=new Te,this.indexArray=new st,this.programConfigurations=r,this.segments=new gi,this.dynamicLayoutVertexArray=new Ze,this.opacityVertexArray=new ye,this.placedSymbolArray=new Uo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,l,u,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,qC.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Qs.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,lb,!0),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}We(xg,"SymbolBuffers");class sv{constructor(r,l,u){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new u,this.segments=new gi,this.collisionVertexArray=new Re,this.collisionVertexArrayExt=new Ze}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,lg.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,cg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}We(sv,"CollisionBuffers");class _l{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(y=>y.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=qo([]),this.placementViewportMatrix=qo([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=xp(this.zoom,l["text-size"]),this.iconSizeData=xp(this.zoom,l["icon-size"]);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>Wr[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new xg(new dl(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new xg(new dl(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new _n,this.lineVertexArray=new yi,this.symbolInstances=new di}calculateGlyphDependencies(r,l,u,h,g){for(let y=0;y<r.length;y++)if(l[r.charCodeAt(y)]=!0,h&&g){const x=Fa[r.charAt(y)];x&&(l[x.charCodeAt(0)]=!0)}}populate(r,l,u,h){const g=this.layers[0],y=g.layout,x=y.get("text-font"),E=y.get("text-field"),M=y.get("icon-image"),T=("constant"!==E.value.kind||E.value.value instanceof Pi&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),k="constant"!==M.value.kind||!!M.value.value||Object.keys(M.parameters).length>0,R=y.get("symbol-sort-key");if(this.features=[],!T&&!k)return;const B=l.iconDependencies,V=l.glyphDependencies,$=l.availableImages,W=new $n(this.zoom);for(const{feature:Q,id:le,index:ce,sourceLayerIndex:fe}of r){const pe=g._featureFilter.needGeometry,ge=Aa(Q,pe);if(!g._featureFilter.filter(W,ge,u))continue;let Se,Ae;if(pe||(ge.geometry=Ho(Q,u,h)),T){const Ne=g.getValueAndResolveTokens("text-field",ge,u,$),De=Pi.factory(Ne);ZC(De)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===su()||this.hasRTLText&&ss.isParsed())&&(Se=WC(De,g,ge))}if(k){const Ne=g.getValueAndResolveTokens("icon-image",ge,u,$);Ae=Ne instanceof bs?Ne:bs.fromString(Ne)}if(!Se&&!Ae)continue;const Oe=this.sortFeaturesByKey?R.evaluate(ge,{},u):void 0;if(this.features.push({id:le,text:Se,icon:Ae,index:ce,sourceLayerIndex:fe,geometry:ge.geometry,properties:Q.properties,type:ab[Q.type],sortKey:Oe}),Ae&&(B[Ae.name]=!0),Se){const Ne=x.evaluate(ge,{},u).join(","),De="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Wr.vertical)>=0;for(const Pe of Se.sections)if(Pe.image)B[Pe.image.name]=!0;else{const Ve=dd(Se.toString()),Ye=Pe.fontStack||Ne,Ge=V[Ye]=V[Ye]||{};this.calculateGlyphDependencies(Pe.text,Ge,De,this.allowVerticalPlacement,Ve)}}}"line"===y.get("symbol-placement")&&(this.features=function(Q){const le={},ce={},fe=[];let pe=0;function ge(Ne){fe.push(Q[Ne]),pe++}function Se(Ne,De,Pe){const Ve=ce[Ne];return delete ce[Ne],ce[De]=Ve,fe[Ve].geometry[0].pop(),fe[Ve].geometry[0]=fe[Ve].geometry[0].concat(Pe[0]),Ve}function Ae(Ne,De,Pe){const Ve=le[De];return delete le[De],le[Ne]=Ve,fe[Ve].geometry[0].shift(),fe[Ve].geometry[0]=Pe[0].concat(fe[Ve].geometry[0]),Ve}function Oe(Ne,De,Pe){const Ve=Pe?De[0][De[0].length-1]:De[0][0];return`${Ne}:${Ve.x}:${Ve.y}`}for(let Ne=0;Ne<Q.length;Ne++){const De=Q[Ne],Pe=De.geometry,Ve=De.text?De.text.toString():null;if(!Ve){ge(Ne);continue}const Ye=Oe(Ve,Pe),Ge=Oe(Ve,Pe,!0);if(Ye in ce&&Ge in le&&ce[Ye]!==le[Ge]){const Xe=Ae(Ye,Ge,Pe),St=Se(Ye,Ge,fe[Xe].geometry);delete le[Ye],delete ce[Ge],ce[Oe(Ve,fe[St].geometry,!0)]=St,fe[Xe].geometry=null}else Ye in ce?Se(Ye,Ge,Pe):Ge in le?Ae(Ye,Ge,Pe):(ge(Ne),le[Ye]=pe-1,ce[Ge]=pe-1)}return fe.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,le)=>Q.sortKey-le.sortKey)}update(r,l,u,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,l,this.layers,u,h),this.icon.programConfigurations.updatePaintArrays(r,l,this.layers,u,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const u=this.lineVertexArray.length,h=r.segment;if(void 0!==h){let g=r.dist(l[h+1]),y=r.dist(l[h]);const x={};for(let E=h+1;E<l.length;E++)x[E]={x:l[E].x,y:l[E].y,tileUnitDistanceFromAnchor:g},E<l.length-1&&(g+=l[E+1].dist(l[E]));for(let E=h||0;E>=0;E--)x[E]={x:l[E].x,y:l[E].y,tileUnitDistanceFromAnchor:y},E>0&&(y+=l[E-1].dist(l[E]));for(let E=0;E<l.length;E++){const M=x[E];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,l,u,h,g,y,x,E,M,T,k,R,B,V){const $=r.indexArray,W=r.layoutVertexArray,Q=r.segments.prepareSegment(4*l.length,W,$,this.canOverlap?y.sortKey:void 0),le=this.glyphOffsetArray.length,ce=Q.vertexLength,fe=this.allowVerticalPlacement&&x===Wr.vertical?Math.PI/2:0,pe=y.text&&y.text.sections;for(let ge=0;ge<l.length;ge++){const{tl:Se,tr:Ae,bl:Oe,br:Ne,tex:De,pixelOffsetTL:Pe,pixelOffsetBR:Ve,minFontScaleX:Ye,minFontScaleY:Ge,glyphOffset:Xe,isSDF:St,sectionIndex:Yt}=l[ge],At=Q.vertexLength,kt=Xe[1];kp(W,E.x,E.y,E.z,M.x,M.y,Se.x,kt+Se.y,De.x,De.y,u,St,Pe.x,Pe.y,Ye,Ge),kp(W,E.x,E.y,E.z,M.x,M.y,Ae.x,kt+Ae.y,De.x+De.w,De.y,u,St,Ve.x,Pe.y,Ye,Ge),kp(W,E.x,E.y,E.z,M.x,M.y,Oe.x,kt+Oe.y,De.x,De.y+De.h,u,St,Pe.x,Ve.y,Ye,Ge),kp(W,E.x,E.y,E.z,M.x,M.y,Ne.x,kt+Ne.y,De.x+De.w,De.y+De.h,u,St,Ve.x,Ve.y,Ye,Ge),Fp(r.dynamicLayoutVertexArray,E,fe),$.emplaceBack(At,At+1,At+2),$.emplaceBack(At+1,At+2,At+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xe[0]),ge!==l.length-1&&Yt===l[ge+1].sectionIndex||r.programConfigurations.populatePaintArrays(W.length,y,y.index,{},B,V,pe&&pe[Yt])}r.placedSymbolArray.emplaceBack(E.x,E.y,E.z,M.x,M.y,le,this.glyphOffsetArray.length-le,ce,T,k,M.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],x,0,!1,0,R,0)}_commitLayoutVertex(r,l,u,h,g,y,x){r.emplaceBack(l,u,h,g,y,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(r,l,u,h,g,y,x){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),M=E.vertexLength,T=x.tileAnchorX,k=x.tileAnchorY;for(let B=0;B<4;B++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(l,-r.padding,-r.padding),u.collisionVertexArrayExt.emplaceBack(l,r.padding,-r.padding),u.collisionVertexArrayExt.emplaceBack(l,r.padding,r.padding),u.collisionVertexArrayExt.emplaceBack(l,-r.padding,r.padding),this._commitLayoutVertex(u.layoutVertexArray,h,g,y,T,k,new Be(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,g,y,T,k,new Be(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,g,y,T,k,new Be(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,g,y,T,k,new Be(r.x1,r.y2)),E.vertexLength+=4;const R=u.indexArray;R.emplaceBack(M,M+1),R.emplaceBack(M+1,M+2),R.emplaceBack(M+2,M+3),R.emplaceBack(M+3,M),E.primitiveLength+=4}_addTextDebugCollisionBoxes(r,l,u,h,g,y){for(let x=h;x<g;x++){const E=u.get(x),M=this.getSymbolInstanceTextSize(r,y,l,x);this._addCollisionDebugVertices(E,M,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(r,l,u,h,g,y){for(let x=h;x<g;x++){const E=u.get(x),M=this.getSymbolInstanceIconSize(r,l,x);this._addCollisionDebugVertices(E,M,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}generateCollisionDebugBuffers(r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new sv(Ue,Ay.members,Dt),this.iconCollisionBox=new sv(Ue,Ay.members,Dt);const u=nc(this.iconSizeData,r),h=nc(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(h,r,l,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(h,r,l,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,r,l,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,r,l,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(r,l,u,h){const g=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:h),y=wd(this.textSizeData,r,g)/24;return this.tilePixelRatio*y}getSymbolInstanceIconSize(r,l,u){const h=this.icon.placedSymbolArray.get(u),g=wd(this.iconSizeData,r,h);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(r,l,u){r.emplaceBack(l,-u,-u),r.emplaceBack(l,u,-u),r.emplaceBack(l,u,u),r.emplaceBack(l,-u,u)}_updateTextDebugCollisionBoxes(r,l,u,h,g,y){for(let x=h;x<g;x++){const E=u.get(x),M=this.getSymbolInstanceTextSize(r,y,l,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,E.padding)}}_updateIconDebugCollisionBoxes(r,l,u,h,g){for(let y=h;y<g;y++){const x=u.get(y),E=this.getSymbolInstanceIconSize(r,l,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,x.padding)}}updateCollisionDebugBuffers(r,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=nc(this.iconSizeData,r),h=nc(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(h,r,l,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(h,r,l,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(u,r,l,y.iconBoxStartIndex,y.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(u,r,l,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,l,u,h,g,y,x,E,M){const T={};for(let k=l;k<u;k++){const R=r.get(k);T.textBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},T.textFeatureIndex=R.featureIndex;break}for(let k=h;k<g;k++){const R=r.get(k);T.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},T.verticalTextFeatureIndex=R.featureIndex;break}for(let k=y;k<x;k++){const R=r.get(k);T.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},T.iconFeatureIndex=R.featureIndex;break}for(let k=E;k<M;k++){const R=r.get(k);T.verticalIconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},T.verticalIconFeatureIndex=R.featureIndex;break}return T}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,l){const u=r.placedSymbolArray.get(l),h=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<h;g+=4)r.indexArray.emplaceBack(g,g+1,g+2),r.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(r),u=Math.cos(r),h=[],g=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const E=this.symbolInstances.get(x);h.push(0|Math.round(l*E.tileAnchorX+u*E.tileAnchorY)),g.push(E.featureIndex)}return y.sort((x,E)=>h[x]-h[E]||g[E]-g[x]),y}addToSortKeyRanges(r,l){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===l?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const u=this.symbolInstances.get(l);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((h,g,y)=>{h>=0&&y.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}We(_l,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),_l.MAX_GLYPHS=65535,_l.addDynamicAttributes=Fp;const ov=new z({"symbol-placement":new D(we.layout_symbol["symbol-placement"]),"symbol-spacing":new D(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new D(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new A(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new D(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new D(we.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new D(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new D(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new D(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new A(we.layout_symbol["icon-size"]),"icon-text-fit":new D(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new D(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new A(we.layout_symbol["icon-image"]),"icon-rotate":new A(we.layout_symbol["icon-rotate"]),"icon-padding":new D(we.layout_symbol["icon-padding"]),"icon-keep-upright":new D(we.layout_symbol["icon-keep-upright"]),"icon-offset":new A(we.layout_symbol["icon-offset"]),"icon-anchor":new A(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new D(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new D(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new D(we.layout_symbol["text-rotation-alignment"]),"text-field":new A(we.layout_symbol["text-field"]),"text-font":new A(we.layout_symbol["text-font"]),"text-size":new A(we.layout_symbol["text-size"]),"text-max-width":new A(we.layout_symbol["text-max-width"]),"text-line-height":new A(we.layout_symbol["text-line-height"]),"text-letter-spacing":new A(we.layout_symbol["text-letter-spacing"]),"text-justify":new A(we.layout_symbol["text-justify"]),"text-radial-offset":new A(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new D(we.layout_symbol["text-variable-anchor"]),"text-anchor":new A(we.layout_symbol["text-anchor"]),"text-max-angle":new D(we.layout_symbol["text-max-angle"]),"text-writing-mode":new D(we.layout_symbol["text-writing-mode"]),"text-rotate":new A(we.layout_symbol["text-rotate"]),"text-padding":new D(we.layout_symbol["text-padding"]),"text-keep-upright":new D(we.layout_symbol["text-keep-upright"]),"text-transform":new A(we.layout_symbol["text-transform"]),"text-offset":new A(we.layout_symbol["text-offset"]),"text-allow-overlap":new D(we.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new D(we.layout_symbol["text-ignore-placement"]),"text-optional":new D(we.layout_symbol["text-optional"])});var bg={paint:new z({"icon-opacity":new A(we.paint_symbol["icon-opacity"]),"icon-color":new A(we.paint_symbol["icon-color"]),"icon-halo-color":new A(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new A(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new A(we.paint_symbol["icon-halo-blur"]),"icon-translate":new D(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new D(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new A(we.paint_symbol["text-opacity"]),"text-color":new A(we.paint_symbol["text-color"],{runtimeType:jn,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new A(we.paint_symbol["text-halo-color"]),"text-halo-width":new A(we.paint_symbol["text-halo-width"]),"text-halo-blur":new A(we.paint_symbol["text-halo-blur"]),"text-translate":new D(we.paint_symbol["text-translate"]),"text-translate-anchor":new D(we.paint_symbol["text-translate-anchor"])}),layout:ov};class Rp{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:To,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}We(Rp,"FormatSectionOverride",{omit:["defaultValue"]});class wg extends Ss{constructor(r){super(r,bg)}recalculate(r,l){super.recalculate(r,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const g of u)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,l,u,h){const g=this.layout.get(r).evaluate(l,{},u,h),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||Vl(y.value)||!g?g:(x=l.properties,g.replace(/{([^{}]+)}/g,(M,T)=>T in x?String(x[T]):""));var x}createBucket(r){return new _l(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of bg.paint.overridableProperties){if(!wg.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),u=new Rp(l),h=new Qu(u,l.property.specification);let g=null;g="constant"===l.value.kind||"source"===l.value.kind?new rs("source",h):new Kc("composite",h,l.value.zoomStops,l.value._interpolationType),this.paint._values[r]=new b(l.property,g,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,u){return!(!this.layout||l.isDataDriven()||u.isDataDriven())&&wg.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const u=r.get("text-field"),h=bg.paint.properties[l];let g=!1;const y=x=>{for(const E of x)if(h.overrides&&h.overrides.hasOverride(E))return void(g=!0)};if("constant"===u.value.kind&&u.value.value instanceof Pi)y(u.value.value.sections);else if("source"===u.value.kind){const x=M=>{g||(M instanceof _a&&Mi(M.value)===ga?y(M.value.sections):M instanceof zc?y(M.sections):M.eachChild(x))},E=u.value;E._styleExpression&&x(E._styleExpression.expression)}return g}getProgramConfiguration(r){return new hi(this,r)}}var XC={paint:new z({"background-color":new D(we.paint_background["background-color"]),"background-pattern":new P(we.paint_background["background-pattern"]),"background-opacity":new D(we.paint_background["background-opacity"])})},KC={paint:new z({"raster-opacity":new D(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new D(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new D(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new D(we.paint_raster["raster-brightness-max"]),"raster-saturation":new D(we.paint_raster["raster-saturation"]),"raster-contrast":new D(we.paint_raster["raster-contrast"]),"raster-resampling":new D(we.paint_raster["raster-resampling"]),"raster-fade-duration":new D(we.paint_raster["raster-fade-duration"])})};class YC extends Ss{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var QC={paint:new z({"sky-type":new D(we.paint_sky["sky-type"]),"sky-atmosphere-sun":new D(we.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new D(we.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new D(we.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new D(we.paint_sky["sky-gradient-radius"]),"sky-gradient":new O(we.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new D(we.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new D(we.paint_sky["sky-atmosphere-color"]),"sky-opacity":new D(we.paint_sky["sky-opacity"])})};function av(a,r,l){const u=[0,0,1],h=uy([]);return function(g,y,x){x*=.5;var E=y[0],M=y[1],T=y[2],k=y[3],R=Math.sin(x),B=Math.cos(x);g[0]=E*B-T*R,g[1]=M*B+k*R,g[2]=T*B+E*R,g[3]=k*B-M*R}(h,h,l?-cn(a)+Math.PI:cn(a)),Is(h,h,-cn(r)),qm(u,u,h),pp(u,u)}const JC={circle:class extends Ss{constructor(a){super(a,M0)}createBucket(a){return new zm(a)}queryRadius(a){const r=a;return gd("circle-radius",this,r)+gd("circle-stroke-width",this,r)+Ql(this.paint.get("circle-translate"))}queryIntersectsFeature(a,r,l,u,h,g,y,x){const E=Um(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l);return dy(a,u,g,y,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,M)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new hi(this,a)}},heatmap:class extends Ss{createBucket(a){return new Wm(a)}constructor(a){super(a,R0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return gd("heatmap-radius",this,a)}queryIntersectsFeature(a,r,l,u,h,g,y,x){const E=this.paint.get("heatmap-radius").evaluate(r,l);return dy(a,u,g,y,x,!0,!0,new Be(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new hi(this,a)}},hillshade:class extends Ss{constructor(a){super(a,my)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ss{constructor(a){super(a,qr)}getProgramIds(){const a=this.paint.get("fill-pattern"),r=a&&a.constantOr(1),l=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new hi(this,a)}recalculate(a,r){super.recalculate(a,r);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new qh(a)}queryRadius(){return Ql(this.paint.get("fill-translate"))}queryIntersectsFeature(a,r,l,u,h,g){return!a.queryGeometry.isAboveHorizon&&pd(Ts(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Ss{constructor(a){super(a,$0)}createBucket(a){return new Xh(a)}queryRadius(){return Ql(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new hi(this,a)}queryIntersectsFeature(a,r,l,u,h,g,y,x,E){const M=Um(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(r,l),k=this.paint.get("fill-extrusion-base").evaluate(r,l),R=[0,0],B=x&&g.elevation,V=g.elevation?g.elevation.exaggeration():1,$=a.tile.getBucket(this);if(B&&$ instanceof Xh){const le=$.centroidVertexArray,ce=E+1;if(ce<le.length){const fe=le.get(ce);R[0]=fe.a_centroid_pos0,R[1]=fe.a_centroid_pos1}}if(0===R[0]&&1===R[1])return!1;const W=(le=u,ce=k,fe=T,pe=M,ge=y,(Se=B?x:null)?function(De,Pe,Ve,Ye,Ge,Xe,St,Yt,At){const kt=[],ht=[],tt=[0,0,0,1];for(const Qt of De){const En=[],zn=[];for(const Yn of Qt){const Bi=Yn.x+Ye.x,yn=Yn.y+Ye.y,nn=H0(Bi,yn,Pe,Ve,Xe,St,Yt,At);tt[0]=Bi,tt[1]=yn,tt[2]=nn.base,tt[3]=1,yd(tt,tt,Ge),tt[3]=Math.max(tt[3],1e-5);const In=My([tt[0]/tt[3],tt[1]/tt[3],tt[2]/tt[3]]);tt[0]=Bi,tt[1]=yn,tt[2]=nn.top,tt[3]=1,yd(tt,tt,Ge),tt[3]=Math.max(tt[3],1e-5);const pi=My([tt[0]/tt[3],tt[1]/tt[3],tt[2]/tt[3]]);En.push(In),zn.push(pi)}kt.push(En),ht.push(zn)}return[kt,ht]}(le,ce,fe,pe,ge,Se,R,V,g.center.lat):function(De,Pe,Ve,Ye,Ge){const Xe=[],St=[],Yt=Ge[8]*Pe,At=Ge[9]*Pe,kt=Ge[10]*Pe,ht=Ge[11]*Pe,tt=Ge[8]*Ve,Qt=Ge[9]*Ve,En=Ge[10]*Ve,zn=Ge[11]*Ve;for(const Yn of De){const Bi=[],yn=[];for(const nn of Yn){const In=nn.x+Ye.x,pi=nn.y+Ye.y,vi=Ge[0]*In+Ge[4]*pi+Ge[12],wi=Ge[1]*In+Ge[5]*pi+Ge[13],qe=Ge[2]*In+Ge[6]*pi+Ge[14],Rs=Ge[3]*In+Ge[7]*pi+Ge[15],Mr=vi+Yt,Vn=wi+At,Xr=qe+kt,Ps=Math.max(Rs+ht,1e-5),ir=vi+tt,Wi=wi+Qt,Jn=qe+En,Fn=Math.max(Rs+zn,1e-5),Zi=new Be(Mr/Ps,Vn/Ps);Zi.z=Xr/Ps,Bi.push(Zi);const Kr=new Be(ir/Fn,Wi/Fn);Kr.z=Jn/Fn,yn.push(Kr)}Xe.push(Bi),St.push(yn)}return[Xe,St]}(le,ce,fe,pe,ge)),Q=a.queryGeometry;var le,ce,fe,pe,ge,Se;return function(le,ce,fe){let pe=1/0;pd(fe,ce)&&(pe=og(fe,ce[0]));for(let ge=0;ge<ce.length;ge++){const Se=ce[ge],Ae=le[ge];for(let Oe=0;Oe<Se.length-1;Oe++){const Ne=Se[Oe],De=[Ne,Se[Oe+1],Ae[Oe+1],Ae[Oe],Ne];Vm(fe,De)&&(pe=Math.min(pe,og(fe,De)))}}return pe!==1/0&&pe}(W[0],W[1],Q.isPointQuery()?Q.screenBounds:Q.screenGeometry)}},line:class extends Ss{constructor(a){super(a,Y0),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof Xu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,r){super.recalculate(a,r),this.paint._values["line-floorwidth"]=Q0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new fl(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new hi(this,a)}queryRadius(a){const r=a,l=ag(gd("line-width",this,r),gd("line-gap-width",this,r)),u=gd("line-offset",this,r);return l/2+Math.abs(u)+Ql(this.paint.get("line-translate"))}queryIntersectsFeature(a,r,l,u,h,g){if(a.queryGeometry.isAboveHorizon)return!1;const y=Ts(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),x=a.pixelToTileUnitsFactor/2*ag(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),E=this.paint.get("line-offset").evaluate(r,l);return E&&(u=function(M,T){const k=[],R=new Be(0,0);for(let B=0;B<M.length;B++){const V=M[B],$=[];for(let W=0;W<V.length;W++){const Q=V[W-1],le=V[W],ce=V[W+1],fe=0===W?R:le.sub(Q)._unit()._perp(),pe=W===V.length-1?R:ce.sub(le)._unit()._perp(),ge=fe._add(pe)._unit();ge._mult(1/(ge.x*pe.x+ge.y*pe.y)),$.push(ge._mult(T)._add(le))}k.push($)}return k}(u,E*a.pixelToTileUnitsFactor)),function(M,T,k){for(let R=0;R<T.length;R++){const B=T[R];if(M.length>=3)for(let V=0;V<B.length;V++)if(Ta(M,B[V]))return!0;if(ry(M,B,k))return!0}return!1}(y,u,x)}isTileClipped(){return!0}},symbol:wg,background:class extends Ss{constructor(a){super(a,XC)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ss{constructor(a){super(a,KC)}getProgramIds(){return["raster"]}},sky:class extends Ss{constructor(a){super(a,QC),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=fu({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(a,r){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),h=!u,g=a.style.light,y=g.properties.get("position");return h&&"viewport"===g.properties.get("anchor")&&Rn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?av(y.azimuthal,90-y.polar,r):av(u[0],90-u[1],r)}const l=this.paint.get("sky-gradient-center");return av(l[0],90-l[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class Pp{constructor(r,l,u,h){this.context=r,this.format=u,this.texture=r.gl.createTexture(),this.update(l,h)}update(r,l,u){const{width:h,height:g}=r,{context:y}=this,{gl:x}=y,{HTMLImageElement:E,HTMLCanvasElement:M,HTMLVideoElement:T,ImageData:k,ImageBitmap:R}=gt;if(x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!l||!1!==l.premultiply)),u||this.size&&this.size[0]===h&&this.size[1]===g){const{x:B,y:V}=u||{x:0,y:0};r instanceof E||r instanceof M||r instanceof T||r instanceof k||R&&r instanceof R?x.texSubImage2D(x.TEXTURE_2D,0,B,V,x.RGBA,x.UNSIGNED_BYTE,r):x.texSubImage2D(x.TEXTURE_2D,0,B,V,h,g,x.RGBA,x.UNSIGNED_BYTE,r.data)}else this.size=[h,g],r instanceof E||r instanceof M||r instanceof T||r instanceof k||R&&r instanceof R?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,r):x.texImage2D(x.TEXTURE_2D,0,this.format,h,g,0,this.format,x.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(r,l){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?r===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:r),this.filter=r),l!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,l),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class lv{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.image=new hl({width:r,height:l}),this.positions={},this.uploaded=!1}getDash(r,l){const u=this.getKey(r,l);return this.positions[u]}trim(){const r=this.width,l=this.height=Yd(this.nextRow);this.image.resize({width:r,height:l})}getKey(r,l){return r.join(",")+l}getDashRanges(r,l,u){const h=[];let g=r.length%2==1?-r[r.length-1]*u:0,y=r[0]*u,x=!0;h.push({left:g,right:y,isDash:x,zeroLength:0===r[0]});let E=r[0];for(let M=1;M<r.length;M++){x=!x;const T=r[M];g=E*u,E+=T,y=E*u,h.push({left:g,right:y,isDash:x,zeroLength:0===T})}return h}addRoundDash(r,l,u){const h=l/2;for(let g=-u;g<=u;g++){const y=this.width*(this.nextRow+u+g);let x=0,E=r[x];for(let M=0;M<this.width;M++){M/E.right>1&&(E=r[++x]);const T=Math.abs(M-E.left),k=Math.abs(M-E.right),R=Math.min(T,k);let B;const V=g/u*(h+1);if(E.isDash){const $=h-Math.abs(V);B=Math.sqrt(R*R+$*$)}else B=h-Math.sqrt(R*R+V*V);this.image.data[y+M]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(r,l){for(let E=r.length-1;E>=0;--E){const M=r[E],T=r[E+1];M.zeroLength?r.splice(E,1):T&&T.isDash===M.isDash&&(T.left=M.left,r.splice(E,1))}const u=r[0],h=r[r.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const g=this.width*this.nextRow;let y=0,x=r[y];for(let E=0;E<this.width;E++){E/x.right>1&&(x=r[++y]);const M=Math.abs(E-x.left),T=Math.abs(E-x.right),k=Math.min(M,T);this.image.data[g+E]=Math.max(0,Math.min(255,(x.isDash?k:-k)+l+128))}}addDash(r,l){const u=this.getKey(r,l);if(this.positions[u])return this.positions[u];const h="round"===l,g=h?7:0,y=2*g+1;if(this.nextRow+y>this.height)return Rn("LineAtlas out of space"),null;0===r.length&&r.push(1);let x=0;for(let T=0;T<r.length;T++)r[T]<0&&(Rn("Negative value is found in line dasharray, replacing values with 0"),r[T]=0),x+=r[T];if(0!==x){const T=this.width/x,k=this.getDashRanges(r,this.width,T);h?this.addRoundDash(k,T,g):this.addRegularDash(k,"square"===l?.5*T:0)}const E=this.nextRow+g;this.nextRow+=y;const M={tl:[E,g],br:[x,0]};return this.positions[u]=M,M}}We(lv,"LineAtlas");class eE{constructor(r){this._callback=r,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const sc=gt.performance;function Op(a){const r=a?a.url.toString():void 0;return sc.getEntriesByName(r)}class cb{constructor(){this.tasks={},this.taskQueue=[],un(["process"],this),this.invoker=new eE(this.process),this.nextId=0}add(r,l){const u=this.nextId++,h=function({type:g,isSymbolTile:y,zoom:x}){return x=x||0,"message"===g?0:"maybePrepare"!==g||y?"parseTile"!==g||y?"parseTile"===g&&y?300-x:"maybePrepare"===g&&y?400-x:500:200-x:100-x}(l);if(0===h){Cn();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:r,metadata:l,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){Cn();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const l=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let r=null,l=1/0;for(let h=0;h<this.taskQueue.length;h++){const g=this.tasks[this.taskQueue[h]];g.priority<l&&(l=g.priority,r=h)}if(null===r)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}const cv=ie([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),Cg=ie([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Eg}=cv,Lp=ie([{name:"a_pos_3",components:3,type:"Int16"}]);var sf=ie([{name:"a_pos",type:"Int16",components:2}]);const Js=Rt/Math.PI/2,us=-Js,Fs=Js,Dg=[new ks([us,us,us],[Fs,Fs,Fs]),new ks([us,us,us],[0,0,Fs]),new ks([0,us,us],[Fs,0,Fs]),new ks([us,0,us],[0,Fs,Fs]),new ks([0,0,us],[Fs,Fs,Fs])];class ub{constructor(r,l,u){this.a=_o([],r,u),this.b=_o([],l,u),this.center=u;const h=pp([],this.a),g=pp([],this.b);this.angle=Math.acos(ec(h,g))}}function Bp(a,r){if(0===a.angle)return null;let l;return l=0===a.a[r]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[r]/a.a[r]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(u,h,g,y){const x=Math.sin(g);return u*(Math.sin((1-y)*g)/x)+h*(Math.sin(y*g)/x)}(a.a[r],a.b[r],a.angle,on(l,0,1))+a.center[r]}function af(a){if(a.z<=1)return Dg[a.z+2*a.y+a.x];const[r,l]=vu(a),u=[Ko(r[0],r[1]),Ko(r[0],l[1]),Ko(l[0],r[1]),Ko(l[0],l[1])],h=[Fs,Fs,Fs],g=[us,us,us];for(const y of u)h[0]=Math.min(h[0],y[0]),h[1]=Math.min(h[1],y[1]),h[2]=Math.min(h[2],y[2]),g[0]=Math.max(g[0],y[0]),g[1]=Math.max(g[1],y[1]),g[2]=Math.max(g[2],y[2]);return new ks(h,g)}function vu(a){const r=1<<a.z,l=a.x/r,u=(a.x+1)/r,h=(a.y+1)/r;return[[fr(a.y/r),go(l)],[fr(h),go(u)]]}function xu(a,r,l,u=Js){return l=cn(l),[a*Math.sin(l)*u,-r*u,a*Math.cos(l)*u]}function Ko(a,r,l){return xu(Math.cos(cn(a)),Math.sin(cn(a)),r,l)}function bu(a,r,l){const u=Math.pow(2,l.z),h=(a/Rt+l.x)/u;return Ko(fr((r/Rt+l.y)/u),go(h))}function wu(a){return 16383/Math.max(..._o([],a.max,a.min))}function Cu(a){const r=qo(new Float64Array(16)),l=wu(a);var u,h;return Xs(r,r,[l,l,l]),du(r,r,((u=[])[0]=-(h=a.min)[0],u[1]=-h[1],u[2]=-h[2],u)),r}function uv(a,r,l,u,h){const g=function(E){const M=Rt/(2*Math.PI);return E/(2*Math.PI)/M}(l),y=[a,r,-l/(2*Math.PI)],x=qo(new Float64Array(16));return du(x,x,y),Xs(x,x,[g,g,g]),hu(x,x,cn(-h)),$m(x,x,cn(-u)),x}function Mg(a){const{x:r,y:l}=a.point,{lng:u,lat:h}=a._center;return uv(r,l,a.worldSize,u,h)}const Sg=cn(85),Ag=Math.cos(Sg),Tg=Math.sin(Sg);function Ig(a,r,l){var u=2*Math.PI*6378137/256/Math.pow(2,l);return[a*u-2*Math.PI*6378137/2,r*u-2*Math.PI*6378137/2]}class Eu{constructor(r,l,u){this.z=r,this.x=l,this.y=u,this.key=Np(0,r,r,l,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l){const u=(y=this.y,x=this.z,E=Ig(256*(g=this.x),256*(y=Math.pow(2,x)-y-1),x),M=Ig(256*(g+1),256*(y+1),x),E[0]+","+E[1]+","+M[0]+","+M[1]),h=function(g,y,x){let E,M="";for(let T=g;T>0;T--)E=1<<T-1,M+=(y&E?1:0)+(x&E?2:0);return M}(this.z,this.x,this.y);var g,y,x,E,M;return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dv{constructor(r,l){this.wrap=r,this.canonical=l,this.key=Np(r,l.z,l.z,l.x,l.y)}}class Dr{constructor(r,l,u,h,g){this.overscaledZ=r,this.wrap=l,this.canonical=new Eu(u,+h,+g),this.key=0===l&&r===u?this.canonical.key:Np(l,r,u,h,g)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const l=this.canonical.z-r;return r>this.canonical.z?new Dr(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Dr(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l=!0){if(this.overscaledZ===r&&l)return this.key;if(r>this.canonical.z)return Np(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return Np(this.wrap*+l,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new Dr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new Dr(l,this.wrap,l,u,h),new Dr(l,this.wrap,l,u+1,h),new Dr(l,this.wrap,l,u,h+1),new Dr(l,this.wrap,l,u+1,h+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Dr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Dr(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Np(a,r,l,u,h){const g=1<<Math.min(l,22);let y=g*(h%g)+u%g;return a&&l<22&&(y+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*y+l)+(r-l)}function oc(a,r){if(!r.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:r};const l=Math.pow(2,-a.z),u=a.x*l,h=(a.x+1)*l,g=a.y*l,y=(a.y+1)*l,x=go(u),E=go(h),M=fr(g),T=fr(y),k=r.project(x,M),R=r.project(E,M),B=r.project(E,T),V=r.project(x,T);let $=Math.min(k.x,R.x,B.x,V.x),W=Math.min(k.y,R.y,B.y,V.y),Q=Math.max(k.x,R.x,B.x,V.x),le=Math.max(k.y,R.y,B.y,V.y);const ce=l/16;function fe(ge,Se,Ae,Oe,Ne,De){const Pe=(Ae+Ne)/2,Ve=(Oe+De)/2,Ye=r.project(go(Pe),fr(Ve)),Ge=Math.max(0,$-Ye.x,W-Ye.y,Ye.x-Q,Ye.y-le);$=Math.min($,Ye.x),Q=Math.max(Q,Ye.x),W=Math.min(W,Ye.y),le=Math.max(le,Ye.y),Ge>ce&&(fe(ge,Ye,Ae,Oe,Pe,Ve),fe(Ye,Se,Pe,Ve,Ne,De))}fe(k,R,u,g,h,g),fe(R,B,h,g,h,y),fe(B,V,h,y,u,y),fe(V,k,u,y,u,g),$-=ce,W-=ce,Q+=ce,le+=ce;const pe=1/Math.max(Q-$,le-W);return{scale:pe,x:$*pe,y:W*pe,x2:Q*pe,y2:le*pe,projection:r}}We(Eu,"CanonicalTileID"),We(Dr,"OverscaledTileID",{omit:["projMatrix"]});class kg{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const u=r[l];this._stringToNumber[u]=l,this._numberToString[l]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const hb=["tile","layer","source","sourceLayer","state"];class Fg{constructor(r,l,u,h,g){this.type="Feature",this._vectorTileFeature=r,this._z=l,this._x=u,this._y=h,this.properties=r.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(r.id=this.id);for(const l of hb)void 0!==this[l]&&(r[l]=this[l]);return r}}const qi=new Uint16Array(8184);for(let a=0;a<2046;a++){let r=a+2,l=0,u=0,h=0,g=0,y=0,x=0;for(1&r?h=g=y=32:l=u=x=32;(r>>=1)>1;){const M=l+h>>1,T=u+g>>1;1&r?(h=l,g=u,l=y,u=x):(l=h,u=g,h=y,g=x),y=M,x=T}const E=4*a;qi[E+0]=l,qi[E+1]=u,qi[E+2]=h,qi[E+3]=g}const Oa=new Uint16Array(2178),ac=new Uint8Array(1089),Rg=new Uint16Array(1089);function fb(a){return 0===a?-.03125:32===a?.03125:0}var Pg=ie([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const pb={type:2,extent:Rt,loadGeometry:()=>[[new Be(0,0),new Be(8193,0),new Be(8193,8193),new Be(0,8193),new Be(0,0)]]};class Og{constructor(r,l,u,h,g){this.tileID=r,this.uid=la(),this.uses=0,this.tileSize=l,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(r){const l=r+this.timeAdded;l<Rr.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=oc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,l,u){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(h,g){const y={};if(!g)return y;for(const x of h){const E=x.layerIds.map(M=>g.getLayer(M)).filter(Boolean);if(0!==E.length){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(M=>E.filter(T=>T.id===M)[0]));for(const M of E)y[M.id]=x}}return y}(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const g=this.buckets[h];if(g instanceof _l){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const g=this.buckets[h];if(g instanceof _l&&g.hasRTLText){this.hasRTLText=!0,ss.isLoading()||ss.isLoaded()||"deferred"!==su()||jo();break}}this.queryPadding=0;for(const h in this.buckets){const g=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(h).queryRadius(g))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new Ds}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const u in this.buckets){const h=this.buckets[u];h.uploadPending()&&h.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Pp(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Pp(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Pp(r,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,u,h,g,y,x,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:x,transform:y,params:g,tileTransform:this.tileTransform},r,l,u):{}}querySourceFeatures(r,l){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const h=u.loadVTLayers(),g=l?l.sourceLayer:"",y=h._geojsonTileLayer||h[g];if(!y)return;const x=ol(l&&l.filter),{z:E,x:M,y:T}=this.tileID.canonical,k={z:E,x:M,y:T};for(let R=0;R<y.length;R++){const B=y.feature(R);if(x.needGeometry){const W=Aa(B,!0);if(!x.filter(new $n(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!x.filter(new $n(this.tileID.overscaledZ),B))continue;const V=u.getId(B,g),$=new Fg(B,E,M,T,V);$.tile=k,r.push($)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const u=Tt(r.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const u=Date.now();let h=!1;if(this.expirationTime>u)h=!1;else if(l)if(this.expirationTime<l)h=!0;else{const g=this.expirationTime-l;g?this.expirationTime=u+Math.max(g,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!l)return;const u=this.latestFeatureIndex.loadVTLayers(),h=l.style.listImages();for(const g in this.buckets){if(!l.style.hasLayer(g))continue;const y=this.buckets[g],x=y.layers[0].sourceLayer||"_geojsonTileLayer",E=u[x],M=r[x];if(!E||!M||0===Object.keys(M).length)continue;if(y.update(M,E,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof fl||y instanceof qh){const k=l.style._getSourceCache(y.layers[0].source);l._terrain&&l._terrain.enabled&&k&&y.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(k.id,this.tileID)}const T=l&&l.style&&l.style.getLayer(g);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Rr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=Rr.now()+r}setTexture(r,l){const u=l.context,h=u.gl;this.texture=l.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new Pp(u,r,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),u.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax))}setDependencies(r,l){const u={};for(const h of l)u[h]=!0;this.dependencies[r]=u}hasDependency(r,l){for(const u of r){const h=this.dependencies[u];if(h)for(const g of l)if(h[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const u=Ho(pb,this.tileID.canonical,this.tileTransform)[0],h=new te,g=new rn;for(let y=0;y<u.length;y++){const{x,y:E}=u[y];h.emplaceBack(x,E),g.emplaceBack(y)}g.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(g),this._tileDebugBuffer=r.createVertexBuffer(h,sf.members),this._tileDebugSegments=gi.simpleSegment(0,0,h.length,g.length)}_makeTileBoundsBuffers(r,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const u=Ho(pb,this.tileID.canonical,this.tileTransform)[0];let h,g;if(this.isRaster){const y=function(x,E){const M=oc(x,E),T=Math.pow(2,x.z);for(let W=0;W<33;W++)for(let Q=0;Q<33;Q++){const le=go((x.x+(Q+fb(Q))/32)/T),ce=fr((x.y+(W+fb(W))/32)/T),fe=E.project(le,ce),pe=33*W+Q;Oa[2*pe+0]=Math.round((fe.x*M.scale-M.x)*Rt),Oa[2*pe+1]=Math.round((fe.y*M.scale-M.y)*Rt)}ac.fill(0),Rg.fill(0);for(let W=2045;W>=0;W--){const Q=4*W,le=qi[Q+0],ce=qi[Q+1],fe=qi[Q+2],pe=qi[Q+3],ge=le+fe>>1,Se=ce+pe>>1,Ae=ge+Se-ce,Oe=Se+le-ge,Ne=33*ce+le,De=33*pe+fe,Pe=33*Se+ge,Ve=Math.hypot((Oa[2*Ne+0]+Oa[2*De+0])/2-Oa[2*Pe+0],(Oa[2*Ne+1]+Oa[2*De+1])/2-Oa[2*Pe+1])>=16;if(ac[Pe]=ac[Pe]||(Ve?1:0),W<1022){const Ye=33*(ce+Oe>>1)+(le+Ae>>1),Ge=33*(pe+Oe>>1)+(fe+Ae>>1);ac[Pe]=ac[Pe]||ac[Ye]||ac[Ge]}}const k=new oe,R=new st;let B=0;function V(W,Q){const le=33*Q+W;return 0===Rg[le]&&(k.emplaceBack(Oa[2*le+0],Oa[2*le+1],W*Rt/32,Q*Rt/32),Rg[le]=++B),Rg[le]-1}function $(W,Q,le,ce,fe,pe){const ge=W+le>>1,Se=Q+ce>>1;if(Math.abs(W-fe)+Math.abs(Q-pe)>1&&ac[33*Se+ge])$(fe,pe,W,Q,ge,Se),$(le,ce,fe,pe,ge,Se);else{const Ae=V(W,Q),Oe=V(le,ce),Ne=V(fe,pe);R.emplaceBack(Ae,Oe,Ne)}}return $(0,0,32,32,32,0),$(32,32,0,0,0,32),{vertices:k,indices:R}}(this.tileID.canonical,l);h=y.vertices,g=y.indices}else{h=new oe,g=new st;for(const{x,y:E}of u)h.emplaceBack(x,E,0,0);const y=Nh(h.int16,void 0,4);for(let x=0;x<y.length;x+=3)g.emplaceBack(y[x],y[x+1],y[x+2])}this._tileBoundsBuffer=r.createVertexBuffer(h,Pg.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(g),this._tileBoundsSegments=gi.simpleSegment(0,0,h.length,g.length)}_makeGlobeTileDebugBuffers(r,l){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!l||"globe"!==l.name)return;const u=this.tileID.canonical,h=Cu(af(u));this._makeGlobeTileDebugBorderBuffer(r,u,h),this._makeGlobeTileDebugTextBuffer(r,u,h)}_makeGlobeTileDebugBorderBuffer(r,l,u){const h=new te,g=new rn,y=new ne,x=(M,T,k,R,B)=>{const V=(k-M)/(B-1),$=(R-T)/(B-1),W=h.length;for(let Q=0;Q<B;Q++){const le=M+Q*V,ce=T+Q*$;h.emplaceBack(le,ce);const fe=bu(le,ce,l),pe=tc(fe,fe,u);y.emplaceBack(pe[0],pe[1],pe[2]),g.emplaceBack(W+Q)}},E=Rt;x(0,0,E,0,16),x(E,0,E,E,16),x(E,E,0,E,16),x(0,E,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(g),this._tileDebugBuffer=r.createVertexBuffer(h,sf.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(y,Lp.members),this._tileDebugSegments=gi.simpleSegment(0,0,h.length,g.length)}_makeGlobeTileDebugTextBuffer(r,l,u){const h=new te,g=new st,y=new ne,x=25;g.reserve(32),h.reserve(x),y.reserve(x);const E=(M,T)=>x*M+T;for(let M=0;M<x;M++){const T=2048*M;for(let k=0;k<x;k++){const R=2048*k;h.emplaceBack(R,T);const B=bu(R,T,l),V=tc(B,B,u);y.emplaceBack(V[0],V[1],V[2])}}for(let M=0;M<4;M++)for(let T=0;T<4;T++){const k=E(M,T),R=E(M,T+1),B=E(M+1,T),V=E(M+1,T+1);g.emplaceBack(k,R,B),g.emplaceBack(B,R,V)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(g),this._tileDebugTextBuffer=r.createVertexBuffer(h,sf.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(y,Lp.members),this._tileDebugTextSegments=gi.simpleSegment(0,0,x,32)}}class Lg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,u){const h=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][h]=this.stateChanges[r][h]||{},bi(this.stateChanges[r][h],u),null===this.deletedStates[r]){this.deletedStates[r]={};for(const g in this.state[r])g!==h&&(this.deletedStates[r][g]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][h]){this.deletedStates[r][h]={};for(const g in this.state[r][h])u[g]||(this.deletedStates[r][h][g]=null)}else for(const g in u)this.deletedStates[r]&&this.deletedStates[r][h]&&null===this.deletedStates[r][h][g]&&delete this.deletedStates[r][h][g]}removeFeatureState(r,l,u){if(null===this.deletedStates[r])return;const h=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},u&&void 0!==l)null!==this.deletedStates[r][h]&&(this.deletedStates[r][h]=this.deletedStates[r][h]||{},this.deletedStates[r][h][u]=null);else if(void 0!==l)if(this.stateChanges[r]&&this.stateChanges[r][h])for(u in this.deletedStates[r][h]={},this.stateChanges[r][h])this.deletedStates[r][h][u]=null;else this.deletedStates[r][h]=null;else this.deletedStates[r]=null}getState(r,l){const u=String(l),h=bi({},(this.state[r]||{})[u],(this.stateChanges[r]||{})[u]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const g=this.deletedStates[r][l];if(null===g)return{};for(const y in g)delete h[y]}return h}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const u={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const g={};for(const y in this.stateChanges[h])this.state[h][y]||(this.state[h][y]={}),bi(this.state[h][y],this.stateChanges[h][y]),g[y]=this.state[h][y];u[h]=g}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const g={};if(null===this.deletedStates[h])for(const y in this.state[h])g[y]={},this.state[h][y]={};else for(const y in this.deletedStates[h]){if(null===this.deletedStates[h][y])this.state[h][y]={};else for(const x of Object.keys(this.deletedStates[h][y]))delete this.state[h][y][x];g[y]=this.state[h][y]}u[h]=u[h]||{},bi(u[h],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const h in r)r[h].setFeatureState(u,l)}}class Bg{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,l){const u=this.toIdx(r,l);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,l){return this.leaves[this.toIdx(r,l)]}toIdx(r,l){return l*this.size+r}}function hv(a,r,l,u){let h=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(l[y]<a[y]||l[y]>r[y])return null}else{const x=1/u[y];let E=(a[y]-l[y])*x,M=(r[y]-l[y])*x;if(E>M){const T=E;E=M,M=T}if(E>h&&(h=E),M<g&&(g=M),h>g)return null}return h}function fv(a,r,l,u,h,g,y,x,E,M,T){const k=u-a,R=h-r,B=g-l,V=y-a,$=x-r,W=E-l,Q=T[1]*W-T[2]*$,le=T[2]*V-T[0]*W,ce=T[0]*$-T[1]*V,fe=k*Q+R*le+B*ce;if(Math.abs(fe)<1e-15)return null;const pe=1/fe,ge=M[0]-a,Se=M[1]-r,Ae=M[2]-l,Oe=(ge*Q+Se*le+Ae*ce)*pe;if(Oe<0||Oe>1)return null;const Ne=Se*B-Ae*R,De=Ae*k-ge*B,Pe=ge*R-Se*k,Ve=(T[0]*Ne+T[1]*De+T[2]*Pe)*pe;return Ve<0||Oe+Ve>1?null:(V*Ne+$*De+W*Pe)*pe}function pv(a,r,l){return(a-r)/(l-r)}function Ng(a,r,l,u,h,g,y,x,E){const M=1<<l,T=g-u,k=y-h,R=(a+1)/M*T+u,B=(r+0)/M*k+h,V=(r+1)/M*k+h;x[0]=(a+0)/M*T+u,x[1]=B,E[0]=R,E[1]=V}class mv{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(g){const y=Math.ceil(Math.log2(g.dim/8)),x=[];let E=Math.ceil(Math.pow(2,y));const M=1/E,T=(B,V,$,W,Q)=>{const le=W?1:0,ce=(B+1)*$-le,fe=V*$,pe=(V+1)*$-le;Q[0]=B*$,Q[1]=fe,Q[2]=ce,Q[3]=pe};let k=new Bg(E);const R=[];for(let B=0;B<E*E;B++){T(B%E,Math.floor(B/E),M,!1,R);const V=lc(R[0],R[1],g),$=lc(R[2],R[1],g),W=lc(R[2],R[3],g),Q=lc(R[0],R[3],g);k.minimums.push(Math.min(V,$,W,Q)),k.maximums.push(Math.max(V,$,W,Q)),k.leaves.push(1)}for(x.push(k),E/=2;E>=1;E/=2){const B=x[x.length-1];k=new Bg(E);for(let V=0;V<E*E;V++){T(V%E,Math.floor(V/E),2,!0,R);const $=B.getElevation(R[0],R[1]),W=B.getElevation(R[2],R[1]),Q=B.getElevation(R[2],R[3]),le=B.getElevation(R[0],R[3]),ce=B.isLeaf(R[0],R[1]),fe=B.isLeaf(R[2],R[1]),pe=B.isLeaf(R[2],R[3]),ge=B.isLeaf(R[0],R[3]),Se=Math.min($.min,W.min,Q.min,le.min),Ae=Math.max($.max,W.max,Q.max,le.max),Oe=ce&&fe&&pe&&ge;k.maximums.push(Ae),k.minimums.push(Se),k.leaves.push(Ae-Se<=5&&Oe?1:0)}x.push(k)}return x}(this.dem),u=l.length-1,h=l[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(l,0,0,u,0)}raycastRoot(r,l,u,h,g,y,x=1){return hv([r,l,-100],[u,h,this.maximums[0]*x],g,y)}raycast(r,l,u,h,g,y,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(r,l,u,h,g,y,x);if(null==E)return null;const M=[],T=[],k=[],R=[],B=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:V,t:$,nodex:W,nodey:Q,depth:le}=B.pop();if(this.leaves[V]){Ng(W,Q,le,r,l,u,h,k,R);const fe=1<<le,pe=(W+0)/fe,ge=(W+1)/fe,Se=(Q+0)/fe,Ae=(Q+1)/fe,Oe=lc(pe,Se,this.dem)*x,Ne=lc(ge,Se,this.dem)*x,De=lc(ge,Ae,this.dem)*x,Pe=lc(pe,Ae,this.dem)*x,Ve=fv(k[0],k[1],Oe,R[0],k[1],Ne,R[0],R[1],De,g,y),Ye=fv(R[0],R[1],De,k[0],R[1],Pe,k[0],k[1],Oe,g,y),Ge=Math.min(null!==Ve?Ve:Number.MAX_VALUE,null!==Ye?Ye:Number.MAX_VALUE);if(Ge!==Number.MAX_VALUE)return Ge;{const Xe=Hm([],g,y,$);if(zg(Oe,Ne,Pe,De,pv(Xe[0],k[0],R[0]),pv(Xe[1],k[1],R[1]))>=Xe[2])return $}continue}let ce=0;for(let fe=0;fe<this._siblingOffset.length;fe++){Ng((W<<1)+this._siblingOffset[fe][0],(Q<<1)+this._siblingOffset[fe][1],le+1,r,l,u,h,k,R),k[2]=-100,R[2]=this.maximums[this.childOffsets[V]+fe]*x;const pe=hv(k,R,g,y);if(null!=pe){const ge=pe;M[fe]=ge;let Se=!1;for(let Ae=0;Ae<ce&&!Se;Ae++)ge>=M[T[Ae]]&&(T.splice(Ae,0,fe),Se=!0);Se||(T[ce]=fe),ce++}}for(let fe=0;fe<ce;fe++){const pe=T[fe];B.push({idx:this.childOffsets[V]+pe,t:M[pe],nodex:(W<<1)+this._siblingOffset[pe][0],nodey:(Q<<1)+this._siblingOffset[pe][1],depth:le+1})}}return null}_addNode(r,l,u){return this.minimums.push(r),this.maximums.push(l),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,l,u,h,g){if(1===r[h].isLeaf(l,u))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=h-1,x=r[y];let E=0,M=0;for(let T=0;T<this._siblingOffset.length;T++){const k=2*l+this._siblingOffset[T][0],R=2*u+this._siblingOffset[T][1],B=x.getElevation(k,R),V=x.isLeaf(k,R),$=this._addNode(B.min,B.max,V);V&&(E|=1<<T),M||(M=$)}for(let T=0;T<this._siblingOffset.length;T++)E&1<<T||this._construct(r,2*l+this._siblingOffset[T][0],2*u+this._siblingOffset[T][1],y,M+T)}}function zg(a,r,l,u,h,g){return ct(ct(a,l,g),ct(r,u,g),h)}function lc(a,r,l){const u=l.dim,h=on(a*u-.5,0,u-1),g=on(r*u-.5,0,u-1),y=Math.floor(h),x=Math.floor(g),E=Math.min(y+1,u-1),M=Math.min(x+1,u-1);return zg(l.get(y,x),l.get(E,x),l.get(y,M),l.get(E,M),h-y,g-x)}const gv={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class lf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,l,u,h=!1,g=!1){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return Rn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const y=this.dim=l.height-2,x=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=u||"mapbox",this.borderReady=h,!h){for(let E=0;E<y;E++)x[this._idx(-1,E)]=x[this._idx(0,E)],x[this._idx(y,E)]=x[this._idx(y-1,E)],x[this._idx(E,-1)]=x[this._idx(E,0)],x[this._idx(E,y)]=x[this._idx(E,y-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(y,-1)]=x[this._idx(y-1,0)],x[this._idx(-1,y)]=x[this._idx(0,y-1)],x[this._idx(y,y)]=x[this._idx(y-1,y-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new mv(this)}get(r,l,u=!1){u&&(r=on(r,-1,this.dim),l=on(l,-1,this.dim));const h=4*this._idx(r,l);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(r){return gv[r]}get unpackVector(){return gv[this.encoding]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}_unpackMapbox(r,l,u){return(256*r*256+256*l+u)/10-1e4}_unpackTerrarium(r,l,u){return 256*r+l+u/256-32768}static pack(r,l){const u=[0,0,0,0],h=lf.getUnpackVector(l);let g=Math.floor((r+h[3])/h[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new Ks({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,l,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let h=l*this.dim,g=l*this.dim+this.dim,y=u*this.dim,x=u*this.dim+this.dim;switch(l){case-1:h=g-1;break;case 1:g=h+1}switch(u){case-1:y=x-1;break;case 1:x=y+1}const E=-l*this.dim,M=-u*this.dim;for(let T=y;T<x;T++)for(let k=h;k<g;k++){const R=4*this._idx(k,T),B=4*this._idx(k+E,T+M);this.pixels[R+0]=r.pixels[B+0],this.pixels[R+1]=r.pixels[B+1],this.pixels[R+2]=r.pixels[B+2],this.pixels[R+3]=r.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}We(lf,"DEMData"),We(mv,"DemMinMaxQuadTree",{omit:["dem"]});class _v{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,u){const h=r.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const g={value:l,timeout:void 0};if(void 0!==u&&(g.timeout=setTimeout(()=>{this.remove(r,g)},u)),this.data[h].push(g),this.order.push(h),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const u=r.wrapped().key,h=void 0===l?0:this.data[u].indexOf(l),g=this.data[u][h];return this.data[u].splice(h,1),g.timeout&&clearTimeout(g.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const u in this.data)for(const h of this.data[u])r(h.value)||l.push(h);for(const u of l)this.remove(u.value.tileID,u)}}class Sd{constructor(r,l,u){this.func=r,this.mask=l,this.range=u}}Sd.ReadOnly=!1,Sd.ReadWrite=!0,Sd.disabled=new Sd(519,Sd.ReadOnly,[0,1]);class cf{constructor(r,l,u,h,g,y){this.test=r,this.ref=l,this.mask=u,this.fail=h,this.depthFail=g,this.pass=y}}cf.disabled=new cf({func:519,mask:0},0,0,7680,7680,7680);class La{constructor(r,l,u){this.blendFunction=r,this.blendColor=l,this.mask=u}}La.Replace=[1,0],La.disabled=new La(La.Replace,ot.transparent,[!1,!1,!1,!1]),La.unblended=new La(La.Replace,ot.transparent,[!0,!0,!0,!0]),La.alphaBlended=new La([1,771],ot.transparent,[!0,!0,!0,!0]);class wo{constructor(r,l,u){this.enable=r,this.mode=l,this.frontFace=u}}wo.disabled=new wo(!1,1029,2305),wo.backCCW=new wo(!0,1029,2305),wo.backCW=new wo(!0,1029,2304),wo.frontCW=new wo(!0,1028,2304),wo.frontCCW=new wo(!0,1028,2305);class Du extends Et{constructor(r,l,u){super(),this.id=r,this._onlySymbols=u,l.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new _v(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Lg,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(r){this.map=r,this._minTileCacheSize=void 0===this._minTileCacheSize&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const l=this._tiles[r];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const l in this._tiles){const u=this._tiles[l];this._source.prepareTile(u)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,u.tileID),u.upload(r),u.prepare(this.map.style.imageManager)}else for(const l in this._tiles){const u=this._tiles[l];u.upload(r),u.prepare(this.map.style.imageManager)}}getIds(){return Il(this._tiles).map(r=>r.tileID).sort(vv).map(r=>r.key)}getRenderableIds(r){const l=[];for(const u in this._tiles)this._isIdRenderable(+u,r)&&l.push(this._tiles[u]);return r?l.sort((u,h)=>{const g=u.tileID,y=h.tileID,x=new Be(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),E=new Be(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-y.overscaledZ||E.y-x.y||E.x-x.x}).map(u=>u.tileID.key):l.map(u=>u.tileID).sort(vv).map(u=>u.key)}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){const u=this._tiles[r];u&&("loading"!==u.state&&(u.state=l),this._loadTile(u,this._tileLoaded.bind(this,u,r,l)))}_tileLoaded(r,l,u,h){if(h)if(r.state="errored",404!==h.status)this._source.fire(new _t(h,{tile:r}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=Rr.now(),"expired"===u&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new pt("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const l=this.getRenderableIds();for(let h=0;h<l.length;h++){const g=l[h];if(r.neighboringTiles&&r.neighboringTiles[g]){const y=this.getTileByID(g);u(r,y),u(y,r)}}function u(h,g){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let y=g.tileID.canonical.x-h.tileID.canonical.x;const x=g.tileID.canonical.y-h.tileID.canonical.y,E=Math.pow(2,h.tileID.canonical.z),M=g.tileID.key;0===y&&0===x||Math.abs(x)>1||(Math.abs(y)>1&&(1===Math.abs(y+E)?y+=E:1===Math.abs(y-E)&&(y-=E)),g.dem&&h.dem&&(h.dem.backfillBorder(g.dem,y,x),h.neighboringTiles&&h.neighboringTiles[M]&&(h.neighboringTiles[M].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,u,h){for(const g in this._tiles){let y=this._tiles[g];if(h[g]||!y.hasData()||y.tileID.overscaledZ<=l||y.tileID.overscaledZ>u)continue;let x=y.tileID;for(;y&&y.tileID.overscaledZ>l+1;){const M=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[M.key],y&&y.hasData()&&(x=M)}let E=x;for(;E.overscaledZ>l;)if(E=E.scaledTo(E.overscaledZ-1),r[E.key]){h[x.key]=x;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const u=this._loadedParentTiles[r.key];return u&&u.tileID.overscaledZ>=l?u:null}for(let u=r.overscaledZ-1;u>=l;u--){const h=r.scaledTo(u),g=this._getLoadedTile(h);if(g)return g}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;const u=Math.ceil(r.width/l)+1,h=Math.ceil(r.height/l)+1,g=Math.floor(u*h*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,g):g,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(x)}handleWrapJump(r){const l=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,l){const u={};for(const h in this._tiles){const g=this._tiles[h];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+l),u[g.tileID.key]=g}this._tiles=u;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(r,l,u){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let h;this.updateCacheSize(r,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Dr(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(h=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(x=>this._source.hasTile(x)))):h=[];const g=this._updateRetainedTiles(h);if(xv(this._source.type)&&0!==h.length){const x={},E={},M=Object.keys(g);for(const k of M){const R=g[k],B=this._tiles[k];if(!B||B.fadeEndTime&&B.fadeEndTime<=Rr.now())continue;const V=this.findLoadedParent(R,Math.max(R.overscaledZ-Du.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),x[V.tileID.key]=V.tileID),E[k]=R}const T=h[h.length-1].overscaledZ;for(const k in this._tiles){const R=this._tiles[k];if(g[k]||!R.hasData())continue;let B=R.tileID;for(;B.overscaledZ>T;){B=B.scaledTo(B.overscaledZ-1);const V=this._tiles[B.key];if(V&&V.hasData()&&E[B.key]){g[k]=R.tileID;break}}}for(const k in x)g[k]||(this._coveredTiles[k]=!0,g[k]=x[k])}for(const x in g)this._tiles[x].clearFadeHold();const y=function(x,E){const M=[];for(const T in x)T in E||M.push(T);return M}(this._tiles,g);for(const x of y){const E=this._tiles[x];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const l={};if(0===r.length)return l;const u={},h=r.reduce((M,T)=>Math.min(M,T.overscaledZ),1/0),g=r[0].overscaledZ,y=Math.max(g-Du.maxOverzooming,this._source.minzoom),x=Math.max(g+Du.maxUnderzooming,this._source.minzoom),E={};for(const M of r){const T=this._addTile(M);l[M.key]=M,T.hasData()||h<this._source.maxzoom&&(E[M.key]=M)}this._retainLoadedChildren(E,h,x,l);for(const M of r){let T=this._tiles[M.key];if(T.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const R=M.children(this._source.maxzoom)[0],B=this.getTile(R);if(B&&B.hasData()){l[R.key]=R;continue}}else{const R=M.children(this._source.maxzoom);if(l[R[0].key]&&l[R[1].key]&&l[R[2].key]&&l[R[3].key])continue}let k=T.wasRequested();for(let R=M.overscaledZ-1;R>=y;--R){const B=M.scaledTo(R);if(u[B.key]||(u[B.key]=!0,T=this.getTile(B),!T&&k&&(T=this._addTile(B)),T&&(l[B.key]=B,k=T.wasRequested(),T.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let u,h=this._tiles[r].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){u=this._loadedParentTiles[h.key];break}l.push(h.key);const g=h.scaledTo(h.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;h=g}for(const g of l)this._loadedParentTiles[g]=u}}_addTile(r){let l=this._tiles[r.key];if(l)return this._source.prepareTile&&this._source.prepareTile(l),l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const u=Boolean(l);if(!u){const h=this.map?this.map.painter:null;l=new Og(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._source.prepareTile&&this._source.prepareTile(l)||this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))}return l?(l.uses++,this._tiles[r.key]=l,u||this._source.fire(new pt("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const u=l.getExpiryTimeout();u&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},u))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,l,u){const h=[],g=this.transform;if(!g)return h;for(const y in this._tiles){const x=this._tiles[y];if(u&&x.clearQueryDebugViz(),x.holdingForFade())continue;const E=r.containsTile(x,g,l);E&&h.push(E)}return h}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map(u=>this._tiles[u].tileID);for(const u of l)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(xv(this._source.type))for(const r in this._tiles){const l=this._tiles[r];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=Rr.now())return!0}return!1}setFeatureState(r,l,u){this._state.updateState(r=r||"_geojsonTileLayer",l,u)}removeFeatureState(r,l,u){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,u)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,u){const h=this._tiles[r];h&&h.setDependencies(l,u)}reloadTilesForDependencies(r,l){for(const u in this._tiles)this._tiles[u].hasDependency(r,l)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(r,l))}_preloadTiles(r,l){const u=new Map,h=Array.isArray(r)?r:[r],g=this.map.painter.terrain,y=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const x of h){const E=x.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const M of E)u.set(M.key,M);this.usedForTerrain&&x.updateElevation(!1)}aa(Array.from(u.values()),(x,E)=>{const M=new Og(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(M,T=>{"raster-dem"===this._source.type&&M.dem&&this._backfillDEM(M),E(T,M)})},l)}}function vv(a,r){const l=Math.abs(2*a.wrap)-+(a.wrap<0),u=Math.abs(2*r.wrap)-+(r.wrap<0);return a.overscaledZ-r.overscaledZ||u-l||r.canonical.y-a.canonical.y||r.canonical.x-a.canonical.x}function xv(a){return"raster"===a||"image"===a||"video"===a}Du.maxOverzooming=10,Du.maxUnderzooming=3;class Ad{constructor(r,l,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=l,this._offset=u}static create(r,l,u){const h=u||r.findDEMTileFor(l);if(!h||!h.dem)return;const g=h.dem,y=h.tileID,x=1<<l.canonical.z-y.canonical.z;return new Ad(h,h.tileSize/Rt/x,[(l.canonical.x/x-y.canonical.x)*g.dim,(l.canonical.y/x-y.canonical.y)*g.dim])}tileCoordToPixel(r,l){const u=l*this._scale+this._offset[1],h=Math.floor(r*this._scale+this._offset[0]),g=Math.floor(u);return new Be(h,g)}getElevationAt(r,l,u,h){const g=r*this._scale+this._offset[0],y=l*this._scale+this._offset[1],x=Math.floor(g),E=Math.floor(y),M=this._dem;return h=!!h,u?ct(ct(M.get(x,E,h),M.get(x,E+1,h),y-E),ct(M.get(x+1,E,h),M.get(x+1,E+1,h),y-E),g-x):M.get(x,E,h)}getElevationAtPixel(r,l,u){return this._dem.get(r,l,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*cu(1,r)*this._dem.stride}}class bv{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Gn(Rt,16,0),this.featureIndexArray=new li,this.promoteId=l}insert(r,l,u,h,g,y=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,g,y);const E=this.grid;for(let M=0;M<l.length;M++){const T=l[M],k=[1/0,1/0,-1/0,-1/0];for(let R=0;R<T.length;R++){const B=T[R];k[0]=Math.min(k[0],B.x),k[1]=Math.min(k[1],B.y),k[2]=Math.max(k[2],B.x),k[3]=Math.max(k[3],B.y)}k[0]<Rt&&k[1]<Rt&&k[2]>=0&&k[3]>=0&&E.insert(x,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new mu.VectorTile(new Yh(this.rawTileData)).layers,this.sourceLayerCoder=new kg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,l,u,h){this.loadVTLayers();const g=r.params||{},y=ol(g.filter),x=r.tileResult,E=r.transform,M=x.bufferedTilespaceBounds,T=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(V,$,W,Q)=>sy(x.bufferedTilespaceGeometry,V,$,W,Q));T.sort(zp);let k=null;E.elevation&&T.length>0&&(k=Ad.create(E.elevation,this.tileID));const R={};let B;for(let V=0;V<T.length;V++){const $=T[V];if($===B)continue;B=$;const W=this.featureIndexArray.get($);let Q=null;this.loadMatchingFeature(R,W,y,g.layers,g.availableImages,l,u,h,(le,ce,fe,pe=0)=>(Q||(Q=Ho(le,this.tileID.canonical,r.tileTransform)),ce.queryIntersectsFeature(x,le,fe,Q,this.z,r.transform,r.pixelPosMatrix,k,pe)))}return R}loadMatchingFeature(r,l,u,h,g,y,x,E,M){const{featureIndex:T,bucketIndex:k,sourceLayerIndex:R,layoutVertexArrayOffset:B}=l,V=this.bucketLayerIDs[k];if(h&&!function(le,ce){for(let fe=0;fe<le.length;fe++)if(ce.indexOf(le[fe])>=0)return!0;return!1}(h,V))return;const $=this.sourceLayerCoder.decode(R),W=this.vtLayers[$].feature(T);if(u.needGeometry){const le=Aa(W,!0);if(!u.filter(new $n(this.tileID.overscaledZ),le,this.tileID.canonical))return}else if(!u.filter(new $n(this.tileID.overscaledZ),W))return;const Q=this.getId(W,$);for(let le=0;le<V.length;le++){const ce=V[le];if(h&&h.indexOf(ce)<0)continue;const fe=y[ce];if(!fe)continue;let pe={};void 0!==Q&&E&&(pe=E.getState(fe.sourceLayer||"_geojsonTileLayer",Q));const ge=bi({},x[ce]);ge.paint=wv(ge.paint,fe.paint,W,pe,g),ge.layout=wv(ge.layout,fe.layout,W,pe,g);const Se=!M||M(W,fe,pe,B);if(!Se)continue;const Ae=new Fg(W,this.z,this.x,this.y,Q);Ae.layer=ge;let Oe=r[ce];void 0===Oe&&(Oe=r[ce]=[]),Oe.push({featureIndex:T,feature:Ae,intersectionZ:Se})}}lookupSymbolFeatures(r,l,u,h,g,y,x,E){const M={};this.loadVTLayers();const T=ol(g);for(const k of r)this.loadMatchingFeature(M,{bucketIndex:u,sourceLayerIndex:h,featureIndex:k,layoutVertexArrayOffset:0},T,y,x,E,l);return M}loadFeature(r){const{featureIndex:l,sourceLayerIndex:u}=r;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),g=this.vtFeatures[h];if(g[l])return g[l];const y=this.vtLayers[h].feature(l);return g[l]=y,y}hasLayer(r){for(const l of this.bucketLayerIDs)for(const u of l)if(r===u)return!0;return!1}getId(r,l){let u=r.id;return this.promoteId&&(u=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof u&&(u=Number(u))),u}}function wv(a,r,l,u,h){return ua(a,(g,y)=>{const x=r instanceof w?r.get(y):null;return x&&x.evaluate?x.evaluate(l,u,h):x})}function zp(a,r){return r-a}We(bv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Vp{constructor(r){const l={},u=[];for(const x in r){const E=r[x],M=l[x]={};for(const T in E.glyphs){const k=E.glyphs[+T];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const R=k.metrics.localGlyph?2:1,B={x:0,y:0,w:k.bitmap.width+2*R,h:k.bitmap.height+2*R};u.push(B),M[T]=B}}const{w:h,h:g}=Qh(u),y=new hl({width:h||1,height:g||1});for(const x in r){const E=r[x];for(const M in E.glyphs){const T=E.glyphs[+M];if(!T||0===T.bitmap.width||0===T.bitmap.height)continue;const k=l[x][M],R=T.metrics.localGlyph?2:1;hl.copy(T.bitmap,y,{x:0,y:0},{x:k.x+R,y:k.y+R},T.bitmap)}}this.image=y,this.positions=l}}We(Vp,"GlyphAtlas");class mb{constructor(r){this.tileID=new Dr(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=oc(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,l,u,h,g){this.status="parsing",this.data=r,this.collisionBoxArray=new Ds;const y=new kg(Object.keys(r.layers).sort()),x=new bv(this.tileID,this.promoteId);x.bucketLayerIDs=[];const E={},M=new lv(256,256),T={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:M,availableImages:u},k=l.familiesBySource[this.source];for(const pe in k){const ge=r.layers[pe];if(!ge)continue;let Se=!1,Ae=!1;for(const De of k[pe])"symbol"===De[0].type?Se=!0:Ae=!0;if(!0===this.isSymbolTile&&!Se||!1===this.isSymbolTile&&!Ae)continue;1===ge.version&&Rn(`Vector tile source "${this.source}" layer "${pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Oe=y.encode(pe),Ne=[];for(let De=0;De<ge.length;De++){const Pe=ge.feature(De),Ve=x.getId(Pe,pe);Ne.push({feature:Pe,id:Ve,index:De,sourceLayerIndex:Oe})}for(const De of k[pe]){const Pe=De[0];void 0!==this.isSymbolTile&&"symbol"===Pe.type!==this.isSymbolTile||Pe.minzoom&&this.zoom<Math.floor(Pe.minzoom)||Pe.maxzoom&&this.zoom>=Pe.maxzoom||"none"!==Pe.visibility&&(uf(De,this.zoom,u),(E[Pe.id]=Pe.createBucket({index:x.bucketLayerIDs.length,layers:De,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Oe,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:u})).populate(Ne,T,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(De.map(Ve=>Ve.id)))}}let R,B,V,$;M.trim();const W={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Q=ua(T.glyphDependencies,pe=>Object.keys(pe).map(Number));Object.keys(Q).length?h.send("getGlyphs",{uid:this.uid,stacks:Q},(pe,ge)=>{R||(R=pe,B=ge,fe.call(this))},void 0,!1,W):B={};const le=Object.keys(T.iconDependencies);le.length?h.send("getImages",{icons:le,source:this.source,tileID:this.tileID,type:"icons"},(pe,ge)=>{R||(R=pe,V=ge,fe.call(this))},void 0,!1,W):V={};const ce=Object.keys(T.patternDependencies);function fe(){if(R)return g(R);if(B&&V&&$){const pe=new Vp(B),ge=new Jh(V,$);for(const Se in E){const Ae=E[Se];Ae instanceof _l?(uf(Ae.layers,this.zoom,u),nv(Ae,B,pe.positions,V,ge.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):Ae.hasPattern&&(Ae instanceof fl||Ae instanceof qh||Ae instanceof Xh)&&(uf(Ae.layers,this.zoom,u),Ae.addFeatures(T,this.tileID.canonical,ge.patternPositions,u,this.tileTransform))}this.status="done",g(null,{buckets:Il(E).filter(Se=>!Se.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pe.image,lineAtlas:M,imageAtlas:ge,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?V:null,glyphPositions:this.returnDependencies?pe.positions:null})}}ce.length?h.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"patterns"},(pe,ge)=>{R||(R=pe,$=ge,fe.call(this))},void 0,!1,W):$={},fe.call(this)}}function uf(a,r,l){const u=new $n(r);for(const h of a)h.recalculate(u,l)}class jp{constructor(r){this.entries={},this.scheduler=r}request(r,l,u,h){const g=this.entries[r]=this.entries[r]||{callbacks:[]};if(g.result){const[y,x]=g.result;return this.scheduler?this.scheduler.add(()=>{h(y,x)},l):h(y,x),()=>{}}return g.callbacks.push(h),g.cancel||(g.cancel=u((y,x)=>{g.result=[y,x];for(const E of g.callbacks)this.scheduler?this.scheduler.add(()=>{E(y,x)},l):E(y,x);setTimeout(()=>delete this.entries[r],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(y=>y!==h),g.callbacks.length||(g.cancel(),delete this.entries[r]))}}}function jg(a,r,l){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},h=>{const g=re(a.request,(y,x,E,M)=>{y?h(y):x&&h(null,{vectorTile:l?void 0:new mu.VectorTile(new Yh(x)),rawData:x,cacheControl:E,expires:M})});return()=>{g.cancel(),h()}},r)}const gb=qo(new Float32Array(16));class cc{constructor(r){this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,l){return{x:0,y:0,z:0}}unproject(r,l){return new Tn(0,0)}projectTilePoint(r,l,u){return{x:r,y:l,z:0}}locationPoint(r,l){return r._coordinatePoint(r.locationCoordinate(l),!1)}pixelsPerMeter(r,l){return cu(1,r)*l}farthestPixelDistance(r){return function(l,u){const h=l.fovAboveCenter,g=l.elevation?l.elevation.getMinElevationBelowMSL()*u:0,y=(l._camera.position[2]*l.worldSize-g)/Math.cos(l._pitch),x=Math.sin(h)*y/Math.sin(Math.max(Math.PI/2-l._pitch-h,.01)),E=Math.sin(l._pitch)*x+y;return Math.min(1.01*E,y*(1/l._horizonShift))}(r,r.pixelsPerMeter)}pointCoordinate(r,l,u,h){const g=r.horizonLineFromTop(!1),y=new Be(l,Math.max(g,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(y,h))}createInversionMatrix(r,l){return gb}createTileMatrix(r,l,u){let h,g,y;const x=u.canonical,E=qo(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=oc(x,this);h=1,g=M.x+u.wrap*M.scale,y=M.y,Xs(E,E,[h/M.scale,h/M.scale,r.pixelsPerMeter/l])}else h=l/r.zoomScale(x.z),g=(x.x+Math.pow(2,x.z)*u.wrap)*h,y=x.y*h;return du(E,E,[g,y,0]),Xs(E,E,[h/Rt,h/Rt,1]),E}upVector(r,l,u){return[0,0,1]}upVectorScale(r,l,u){return{metersToTile:1,metersToLabelSpace:1}}}class Ug extends cc{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,l){return{x:Ma(r),y:Ih(l),z:0}}unproject(r,l){const u=go(r),h=fr(l);return new Tn(u,h)}}class tE extends cc{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[l,u]=this.parallels=r.parallels||[29.5,45.5],h=Math.sin(cn(l));this.n=(h+Math.sin(cn(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(r,l){const{n:u,c:h,r0:g}=this,y=cn(r-this.center[0]),x=cn(l),E=Math.sqrt(h-2*u*Math.sin(x))/u;return{x:E*Math.sin(y*u),y:E*Math.cos(y*u)-g,z:0}}unproject(r,l){const{n:u,c:h,r0:g}=this,y=g+l;let x=Math.atan2(r,Math.abs(y))*Math.sign(y);y*u<0&&(x-=Math.PI*Math.sign(r)*Math.sign(y));const E=cn(this.center[0])*u;x=gs(x,-Math.PI-E,Math.PI-E);const M=Fr(x/u)+this.center[0],T=Math.asin(on((h-(r*r+y*y)*u*u)/(2*u),-1,1)),k=on(Fr(T),-85.051129,Sa);return new Tn(M,k)}}const df=1.340264,Td=-.081106,Id=893e-6,kd=.003796,hf=Math.sqrt(3)/2;class Cv extends cc{project(r,l){l=l/180*Math.PI,r=r/180*Math.PI;const u=Math.asin(hf*Math.sin(l)),h=u*u,g=h*h*h;return{x:.5*(r*Math.cos(u)/(hf*(df+3*Td*h+g*(7*Id+9*kd*h)))/Math.PI+.5),y:1-.5*(u*(df+Td*h+g*(Id+kd*h))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,h=u*u,g=h*h*h;for(let T,k,R,B=0;B<12&&(k=u*(df+Td*h+g*(Id+kd*h))-l,R=df+3*Td*h+g*(7*Id+9*kd*h),T=k/R,u=on(u-T,-Math.PI/3,Math.PI/3),h=u*u,g=h*h*h,!(Math.abs(T)<1e-12));++B);const y=hf*r*(df+3*Td*h+g*(7*Id+9*kd*h))/Math.cos(u),x=Math.asin(Math.sin(u)/hf),E=on(180*y/Math.PI,-180,180),M=on(180*x/Math.PI,-85.051129,Sa);return new Tn(E,M)}}class yl extends cc{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){return{x:.5+r/360,y:.5-l/360,z:0}}unproject(r,l){const u=360*(r-.5),h=on(360*(.5-l),-85.051129,Sa);return new Tn(u,h)}}const vl=Math.PI/2;function Up(a){return Math.tan((vl+a)/2)}class _b extends cc{constructor(r){super(r),this.center=r.center||[0,30];const[l,u]=this.parallels=r.parallels||[30,30],h=cn(l),g=cn(u),y=Math.cos(h);this.n=h===g?Math.sin(h):Math.log(y/Math.cos(g))/Math.log(Up(g)/Up(h)),this.f=y*Math.pow(Up(h),this.n)/this.n}project(r,l){l=cn(l),r=cn(r-this.center[0]);const u=1e-6,{n:h,f:g}=this;g>0?l<-vl+u&&(l=-vl+u):l>vl-u&&(l=vl-u);const y=g/Math.pow(Up(l),h),x=y*Math.sin(h*r),E=g-y*Math.cos(h*r);return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+.5),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI,l=(2*(1-l)-.5)*Math.PI;const{n:u,f:h}=this,g=h-l,y=Math.sign(g),x=Math.sign(u)*Math.sqrt(r*r+g*g);let E=Math.atan2(r,Math.abs(g))*y;g*u<0&&(E-=Math.PI*Math.sign(r)*y);const M=on(Fr(E/u)+this.center[0],-180,180),T=on(Fr(2*Math.atan(Math.pow(h/x,1/u))-vl),-85.051129,Sa);return new Tn(M,T)}}const yb=cn(Sa);class Gg extends cc{project(r,l){const u=(l=cn(l))*l,h=u*u;return{x:.5*((r=cn(r))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let u=l=(2*(1-l)-1)*Math.PI,h=25,g=0,y=u*u;do{y=u*u;const M=y*y;g=(u*(1.007226+y*(.015085+M*(.028874*y-.044475-.005916*M)))-l)/(1.007226+y*(.045255+M*(.259866*y-.311325-.005916*11*M))),u=on(u-g,-yb,yb)}while(Math.abs(g)>1e-6&&--h>0);y=u*u;const x=on(Fr(r/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),E=Fr(u);return new Tn(x,E)}}const $g=cn(Sa);class Hg extends cc{project(r,l){l=cn(l),r=cn(r);const u=Math.cos(l),h=2/Math.PI,g=Math.acos(u*Math.cos(r/2)),y=Math.sin(g)/g,x=.5*(r*h+2*u*Math.sin(r/2)/y)||0,E=.5*(l+Math.sin(l)/y)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(r,l){let u=r=(2*r-.5)*Math.PI,h=l=(2*(1-l)-1)*Math.PI,g=25;const y=1e-6;let x=0,E=0;do{const M=Math.cos(h),T=Math.sin(h),k=2*T*M,R=T*T,B=M*M,V=Math.cos(u/2),$=Math.sin(u/2),W=2*V*$,Q=$*$,le=1-B*V*V,ce=le?1/le:0,fe=le?Math.acos(M*V)*Math.sqrt(1/le):0,pe=.5*(2*fe*M*$+2*u/Math.PI)-r,ge=.5*(fe*T+h)-l,Se=.5*ce*(B*Q+fe*M*V*R)+1/Math.PI,Ae=ce*(W*k/4-fe*T*$),Oe=.125*ce*(k*$-fe*T*B*W),Ne=.5*ce*(R*V+fe*Q*M)+.5,De=Ae*Oe-Ne*Se;x=(ge*Ae-pe*Ne)/De,E=(pe*Oe-ge*Se)/De,u=on(u-x,-Math.PI,Math.PI),h=on(h-E,-$g,$g)}while((Math.abs(x)>y||Math.abs(E)>y)&&--g>0);return new Tn(Fr(u),Fr(h))}}class Fd extends cc{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(cn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){const{scale:u,cosPhi:h}=this;return{x:cn(r)*h*u+.5,y:-Math.sin(cn(l))/h*u+.5,z:0}}unproject(r,l){const{scale:u,cosPhi:h}=this,g=-(l-.5)/u,y=on(Fr((r-.5)/u)/h,-180,180),x=Math.asin(on(g*h,-1,1)),E=on(Fr(x),-85.051129,Sa);return new Tn(y,E)}}p.ARRAY_TYPE=Hr,p.AUTH_ERR_MSG=Wa,p.Aabb=ks,p.Actor=class{constructor(a,r,l){this.target=a,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},un(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Cn()?a:gt,this.scheduler=new cb}send(a,r,l,u,h=!1,g){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=g,this.callbacks[y]=l);const x=Ha(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:a,hasCallback:!!l,targetMapId:u,mustQueue:h,sourceMapId:this.mapId,data:wa(r,x)},x),{cancel:()=>{l&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(a){const r=a.data,l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(r.mustQueue||Cn()){const u=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,r),u&&u.metadata||{type:"message"})}else this.processTask(l,r)}processTask(a,r){if("<response>"===r.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(r.error?l(tr(r.error)):l(null,tr(r.data)))}else{const l=Ha(this.globalScope)?void 0:[],u=r.hasCallback?(g,y)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:g?wa(g):null,data:wa(y,l)},l)}:g=>{},h=tr(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,h,u);else if(this.parent.getWorkerSource){const g=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,g[0],h.source)[g[1]](h,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=Eu,p.Color=ot,p.ColorMode=La,p.CullFaceMode=wo,p.DEMData=lf,p.DataConstantProperty=D,p.DedupedRequest=jp,p.DepthMode=Sd,p.EXTENT=Rt,p.Elevation=class{isDataAvailableAtPoint(a){const r=this._source();if(!r||a.y<0||a.y>1)return!1;const l=r.getSource().maxzoom,u=1<<l,h=Math.floor(a.x),g=Math.floor((a.x-h)*u),y=Math.floor(a.y*u),x=this.findDEMTileFor(new Dr(l,h,l,g,y));return!(!x||!x.dem)}getAtPointOrZero(a,r=0){return this.getAtPoint(a,r)||0}getAtPoint(a,r,l=!0){null==r&&(r=null);const u=this._source();if(!u||a.y<0||a.y>1)return r;const h=u.getSource().maxzoom,g=1<<h,y=Math.floor(a.x),x=a.x-y,E=new Dr(h,y,h,Math.floor(x*g),Math.floor(a.y*g)),M=this.findDEMTileFor(E);if(!M||!M.dem)return r;const T=M.dem,k=1<<M.tileID.canonical.z,R=(x*k-M.tileID.canonical.x)*T.dim,B=(a.y*k-M.tileID.canonical.y)*T.dim,V=Math.floor(R),$=Math.floor(B);return(l?this.exaggeration():1)*ct(ct(T.get(V,$),T.get(V,$+1),B-$),ct(T.get(V+1,$),T.get(V+1,$+1),B-$),R-V)}getAtTileOffset(a,r,l){const u=1<<a.canonical.z;return this.getAtPointOrZero(new op(a.wrap+(a.canonical.x+r/Rt)/u,(a.canonical.y+l/Rt)/u))}getAtTileOffsetFunc(a,r,l,u){return h=>{const g=this.getAtTileOffset(a,h.x,h.y),y=u.upVector(a.canonical,h.x,h.y);return Lh(y,y,g*u.upVectorScale(a.canonical,r,l).metersToTile),y}}getForTilePoints(a,r,l,u){const h=Ad.create(this,a,u);return!!h&&(r.forEach(g=>{g[2]=this.exaggeration()*h.getElevationAt(g[0],g[1],l)}),!0)}getMinMaxForTile(a){const r=this.findDEMTileFor(a);if(!r||!r.dem)return null;const l=r.dem.tree,u=r.tileID,h=1<<a.canonical.z-u.canonical.z;let g=a.canonical.x/h-u.canonical.x,y=a.canonical.y/h-u.canonical.y,x=0;for(let E=0;E<a.canonical.z-u.canonical.z&&!l.leaves[x];E++){g*=2,y*=2;const M=2*Math.floor(y)+Math.floor(g);x=l.childOffsets[x]+M,g%=1,y%=1}return{min:this.exaggeration()*l.minimums[x],max:this.exaggeration()*l.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,r,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=_t,p.EvaluationParameters=$n,p.Event=pt,p.Evented=Et,p.FillExtrusionBucket=Xh,p.Frustum=yo,p.GLOBE_RADIUS=Js,p.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a),this._createAtmosphere(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(a){const r=new te,l=new st,u=65;for(let h=0;h<u;h++)for(let g=0;g<u;g++)r.emplaceBack(g,h);for(let h=0;h<64;h++)for(let g=0;g<64;g++){const y=h*u+g;l.emplaceBack(y+1,y,y+u),l.emplaceBack(y+u,y+u+1,y+1)}this._gridBuffer=a.createVertexBuffer(r,sf.members),this._gridIndexBuffer=a.createIndexBuffer(l,!0),this._gridSegments=gi.simpleSegment(0,0,4225,8192)}_createPoles(a){const r=new st;for(let h=0;h<=64;h++)r.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=a.createIndexBuffer(r,!0);const l=new vt,u=new vt;this._poleSegments=[];for(let h=0,g=0;h<5;h++){const y=1<<h,x=512*y/Math.PI/2,E=360/y;l.emplaceBack(0,-x,0,0,0,.5,0),u.emplaceBack(0,-x,0,0,0,.5,1);for(let M=0;M<=64;M++){const T=M/64,k=ct(0,E,T),[R,B,V]=xu(Ag,Tg,k,x);l.emplaceBack(R,B,V,0,0,T,0),u.emplaceBack(R,B,V,0,0,T,1)}this._poleSegments.push(gi.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,Eg,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,Eg,!1)}_createAtmosphere(a){const r=new It;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const l=new st;l.emplaceBack(0,1,2),l.emplaceBack(2,3,0),this.atmosphereVertexBuffer=a.createVertexBuffer(r,Cg.members),this.atmosphereIndexBuffer=a.createIndexBuffer(l),this.atmosphereSegments=gi.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a){if(!this._wireframeSegments){const r=new Dt,l=64,u=l+1;for(let h=0;h<l;h++)for(let g=0;g<l;g++){const y=h*u+g;r.emplaceBack(y,y+1),r.emplaceBack(y,y+u),r.emplaceBack(y,y+u+1)}this._wireframeIndexBuffer=a.createIndexBuffer(r),this._wireframeSegments=gi.simpleSegment(0,0,l*l,r.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},p.GlyphManager=Dd,p.ImagePosition=Ep,p.LineAtlas=lv,p.LngLat=Tn,p.LngLatBounds=lu,p.LocalGlyphMode=gg,p.MAX_MERCATOR_LATITUDE=Sa,p.MercatorCoordinate=op,p.ONE_EM=24,p.OverscaledTileID=Dr,p.Properties=z,p.RGBAImage=Ks,p.Ray=class{constructor(a,r){this.pos=a,this.dir=r}intersectsPlane(a,r,l){const u=ec(r,this.dir);if(Math.abs(u)<1e-6)return!1;const h=((a[0]-this.pos[0])*r[0]+(a[1]-this.pos[1])*r[1]+(a[2]-this.pos[2])*r[2])/u;return l[0]=this.pos[0]+this.dir[0]*h,l[1]=this.pos[1]+this.dir[1]*h,l[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(a,r,l){if(V=(R=this.pos)[0],$=R[1],W=R[2],Q=(B=a)[0],le=B[1],ce=B[2],Math.abs(V-Q)<=hp*Math.max(1,Math.abs(V),Math.abs(Q))&&Math.abs($-le)<=hp*Math.max(1,Math.abs($),Math.abs(le))&&Math.abs(W-ce)<=hp*Math.max(1,Math.abs(W),Math.abs(ce))||0===r)return l[0]=l[1]=l[2]=0,!1;var R,B,V,$,W,Q,le,ce;const[u,h,g]=this.dir,y=this.pos[0]-a[0],x=this.pos[1]-a[1],E=this.pos[2]-a[2],M=u*u+h*h+g*g,T=2*(y*u+x*h+E*g),k=T*T-4*M*(y*y+x*x+E*E-r*r);if(k<0){const R=Math.max(-T/2,0),B=y+u*R,V=x+h*R,$=E+g*R,W=Math.hypot(B,V,$);return l[0]=B*r/W,l[1]=V*r/W,l[2]=$*r/W,!1}{const R=(-T-Math.sqrt(k))/(2*M);if(R<0){const B=Math.hypot(y,x,E);return l[0]=y*r/B,l[1]=x*r/B,l[2]=E*r/B,!1}return l[0]=y+u*R,l[1]=x+h*R,l[2]=E+g*R,!0}}},p.RequestManager=class{constructor(a,r,l){this._transformRequestFn=a,this._customAccessToken=r,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let r="";for(let l=0;l<10;l++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",vs,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,r){return this._transformRequestFn&&this._transformRequestFn(a,r)||{url:a}}normalizeStyleURL(a,r){if(!co(a))return a;const l=Vs(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeGlyphsURL(a,r){if(!co(a))return a;const l=Vs(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeSourceURL(a,r){if(!co(a))return a;const l=Vs(a);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||r)}normalizeSpriteURL(a,r,l,u){const h=Vs(a);return co(a)?(h.path=`/styles/v1${h.path}/sprite${r}${l}`,this._makeAPIURL(h,this._customAccessToken||u)):(h.path+=`${r}${l}`,Xa(h))}normalizeTileURL(a,r,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!co(a))return a;const u=Vs(a);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||l&&"raster"!==u.authority&&512===l?"@2x":""}${qa.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${mn.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${mn.TILE_URL_VERSION}${u.path}`);const h=this._customAccessToken||function(g){for(const y of g){const x=y.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(u.params)||mn.ACCESS_TOKEN;return mn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,h)}canonicalizeTileURL(a,r){const l=Vs(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let u="mapbox://";l.path.match(/^\/raster\/v1\//)?u+=`raster/${l.path.replace(`/${mn.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${l.path.replace(`/${mn.TILE_URL_VERSION}/`,"")}`;let h=l.params;return r&&(h=h.filter(g=>!g.match(/^access_token=/))),h.length&&(u+=`?${h.join("&")}`),u}canonicalizeTileset(a,r){const l=!!r&&co(r),u=[];for(const h of a.tiles||[])Za(h)?u.push(this.canonicalizeTileURL(h,l)):u.push(h);return u}_makeAPIURL(a,r){const l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",u=Vs(mn.API_URL);if(a.protocol=u.protocol,a.authority=u.authority,"http"===a.protocol){const h=a.params.indexOf("secure");h>=0&&a.params.splice(h,1)}if("/"!==u.path&&(a.path=`${u.path}${a.path}`),!mn.REQUIRE_ACCESS_TOKEN)return Xa(a);if(r=r||mn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(h=>-1===h.indexOf("access_token")),a.params.push(`access_token=${r||""}`),Xa(a)}},p.ResourceType=J,p.SegmentVector=gi,p.SourceCache=Du,p.StencilMode=cf,p.StructArrayLayout1ui2=rn,p.StructArrayLayout2f1f2i16=rt,p.StructArrayLayout2i4=te,p.StructArrayLayout2ui4=Dt,p.StructArrayLayout3f12=Ze,p.StructArrayLayout3ui6=st,p.StructArrayLayout4i8=oe,p.Texture=Pp,p.Tile=Og,p.Transitionable=m,p.Uniform1f=Bm,p.Uniform1i=class extends Ms{constructor(a,r){super(a,r),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},p.Uniform2f=class extends Ms{constructor(a,r){super(a,r),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},p.Uniform3f=class extends Ms{constructor(a,r){super(a,r),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},p.Uniform4f=J_,p.UniformColor=dt,p.UniformMatrix2f=class extends Ms{constructor(a,r){super(a,r),this.current=VC}set(a){for(let r=0;r<4;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}},p.UniformMatrix3f=class extends Ms{constructor(a,r){super(a,r),this.current=zC}set(a){for(let r=0;r<9;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},p.UniformMatrix4f=class extends Ms{constructor(a,r){super(a,r),this.current=b0}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let r=1;r<16;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},p.UnwrappedTileID=dv,p.ValidationError=et,p.VectorTileWorkerSource=class extends Et{constructor(a,r,l,u,h){super(),this.actor=a,this.layerIndex=r,this.availableImages=l,this.loadVectorData=h||jg,this.loading={},this.loaded={},this.deduped=new jp(a.scheduler),this.isSpriteLoaded=u,this.scheduler=a.scheduler}loadTile(a,r){const l=a.uid,u=a&&a.request,h=u&&u.collectResourceTiming,g=this.loading[l]=new mb(a);g.abort=this.loadVectorData(a,(y,x)=>{const E=!this.loading[l];if(delete this.loading[l],E||y||!x)return g.status="done",E||(this.loaded[l]=g),r(y);const M=x.rawData,T={};x.expires&&(T.expires=x.expires),x.cacheControl&&(T.cacheControl=x.cacheControl),g.vectorTile=x.vectorTile||new mu.VectorTile(new Yh(M));const k=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(R,B)=>{if(R||!B)return r(R);const V={};if(h){const $=Op(u);$.length>0&&(V.resourceTiming=JSON.parse(JSON.stringify($)))}r(null,bi({rawTileData:M.slice(0)},B,T,V))})};this.isSpriteLoaded?k():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(k,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):k()}),this.loaded=this.loaded||{},this.loaded[l]=g})}reloadTile(a,r){const l=this.loaded,u=a.uid,h=this;if(l&&l[u]){const g=l[u];g.showCollisionBoxes=a.showCollisionBoxes,g.enableTerrain=!!a.enableTerrain,g.projection=a.projection,g.tileTransform=oc(a.tileID.canonical,a.projection);const y=(x,E)=>{const M=g.reloadCallback;M&&(delete g.reloadCallback,g.parse(g.vectorTile,h.layerIndex,this.availableImages,h.actor,M)),r(x,E)};"parsing"===g.status?g.reloadCallback=y:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(a,r){const l=a.uid,u=this.loading[l];u&&(u.abort&&u.abort(),delete this.loading[l]),r()}removeTile(a,r){const l=this.loaded,u=a.uid;l&&l[u]&&delete l[u],r()}},p.WritingMode=Wr,p.ZoomHistory=ph,p.add=ay,p.addDynamicAttributes=Fp,p.adjoint=function(a,r){var l=r[0],u=r[1],h=r[2],g=r[3],y=r[4],x=r[5],E=r[6],M=r[7],T=r[8];return a[0]=y*T-x*M,a[1]=h*M-u*T,a[2]=u*x-h*y,a[3]=x*E-g*T,a[4]=l*T-h*E,a[5]=h*g-l*x,a[6]=g*M-y*E,a[7]=u*E-l*M,a[8]=l*y-u*g,a},p.asyncAll=aa,p.bezier=es,p.bindAll=un,p.boundsAttributes=Pg,p.bufferConvexPolygon=function(a,r){const l=[];for(let u=0;u<a.length;u++){const h=gs(u-1,-1,a.length-1),g=gs(u+1,-1,a.length-1),y=a[u],x=a[g],E=a[h].sub(y).unit(),M=x.sub(y).unit(),T=M.angleWithSep(E.x,E.y),k=E.add(M).unit().mult(-1*r/Math.sin(T/2));l.push(y.add(k))}return l},p.cacheEntryPossiblyAdded=function(a){Ol++,Ol>Ri&&(a.getActor().send("enforceCacheSizeLimit",fa),Ol=0)},p.calculateGlobeLabelMatrix=function(a,r){const{lng:l,lat:u}=a._center,h=uv(0,0,a.worldSize/a._projectionScaler,l,u);return Gm(h,h,function(g){const y=qo(new Float64Array(16)),x=1/wu(g);return du(y,y,g.min),Xs(y,y,[x,x,x]),y}(af(r)))},p.calculateGlobeMatrix=Mg,p.calculateGlobeMercatorMatrix=function(a){const r=a.worldSize,l=a.point,u=cu(1,a.center.lat)*r,h=a.pixelsPerMeter,g=r/(u/a.pixelsPerMeter),y=qo(new Float64Array(16));return du(y,y,[l.x,l.y,0]),Xs(y,y,[g,g,h]),Float32Array.from(y)},p.circumferenceAtLatitude=Th,p.clamp=on,p.clearTileCache=function(a){const r=gt.caches.delete(Pc);a&&r.catch(a).then(()=>a())},p.clipLine=Jy,p.clone=function(a){var r=new Hr(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r},p.clone$1=_s,p.collisionCircleLayout=Ty,p.config=mn,p.conjugate=function(a,r){return a[0]=-r[0],a[1]=-r[1],a[2]=-r[2],a[3]=r[3],a},p.create=function(){var a=new Hr(16);return Hr!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},p.create$1=Fh,p.createExpression=jr,p.createLayout=ie,p.createStyleLayer=function(a){return"custom"===a.type?new YC(a):new JC[a.type](a)},p.cross=mp,p.degToRad=cn,p.div=function(a,r,l){return a[0]=r[0]/l[0],a[1]=r[1]/l[1],a[2]=r[2]/l[2],a},p.dot=ec,p.earthRadius=ny,p.ease=ts,p.easeCubicInOut=Mo,p.emitValidationErrors=Om,p.endsWith=zs,p.enforceCacheSizeLimit=function(a){Pl(),xs&&xs.then(r=>{r.keys().then(l=>{for(let u=0;u<l.length-a;u++)r.delete(l[u])})})},p.evaluateSizeForFeature=wd,p.evaluateSizeForZoom=nc,p.evaluateVariableOffset=sb,p.evented=wh,p.exactEquals=function(a,r){return a[0]===r[0]&&a[1]===r[1]&&a[2]===r[2]&&a[3]===r[3]},p.exactEquals$1=function(a,r){return a[0]===r[0]&&a[1]===r[1]&&a[2]===r[2]},p.exported=Rr,p.exported$1=qa,p.extend=bi,p.extend$1=vn,p.filterObject=Sc,p.fromMat4=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[4],a[4]=r[5],a[5]=r[6],a[6]=r[8],a[7]=r[9],a[8]=r[10],a},p.fromQuat=function(a,r){var l=r[0],u=r[1],h=r[2],g=r[3],y=l+l,x=u+u,E=h+h,M=l*y,T=u*y,k=u*x,R=h*y,B=h*x,V=h*E,$=g*y,W=g*x,Q=g*E;return a[0]=1-k-V,a[1]=T+Q,a[2]=R-W,a[3]=0,a[4]=T-Q,a[5]=1-M-V,a[6]=B+$,a[7]=0,a[8]=R+W,a[9]=B-$,a[10]=1-M-k,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},p.fromRotation=function(a,r){var l=Math.sin(r),u=Math.cos(r);return a[0]=u,a[1]=l,a[2]=0,a[3]=-l,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},p.fromScaling=function(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},p.furthestTileCorner=function(a){const r=Math.round((a+45+360)%360/90)%4;return $u[r]},p.getAABBPointSquareDist=function(a,r,l){let u=0;for(let h=0;h<2;++h){const g=l?l[h]:0;a[h]>g&&(u+=(a[h]-g)*(a[h]-g)),r[h]<g&&(u+=(g-r[h])*(g-r[h]))}return u},p.getAnchorAlignment=Mp,p.getAnchorJustification=iv,p.getBounds=function(a){let r=1/0,l=1/0,u=-1/0,h=-1/0;for(const g of a)r=Math.min(r,g.x),l=Math.min(l,g.y),u=Math.max(u,g.x),h=Math.max(h,g.y);return{min:new Be(r,l),max:new Be(u,h)}},p.getColumn=function(a,r){return[a[4*r],a[4*r+1],a[4*r+2],a[4*r+3]]},p.getGridMatrix=function(a,r){const[l,u]=r,h=.015625;return[0,(u[1]-l[1])*h,1<<a.z,(u[0]-l[0])*h,0,a.y,l[0],l[1],h]},p.getImage=Je,p.getJSON=function(a,r){return K(bi(a,{type:"json"}),r)},p.getMapSessionAPI=Rc,p.getPerformanceMeasurement=Op,p.getProjection=function(a){const r=a.parallels,l=!!r&&Math.abs(r[0]+r[1])<.01;switch(a.name){case"mercator":return new Ug(a);case"equirectangular":return new yl(a);case"naturalEarth":return new Gg(a);case"equalEarth":return new Cv(a);case"winkelTripel":return new Hg(a);case"albers":return l?new Fd(a):new tE(a);case"lambertConformalConic":return l?new Fd(a):new _b(a)}throw new Error(`Invalid projection name: ${a.name}`)},p.getRTLTextPluginStatus=su,p.getReferrer=j,p.getTilePoint=function(a,{x:r,y:l},u=0){return new Be(((r-u)*a.scale-a.x)*Rt,(l*a.scale-a.y)*Rt)},p.getTileVec3=function(a,r,l=0){return Rh(((r.x-l)*a.scale-a.x)*Rt,(r.y*a.scale-a.y)*Rt,iy(r.z,r.y))},p.getVideo=function(a,r){const l=gt.document.createElement("video");l.muted=!0,l.onloadstart=function(){r(null,l)};for(let u=0;u<a.length;u++){const h=gt.document.createElement("source");_e(a[u])||(l.crossOrigin="Anonymous"),h.src=a[u],l.appendChild(h)}return{cancel:()=>{}}},p.globeECEFOrigin=function(a,r){const l=[0,0,0];return tc(l,l,Cu(af(r.canonical))),tc(l,l,a),l},p.globePixelsToTileUnits=function(a,r){return Rt/(512*Math.pow(2,a))*wu(af(r))},p.globePoleMatrixForTile=function(a,r,l){const u=qo(new Float64Array(16)),h=1<<a,g=360*(r/h-.5),y=l.point,x=l.worldSize/(l.tileSize*h);return du(u,u,[y.x,y.y,-l.worldSize/Math.PI/2]),Xs(u,u,[x,x,x]),hu(u,u,cn(-l._center.lat)),$m(u,u,cn(-l._center.lng+g)),Float32Array.from(u)},p.globeTileLatLngCorners=vu,p.globeToMercatorTransition=function(a){return $a(5,6,a)},p.identity=qo,p.identity$1=uy,p.invert=function(a,r){var l=r[0],u=r[1],h=r[2],g=r[3],y=r[4],x=r[5],E=r[6],M=r[7],T=r[8],k=r[9],R=r[10],B=r[11],V=r[12],$=r[13],W=r[14],Q=r[15],le=l*x-u*y,ce=l*E-h*y,fe=l*M-g*y,pe=u*E-h*x,ge=u*M-g*x,Se=h*M-g*E,Ae=T*$-k*V,Oe=T*W-R*V,Ne=T*Q-B*V,De=k*W-R*$,Pe=k*Q-B*$,Ve=R*Q-B*W,Ye=le*Ve-ce*Pe+fe*De+pe*Ne-ge*Oe+Se*Ae;return Ye?(a[0]=(x*Ve-E*Pe+M*De)*(Ye=1/Ye),a[1]=(h*Pe-u*Ve-g*De)*Ye,a[2]=($*Se-W*ge+Q*pe)*Ye,a[3]=(R*ge-k*Se-B*pe)*Ye,a[4]=(E*Ne-y*Ve-M*Oe)*Ye,a[5]=(l*Ve-h*Ne+g*Oe)*Ye,a[6]=(W*fe-V*Se-Q*ce)*Ye,a[7]=(T*Se-R*fe+B*ce)*Ye,a[8]=(y*Pe-x*Ne+M*Ae)*Ye,a[9]=(u*Ne-l*Pe-g*Ae)*Ye,a[10]=(V*ge-$*fe+Q*le)*Ye,a[11]=(k*fe-T*ge-B*le)*Ye,a[12]=(x*Oe-y*De-E*Ae)*Ye,a[13]=(l*De-u*Oe+h*Ae)*Ye,a[14]=($*ce-V*pe-W*le)*Ye,a[15]=(T*pe-k*ce+R*le)*Ye,a):null},p.isMapAuthenticated=function(a){return Ya.has(a)},p.isMapboxURL=co,p.isSafariWithAntialiasingBug=function(a){const r=a.navigator?a.navigator.userAgent:null;return!!Ha(a)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=fr,p.len=T0,p.length=S0,p.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},p.loadVectorTile=jg,p.makeRequest=K,p.mercatorXfromLng=Ma,p.mercatorYfromLat=Ih,p.mercatorZfromAltitude=cu,p.mul=UC,p.mul$1=A0,p.multiply=function(a,r,l){var u=r[0],h=r[1],g=r[2],y=r[3],x=r[4],E=r[5],M=r[6],T=r[7],k=r[8],R=l[0],B=l[1],V=l[2],$=l[3],W=l[4],Q=l[5],le=l[6],ce=l[7],fe=l[8];return a[0]=R*u+B*y+V*M,a[1]=R*h+B*x+V*T,a[2]=R*g+B*E+V*k,a[3]=$*u+W*y+Q*M,a[4]=$*h+W*x+Q*T,a[5]=$*g+W*E+Q*k,a[6]=le*u+ce*y+fe*M,a[7]=le*h+ce*x+fe*T,a[8]=le*g+ce*E+fe*k,a},p.multiply$1=Gm,p.multiply$2=Ph,p.nextPowerOfTwo=Yd,p.normalize=pp,p.normalize$1=function(a,r){var l=r[0],u=r[1],h=r[2],g=r[3],y=l*l+u*u+h*h+g*g;return y>0&&(y=1/Math.sqrt(y)),a[0]=l*y,a[1]=u*y,a[2]=h*y,a[3]=g*y,a},p.number=ct,p.ortho=function(a,r,l,u,h,g,y){var x=1/(r-l),E=1/(u-h),M=1/(g-y);return a[0]=-2*x,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*E,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*M,a[11]=0,a[12]=(r+l)*x,a[13]=(h+u)*E,a[14]=(y+g)*M,a[15]=1,a},p.pbf=Yh,p.perspective=function(a,r,l,u,h){var g,y=1/Math.tan(r/2);return a[0]=y/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=y,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=h&&h!==1/0?(a[10]=(h+u)*(g=1/(u-h)),a[14]=2*h*u*g):(a[10]=-1,a[14]=-2*u),a},p.pick=function(a,r){const l={};for(let u=0;u<r.length;u++){const h=r[u];h in a&&(l[h]=a[h])}return l},p.plugin=ss,p.pointGeometry=Be,p.polygonIntersectsBox=sy,p.polygonIntersectsPolygon=Vm,p.polygonizeBounds=function(a,r,l=0,u=!0){const h=new Be(l,l),g=a.sub(h),y=r.add(h),x=[g,new Be(y.x,g.y),y,new Be(g.x,y.y)];return u&&x.push(g),x},p.posAttributes=sf,p.postMapLoadEvent=Fc,p.postTurnstileEvent=Ic,p.potpack=Qh,p.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},p.radToDeg=Fr,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(a){return a({pluginStatus:dr,pluginURL:br}),wh.on("pluginStateChange",a),a},p.removeAuthState=function(a){Ya.delete(a)},p.renderColorRamp=fu,p.rotateX=hu,p.rotateX$1=Is,p.rotateY=$m,p.rotateZ=function(a,r,l){var u=Math.sin(l),h=Math.cos(l),g=r[0],y=r[1],x=r[2],E=r[3],M=r[4],T=r[5],k=r[6],R=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=g*h+M*u,a[1]=y*h+T*u,a[2]=x*h+k*u,a[3]=E*h+R*u,a[4]=M*h-g*u,a[5]=T*h-y*u,a[6]=k*h-x*u,a[7]=R*h-E*u,a},p.rotateZ$1=function(a,r,l){l*=.5;var u=r[0],h=r[1],g=r[2],y=r[3],x=Math.sin(l),E=Math.cos(l);return a[0]=u*E+h*x,a[1]=h*E-u*x,a[2]=g*E+y*x,a[3]=y*E-g*x,a},p.scale=Xs,p.scale$1=function(a,r,l){return a[0]=r[0]*l,a[1]=r[1]*l,a[2]=r[2]*l,a[3]=r[3]*l,a},p.scale$2=Lh,p.scaleAndAdd=Hm,p.setCacheLimits=function(a,r){fa=a,Ri=r},p.setColumn=function(a,r,l){a[4*r+0]=l[0],a[4*r+1]=l[1],a[4*r+2]=l[2],a[4*r+3]=l[3]},p.setRTLTextPlugin=function(a,r,l=!1){if(dr===vh||dr===Zl||dr===xh)throw new Error("setRTLTextPlugin cannot be called multiple times.");br=Rr.resolveURL(a),dr=vh,bh=r,Vo(),l||jo()},p.smoothstep=$a,p.spec=we,p.storeAuthState=function(a,r){r?Ya.add(a):Ya.delete(a)},p.sub=_o,p.subtract=ly,p.symbolSize=Iy,p.tileAABB=function(a,r,l,u,h,g,y,x,E){if("globe"===E.name)return function db(a,r,l){const u=r/a.worldSize,h=(Pe,Ve)=>{Lh(Pe,Pe,u),Lh(Ve,Ve,u)},g=Number.MAX_VALUE,y=[-g,-g,-g],x=[g,g,g],E=Mg(a);if(l.z<=1){const Pe=af(l).getCorners();for(let Ve=0;Ve<Pe.length;Ve++)tc(Pe[Ve],Pe[Ve],E),Oh(x,x,Pe[Ve]),Jl(y,y,Pe[Ve]);return h(x,y),new ks(x,y)}const[M,T]=vu(l),k=new lu;k.setSouthWest([M[1],T[0]]),k.setNorthEast([T[1],M[0]]);const R=[Ko(k.getSouth(),k.getWest()),Ko(k.getSouth(),k.getEast()),Ko(k.getNorth(),k.getEast()),Ko(k.getNorth(),k.getWest())];for(let Pe=0;Pe<R.length;Pe++)tc(R[Pe],R[Pe],E),Oh(x,x,R[Pe]),Jl(y,y,R[Pe]);if(k.contains(a.center))return y[2]=0,h(x,y),new ks(x,y);const B=[E[12],E[13],E[14]],V=a.center.lng,$=on(a.center.lat,-85.051129,Sa),W=[Ma(V),Ih($)],Q=k.getCenter().lng,le=on(k.getCenter().lat,-85.051129,Sa),ce=[Ma(Q),Ih(le)];let fe=new Array(3),pe=0;const ge=W[0]-ce[0],Se=W[1]-ce[1];if(Math.abs(ge)>Math.abs(Se))pe=ge>=0?1:3,fe=B;else{pe=Se>=0?0:2;const Pe=[E[4],E[5],E[6]];let Ve;Ve=Se>=0?-Math.sin(cn(k.getSouth()))*Js:-Math.sin(cn(k.getNorth()))*Js,fe=Hm(fe,B,Pe,Ve)}const Ae=R[pe],Oe=R[(pe+1)%4],Ne=new ub(Ae,Oe,fe),De=[Bp(Ne,0)||Ae[0],Bp(Ne,1)||Ae[1],Bp(Ne,2)||Ae[2]];return x[2]=Math.min(Ae[2],Oe[2]),Oh(x,x,De),Jl(y,y,De),h(x,y),new ks(x,y)}(a,r,new Eu(l,u,h));const M=oc({z:l,x:u,y:h},E);return new ks([(g+M.x/M.scale)*r,r*(M.y/M.scale),y],[(g+M.x2/M.scale)*r,r*(M.y2/M.scale),x])},p.tileTransform=oc,p.transformMat3=function(a,r,l){var u=r[0],h=r[1],g=r[2];return a[0]=u*l[0]+h*l[3]+g*l[6],a[1]=u*l[1]+h*l[4]+g*l[7],a[2]=u*l[2]+h*l[5]+g*l[8],a},p.transformMat4=tc,p.transformMat4$1=yd,p.transformQuat=qm,p.translate=du,p.transpose=function(a,r){if(a===r){var l=r[1],u=r[2],h=r[5];a[1]=r[3],a[2]=r[6],a[3]=l,a[5]=r[7],a[6]=u,a[7]=h}else a[0]=r[0],a[1]=r[3],a[2]=r[6],a[3]=r[1],a[4]=r[4],a[5]=r[7],a[6]=r[2],a[7]=r[5],a[8]=r[8];return a},p.triggerPluginCompletionEvent=Xl,p.uniqueId=la,p.validateCustomStyleLayer=function(a){const r=[],l=a.id;return void 0===l&&r.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&r.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},p.validateFilter=a=>Hs(ll(a)),p.validateFog=a=>Hs(sd(a)),p.validateLayer=a=>Hs(ch(a)),p.validateLight=a=>Hs(dh(a)),p.validateSource=a=>Hs(uh(a)),p.validateStyle=jl,p.validateTerrain=a=>Hs(Qf(a)),p.values=Il,p.vectorTile=mu,p.version="2.8.2",p.warnOnce=Rn,p.window=gt,p.wrap=gs}),Kd(0,function(p){function Wn(J){if("number"==typeof J||"boolean"==typeof J||"string"==typeof J||null==J)return JSON.stringify(J);if(Array.isArray(J)){let j="[";for(const K of J)j+=`${Wn(K)},`;return`${j}]`}let N="{";for(const j of Object.keys(J).sort())N+=`${j}:${Wn(J[j])},`;return`${N}}`}function Do(J){let N="";for(const j of p.refProperties)N+=`/${Wn(J[j])}`;return N}class kr{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,j){for(const re of N)this._layerConfigs[re.id]=re,(this._layers[re.id]=p.createStyleLayer(re)).compileFilter(),this.keyCache[re.id]&&delete this.keyCache[re.id];for(const re of j)delete this.keyCache[re],delete this._layerConfigs[re],delete this._layers[re];this.familiesBySource={};const K=function(re,de){const me={};for(let he=0;he<re.length;he++){const be=de&&de[re[he].id]||Do(re[he]);de&&(de[re[he].id]=be);let Le=me[be];Le||(Le=me[be]=[]),Le.push(re[he])}const _e=[];for(const he in me)_e.push(me[he]);return _e}(p.values(this._layerConfigs),this.keyCache);for(const re of K){const de=re.map(Je=>this._layers[Je.id]),me=de[0];if("none"===me.visibility)continue;const _e=me.source||"";let he=this.familiesBySource[_e];he||(he=this.familiesBySource[_e]={});const be=me.sourceLayer||"_geojsonTileLayer";let Le=he[be];Le||(Le=he[be]=[]),Le.push(de)}}}class Be{loadTile(N,j){const{uid:K,encoding:re,rawImageData:de,padding:me,buildQuadTree:_e}=N,he=p.window.ImageBitmap&&de instanceof p.window.ImageBitmap?this.getImageData(de,me):de;j(null,new p.DEMData(K,he,re,me<1,_e))}getImageData(N,j){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);const K=this.offscreenCanvasContext.getImageData(-j,-j,N.width+2*j,N.height+2*j);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),K}}var Bt=function J(N,j){var K,re=N&&N.type;if("FeatureCollection"===re)for(K=0;K<N.features.length;K++)J(N.features[K],j);else if("GeometryCollection"===re)for(K=0;K<N.geometries.length;K++)J(N.geometries[K],j);else if("Feature"===re)J(N.geometry,j);else if("Polygon"===re)gt(N.coordinates,j);else if("MultiPolygon"===re)for(K=0;K<N.coordinates.length;K++)gt(N.coordinates[K],j);return N};function gt(J,N){if(0!==J.length){Bs(J[0],N);for(var j=1;j<J.length;j++)Bs(J[j],!N)}}function Bs(J,N){for(var j=0,K=0,re=0,de=J.length,me=de-1;re<de;me=re++){var _e=(J[re][0]-J[me][0])*(J[me][1]+J[re][1]),he=j+_e;K+=Math.abs(j)>=Math.abs(_e)?j-he+_e:_e-he+j,j=he}j+K>=0!=!!N&&J.reverse()}const Jr=p.vectorTile.VectorTileFeature.prototype.toGeoJSON;class cn{constructor(N){this._feature=N,this.extent=p.EXTENT,this.type=N.type,this.properties=N.tags,"id"in N&&!isNaN(N.id)&&(this.id=parseInt(N.id,10))}loadGeometry(){if(1===this._feature.type){const N=[];for(const j of this._feature.geometry)N.push([new p.pointGeometry(j[0],j[1])]);return N}{const N=[];for(const j of this._feature.geometry){const K=[];for(const re of j)K.push(new p.pointGeometry(re[0],re[1]));N.push(K)}return N}}toGeoJSON(N,j,K){return Jr.call(this,N,j,K)}}class Fr{constructor(N){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=N.length,this._features=N}feature(N){return new cn(this._features[N])}}var $u=p.vectorTile.VectorTileFeature,Mo=es;function es(J,N){this.options=N||{},this.features=J,this.length=J.length}function ts(J,N){this.id="number"==typeof J.id?J.id:void 0,this.type=J.type,this.rawGeometry=1===J.type?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=N||4096}es.prototype.feature=function(J){return new ts(this.features[J],this.options.extent)},ts.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var N=0;N<J.length;N++){for(var j=J[N],K=[],re=0;re<j.length;re++)K.push(new p.pointGeometry(j[re][0],j[re][1]));this.geometry.push(K)}return this.geometry},ts.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,N=1/0,j=-1/0,K=1/0,re=-1/0,de=0;de<J.length;de++)for(var me=J[de],_e=0;_e<me.length;_e++){var he=me[_e];N=Math.min(N,he.x),j=Math.max(j,he.x),K=Math.min(K,he.y),re=Math.max(re,he.y)}return[N,K,j,re]},ts.prototype.toGeoJSON=$u.prototype.toGeoJSON;var on=gs,$a=Mo;function gs(J){var N=new p.pbf;return function(j,K){for(var re in j.layers)K.writeMessage(3,aa,j.layers[re])}(J,N),N.finish()}function aa(J,N){var j;N.writeVarintField(15,J.version||1),N.writeStringField(1,J.name||""),N.writeVarintField(5,J.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<J.length;j++)K.feature=J.feature(j),N.writeMessage(2,Il,K);var re=K.keys;for(j=0;j<re.length;j++)N.writeStringField(3,re[j]);var de=K.values;for(j=0;j<de.length;j++)N.writeMessage(4,Yd,de[j])}function Il(J,N){var j=J.feature;void 0!==j.id&&N.writeVarintField(1,j.id),N.writeMessage(2,bi,J),N.writeVarintField(3,j.type),N.writeMessage(4,Ns,j)}function bi(J,N){var j=J.feature,K=J.keys,re=J.values,de=J.keycache,me=J.valuecache;for(var _e in j.properties){var he=j.properties[_e],be=de[_e];if(null!==he){void 0===be&&(K.push(_e),de[_e]=be=K.length-1),N.writeVarint(be);var Le=typeof he;"string"!==Le&&"boolean"!==Le&&"number"!==Le&&(he=JSON.stringify(he));var Je=Le+":"+he,ze=me[Je];void 0===ze&&(re.push(he),me[Je]=ze=re.length-1),N.writeVarint(ze)}}}function Mc(J,N){return(N<<3)+(7&J)}function la(J){return J<<1^J>>31}function Ns(J,N){for(var j=J.loadGeometry(),K=J.type,re=0,de=0,me=j.length,_e=0;_e<me;_e++){var he=j[_e],be=1;1===K&&(be=he.length),N.writeVarint(Mc(1,be));for(var Le=3===K?he.length-1:he.length,Je=0;Je<Le;Je++){1===Je&&1!==K&&N.writeVarint(Mc(2,Le-1));var ze=he[Je].x-re,xt=he[Je].y-de;N.writeVarint(la(ze)),N.writeVarint(la(xt)),re+=ze,de+=xt}3===K&&N.writeVarint(Mc(7,1))}}function Yd(J,N){var j=typeof J;"string"===j?N.writeStringField(1,J):"boolean"===j?N.writeBooleanField(7,J):"number"===j&&(J%1!=0?N.writeDoubleField(3,J):J<0?N.writeSVarintField(6,J):N.writeVarintField(5,J))}function ca(J,N,j,K,re,de){if(re-K<=j)return;const me=K+re>>1;un(J,N,me,K,re,de%2),ca(J,N,j,K,me-1,de+1),ca(J,N,j,me+1,re,de+1)}function un(J,N,j,K,re,de){for(;re>K;){if(re-K>600){const be=re-K+1,Le=j-K+1,Je=Math.log(be),ze=.5*Math.exp(2*Je/3),xt=.5*Math.sqrt(Je*ze*(be-ze)/be)*(Le-be/2<0?-1:1);un(J,N,j,Math.max(K,Math.floor(j-Le*ze/be+xt)),Math.min(re,Math.floor(j+(be-Le)*ze/be+xt)),de)}const me=N[2*j+de];let _e=K,he=re;for(zs(J,N,K,j),N[2*re+de]>me&&zs(J,N,K,re);_e<he;){for(zs(J,N,_e,he),_e++,he--;N[2*_e+de]<me;)_e++;for(;N[2*he+de]>me;)he--}N[2*K+de]===me?zs(J,N,K,he):(he++,zs(J,N,he,re)),he<=j&&(K=he+1),j<=he&&(re=he-1)}}function zs(J,N,j,K){ua(J,j,K),ua(N,2*j,2*K),ua(N,2*j+1,2*K+1)}function ua(J,N,j){const K=J[N];J[N]=J[j],J[j]=K}function Sc(J,N,j,K){const re=J-j,de=N-K;return re*re+de*de}on.fromVectorTileJs=gs,on.fromGeojsonVt=function(J,N){N=N||{};var j={};for(var K in J)j[K]=new Mo(J[K].features,N),j[K].name=K,j[K].version=N.version,j[K].extent=N.extent;return gs({layers:j})},on.GeoJSONWrapper=$a;const _s=J=>J[0],Nt=J=>J[1];class Rn{constructor(N,j=_s,K=Nt,re=64,de=Float64Array){this.nodeSize=re,this.points=N;const me=N.length<65536?Uint16Array:Uint32Array,_e=this.ids=new me(N.length),he=this.coords=new de(2*N.length);for(let be=0;be<N.length;be++)_e[be]=be,he[2*be]=j(N[be]),he[2*be+1]=K(N[be]);ca(_e,he,re,0,_e.length-1,0)}range(N,j,K,re){return function(de,me,_e,he,be,Le,Je){const ze=[0,de.length-1,0],xt=[];let pt,_t;for(;ze.length;){const Et=ze.pop(),we=ze.pop(),vn=ze.pop();if(we-vn<=Je){for(let xn=vn;xn<=we;xn++)pt=me[2*xn],_t=me[2*xn+1],pt>=_e&&pt<=be&&_t>=he&&_t<=Le&&xt.push(de[xn]);continue}const lt=Math.floor((vn+we)/2);pt=me[2*lt],_t=me[2*lt+1],pt>=_e&&pt<=be&&_t>=he&&_t<=Le&&xt.push(de[lt]);const gn=(Et+1)%2;(0===Et?_e<=pt:he<=_t)&&(ze.push(vn),ze.push(lt-1),ze.push(gn)),(0===Et?be>=pt:Le>=_t)&&(ze.push(lt+1),ze.push(we),ze.push(gn))}return xt}(this.ids,this.coords,N,j,K,re,this.nodeSize)}within(N,j,K){return function(re,de,me,_e,he,be){const Le=[0,re.length-1,0],Je=[],ze=he*he;for(;Le.length;){const xt=Le.pop(),pt=Le.pop(),_t=Le.pop();if(pt-_t<=be){for(let gn=_t;gn<=pt;gn++)Sc(de[2*gn],de[2*gn+1],me,_e)<=ze&&Je.push(re[gn]);continue}const Et=Math.floor((_t+pt)/2),we=de[2*Et],vn=de[2*Et+1];Sc(we,vn,me,_e)<=ze&&Je.push(re[Et]);const lt=(xt+1)%2;(0===xt?me-he<=we:_e-he<=vn)&&(Le.push(_t),Le.push(Et-1),Le.push(lt)),(0===xt?me+he>=we:_e+he>=vn)&&(Le.push(Et+1),Le.push(pt),Le.push(lt))}return Je}(this.ids,this.coords,N,j,K,this.nodeSize)}}const Ji={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},Pn=Math.fround||(Cn=new Float32Array(1),J=>(Cn[0]=+J,Cn[0]));var Cn;class Tt{constructor(N){this.options=Rr(Object.create(Ji),N),this.trees=new Array(this.options.maxZoom+1)}load(N){const{log:j,minZoom:K,maxZoom:re,nodeSize:de}=this.options;j&&console.time("total time");const me=`prepare ${N.length} points`;j&&console.time(me),this.points=N;let _e=[];for(let he=0;he<N.length;he++)N[he].geometry&&_e.push(Hu(N[he],he));this.trees[re+1]=new Rn(_e,kl,mn,de,Float32Array),j&&console.timeEnd(me);for(let he=re;he>=K;he--){const be=+Date.now();_e=this._cluster(_e,he),this.trees[he]=new Rn(_e,kl,mn,de,Float32Array),j&&console.log("z%d: %d clusters in %dms",he,_e.length,+Date.now()-be)}return j&&console.timeEnd("total time"),this}getClusters(N,j){let K=((N[0]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,N[1]));let de=180===N[2]?180:((N[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)K=-180,de=180;else if(K>de){const Le=this.getClusters([K,re,180,me],j),Je=this.getClusters([-180,re,de,me],j);return Le.concat(Je)}const _e=this.trees[this._limitZoom(j)],he=_e.range(an(K),Ha(me),an(de),Ha(re)),be=[];for(const Le of he){const Je=_e.points[Le];be.push(Je.numPoints?da(Je):this.points[Je.index])}return be}getChildren(N){const j=this._getOriginId(N),K=this._getOriginZoom(N),re="No cluster with the specified id.",de=this.trees[K];if(!de)throw new Error(re);const me=de.points[j];if(!me)throw new Error(re);const _e=this.options.radius/(this.options.extent*Math.pow(2,K-1)),he=de.within(me.x,me.y,_e),be=[];for(const Le of he){const Je=de.points[Le];Je.parentId===N&&be.push(Je.numPoints?da(Je):this.points[Je.index])}if(0===be.length)throw new Error(re);return be}getLeaves(N,j,K){const re=[];return this._appendLeaves(re,N,j=j||10,K=K||0,0),re}getTile(N,j,K){const re=this.trees[this._limitZoom(N)],de=Math.pow(2,N),{extent:me,radius:_e}=this.options,he=_e/me,be=(K-he)/de,Le=(K+1+he)/de,Je={features:[]};return this._addTileFeatures(re.range((j-he)/de,be,(j+1+he)/de,Le),re.points,j,K,de,Je),0===j&&this._addTileFeatures(re.range(1-he/de,be,1,Le),re.points,de,K,de,Je),j===de-1&&this._addTileFeatures(re.range(0,be,he/de,Le),re.points,-1,K,de,Je),Je.features.length?Je:null}getClusterExpansionZoom(N){let j=this._getOriginZoom(N)-1;for(;j<=this.options.maxZoom;){const K=this.getChildren(N);if(j++,1!==K.length)break;N=K[0].properties.cluster_id}return j}_appendLeaves(N,j,K,re,de){const me=this.getChildren(j);for(const _e of me){const he=_e.properties;if(he&&he.cluster?de+he.point_count<=re?de+=he.point_count:de=this._appendLeaves(N,he.cluster_id,K,re,de):de<re?de++:N.push(_e),N.length===K)break}return de}_addTileFeatures(N,j,K,re,de,me){for(const _e of N){const he=j[_e],be=he.numPoints;let Le,Je,ze;if(be)Le=So(he),Je=he.x,ze=he.y;else{const _t=this.points[he.index];Le=_t.properties,Je=an(_t.geometry.coordinates[0]),ze=Ha(_t.geometry.coordinates[1])}const xt={type:1,geometry:[[Math.round(this.options.extent*(Je*de-K)),Math.round(this.options.extent*(ze*de-re))]],tags:Le};let pt;be?pt=he.id:this.options.generateId?pt=he.index:this.points[he.index].id&&(pt=this.points[he.index].id),void 0!==pt&&(xt.id=pt),me.features.push(xt)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(+N,this.options.maxZoom+1))}_cluster(N,j){const K=[],{radius:re,extent:de,reduce:me,minPoints:_e}=this.options,he=re/(de*Math.pow(2,j));for(let be=0;be<N.length;be++){const Le=N[be];if(Le.zoom<=j)continue;Le.zoom=j;const Je=this.trees[j+1],ze=Je.within(Le.x,Le.y,he),xt=Le.numPoints||1;let pt=xt;for(const _t of ze){const Et=Je.points[_t];Et.zoom>j&&(pt+=Et.numPoints||1)}if(pt>xt&&pt>=_e){let _t=Le.x*xt,Et=Le.y*xt,we=me&&xt>1?this._map(Le,!0):null;const vn=(be<<5)+(j+1)+this.points.length;for(const lt of ze){const gn=Je.points[lt];if(gn.zoom<=j)continue;gn.zoom=j;const xn=gn.numPoints||1;_t+=gn.x*xn,Et+=gn.y*xn,gn.parentId=vn,me&&(we||(we=this._map(Le,!0)),me(we,this._map(gn)))}Le.parentId=vn,K.push(lo(_t/pt,Et/pt,vn,pt,we))}else if(K.push(Le),pt>1)for(const _t of ze){const Et=Je.points[_t];Et.zoom<=j||(Et.zoom=j,K.push(Et))}}return K}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,j){if(N.numPoints)return j?Rr({},N.properties):N.properties;const K=this.points[N.index].properties,re=this.options.map(K);return j&&re===K?Rr({},re):re}}function lo(J,N,j,K,re){return{x:Pn(J),y:Pn(N),zoom:1/0,id:j,parentId:-1,numPoints:K,properties:re}}function Hu(J,N){const[j,K]=J.geometry.coordinates;return{x:Pn(an(j)),y:Pn(Ha(K)),zoom:1/0,index:N,parentId:-1}}function da(J){return{type:"Feature",id:J.id,properties:So(J),geometry:{type:"Point",coordinates:[(N=J.x,360*(N-.5)),Qd(J.y)]}};var N}function So(J){const N=J.numPoints,j=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N;return Rr(Rr({},J.properties),{cluster:!0,cluster_id:J.id,point_count:N,point_count_abbreviated:j})}function an(J){return J/360+.5}function Ha(J){const N=Math.sin(J*Math.PI/180),j=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return j<0?0:j>1?1:j}function Qd(J){const N=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function Rr(J,N){for(const j in N)J[j]=N[j];return J}function kl(J){return J.x}function mn(J){return J.y}function qa(J,N,j,K){for(var re,de=K,me=j-N>>1,_e=j-N,he=J[N],be=J[N+1],Le=J[j],Je=J[j+1],ze=N+3;ze<j;ze+=3){var xt=ha(J[ze],J[ze+1],he,be,Le,Je);if(xt>de)re=ze,de=xt;else if(xt===de){var pt=Math.abs(ze-me);pt<_e&&(re=ze,_e=pt)}}de>K&&(re-N>3&&qa(J,N,re,K),J[re+2]=de,j-re>3&&qa(J,re,j,K))}function ha(J,N,j,K,re,de){var me=re-j,_e=de-K;if(0!==me||0!==_e){var he=((J-j)*me+(N-K)*_e)/(me*me+_e*_e);he>1?(j=re,K=de):he>0&&(j+=me*he,K+=_e*he)}return(me=J-j)*me+(_e=N-K)*_e}function ys(J,N,j,K){var re={id:void 0===J?null:J,type:N,geometry:j,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var me=de.geometry,_e=de.type;if("Point"===_e||"MultiPoint"===_e||"LineString"===_e)Fl(de,me);else if("Polygon"===_e||"MultiLineString"===_e)for(var he=0;he<me.length;he++)Fl(de,me[he]);else if("MultiPolygon"===_e)for(he=0;he<me.length;he++)for(var be=0;be<me[he].length;be++)Fl(de,me[he][be])}(re),re}function Fl(J,N){for(var j=0;j<N.length;j+=3)J.minX=Math.min(J.minX,N[j]),J.minY=Math.min(J.minY,N[j+1]),J.maxX=Math.max(J.maxX,N[j]),J.maxY=Math.max(J.maxY,N[j+1])}function Ac(J,N,j,K){if(N.geometry){var re=N.geometry.coordinates,de=N.geometry.type,me=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),_e=[],he=N.id;if(j.promoteId?he=N.properties[j.promoteId]:j.generateId&&(he=K||0),"Point"===de)qu(re,_e);else if("MultiPoint"===de)for(var be=0;be<re.length;be++)qu(re[be],_e);else if("LineString"===de)vs(re,_e,me,!1);else if("MultiLineString"===de){if(j.lineMetrics){for(be=0;be<re.length;be++)vs(re[be],_e=[],me,!1),J.push(ys(he,"LineString",_e,N.properties));return}Wa(re,_e,me,!1)}else if("Polygon"===de)Wa(re,_e,me,!0);else{if("MultiPolygon"!==de){if("GeometryCollection"===de){for(be=0;be<N.geometry.geometries.length;be++)Ac(J,{id:he,geometry:N.geometry.geometries[be],properties:N.properties},j,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(be=0;be<re.length;be++){var Le=[];Wa(re[be],Le,me,!0),_e.push(Le)}}J.push(ys(he,de,_e,N.properties))}}function qu(J,N){N.push(co(J[0])),N.push(Za(J[1])),N.push(0)}function vs(J,N,j,K){for(var re,de,me=0,_e=0;_e<J.length;_e++){var he=co(J[_e][0]),be=Za(J[_e][1]);N.push(he),N.push(be),N.push(0),_e>0&&(me+=K?(re*be-he*de)/2:Math.sqrt(Math.pow(he-re,2)+Math.pow(be-de,2))),re=he,de=be}var Le=N.length-3;N[2]=1,qa(N,0,Le,j),N[Le+2]=1,N.size=Math.abs(me),N.start=0,N.end=N.size}function Wa(J,N,j,K){for(var re=0;re<J.length;re++){var de=[];vs(J[re],de,j,K),N.push(de)}}function co(J){return J/360+.5}function Za(J){var N=Math.sin(J*Math.PI/180),j=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return j<0?0:j>1?1:j}function uo(J,N,j,K,re,de,me,_e){if(K/=N,de>=(j/=N)&&me<K)return J;if(me<j||de>=K)return null;for(var he=[],be=0;be<J.length;be++){var Le=J[be],Je=Le.geometry,ze=Le.type,xt=0===re?Le.minX:Le.minY,pt=0===re?Le.maxX:Le.maxY;if(xt>=j&&pt<K)he.push(Le);else if(!(pt<j||xt>=K)){var _t=[];if("Point"===ze||"MultiPoint"===ze)Vs(Je,_t,j,K,re);else if("LineString"===ze)Xa(Je,_t,j,K,re,!1,_e.lineMetrics);else if("MultiLineString"===ze)Rl(Je,_t,j,K,re,!1);else if("Polygon"===ze)Rl(Je,_t,j,K,re,!0);else if("MultiPolygon"===ze)for(var Et=0;Et<Je.length;Et++){var we=[];Rl(Je[Et],we,j,K,re,!0),we.length&&_t.push(we)}if(_t.length){if(_e.lineMetrics&&"LineString"===ze){for(Et=0;Et<_t.length;Et++)he.push(ys(Le.id,ze,_t[Et],Le.tags));continue}"LineString"!==ze&&"MultiLineString"!==ze||(1===_t.length?(ze="LineString",_t=_t[0]):ze="MultiLineString"),"Point"!==ze&&"MultiPoint"!==ze||(ze=3===_t.length?"Point":"MultiPoint"),he.push(ys(Le.id,ze,_t,Le.tags))}}}return he.length?he:null}function Vs(J,N,j,K,re){for(var de=0;de<J.length;de+=3){var me=J[de+re];me>=j&&me<=K&&(N.push(J[de]),N.push(J[de+1]),N.push(J[de+2]))}}function Xa(J,N,j,K,re,de,me){for(var _e,he,be=Wu(J),Le=0===re?Ic:kc,Je=J.start,ze=0;ze<J.length-3;ze+=3){var xt=J[ze],pt=J[ze+1],_t=J[ze+2],Et=J[ze+3],we=J[ze+4],vn=0===re?xt:pt,lt=0===re?Et:we,gn=!1;me&&(_e=Math.sqrt(Math.pow(xt-Et,2)+Math.pow(pt-we,2))),vn<j?lt>j&&(he=Le(be,xt,pt,Et,we,j),me&&(be.start=Je+_e*he)):vn>K?lt<K&&(he=Le(be,xt,pt,Et,we,K),me&&(be.start=Je+_e*he)):Tc(be,xt,pt,_t),lt<j&&vn>=j&&(he=Le(be,xt,pt,Et,we,j),gn=!0),lt>K&&vn<=K&&(he=Le(be,xt,pt,Et,we,K),gn=!0),!de&&gn&&(me&&(be.end=Je+_e*he),N.push(be),be=Wu(J)),me&&(Je+=_e)}var xn=J.length-3;xt=J[xn],pt=J[xn+1],_t=J[xn+2],(vn=0===re?xt:pt)>=j&&vn<=K&&Tc(be,xt,pt,_t),xn=be.length-3,de&&xn>=3&&(be[xn]!==be[0]||be[xn+1]!==be[1])&&Tc(be,be[0],be[1],be[2]),be.length&&N.push(be)}function Wu(J){var N=[];return N.size=J.size,N.start=J.start,N.end=J.end,N}function Rl(J,N,j,K,re,de){for(var me=0;me<J.length;me++)Xa(J[me],N,j,K,re,de,!1)}function Tc(J,N,j,K){J.push(N),J.push(j),J.push(K)}function Ic(J,N,j,K,re,de){var me=(de-N)/(K-N);return J.push(de),J.push(j+(re-j)*me),J.push(1),me}function kc(J,N,j,K,re,de){var me=(de-j)/(re-j);return J.push(N+(K-N)*me),J.push(de),J.push(1),me}function Fc(J,N){for(var j=[],K=0;K<J.length;K++){var re,de=J[K],me=de.type;if("Point"===me||"MultiPoint"===me||"LineString"===me)re=Ka(de.geometry,N);else if("MultiLineString"===me||"Polygon"===me){re=[];for(var _e=0;_e<de.geometry.length;_e++)re.push(Ka(de.geometry[_e],N))}else if("MultiPolygon"===me)for(re=[],_e=0;_e<de.geometry.length;_e++){for(var he=[],be=0;be<de.geometry[_e].length;be++)he.push(Ka(de.geometry[_e][be],N));re.push(he)}j.push(ys(de.id,me,re,de.tags))}return j}function Ka(J,N){var j=[];j.size=J.size,void 0!==J.start&&(j.start=J.start,j.end=J.end);for(var K=0;K<J.length;K+=3)j.push(J[K]+N,J[K+1],J[K+2]);return j}function Rc(J,N){if(J.transformed)return J;var j,K,re,de=1<<J.z,me=J.x,_e=J.y;for(j=0;j<J.features.length;j++){var he=J.features[j],be=he.geometry,Le=he.type;if(he.geometry=[],1===Le)for(K=0;K<be.length;K+=2)he.geometry.push(Ya(be[K],be[K+1],N,de,me,_e));else for(K=0;K<be.length;K++){var Je=[];for(re=0;re<be[K].length;re+=2)Je.push(Ya(be[K][re],be[K][re+1],N,de,me,_e));he.geometry.push(Je)}}return J.transformed=!0,J}function Ya(J,N,j,K,re,de){return[Math.round(j*(J*K-re)),Math.round(j*(N*K-de))]}function Pc(J,N,j,K,re){for(var de=N===re.maxZoom?0:re.tolerance/((1<<N)*re.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:K,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},_e=0;_e<J.length;_e++){me.numFeatures++,xs(me,J[_e],de,re);var he=J[_e].minX,be=J[_e].minY,Le=J[_e].maxX,Je=J[_e].maxY;he<me.minX&&(me.minX=he),be<me.minY&&(me.minY=be),Le>me.maxX&&(me.maxX=Le),Je>me.maxY&&(me.maxY=Je)}return me}function xs(J,N,j,K){var re=N.geometry,de=N.type,me=[];if("Point"===de||"MultiPoint"===de)for(var _e=0;_e<re.length;_e+=3)me.push(re[_e]),me.push(re[_e+1]),J.numPoints++,J.numSimplified++;else if("LineString"===de)Ao(me,re,J,j,!1,!1);else if("MultiLineString"===de||"Polygon"===de)for(_e=0;_e<re.length;_e++)Ao(me,re[_e],J,j,"Polygon"===de,0===_e);else if("MultiPolygon"===de)for(var he=0;he<re.length;he++){var be=re[he];for(_e=0;_e<be.length;_e++)Ao(me,be[_e],J,j,!0,0===_e)}if(me.length){var Le=N.tags||null;if("LineString"===de&&K.lineMetrics){for(var Je in Le={},N.tags)Le[Je]=N.tags[Je];Le.mapbox_clip_start=re.start/re.size,Le.mapbox_clip_end=re.end/re.size}var ze={geometry:me,type:"Polygon"===de||"MultiPolygon"===de?3:"LineString"===de||"MultiLineString"===de?2:1,tags:Le};null!==N.id&&(ze.id=N.id),J.features.push(ze)}}function Ao(J,N,j,K,re,de){var me=K*K;if(K>0&&N.size<(re?me:K))j.numPoints+=N.length/3;else{for(var _e=[],he=0;he<N.length;he+=3)(0===K||N[he+2]>me)&&(j.numSimplified++,_e.push(N[he]),_e.push(N[he+1])),j.numPoints++;re&&function(be,Le){for(var Je=0,ze=0,xt=be.length,pt=xt-2;ze<xt;pt=ze,ze+=2)Je+=(be[ze]-be[pt])*(be[ze+1]+be[pt+1]);if(Je>0===Le)for(ze=0,xt=be.length;ze<xt/2;ze+=2){var _t=be[ze],Et=be[ze+1];be[ze]=be[xt-2-ze],be[ze+1]=be[xt-1-ze],be[xt-2-ze]=_t,be[xt-1-ze]=Et}}(_e,de),J.push(_e)}}function fa(J,N){var j=(N=this.options=function(re,de){for(var me in de)re[me]=de[me];return re}(Object.create(this.options),N)).debug;if(j&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var re,de,me,_e,he,be,K=function(re,de){var me=[];if("FeatureCollection"===re.type)for(var _e=0;_e<re.features.length;_e++)Ac(me,re.features[_e],de,_e);else Ac(me,"Feature"===re.type?re:{geometry:re},de);return me}(J,N);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(re=K,de=N,me=de.buffer/de.extent,_e=re,he=uo(re,1,-1-me,me,0,-1,2,de),be=uo(re,1,1-me,2+me,0,-1,2,de),(he||be)&&(_e=uo(re,1,-me,1+me,0,-1,2,de)||[],he&&(_e=Fc(he,1).concat(_e)),be&&(_e=_e.concat(Fc(be,-1)))),K=_e).length&&this.splitTile(K,0,0,0),j&&(K.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ri(J,N,j){return 32*((1<<J)*j+N)+J}function Pl(J,N){const j=J.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);const K=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!K)return N(null,null);const re=new Fr(K.features);let de=on(re);0===de.byteOffset&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),N(null,{vectorTile:re,rawData:de.buffer})}fa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},fa.prototype.splitTile=function(J,N,j,K,re,de,me){for(var _e=[J,N,j,K],he=this.options,be=he.debug;_e.length;){K=_e.pop(),j=_e.pop(),N=_e.pop(),J=_e.pop();var Le=1<<N,Je=Ri(N,j,K),ze=this.tiles[Je];if(!ze&&(be>1&&console.time("creation"),ze=this.tiles[Je]=Pc(J,N,j,K,he),this.tileCoords.push({z:N,x:j,y:K}),be)){be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,j,K,ze.numFeatures,ze.numPoints,ze.numSimplified),console.timeEnd("creation"));var xt="z"+N;this.stats[xt]=(this.stats[xt]||0)+1,this.total++}if(ze.source=J,re){if(N===he.maxZoom||N===re)continue;var pt=1<<re-N;if(j!==Math.floor(de/pt)||K!==Math.floor(me/pt))continue}else if(N===he.indexMaxZoom||ze.numPoints<=he.indexMaxPoints)continue;if(ze.source=null,0!==J.length){be>1&&console.time("clipping");var _t,Et,we,vn,lt,gn,xn=.5*he.buffer/he.extent,pa=.5-xn,To=.5+xn,Qe=1+xn;_t=Et=we=vn=null,lt=uo(J,Le,j-xn,j+To,0,ze.minX,ze.maxX,he),gn=uo(J,Le,j+pa,j+Qe,0,ze.minX,ze.maxX,he),J=null,lt&&(_t=uo(lt,Le,K-xn,K+To,1,ze.minY,ze.maxY,he),Et=uo(lt,Le,K+pa,K+Qe,1,ze.minY,ze.maxY,he),lt=null),gn&&(we=uo(gn,Le,K-xn,K+To,1,ze.minY,ze.maxY,he),vn=uo(gn,Le,K+pa,K+Qe,1,ze.minY,ze.maxY,he),gn=null),be>1&&console.timeEnd("clipping"),_e.push(_t||[],N+1,2*j,2*K),_e.push(Et||[],N+1,2*j,2*K+1),_e.push(we||[],N+1,2*j+1,2*K),_e.push(vn||[],N+1,2*j+1,2*K+1)}}},fa.prototype.getTile=function(J,N,j){var K=this.options,re=K.extent,de=K.debug;if(J<0||J>24)return null;var me=1<<J,_e=Ri(J,N=(N%me+me)%me,j);if(this.tiles[_e])return Rc(this.tiles[_e],re);de>1&&console.log("drilling down to z%d-%d-%d",J,N,j);for(var he,be=J,Le=N,Je=j;!he&&be>0;)be--,Le=Math.floor(Le/2),Je=Math.floor(Je/2),he=this.tiles[Ri(be,Le,Je)];return he&&he.source?(de>1&&console.log("found parent tile z%d-%d-%d",be,Le,Je),de>1&&console.time("drilling down"),this.splitTile(he.source,be,Le,Je,J,N,j),de>1&&console.timeEnd("drilling down"),this.tiles[_e]?Rc(this.tiles[_e],re):null):null};class Oc extends p.VectorTileWorkerSource{constructor(N,j,K,re,de){super(N,j,K,re,Pl),de&&(this.loadGeoJSON=de)}loadData(N,j){const K=N&&N.request,re=K&&K.collectResourceTiming;this.loadGeoJSON(N,(de,me)=>{if(de||!me)return j(de);if("object"!=typeof me)return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));{Bt(me,!0);try{if(N.filter){const he=p.createExpression(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===he.result)throw new Error(he.value.map(Le=>`${Le.key}: ${Le.message}`).join(", "));const be=me.features.filter(Le=>he.value.evaluate({zoom:0},Le));me={type:"FeatureCollection",features:be}}this._geoJSONIndex=N.cluster?new Tt(function({superclusterOptions:he,clusterProperties:be}){if(!be||!he)return he;const Le={},Je={},ze={accumulated:null,zoom:0},xt={properties:null},pt=Object.keys(be);for(const _t of pt){const[Et,we]=be[_t],vn=p.createExpression(we),lt=p.createExpression("string"==typeof Et?[Et,["accumulated"],["get",_t]]:Et);Le[_t]=vn.value,Je[_t]=lt.value}return he.map=_t=>{xt.properties=_t;const Et={};for(const we of pt)Et[we]=Le[we].evaluate(ze,xt);return Et},he.reduce=(_t,Et)=>{xt.properties=Et;for(const we of pt)ze.accumulated=_t[we],_t[we]=Je[we].evaluate(ze,xt)},he}(N)).load(me.features):new fa(he=me,N.geojsonVtOptions)}catch(he){return j(he)}this.loaded={};const _e={};if(re){const he=p.getPerformanceMeasurement(K);he&&(_e.resourceTiming={},_e.resourceTiming[N.source]=JSON.parse(JSON.stringify(he)))}j(null,_e)}var he})}reloadTile(N,j){const K=this.loaded;return K&&K[N.uid]?super.reloadTile(N,j):this.loadTile(N,j)}loadGeoJSON(N,j){if(N.request)p.getJSON(N.request,j);else{if("string"!=typeof N.data)return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(N.data))}catch(K){return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(N,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(N.clusterId))}catch(K){j(K)}}getClusterChildren(N,j){try{j(null,this._geoJSONIndex.getChildren(N.clusterId))}catch(K){j(K)}}getClusterLeaves(N,j){try{j(null,this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset))}catch(K){j(K)}}}class Ol{constructor(N){this.self=N,this.actor=new p.Actor(N,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:Oc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,K)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=K},this.self.registerRTLTextPlugin=j=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=j.applyArabicShaping,p.plugin.processBidirectionalText=j.processBidirectionalText,p.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}clearCaches(N,j,K){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N],K()}checkIfReady(N,j,K){K()}setReferrer(N,j){this.referrer=j}spriteLoaded(N,j){this.isSpriteLoaded[N]=j;for(const K in this.workerSources[N]){const re=this.workerSources[N][K];for(const de in re)re[de]instanceof p.VectorTileWorkerSource&&(re[de].isSpriteLoaded=j,re[de].fire(new p.Event("isSpriteLoaded")))}}setImages(N,j,K){this.availableImages[N]=j;for(const re in this.workerSources[N]){const de=this.workerSources[N][re];for(const me in de)de[me].availableImages=j}K()}enableTerrain(N,j,K){this.terrain=j,K()}setProjection(N,j){this.projections[N]=p.getProjection(j)}setLayers(N,j,K){this.getLayerIndex(N).replace(j),K()}updateLayers(N,j,K){this.getLayerIndex(N).update(j.layers,j.removedIds),K()}loadTile(N,j,K){const re=this.enableTerrain?p.extend({enableTerrain:this.terrain},j):j;re.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,j.type,j.source).loadTile(re,K)}loadDEMTile(N,j,K){const re=this.enableTerrain?p.extend({buildQuadTree:this.terrain},j):j;this.getDEMWorkerSource(N,j.source).loadTile(re,K)}reloadTile(N,j,K){const re=this.enableTerrain?p.extend({enableTerrain:this.terrain},j):j;re.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,j.type,j.source).reloadTile(re,K)}abortTile(N,j,K){this.getWorkerSource(N,j.type,j.source).abortTile(j,K)}removeTile(N,j,K){this.getWorkerSource(N,j.type,j.source).removeTile(j,K)}removeSource(N,j,K){if(!this.workerSources[N]||!this.workerSources[N][j.type]||!this.workerSources[N][j.type][j.source])return;const re=this.workerSources[N][j.type][j.source];delete this.workerSources[N][j.type][j.source],void 0!==re.removeSource?re.removeSource(j,K):K()}loadWorkerSource(N,j,K){try{this.self.importScripts(j.url),K()}catch(re){K(re.toString())}}syncRTLPluginState(N,j,K){try{p.plugin.setState(j);const re=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=re){this.self.importScripts(re);const de=p.plugin.isParsed();K(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${re}`),de)}}catch(re){K(re.toString())}}getAvailableImages(N){let j=this.availableImages[N];return j||(j=[]),j}getLayerIndex(N){let j=this.layerIndexes[N];return j||(j=this.layerIndexes[N]=new kr),j}getWorkerSource(N,j,K){return this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][j]||(this.workerSources[N][j]={}),this.workerSources[N][j][K]||(this.workerSources[N][j][K]=new this.workerSourceTypes[j]({send:(re,de,me,_e,he,be)=>{this.actor.send(re,de,me,N,he,be)},scheduler:this.actor.scheduler},this.getLayerIndex(N),this.getAvailableImages(N),this.isSpriteLoaded[N])),this.workerSources[N][j][K]}getDEMWorkerSource(N,j){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][j]||(this.demWorkerSources[N][j]=new Be),this.demWorkerSources[N][j]}enforceCacheSizeLimit(N,j){p.enforceCacheSizeLimit(j)}getWorkerPerformanceMetrics(N,j,K){K(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Ol(self)),Ol}),Kd(0,function(p){var Wn=Do;function Do(m){return o=m,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,b,w=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(w);try{b=new Worker(D),_=!0}catch(A){_=!1}return b&&b.terminate(),URL.revokeObjectURL(D),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var b=_.getContext("2d");if(!b)return!1;var w=b.getImageData(0,0,1,1);return w&&w.width===_.width}()||(void 0===kr[d=o&&o.failIfMajorPerformanceCaveat]&&(kr[d]=function(_){var b,D,A,F,w=(D=_,A=document.createElement("canvas"),(F=Object.create(Do.webGLContextAttributes)).failIfMajorPerformanceCaveat=D,A.getContext("webgl",F)||A.getContext("experimental-webgl",F));if(!w)return!1;try{b=w.createShader(w.VERTEX_SHADER)}catch(D){return!1}return!(!b||w.isContextLost())&&(w.shaderSource(b,"void main() {}"),w.compileShader(b),!0===w.getShaderParameter(b,w.COMPILE_STATUS))}(d)),!kr[d]||document.documentMode));var o,d}var kr={};function Be(m,o){if(Array.isArray(m)){if(!Array.isArray(o)||m.length!==o.length)return!1;for(let d=0;d<m.length;d++)if(!Be(m[d],o[d]))return!1;return!0}if("object"==typeof m&&null!==m&&null!==o){if("object"!=typeof o||Object.keys(m).length!==Object.keys(o).length)return!1;for(const d in m)if(!Be(m[d],o[d]))return!1;return!0}return m===o}function Bt(m,o,d){const _=p.window.document.createElement(m);return void 0!==o&&(_.className=o),d&&d.appendChild(_),_}function gt(m,o,d){const _=p.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const b of Object.keys(o))_.setAttributeNS(null,b,o[b]);return d&&d.appendChild(_),_}Do.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Bs=p.window.document&&p.window.document.documentElement.style,Jr=Bs&&void 0!==Bs.userSelect?"userSelect":"WebkitUserSelect";let cn;function Fr(){Bs&&Jr&&(cn=Bs[Jr],Bs[Jr]="none")}function $u(){Bs&&Jr&&(Bs[Jr]=cn)}function Mo(m){m.preventDefault(),m.stopPropagation(),p.window.removeEventListener("click",Mo,!0)}function es(){p.window.addEventListener("click",Mo,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",Mo,!0)},0)}function ts(m,o){const d=m.getBoundingClientRect();return gs(m,d,o)}function on(m,o){const d=m.getBoundingClientRect(),_=[];for(let b=0;b<o.length;b++)_.push(gs(m,d,o[b]));return _}function $a(m){return void 0!==p.window.InstallTrigger&&2===m.button&&m.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function gs(m,o,d){const _=m.offsetWidth===o.width?1:m.offsetWidth/o.width;return new p.pointGeometry((d.clientX-o.left)*_,(d.clientY-o.top)*_)}function aa(m,o){var d=o[0],_=o[1],b=o[2],w=o[3],D=d*w-b*_;return D?(m[0]=w*(D=1/D),m[1]=-_*D,m[2]=-b*D,m[3]=d*D,m):null}function Il(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}class bi extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,_);this.requestors=[]}}hasImage(o){return!!this.getImage(o)}getImage(o){return this.images[o]}addImage(o,d){this._validate(o,d)&&(this.images[o]=d)}_validate(o,d){let _=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new p.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),_=!1),_}_validateStretch(o,d){if(!o)return!0;let _=0;for(const b of o){if(b[0]<_||b[1]<b[0]||d<b[1])return!1;_=b[1]}return!0}_validateContent(o,d){return!(o&&(4!==o.length||o[0]<0||d.data.width<o[0]||o[1]<0||d.data.height<o[1]||o[2]<0||d.data.width<o[2]||o[3]<0||d.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,d){d.version=this.images[o].version+1,this.images[o]=d,this.updatedImages[o]=!0}removeImage(o){const d=this.images[o];delete this.images[o],delete this.patterns[o],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,d){let _=!0;if(!this.isLoaded())for(const b of o)this.images[b]||(_=!1);this.isLoaded()||_?this._notify(o,d):this.requestors.push({ids:o,callback:d})}_notify(o,d){const _={};for(const b of o){this.images[b]||this.fire(new p.Event("styleimagemissing",{id:b}));const w=this.images[b];w?_[b]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:Boolean(w.userImage&&w.userImage.render)}:p.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,_)}getPixelSize(){const{width:o,height:d}=this.atlasImage;return{width:o,height:d}}getPattern(o){const d=this.patterns[o],_=this.getImage(o);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new p.ImagePosition(b,_);this.patterns[o]={bin:b,position:w}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const d=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(o,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const w in this.patterns)o.push(this.patterns[w].bin);const{w:d,h:_}=p.potpack(o),b=this.atlasImage;b.resize({width:d||1,height:_||1});for(const w in this.patterns){const{bin:D}=this.patterns[w],A=D.x+1,F=D.y+1,P=this.images[w].data,O=P.width,z=P.height;p.RGBAImage.copy(P,b,{x:0,y:0},{x:A,y:F},{width:O,height:z}),p.RGBAImage.copy(P,b,{x:0,y:z-1},{x:A,y:F-1},{width:O,height:1}),p.RGBAImage.copy(P,b,{x:0,y:0},{x:A,y:F+z},{width:O,height:1}),p.RGBAImage.copy(P,b,{x:O-1,y:0},{x:A-1,y:F},{width:1,height:z}),p.RGBAImage.copy(P,b,{x:0,y:0},{x:A+O,y:F},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const d of o){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.images[d];Il(_)&&this.updateImage(d,_)}}}const Mc=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(m,o){return function([d,_,b]){const w=p.degToRad(_+90),D=p.degToRad(b);return{x:d*Math.cos(w)*Math.sin(D),y:d*Math.sin(w)*Math.sin(D),z:d*Math.cos(D),azimuthal:_,polar:b}}(m.expression.evaluate(o))}interpolate(m,o,d){return{x:p.number(m.x,o.x,d),y:p.number(m.y,o.y,d),z:p.number(m.z,o.z,d),azimuthal:p.number(m.azimuthal,o.azimuthal,d),polar:p.number(m.polar,o.polar,d)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)}),la="-transition";class Ns extends p.Evented{constructor(o){super(),this._transitionable=new p.Transitionable(Mc),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d={}){if(!this._validate(p.validateLight,o,d))for(const _ in o){const b=o[_];p.endsWith(_,la)?this._transitionable.setTransition(_.slice(0,-la.length),b):this._transitionable.setValue(_,b)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,o.call(p.validateStyle,p.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const Yd=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)}),ca="-transition";class un extends p.Evented{constructor(o,d){super(),this._transitionable=new p.Transitionable(Yd),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=d}get(){return this._transitionable.serialize()}set(o){for(const d in o){const _=o[d];p.endsWith(d,ca)?this._transitionable.setTransition(d.slice(0,-ca.length),_):this._transitionable.setValue(d,_)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function zs(m,o,d,_){const b=p.smoothstep(45,65,d),[w,D]=ua(m,_),A=p.length(o);let F=1-Math.min(1,Math.exp((A-w)/(D-w)*-6));return F*=F*F,F=Math.min(1,1.00747*F),F*b*m.alpha}function ua(m,o){const d=.5/Math.tan(.5*o);return[m.range[0]+d,m.range[1]+d]}const Sc=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"])}),_s="-transition";class Nt extends p.Evented{constructor(o,d){super(),this._transitionable=new p.Transitionable(Sc),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,d={}){if(!this._validate(p.validateFog,o,d))for(const _ in o){const b=o[_];p.endsWith(_,_s)?this._transitionable.setTransition(_.slice(0,-_s.length),b):this._transitionable.setValue(_,b)}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return p.smoothstep(45,65,o)*d.a}getOpacityAtLatLng(o,d){return this._transform.projection.supportsFog?function(_,b,w){const D=p.MercatorCoordinate.fromLngLat(b),A=w.elevation?w.elevation.getAtPointOrZero(D):0,F=[D.x,D.y,A];return p.transformMat4(F,F,w.mercatorFogMatrix),zs(_,F,w.pitch,w._fov)}(this.state,o,d):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?ua(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,o.call(p.validateStyle,p.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class Rn{constructor(o,d){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const _=this.workerPool.acquire(this.id);for(let b=0;b<_.length;b++){const w=new Rn.Actor(_[b],d,this.id);w.name=`Worker ${b}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,d,_){p.asyncAll(this.actors,(b,w)=>{b.send(o,d,w)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ji(m,o,d){return o*(p.EXTENT/(m.tileSize*Math.pow(2,d-m.tileID.overscaledZ)))}Rn.Actor=p.Actor;class Pn{constructor(o,d,_,b){this.screenBounds=o,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(w=>b.pointCoordinate3D(w)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(o,d){let _,b;if(o instanceof p.pointGeometry||"number"==typeof o[0]){const w=p.pointGeometry.convert(o);_=[p.pointGeometry.convert(o)],b=d.isPointAboveHorizon(w)}else{const w=p.pointGeometry.convert(o[0]),D=p.pointGeometry.convert(o[1]);_=[w,D],b=p.polygonizeBounds(w,D).every(A=>d.isPointAboveHorizon(A))}return new Pn(_,d.getCameraPoint(),b,d)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(o){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const d=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],b=p.polygonizeBounds(d,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<_.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),p.bufferConvexPolygon(b,o)}containsTile(o,d,_){const b=o.queryPadding+1,w=o.tileID.wrap,D=_?this._bufferedCameraMercator(b,d).map(H=>p.getTilePoint(o.tileTransform,H,w)):this._bufferedScreenMercator(b,d).map(H=>p.getTilePoint(o.tileTransform,H,w)),A=this.screenGeometryMercator.map(H=>p.getTileVec3(o.tileTransform,H,w)),F=A.map(H=>new p.pointGeometry(H[0],H[1])),P=d.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),O=p.getTileVec3(o.tileTransform,P,w),z=A.map(H=>{const U=p.sub(H,H,O);return p.normalize(U,U),new p.Ray(O,U)}),G=Ji(o,1,d.zoom);if(p.polygonIntersectsBox(D,0,0,p.EXTENT,p.EXTENT))return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:z,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(Z=p.getBounds(D),Z.min.x=p.clamp(Z.min.x,0,p.EXTENT),Z.min.y=p.clamp(Z.min.y,0,p.EXTENT),Z.max.x=p.clamp(Z.max.x,0,p.EXTENT),Z.max.y=p.clamp(Z.max.y,0,p.EXTENT),Z),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:G};var Z}_bufferedScreenMercator(o,d){const _=Cn(o);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{const b=this.bufferedScreenGeometry(o).map(w=>d.pointCoordinate3D(w));return this._screenRaycastCache[_]=b,b}}_bufferedCameraMercator(o,d){const _=Cn(o);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{const b=this.bufferedCameraGeometry(o).map(w=>d.pointCoordinate3D(w));return this._cameraRaycastCache[_]=b,b}}}function Cn(m){return 100*m|0}function Tt(m,o,d){const _=function(b,w){if(b)return d(b);if(w){const D=p.pick(p.extend(w,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(D.vectorLayers=w.vector_layers,D.vectorLayerIds=D.vectorLayers.map(A=>A.id)),D.tiles=o.canonicalizeTileset(D,m.url),d(null,D)}};return m.url?p.getJSON(o.transformRequest(o.normalizeSourceURL(m.url),p.ResourceType.Source),_):p.exported.frame(()=>_(null,m))}class lo{constructor(o,d,_){this.bounds=p.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const d=Math.pow(2,o.z),_=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*d),b=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*d),w=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*d),D=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*d);return o.x>=_&&o.x<w&&o.y>=b&&o.y<D}}class Hu{constructor(o,d,_){this.context=o;const b=o.gl;this.buffer=b.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const da={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class So{constructor(o,d,_,b){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.context=o;const w=o.gl;this.buffer=w.createBuffer(),o.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let _=0;_<this.attributes.length;_++){const b=d.attributes[this.attributes[_].name];void 0!==b&&o.enableVertexAttribArray(b)}}setVertexAttribPointers(o,d,_){for(let b=0;b<this.attributes.length;b++){const w=this.attributes[b],D=d.attributes[w.name];void 0!==D&&o.vertexAttribPointer(D,w.components,o[da[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class an{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ha extends an{getDefault(){return p.Color.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Qd extends an{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Rr extends an{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class kl extends an{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class mn extends an{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class qa extends an{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class ha extends an{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class ys extends an{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Fl extends an{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class Ac extends an{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class qu extends an{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class vs extends an{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Wa extends an{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class co extends an{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Za extends an{getDefault(){return p.Color.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class uo extends an{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Vs extends an{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class Xa extends an{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Wu extends an{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Rl extends an{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Tc extends an{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ic extends an{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class kc extends an{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Fc extends an{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ka extends an{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Rc extends an{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Ya extends an{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Pc extends an{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class xs extends an{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Ao extends an{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class fa extends an{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Ri extends an{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class Pl extends Ri{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Oc extends Ri{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ol extends Oc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class J{constructor(o,d,_,b){this.context=o,this.width=d,this.height=_;const w=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new Pl(o,w),b&&(this.depthAttachment=new Oc(o,w))}destroy(){const o=this.context.gl,d=this.colorAttachment.get();if(d&&o.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&o.deleteRenderbuffer(_)}o.deleteFramebuffer(this.framebuffer)}}class N{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ha(this),this.clearDepth=new Qd(this),this.clearStencil=new Rr(this),this.colorMask=new kl(this),this.depthMask=new mn(this),this.stencilMask=new qa(this),this.stencilFunc=new ha(this),this.stencilOp=new ys(this),this.stencilTest=new Fl(this),this.depthRange=new Ac(this),this.depthTest=new qu(this),this.depthFunc=new vs(this),this.blend=new Wa(this),this.blendFunc=new co(this),this.blendColor=new Za(this),this.blendEquation=new uo(this),this.cullFace=new Vs(this),this.cullFaceSide=new Xa(this),this.frontFace=new Wu(this),this.program=new Rl(this),this.activeTexture=new Tc(this),this.viewport=new Ic(this),this.bindFramebuffer=new kc(this),this.bindRenderbuffer=new Fc(this),this.bindTexture=new Ka(this),this.bindVertexBuffer=new Rc(this),this.bindElementBuffer=new Ya(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Pc(this),this.pixelStoreUnpack=new xs(this),this.pixelStoreUnpackPremultiplyAlpha=new Ao(this),this.pixelStoreUnpackFlipY=new fa(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d){return new Hu(this,o,d)}createVertexBuffer(o,d,_){return new So(this,o,d,_)}createRenderbuffer(o,d,_){const b=this.gl,w=b.createRenderbuffer();return this.bindRenderbuffer.set(w),b.renderbufferStorage(b.RENDERBUFFER,o,d,_),this.bindRenderbuffer.set(null),w}createFramebuffer(o,d,_){return new J(this,o,d,_)}clear({color:o,depth:d,stencil:_}){const b=this.gl;let w=0;o&&(w|=b.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(w|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),void 0!==_&&(w|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(w)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){Be(o.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class j extends p.Evented{constructor(o,d,_,b){super(),this.id=o,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},d),p.extend(this,p.pick(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Tt(this._options,this.map._requestManager,(o,d)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new p.ErrorEvent(o)):d&&(p.extend(this,d),d.bounds&&(this.tileBounds=new lo(d.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(d.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return p.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,d){const _=p.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);o.request=p.getImage(this.map._requestManager.transformRequest(b,p.ResourceType.Tile),(w,D,A,F)=>(delete o.request,o.aborted?(o.state="unloaded",d(null)):w?(o.state="errored",d(w)):D?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:A,expires:F}),o.setTexture(D,this.map.painter),o.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(o,d,_){o.setTexture(d,_)}static unloadTileData(o,d){o.texture&&d.saveTileTexture(o.texture)}abortTile(o,d){o.request&&(o.request.cancel(),delete o.request),d()}unloadTile(o,d){o.texture&&this.map.painter.saveTileTexture(o.texture),d()}hasTransition(){return!1}}let K;function re(m,o,d,_,b,w,D,A){const F=[m,d,b,o,_,w,1,1,1],P=[D,A,1],O=p.adjoint([],F),[z,G,Z]=p.transformMat3(P,P,p.transpose(O,O));return p.multiply(F,[z,0,0,0,G,0,0,0,Z],F)}class de extends p.Evented{constructor(o,d,_,b){super(),this.id=o,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=d}load(o){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(d,_)=>{if(this._loaded=!0,d)this.fire(new p.ErrorEvent(d));else if(_){const{HTMLImageElement:b}=p.window;this.image=_ instanceof b?p.exported.getImageData(_):_,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading()}})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(o){this.coordinates=o,this._boundsArray=void 0;const d=o.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let b=1/0,w=1/0,D=-1/0,A=-1/0;for(const z of _)b=Math.min(b,z.x),w=Math.min(w,z.y),D=Math.max(D,z.x),A=Math.max(A,z.y);const F=Math.max(D-b,A-w),P=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),O=Math.pow(2,P);return new p.CanonicalTileID(P,Math.floor((b+D)/2*O),Math.floor((w+A)/2*O))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(o){for(const F in this.tiles){const P=this.tiles[F];"loaded"!==P.state&&(P.state="loaded",P.texture=this.texture)}if(this._boundsArray)return;const d=p.tileTransform(this.tileID,this.map.transform.projection),[_,b,w,D]=this.coordinates.map(F=>{const P=d.projection.project(F[0],F[1]);return p.getTilePoint(d,P)._round()});this.perspectiveTransform=function(F,P,O,z,G,Z,H,U,ie,Y){const te=re(0,0,F,0,0,P,F,P),ne=re(O,z,G,Z,H,U,ie,Y);return p.multiply(ne,p.adjoint(te,te),ne),[ne[6]/ne[8]*F/p.EXTENT,ne[7]/ne[8]*P/p.EXTENT]}(this.width,this.height,_.x,_.y,b.x,b.y,D.x,D.y,w.x,w.y);const A=this._boundsArray=new p.StructArrayLayout4i8;A.emplaceBack(_.x,_.y,0,0),A.emplaceBack(b.x,b.y,p.EXTENT,0),A.emplaceBack(D.x,D.y,0,p.EXTENT),A.emplaceBack(w.x,w.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=o.createVertexBuffer(A,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,d=o.gl;this.texture?this.texture.update(this.image):(this.texture=new p.Texture(o,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._prepareData(o)}loadTile(o,d){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},d(null)):(o.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const me={vector:class extends p.Evented{constructor(m,o,d,_){if(super(),this.id=m,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(o,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Tt(this._options,this.map._requestManager,(m,o)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new p.ErrorEvent(m)):o&&(p.extend(this,o),o.bounds&&(this.tileBounds=new lo(o.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}onAdd(m){this.map=m,this.load()}setSourceProperty(m){this._tileJSONRequest&&this._tileJSONRequest.cancel(),m();const o=this.map.style._getSourceCaches(this.id);for(const d of o)d.clearTiles();this.load()}setTiles(m){return this.setSourceProperty(()=>{this._options.tiles=m}),this}setUrl(m){return this.setSourceProperty(()=>{this.url=m,this._options.url=m}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return p.extend({},this._options)}loadTile(m,o){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(d,p.ResourceType.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:m.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,m.actor&&"expired"!==m.state)"loading"===m.state?m.reloadCallback=o:m.request=m.actor.send("reloadTile",_,b.bind(this));else if(m.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)m.request=m.actor.send("loadTile",_,b.bind(this),void 0,!0);else{const w=p.loadVectorTile.call({deduped:this._deduped},_,(D,A)=>{D||!A?b.call(this,D):(_.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},m.actor&&m.actor.send("loadTile",_,b.bind(this),void 0,!0))},!0);m.request={cancel:w}}function b(w,D){return delete m.request,m.aborted?o(null):w&&404!==w.status?o(w):(D&&D.resourceTiming&&(m.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&m.setExpiryData(D),m.loadVectorData(D,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(m.reloadCallback&&(this.loadTile(m,m.reloadCallback),m.reloadCallback=null)))}}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.actor&&m.actor.send("abortTile",{uid:m.uid,type:this.type,source:this.id})}unloadTile(m){m.unloadVectorData(),m.actor&&m.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:j,"raster-dem":class extends j{constructor(m,o,d,_){super(m,o,d,_),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(m,o){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(b,w){b&&(m.state="errored",o(b)),w&&(m.dem=w,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",o(null))}m.request=p.getImage(this.map._requestManager.transformRequest(d,p.ResourceType.Tile),function(b,w,D,A){if(delete m.request,m.aborted)m.state="unloaded",o(null);else if(b)m.state="errored",o(b);else if(w){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:D,expires:A});const F=p.window.ImageBitmap&&w instanceof p.window.ImageBitmap&&(null==K&&(K=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),K),P=1-(w.width-p.prevPowerOfTwo(w.width))/2;P<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const O=F?w:p.exported.getImageData(w,P),z={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:O,encoding:this.encoding,padding:P};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",z,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const o=m.canonical,d=Math.pow(2,o.z),_=(o.x-1+d)%d,b=0===o.x?m.wrap-1:m.wrap,w=(o.x+1+d)%d,D=o.x+1===d?m.wrap+1:m.wrap,A={};return A[new p.OverscaledTileID(m.overscaledZ,b,o.z,_,o.y).key]={backfilled:!1},A[new p.OverscaledTileID(m.overscaledZ,D,o.z,w,o.y).key]={backfilled:!1},o.y>0&&(A[new p.OverscaledTileID(m.overscaledZ,b,o.z,_,o.y-1).key]={backfilled:!1},A[new p.OverscaledTileID(m.overscaledZ,m.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},A[new p.OverscaledTileID(m.overscaledZ,D,o.z,w,o.y-1).key]={backfilled:!1}),o.y+1<d&&(A[new p.OverscaledTileID(m.overscaledZ,b,o.z,_,o.y+1).key]={backfilled:!1},A[new p.OverscaledTileID(m.overscaledZ,m.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},A[new p.OverscaledTileID(m.overscaledZ,D,o.z,w,o.y+1).key]={backfilled:!1}),A}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends p.Evented{constructor(m,o,d,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(_),this._data=o.data,this._options=p.extend({},o),this._collectResourceTiming=o.collectResourceTiming,void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const b=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*b,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*b,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==o.clusterRadius?o.clusterRadius:50)*b,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},o),this}getClusterChildren(m,o){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},o),this}getClusterLeaves(m,o,d,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:o,offset:d},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=p.extend({},this.workerOptions),o=this._data;"string"==typeof o?(m.request=this.map._requestManager.transformRequest(p.exported.resolveURL(o),p.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new p.ErrorEvent(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(b.resourceTiming=_.resourceTiming[this.id]),this.fire(new p.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,o){const d=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(d,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,b)=>(delete m.request,m.unloadVectorData(),m.aborted?o(null):_?o(_):(m.loadVectorData(b,this.map.painter,"reloadTile"===d),o(null))),void 0,"loadTile"===d)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends de{constructor(m,o,d,_){super(m,o,d,_),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const o of m.urls)this.urls.push(this.map._requestManager.transformRequest(o,p.ResourceType.Source).url);p.getVideo(this.urls,(o,d)=>{this._loaded=!0,o?this.fire(new p.ErrorEvent(o)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const o=this.video.seekable;m<o.start(0)||m>o.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,o=m.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(m,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:de,canvas:class extends de{constructor(m,o,d,_){super(m,o,d,_),o.coordinates?Array.isArray(o.coordinates)&&4===o.coordinates.length&&!o.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(w=>"number"!=typeof w))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),o.animate&&"boolean"!=typeof o.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),o.canvas?"string"==typeof o.canvas||o.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=o,this.animate=void 0===o.animate||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const o=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends p.Evented{constructor(m,o,d,_){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=o,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new lo(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:o,y:d,z:_}=m.canonical;return this._implementation.hasTile({x:o,y:d,z:_})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,o){const{x:d,y:_,z:b}=m.tileID.canonical,w=new p.window.AbortController,D=this._implementation.loadTile({x:d,y:_,z:b},{signal:w.signal});if(!D)return this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",o(null);D.cancel=()=>w.abort(),m.request=D.then(function(A){return delete m.request,m.aborted?(m.state="unloaded",o(null)):A?(F=A)instanceof p.window.ImageData||F instanceof p.window.ImageBitmap||F instanceof p.window.HTMLCanvasElement?(this.loadTileData(m,A),m.state="loaded",void o(null)):(m.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",o(null));var F}.bind(this)).catch(A=>{20!==A.code&&(m.state="errored",o(A))})}loadTileData(m,o){j.loadTileData(m,o,this._map.painter)}unloadTileData(m){j.unloadTileData(m,this._map.painter)}prepareTile(m){if(!this._implementation.prepareTile)return null;const{x:o,y:d,z:_}=m.tileID.canonical,b=this._implementation.prepareTile({x:o,y:d,z:_});return b?(this.loadTileData(m,b),m.state="loaded",b):null}unloadTile(m,o){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:d,y:_,z:b}=m.tileID.canonical;this._implementation.unloadTile({x:d,y:_,z:b})}o()}abortTile(m,o){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},_e=function(m,o,d,_){const b=new me[o.type](m,o,d,_);if(b.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${b.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],b),b};function he(m,o){const d=p.identity([]);return p.scale(d,d,[.5*m.width,.5*-m.height,1]),p.translate(d,d,[1,-1,0]),p.multiply$1(d,d,m.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(d)}function be(m,o,d,_,b,w,D,A=!1){const F=m.tilesIn(_,D,A);F.sort(Je);const P=[];for(const z of F)P.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(o,d,m._state,z,b,w,he(m.transform,z.tile.tileID),A)});const O=function(z){const G={},Z={};for(const H of z){const U=H.queryResults,ie=H.wrappedTileID,Y=Z[ie]=Z[ie]||{};for(const te in U){const ne=U[te],oe=Y[te]=Y[te]||{},ee=G[te]=G[te]||[];for(const ae of ne)oe[ae.featureIndex]||(oe[ae.featureIndex]=!0,ee.push(ae))}}return G}(P);for(const z in O)O[z].forEach(G=>{const Z=G.feature,H=Z.layer;H&&"background"!==H.type&&"sky"!==H.type&&(Z.source=H.source,H["source-layer"]&&(Z.sourceLayer=H["source-layer"]),Z.state=void 0!==Z.id?m.getFeatureState(H["source-layer"],Z.id):{})});return O}function Le(m,o){const d=m.getRenderableIds().map(w=>m.getTileByID(w)),_=[],b={};for(let w=0;w<d.length;w++){const D=d[w],A=D.tileID.canonical.key;b[A]||(b[A]=!0,D.querySourceFeatures(_,o))}return _}function Je(m,o){const d=m.tileID,_=o.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function ze(){return null!=cl.workerClass?new cl.workerClass:new p.window.Worker(cl.workerUrl)}const xt="mapboxgl_preloaded_worker_pool";class pt{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<pt.workerCount;)this.workers.push(new ze);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[xt]}numActive(){return Object.keys(this.active).length}}let _t;function Et(){return _t||(_t=new pt),_t}function we(m,o){const d={};for(const _ in m)"ref"!==_&&(d[_]=m[_]);return p.refProperties.forEach(_=>{_ in o&&(d[_]=o[_])}),d}function vn(m){m=m.slice();const o=Object.create(null);for(let d=0;d<m.length;d++)o[m[d].id]=m[d];for(let d=0;d<m.length;d++)"ref"in m[d]&&(m[d]=we(m[d],o[m[d].ref]));return m}pt.workerCount=2;const lt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function gn(m,o,d){d.push({command:lt.addSource,args:[m,o[m]]})}function xn(m,o,d){o.push({command:lt.removeSource,args:[m]}),d[m]=!0}function pa(m,o,d,_){xn(m,d,_),gn(m,o,d)}function To(m,o,d){let _;for(_ in m[d])if(m[d].hasOwnProperty(_)&&"data"!==_&&!Be(m[d][_],o[d][_]))return!1;for(_ in o[d])if(o[d].hasOwnProperty(_)&&"data"!==_&&!Be(m[d][_],o[d][_]))return!1;return!0}function Qe(m,o,d,_,b,w){let D;for(D in o=o||{},m=m||{})m.hasOwnProperty(D)&&(Be(m[D],o[D])||d.push({command:w,args:[_,D,o[D],b]}));for(D in o)o.hasOwnProperty(D)&&!m.hasOwnProperty(D)&&(Be(m[D],o[D])||d.push({command:w,args:[_,D,o[D],b]}))}function Mt(m){return m.id}function Ft(m,o){return m[o.id]=o,m}class jn{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=p.clamp(o,0,1);let d=1,_=this._distances[d];const b=o*this.paddedLength+this.padding;for(;_<b&&d<this._distances.length;)_=this._distances[++d];const w=d-1,D=this._distances[w],A=_-D,F=A>0?(b-D)/A:0;return this.points[w].mult(1-F).add(this.points[d].mult(F))}}class ma{constructor(o,d,_){const b=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(o/_),this.yCellCount=Math.ceil(d/_);for(let D=0;D<this.xCellCount*this.yCellCount;D++)b.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,_,b,w){this._forEachCell(d,_,b,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(w)}insertCircle(o,d,_,b){this._forEachCell(d-b,_-b,d+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(_),this.circles.push(b)}_insertBoxCell(o,d,_,b,w,D){this.boxCells[w].push(D)}_insertCircleCell(o,d,_,b,w,D){this.circleCells[w].push(D)}_query(o,d,_,b,w,D){if(_<0||o>this.width||b<0||d>this.height)return!w&&[];const A=[];if(o<=0&&d<=0&&this.width<=_&&this.height<=b){if(w)return!0;for(let F=0;F<this.boxKeys.length;F++)A.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const P=this.circles[3*F],O=this.circles[3*F+1],z=this.circles[3*F+2];A.push({key:this.circleKeys[F],x1:P-z,y1:O-z,x2:P+z,y2:O+z})}return D?A.filter(D):A}return this._forEachCell(o,d,_,b,this._queryCell,A,{hitTest:w,seenUids:{box:{},circle:{}}},D),w?A.length>0:A}_queryCircle(o,d,_,b,w){const D=o-_,A=o+_,F=d-_,P=d+_;if(A<0||D>this.width||P<0||F>this.height)return!b&&[];const O=[];return this._forEachCell(D,F,A,P,this._queryCellCircle,O,{hitTest:b,circle:{x:o,y:d,radius:_},seenUids:{box:{},circle:{}}},w),b?O.length>0:O}query(o,d,_,b,w){return this._query(o,d,_,b,!1,w)}hitTest(o,d,_,b,w){return this._query(o,d,_,b,!0,w)}hitTestCircle(o,d,_,b){return this._queryCircle(o,d,_,!0,b)}_queryCell(o,d,_,b,w,D,A,F){const P=A.seenUids,O=this.boxCells[w];if(null!==O){const G=this.bboxes;for(const Z of O)if(!P.box[Z]){P.box[Z]=!0;const H=4*Z;if(o<=G[H+2]&&d<=G[H+3]&&_>=G[H+0]&&b>=G[H+1]&&(!F||F(this.boxKeys[Z]))){if(A.hitTest)return D.push(!0),!0;D.push({key:this.boxKeys[Z],x1:G[H],y1:G[H+1],x2:G[H+2],y2:G[H+3]})}}}const z=this.circleCells[w];if(null!==z){const G=this.circles;for(const Z of z)if(!P.circle[Z]){P.circle[Z]=!0;const H=3*Z;if(this._circleAndRectCollide(G[H],G[H+1],G[H+2],o,d,_,b)&&(!F||F(this.circleKeys[Z]))){if(A.hitTest)return D.push(!0),!0;{const U=G[H],ie=G[H+1],Y=G[H+2];D.push({key:this.circleKeys[Z],x1:U-Y,y1:ie-Y,x2:U+Y,y2:ie+Y})}}}}}_queryCellCircle(o,d,_,b,w,D,A,F){const P=A.circle,O=A.seenUids,z=this.boxCells[w];if(null!==z){const Z=this.bboxes;for(const H of z)if(!O.box[H]){O.box[H]=!0;const U=4*H;if(this._circleAndRectCollide(P.x,P.y,P.radius,Z[U+0],Z[U+1],Z[U+2],Z[U+3])&&(!F||F(this.boxKeys[H])))return D.push(!0),!0}}const G=this.circleCells[w];if(null!==G){const Z=this.circles;for(const H of G)if(!O.circle[H]){O.circle[H]=!0;const U=3*H;if(this._circlesCollide(Z[U],Z[U+1],Z[U+2],P.x,P.y,P.radius)&&(!F||F(this.circleKeys[H])))return D.push(!0),!0}}}_forEachCell(o,d,_,b,w,D,A,F){const P=this._convertToXCellCoord(o),O=this._convertToYCellCoord(d),z=this._convertToXCellCoord(_),G=this._convertToYCellCoord(b);for(let Z=P;Z<=z;Z++)for(let H=O;H<=G;H++)if(w.call(this,o,d,_,b,this.xCellCount*H+Z,D,A,F))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,_,b,w,D){const A=b-o,F=w-d,P=_+D;return P*P>A*A+F*F}_circleAndRectCollide(o,d,_,b,w,D,A){const F=(D-b)/2,P=Math.abs(o-(b+F));if(P>F+_)return!1;const O=(A-w)/2,z=Math.abs(d-(w+O));if(z>O+_)return!1;if(P<=F||z<=O)return!0;const G=P-F,Z=z-O;return G*G+Z*Z<=_*_}}const Ht=Math.tan(85*Math.PI/180);function Mn(m,o,d,_,b,w){const D=p.create();if(d){if("globe"===b.projection.name)p.multiply$1(D,D,p.calculateGlobeLabelMatrix(b,o));else{const A=aa([],w);D[0]=A[0],D[1]=A[1],D[4]=A[2],D[5]=A[3]}_||p.rotateZ(D,D,b.angle)}else p.multiply$1(D,b.labelPlaneMatrix,m);return D}function ga(m,o,d,_,b,w){if(d){if("globe"===b.projection.name){const D=Mn(m,o,d,_,b,w);return p.invert(D,D),p.multiply$1(D,m,D),D}{const D=p.clone(m),A=p.identity([]);return A[0]=w[0],A[1]=w[1],A[4]=w[2],A[5]=w[3],p.multiply$1(D,D,A),_||p.rotateZ(D,D,-b.angle),D}}return b.glCoordMatrix}function Wt(m,o,d=0){const _=[m.x,m.y,d,1];d?p.transformMat4$1(_,_,o):bs(_,_,o);const b=_[3];return{point:new p.pointGeometry(_[0]/b,_[1]/b),signedDistanceFromCamera:b}}function Pr(m,o){const d=[m[0],m[1],m[2],1];p.transformMat4$1(d,d,o);const _=d[3];return{point:new p.pointGeometry(d[0]/_,d[1]/_),signedDistanceFromCamera:_}}function ni(m,o){return Math.min(.5+m/o*.5,1.5)}function On(m,o){const d=m[0]/m[3],_=m[1]/m[3];return d>=-o[0]&&d<=o[0]&&_>=-o[1]&&_<=o[1]}function Ut(m,o,d,_,b,w,D,A,F,P){const O=d.transform,z=_?m.textSizeData:m.iconSizeData,G=p.evaluateSizeForZoom(z,d.transform.zoom),Z=[256/d.width*2+1,256/d.height*2+1],H=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;H.clear();const U=m.lineVertexArray,ie=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,Y=d.transform.width/d.transform.height;let te=!1;for(let ne=0;ne<ie.length;ne++){const oe=ie.get(ne);if(oe.writingMode!==p.WritingMode.vertical||te||0!==ne&&ie.get(ne-1).writingMode===p.WritingMode.horizontal||(te=!0),(oe.hidden||oe.writingMode===p.WritingMode.vertical)&&!te){Pi(oe.numGlyphs,H);continue}te=!1;const ee=new p.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),ae=F?F(ee):[0,0,0],ve=O.projection.projectTilePoint(ee.x,ee.y,P.canonical),Me=[ve.x+ae[0],ve.y+ae[1],ve.z+ae[2]],Fe=[...Me,1];if(p.transformMat4$1(Fe,Fe,o),!On(Fe,Z)){Pi(oe.numGlyphs,H);continue}const Te=ni(d.transform.cameraToCenterDistance,Fe[3]),Ze=p.evaluateSizeForFeature(z,G,oe),ye=D?Ze/Te:Ze*Te,He=Wt(new p.pointGeometry(Me[0],Me[1]),b,Me[2]);if(He.signedDistanceFromCamera<=0){Pi(oe.numGlyphs,H);continue}let Ue={};const rt=D?null:F,Re=dn(oe,ye,!1,A,o,b,w,m.glyphOffsetArray,U,H,He.point,ee,Ue,Y,rt,O.projection,P);te=Re.useVertical,rt&&Re.needsFlipping&&(Ue={}),(Re.notEnoughRoom||te||Re.needsFlipping&&dn(oe,ye,!0,A,o,b,w,m.glyphOffsetArray,U,H,He.point,ee,Ue,Y,rt,O.projection,P).notEnoughRoom)&&Pi(oe.numGlyphs,H)}_?m.text.dynamicLayoutVertexBuffer.updateData(H):m.icon.dynamicLayoutVertexBuffer.updateData(H)}function Lc(m,o,d,_,b,w,D,A,F,P,O,z,G,Z,H){const U=A.glyphStartIndex+A.numGlyphs,ie=A.lineStartIndex,Y=A.lineStartIndex+A.lineLength,te=o.getoffsetX(A.glyphStartIndex),ne=o.getoffsetX(U-1),oe=Di(m*te,d,_,b,w,D,A.segment,ie,Y,F,P,O,z,G,!0,Z,H);if(!oe)return null;const ee=Di(m*ne,d,_,b,w,D,A.segment,ie,Y,F,P,O,z,G,!0,Z,H);return ee?{first:oe,last:ee}:null}function Bc(m,o,d,_){return m.writingMode===p.WritingMode.horizontal&&Math.abs(d.y-o.y)>Math.abs(d.x-o.x)*_?{useVertical:!0}:m.writingMode===p.WritingMode.vertical?o.y<d.y?{needsFlipping:!0}:null:0!==m.flipState&&function(b,w,D){const A=(w.x-b.x)*D;return 0===A||Math.abs((w.y-b.y)/A)>Ht}(o,d,_)?1===m.flipState?{needsFlipping:!0}:null:o.x>d.x?{needsFlipping:!0}:null}function dn(m,o,d,_,b,w,D,A,F,P,O,z,G,Z,H,U,ie){const Y=o/24,te=m.lineOffsetX*Y,ne=m.lineOffsetY*Y;let oe;if(m.numGlyphs>1){const ee=m.glyphStartIndex+m.numGlyphs,ae=m.lineStartIndex,ve=m.lineStartIndex+m.lineLength,Me=Lc(Y,A,te,ne,d,O,z,m,F,w,G,H,!1,U,ie);if(!Me)return{notEnoughRoom:!0};const Fe=Wt(Me.first.point,D).point,Te=Wt(Me.last.point,D).point;if(_&&!d){const Ze=Bc(m,Fe,Te,Z);if(m.flipState=Ze&&Ze.needsFlipping?1:2,Ze)return Ze}oe=[Me.first];for(let Ze=m.glyphStartIndex+1;Ze<ee-1;Ze++)oe.push(Di(Y*A.getoffsetX(Ze),te,ne,d,O,z,m.segment,ae,ve,F,w,G,H,!1,!1,U,ie));oe.push(Me.last)}else{if(_&&!d){const ae=Wt(z,b).point,ve=m.lineStartIndex+m.segment+1,Me=new p.pointGeometry(F.getx(ve),F.gety(ve)),Fe=Wt(Me,b),Te=Bc(m,ae,Fe.signedDistanceFromCamera>0?Fe.point:ot(z,Me,ae,1,b,void 0,U,ie.canonical),Z);if(m.flipState=Te&&Te.needsFlipping?1:2,Te)return Te}const ee=Di(Y*A.getoffsetX(m.glyphStartIndex),te,ne,d,O,z,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,F,w,G,H,!1,!1,U,ie);if(!ee)return{notEnoughRoom:!0};oe=[ee]}for(const ee of oe)p.addDynamicAttributes(P,ee.point,ee.angle);return{}}function Nc(m,o,d,_,b){const w=_.projectTilePoint(m.x,m.y,o);if(!b)return Wt(w,d,w.z);const D=b(m);return Wt(new p.pointGeometry(w.x+D[0],w.y+D[1]),d,w.z+D[2])}function ot(m,o,d,_,b,w,D,A){const F=Nc(m.add(m.sub(o)._unit()),A,b,D,w).point,P=d.sub(F);return d.add(P._mult(_/P.mag()))}function Di(m,o,d,_,b,w,D,A,F,P,O,z,G,Z,H,U,ie){const Y=_?m-o:m+o;let te=Y>0?1:-1,ne=0;_&&(te*=-1,ne=Math.PI),te<0&&(ne+=Math.PI);let oe=te>0?A+D:A+D+1,ee=b,ae=b,ve=0,Me=0;const Fe=Math.abs(Y),Te=[],Ze=[];let ye=w;const He=()=>{const at=oe-te;return 0===ve?w:new p.pointGeometry(P.getx(at),P.gety(at))},Ue=()=>ot(He(),ye,ae,Fe-ve+1,O,G,U,ie.canonical);for(;ve+Me<=Fe;){if(oe+=te,oe<A||oe>=F)return null;if(ae=ee,Te.push(ee),Z&&Ze.push(ye||He()),ee=z[oe],void 0===ee){ye=new p.pointGeometry(P.getx(oe),P.gety(oe));const at=Nc(ye,ie.canonical,O,U,G);ee=at.signedDistanceFromCamera>0?z[oe]=at.point:Ue()}else ye=null;ve+=Me,Me=ae.dist(ee)}H&&G&&(ye=ye||new p.pointGeometry(P.getx(oe),P.gety(oe)),z[oe]=ee=void 0===z[oe]?ee:Ue(),Me=ae.dist(ee));const rt=(Fe-ve)/Me,Re=ee.sub(ae),st=Re.mult(rt)._add(ae);d&&st._add(Re._unit()._perp()._mult(d*te));const ft=ne+Math.atan2(ee.y-ae.y,ee.x-ae.x);return Te.push(st),Z&&(ye=ye||new p.pointGeometry(P.getx(oe),P.gety(oe)),Ze.push(function(at,nt,vt){const It=1-vt;return new p.pointGeometry(at.x*It+nt.x*vt,at.y*It+nt.y*vt)}(Ze.length>0?Ze[Ze.length-1]:ye,ye,rt))),{point:st,angle:ft,path:Te,tilePath:Ze}}const Jd=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Pi(m,o){for(let d=0;d<m;d++){const _=o.length;o.resize(_+4),o.float32.set(Jd,3*_)}}function bs(m,o,d){const _=o[0],b=o[1];return m[0]=d[0]*_+d[4]*b+d[12],m[1]=d[1]*_+d[5]*b+d[13],m[3]=d[3]*_+d[7]*b+d[15],m}const Or=100;class cr{constructor(o,d,_=new ma(o.width+200,o.height+200,25),b=new ma(o.width+200,o.height+200,25)){this.transform=o,this.grid=_,this.ignoredGrid=b,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Or,this.screenBottomBoundary=o.height+Or,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=d}placeCollisionBox(o,d,_,b,w,D,A){let F=d.projectedAnchorX,P=d.projectedAnchorY,O=d.projectedAnchorZ;const z=d.elevation,G=d.tileID;if(z&&G){const oe=this.transform.projection.upVector(G.canonical,d.tileAnchorX,d.tileAnchorY),ee=this.transform.projection.upVectorScale(G.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=oe[0]*z*ee,P+=oe[1]*z*ee,O+=oe[2]*z*ee}const Z=this.projectAndGetPerspectiveRatio(D,[F,P,O],d.tileID,"globe"===this.transform.projection.name||!!z||this.transform.pitch>0),H=w*Z.perspectiveRatio,U=(d.x1*o+_.x-d.padding)*H+Z.point.x,ie=(d.y1*o+_.y-d.padding)*H+Z.point.y,Y=(d.x2*o+_.x+d.padding)*H+Z.point.x,te=(d.y2*o+_.y+d.padding)*H+Z.point.y,ne=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(U,ie,Y,te)||!b&&this.grid.hitTest(U,ie,Y,te,A)||ne?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[U,ie,Y,te],offscreen:this.isOffscreen(U,ie,Y,te),occluded:!1}}placeCollisionCircles(o,d,_,b,w,D,A,F,P,O,z,G,Z,H){const U=[],ie=this.transform.elevation,Y=ie?ie.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,this.transform.projection):Ue=>[0,0,0],te=new p.pointGeometry(d.tileAnchorX,d.tileAnchorY),ne=this.transform.projection.projectTilePoint(d.tileAnchorX,d.tileAnchorY,H.canonical),oe=Y(te),ee=[ne.x+oe[0],ne.y+oe[1],ne.z+oe[2]],ae=this.projectAndGetPerspectiveRatio(D,[ee[0],ee[1],ee[2]],H,"globe"===this.transform.projection.name||!!ie||this.transform.pitch>0),{perspectiveRatio:ve}=ae,Me=(O?w/ve:w*ve)/p.ONE_EM,Fe=Wt(new p.pointGeometry(ee[0],ee[1]),A,ee[2]).point,Te=ae.signedDistanceFromCamera>0?Lc(Me,b,d.lineOffsetX*Me,d.lineOffsetY*Me,!1,Fe,te,d,_,A,{},ie&&!O?Y:null,O&&!!ie,this.transform.projection,H):null;let Ze=!1,ye=!1,He=!0;if(Te&&!ae.occluded){const Ue=.5*G*ve+Z,rt=new p.pointGeometry(-100,-100),Re=new p.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),st=new jn,ft=Te.first,at=Te.last;let nt=[];for(let yt=ft.path.length-1;yt>=1;yt--)nt.push(ft.path[yt]);for(let yt=1;yt<at.path.length;yt++)nt.push(at.path[yt]);const vt=2.5*Ue;if(F){const yt=nt.map(ie?(Dt,rn)=>{const oi=Y(rn<ft.path.length-1?ft.tilePath[ft.path.length-1-rn]:at.tilePath[rn-ft.path.length+2]);return Wt(Dt,F,oi[2])}:Dt=>Wt(Dt,F));nt=yt.some(Dt=>Dt.signedDistanceFromCamera<=0)?[]:yt.map(Dt=>Dt.point)}let It=[];if(nt.length>0){const yt=nt[0].clone(),Dt=nt[0].clone();for(let rn=1;rn<nt.length;rn++)yt.x=Math.min(yt.x,nt[rn].x),yt.y=Math.min(yt.y,nt[rn].y),Dt.x=Math.max(Dt.x,nt[rn].x),Dt.y=Math.max(Dt.y,nt[rn].y);It=yt.x>=rt.x&&Dt.x<=Re.x&&yt.y>=rt.y&&Dt.y<=Re.y?[nt]:Dt.x<rt.x||yt.x>Re.x||Dt.y<rt.y||yt.y>Re.y?[]:p.clipLine([nt],rt.x,rt.y,Re.x,Re.y)}for(const yt of It){st.reset(yt,.25*Ue);let Dt=0;Dt=st.length<=.5*Ue?1:Math.ceil(st.paddedLength/vt)+1;for(let rn=0;rn<Dt;rn++){const oi=rn/Math.max(Dt-1,1),hr=st.lerp(oi),Si=hr.x+Or,wr=hr.y+Or;U.push(Si,wr,Ue,0);const os=Si-Ue,Ds=wr-Ue,Zs=Si+Ue,Uo=wr+Ue;if(He=He&&this.isOffscreen(os,Ds,Zs,Uo),ye=ye||this.isInsideGrid(os,Ds,Zs,Uo),!o&&this.grid.hitTestCircle(Si,wr,Ue,z)&&(Ze=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Ze,occluded:!1}}}}return{circles:!P&&Ze||!ye?[]:U,offscreen:He,collisionDetected:Ze,occluded:ae.occluded}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const d=[];let _=1/0,b=1/0,w=-1/0,D=-1/0;for(const O of o){const z=new p.pointGeometry(O.x+Or,O.y+Or);_=Math.min(_,z.x),b=Math.min(b,z.y),w=Math.max(w,z.x),D=Math.max(D,z.y),d.push(z)}const A=this.grid.query(_,b,w,D).concat(this.ignoredGrid.query(_,b,w,D)),F={},P={};for(const O of A){const z=O.key;if(void 0===F[z.bucketInstanceId]&&(F[z.bucketInstanceId]={}),F[z.bucketInstanceId][z.featureIndex])continue;const G=[new p.pointGeometry(O.x1,O.y1),new p.pointGeometry(O.x2,O.y1),new p.pointGeometry(O.x2,O.y2),new p.pointGeometry(O.x1,O.y2)];p.polygonIntersectsPolygon(d,G)&&(F[z.bucketInstanceId][z.featureIndex]=!0,void 0===P[z.bucketInstanceId]&&(P[z.bucketInstanceId]=[]),P[z.bucketInstanceId].push(z.featureIndex))}return P}insertCollisionBox(o,d,_,b,w){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:b,collisionGroupID:w},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,_,b,w){const D=d?this.ignoredGrid:this.grid,A={bucketInstanceId:_,featureIndex:b,collisionGroupID:w};for(let F=0;F<o.length;F+=4)D.insertCircle(A,o[F],o[F+1],o[F+2])}projectAndGetPerspectiveRatio(o,d,_,b){const w=[d[0],d[1],d[2],1];let D=!1;return d[2]||this.transform.pitch>0?(p.transformMat4$1(w,w,o),this.fogState&&_&&(D=function(A,F,P,O,z,G){const Z=G.calculateFogTileMatrix(z),H=[F,P,O];return p.transformMat4(H,H,Z),zs(A,H,G.pitch,G._fov)}(this.fogState,d[0],d[1],d[2],_.toUnwrapped(),this.transform)>.9)):bs(w,w,o),{point:new p.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+Or,(-w[1]/w[3]+1)/2*this.transform.height+Or),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/w[3]*.5,1.5),signedDistanceFromCamera:w[3],occluded:b&&w[2]>w[3]||D}}isOffscreen(o,d,_,b){return _<Or||o>=this.screenRightBoundary||b<Or||d>this.screenBottomBoundary}isInsideGrid(o,d,_,b){return _>=0&&o<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=p.identity([]);return p.translate(o,o,[-100,-100,0]),o}}class Mi{constructor(o,d,_,b){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):b&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class Io{constructor(o,d,_,b,w,D=!1){this.text=new Mi(o?o.text:null,d,_,w),this.icon=new Mi(o?o.icon:null,d,b,w),this.clipped=D}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _a{constructor(o,d,_,b=!1){this.text=o,this.icon=d,this.skipFade=_,this.clipped=b}}class ii{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class Nf{constructor(o,d,_,b,w){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=w}}class ho{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[o]}}function zc(m,o,d,_,b){const{horizontalAlign:w,verticalAlign:D}=p.getAnchorAlignment(m),A=-(w-.5)*o,F=-(D-.5)*d,P=p.evaluateVariableOffset(m,_);return new p.pointGeometry(A+P[0]*b,F+P[1]*b)}function Vc(m,o,d,_,b){const w=new p.pointGeometry(m,o);return d&&w._rotate(_?b:-b),w}class Dm{constructor(o,d,_,b,w){this.transform=o.clone(),this.collisionIndex=new cr(this.transform,w),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new ho(_),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,d,_,b){const w=_.getBucket(d),D=_.latestFeatureIndex;if(!w||!D||d.id!==w.layerIds[0])return;const A=w.layers[0].layout,F=_.collisionBoxArray,P=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),O=_.tileSize/p.EXTENT,z=_.tileID.toUnwrapped(),G=this.transform.calculateProjMatrix(z),Z="map"===A.get("text-pitch-alignment"),H="map"===A.get("text-rotation-alignment");d.compileFilter();const U=d.dynamicFilter(),ie=d.dynamicFilterNeedsFeature(),Y=this.transform.calculatePixelsToTileUnitsMatrix(_),te=Mn(G,_.tileID.canonical,Z,H,this.transform,Y);let ne=null;if(Z){const ae=ga(G,_.tileID.canonical,Z,H,this.transform,Y);ne=p.multiply$1([],this.transform.labelPlaneMatrix,ae)}let oe=null;U&&_.latestFeatureIndex&&(oe={unwrappedTileID:z,dynamicFilter:U,dynamicFilterNeedsFeature:ie,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new Nf(w.bucketInstanceId,D,w.sourceLayerIndex,w.index,_.tileID);const ee={bucket:w,layout:A,posMatrix:G,textLabelPlaneMatrix:te,labelToScreenMatrix:ne,clippingData:oe,scale:P,textPixelRatio:O,holdingForFade:_.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(b)for(const ae of w.sortKeyRanges){const{sortKey:ve,symbolInstanceStart:Me,symbolInstanceEnd:Fe}=ae;o.push({sortKey:ve,symbolInstanceStart:Me,symbolInstanceEnd:Fe,parameters:ee})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:ee})}attemptAnchorPlacement(o,d,_,b,w,D,A,F,P,O,z,G,Z,H,U,ie,Y,te){const ne=[G.textOffset0,G.textOffset1],oe=zc(o,_,b,ne,w),ee=this.collisionIndex.placeCollisionBox(w,d,Vc(oe.x,oe.y,D,A,this.transform.angle),z,F,P,O.predicate);if((!ie||0!==this.collisionIndex.placeCollisionBox(H.getSymbolInstanceIconSize(te,this.transform.zoom,Z),ie,Vc(oe.x,oe.y,D,A,this.transform.angle),z,F,P,O.predicate).box.length)&&ee.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(ae=this.prevPlacement.variableOffsets[G.crossTileID].anchor),this.variableOffsets[G.crossTileID]={textOffset:ne,width:_,height:b,anchor:o,textScale:w,prevAnchor:ae},this.markUsedJustification(H,o,G,U),H.allowVerticalPlacement&&(this.markUsedOrientation(H,U,G),this.placedOrientations[G.crossTileID]=U),{shift:oe,placedGlyphBoxes:ee}}}placeLayerBucketPart(o,d,_,b){const{bucket:w,layout:D,posMatrix:A,textLabelPlaneMatrix:F,labelToScreenMatrix:P,clippingData:O,textPixelRatio:z,holdingForFade:G,collisionBoxArray:Z,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:U,collisionGroup:ie}=o.parameters,Y=D.get("text-optional"),te=D.get("icon-optional"),ne=D.get("text-allow-overlap"),oe=D.get("icon-allow-overlap"),ee="map"===D.get("text-rotation-alignment"),ae="map"===D.get("text-pitch-alignment"),ve="none"!==D.get("icon-text-fit"),Me="viewport-y"===D.get("symbol-z-order");let Fe=ne&&(oe||!w.hasIconData()||te),Te=oe&&(ne||!w.hasTextData()||Y);!w.collisionArrays&&Z&&w.deserializeCollisionBoxes(Z),_&&b&&w.updateCollisionDebugBuffers(this.transform.zoom,Z);const Ze=(ye,He,Ue)=>{if(O){const ai={zoom:this.transform.zoom,pitch:this.transform.pitch};let di=null;if(O.dynamicFilterNeedsFeature){const _n=this.retainedQueryData[w.bucketInstanceId];di=O.featureIndex.loadFeature({featureIndex:ye.featureIndex,bucketIndex:_n.bucketIndex,sourceLayerIndex:_n.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(ai,di,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new p.pointGeometry(ye.tileAnchorX,ye.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[ye.crossTileID]=new _a(!1,!1,!1,!0),void(d[ye.crossTileID]=!0)}if(d[ye.crossTileID])return;if(G)return void(this.placements[ye.crossTileID]=new _a(!1,!1,!1));let rt=!1,Re=!1,st=!0,ft=!1,at=!1,nt=null,vt={box:null,offscreen:null,occluded:null},It={box:null,offscreen:null,occluded:null},yt=null,Dt=null,rn=null,oi=0,hr=0,Si=0;Ue.textFeatureIndex?oi=Ue.textFeatureIndex:ye.useRuntimeCollisionCircles&&(oi=ye.featureIndex),Ue.verticalTextFeatureIndex&&(hr=Ue.verticalTextFeatureIndex);const wr=ai=>{ai.tileID=this.retainedQueryData[w.bucketInstanceId].tileID,(this.transform.elevation||ai.elevation)&&(ai.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[w.bucketInstanceId].tileID,ai.tileAnchorX,ai.tileAnchorY):0)},os=Ue.textBox;if(os){wr(os);const ai=_n=>{let yi=p.WritingMode.horizontal;if(w.allowVerticalPlacement&&!_n&&this.prevPlacement){const as=this.prevPlacement.placedOrientations[ye.crossTileID];as&&(this.placedOrientations[ye.crossTileID]=as,yi=as,this.markUsedOrientation(w,yi,ye))}return yi},di=(_n,yi)=>{if(w.allowVerticalPlacement&&ye.numVerticalGlyphVertices>0&&Ue.verticalTextBox){for(const as of w.writingModes)if(as===p.WritingMode.vertical?(vt=yi(),It=vt):vt=_n(),vt&&vt.box&&vt.box.length)break}else vt=_n()};if(D.get("text-variable-anchor")){let _n=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ye.crossTileID]){const li=this.prevPlacement.variableOffsets[ye.crossTileID];_n.indexOf(li.anchor)>0&&(_n=_n.filter(Cr=>Cr!==li.anchor),_n.unshift(li.anchor))}const yi=(li,Cr,Go)=>{const ls=w.getSymbolInstanceTextSize(H,ye,this.transform.zoom,He),Ca=(li.x2-li.x1)*ls+2*li.padding,Ch=(li.y2-li.y1)*ls+2*li.padding,Ea=ve&&!oe?Cr:null;Ea&&wr(Ea);let wt={box:[],offscreen:!1,occluded:!1};const Eh=ne?2*_n.length:_n.length;for(let $r=0;$r<Eh;++$r){const Da=this.attemptAnchorPlacement(_n[$r%_n.length],li,Ca,Ch,ls,ee,ae,z,A,ie,$r>=_n.length,ye,He,w,Go,Ea,H,U);if(Da&&(wt=Da.placedGlyphBoxes,wt&&wt.box&&wt.box.length)){rt=!0,nt=Da.shift;break}}return wt};di(()=>yi(os,Ue.iconBox,p.WritingMode.horizontal),()=>{const li=Ue.verticalTextBox;return li&&wr(li),w.allowVerticalPlacement&&!(vt&&vt.box&&vt.box.length)&&ye.numVerticalGlyphVertices>0&&li?yi(li,Ue.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),vt&&(rt=vt.box,st=vt.offscreen,ft=vt.occluded);const as=ai(vt&&vt.box);if(!rt&&this.prevPlacement){const li=this.prevPlacement.variableOffsets[ye.crossTileID];li&&(this.variableOffsets[ye.crossTileID]=li,this.markUsedJustification(w,li.anchor,ye,as))}}else{const _n=(yi,as)=>{const li=w.getSymbolInstanceTextSize(H,ye,this.transform.zoom,He),Cr=this.collisionIndex.placeCollisionBox(li,yi,new p.pointGeometry(0,0),ne,z,A,ie.predicate);return Cr&&Cr.box&&Cr.box.length&&(this.markUsedOrientation(w,as,ye),this.placedOrientations[ye.crossTileID]=as),Cr};di(()=>_n(os,p.WritingMode.horizontal),()=>{const yi=Ue.verticalTextBox;return w.allowVerticalPlacement&&ye.numVerticalGlyphVertices>0&&yi?(wr(yi),_n(yi,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ai(vt&&vt.box&&vt.box.length)}}if(yt=vt,rt=yt&&yt.box&&yt.box.length>0,st=yt&&yt.offscreen,ft=yt&&yt.occluded,ye.useRuntimeCollisionCircles){const ai=w.text.placedSymbolArray.get(ye.centerJustifiedTextSymbolIndex>=0?ye.centerJustifiedTextSymbolIndex:ye.verticalPlacedTextSymbolIndex),di=p.evaluateSizeForFeature(w.textSizeData,H,ai),_n=D.get("text-padding");Dt=this.collisionIndex.placeCollisionCircles(ne,ai,w.lineVertexArray,w.glyphOffsetArray,di,A,F,P,_,ae,ie.predicate,ye.collisionCircleDiameter*di/p.ONE_EM,_n,this.retainedQueryData[w.bucketInstanceId].tileID),rt=ne||Dt.circles.length>0&&!Dt.collisionDetected,st=st&&Dt.offscreen,ft=Dt.occluded}if(Ue.iconFeatureIndex&&(Si=Ue.iconFeatureIndex),Ue.iconBox){const ai=di=>{wr(di);const _n=ve&&nt?Vc(nt.x,nt.y,ee,ae,this.transform.angle):new p.pointGeometry(0,0),yi=w.getSymbolInstanceIconSize(U,this.transform.zoom,He);return this.collisionIndex.placeCollisionBox(yi,di,_n,oe,z,A,ie.predicate)};It&&It.box&&It.box.length&&Ue.verticalIconBox?(rn=ai(Ue.verticalIconBox),Re=rn.box.length>0):(rn=ai(Ue.iconBox),Re=rn.box.length>0),st=st&&rn.offscreen,at=rn.occluded}const Ds=Y||0===ye.numHorizontalGlyphVertices&&0===ye.numVerticalGlyphVertices,Zs=te||0===ye.numIconVertices;if(Ds||Zs?Zs?Ds||(Re=Re&&rt):rt=Re&&rt:Re=rt=Re&&rt,rt&&yt&&yt.box&&this.collisionIndex.insertCollisionBox(yt.box,D.get("text-ignore-placement"),w.bucketInstanceId,It&&It.box&&hr?hr:oi,ie.ID),Re&&rn&&this.collisionIndex.insertCollisionBox(rn.box,D.get("icon-ignore-placement"),w.bucketInstanceId,Si,ie.ID),Dt&&(rt&&this.collisionIndex.insertCollisionCircles(Dt.circles,D.get("text-ignore-placement"),w.bucketInstanceId,oi,ie.ID),_)){const ai=w.bucketInstanceId;let di=this.collisionCircleArrays[ai];void 0===di&&(di=this.collisionCircleArrays[ai]=new ii);for(let _n=0;_n<Dt.circles.length;_n+=4)di.circles.push(Dt.circles[_n+0]),di.circles.push(Dt.circles[_n+1]),di.circles.push(Dt.circles[_n+2]),di.circles.push(Dt.collisionDetected?1:0)}const Uo="globe"!==this.transform.projection.name;Fe=Fe&&(Uo||!ft),Te=Te&&(Uo||!at),this.placements[ye.crossTileID]=new _a(rt||Fe,Re||Te,st||w.justReloaded),d[ye.crossTileID]=!0};if(Me){const ye=w.getSortedSymbolIndexes(this.transform.angle);for(let He=ye.length-1;He>=0;--He){const Ue=ye[He];Ze(w.symbolInstances.get(Ue),Ue,w.collisionArrays[Ue])}}else for(let ye=o.symbolInstanceStart;ye<o.symbolInstanceEnd;ye++)Ze(w.symbolInstances.get(ye),ye,w.collisionArrays[ye]);if(_&&w.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[w.bucketInstanceId];p.invert(ye.invProjMatrix,A),ye.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(o,d,_,b){let w;w=b===p.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(d)];const D=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const A of D)A>=0&&(o.text.placedSymbolArray.get(A).crossTileID=w>=0&&A!==w?0:_.crossTileID)}markUsedOrientation(o,d,_){const b=d===p.WritingMode.horizontal||d===p.WritingMode.horizontalOnly?d:0,w=d===p.WritingMode.vertical?d:0,D=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const A of D)o.text.placedSymbolArray.get(A).placedOrientation=b;_.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(o):1,w=d?d.opacities:{},D=d?d.variableOffsets:{},A=d?d.placedOrientations:{};for(const F in this.placements){const P=this.placements[F],O=w[F];O?(this.opacities[F]=new Io(O,b,P.text,P.icon,null,P.clipped),_=_||P.text!==O.text.placed||P.icon!==O.icon.placed):(this.opacities[F]=new Io(null,b,P.text,P.icon,P.skipFade,P.clipped),_=_||P.text||P.icon)}for(const F in w){const P=w[F];if(!this.opacities[F]){const O=new Io(P,b,!1,!1);O.isHidden()||(this.opacities[F]=O,_=_||P.text.placed||P.icon.placed)}}for(const F in D)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=D[F]);for(const F in A)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=A[F]);_?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d){const _={};for(const b of d){const w=b.getBucket(o);w&&b.latestFeatureIndex&&o.id===w.layerIds[0]&&this.updateBucketOpacities(w,_,b.collisionBoxArray)}}updateBucketOpacities(o,d,_){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const b=o.layers[0].layout,w=!!o.layers[0].dynamicFilter(),D=new Io(null,0,!1,!1,!0),A=b.get("text-allow-overlap"),F=b.get("icon-allow-overlap"),P=b.get("text-variable-anchor"),O="map"===b.get("text-rotation-alignment"),z="map"===b.get("text-pitch-alignment"),G="none"!==b.get("icon-text-fit"),Z=new Io(null,0,A&&(F||!o.hasIconData()||b.get("icon-optional")),F&&(A||!o.hasTextData()||b.get("text-optional")),!0);!o.collisionArrays&&_&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(_);const H=(ie,Y,te)=>{for(let ne=0;ne<Y/4;ne++)ie.opacityVertexArray.emplaceBack(te)};let U=0;for(let ie=0;ie<o.symbolInstances.length;ie++){const Y=o.symbolInstances.get(ie),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:ne,crossTileID:oe}=Y;let ee=this.opacities[oe];d[oe]?ee=D:ee||(ee=Z,this.opacities[oe]=ee),d[oe]=!0;const ae=te>0||ne>0,ve=Y.numIconVertices>0,Me=this.placedOrientations[Y.crossTileID],Fe=Me===p.WritingMode.vertical,Te=Me===p.WritingMode.horizontal||Me===p.WritingMode.horizontalOnly;if(!ae&&!ve||ee.isHidden()||U++,ae){const Ze=Ke(ee.text);H(o.text,te,Fe?th:Ze),H(o.text,ne,Te?th:Ze);const ye=ee.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(rt=>{rt>=0&&(o.text.placedSymbolArray.get(rt).hidden=ye||Fe?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=ye||Te?1:0);const He=this.variableOffsets[Y.crossTileID];He&&this.markUsedJustification(o,He.anchor,Y,Me);const Ue=this.placedOrientations[Y.crossTileID];Ue&&(this.markUsedJustification(o,"left",Y,Ue),this.markUsedOrientation(o,Ue,Y))}if(ve){const Ze=Ke(ee.icon);Y.placedIconSymbolIndex>=0&&(H(o.icon,Y.numIconVertices,Fe?th:Ze),o.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=ee.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&(H(o.icon,Y.numVerticalIconVertices,Te?th:Ze),o.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=ee.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Ze=o.collisionArrays[ie];if(Ze){let ye=new p.pointGeometry(0,0),He=!0;if(Ze.textBox||Ze.verticalTextBox){if(P){const rt=this.variableOffsets[oe];rt?(ye=zc(rt.anchor,rt.width,rt.height,rt.textOffset,rt.textScale),O&&ye._rotate(z?this.transform.angle:-this.transform.angle)):He=!1}w&&(He=!ee.clipped),Ze.textBox&&fo(o.textCollisionBox.collisionVertexArray,ee.text.placed,!He||Fe,ye.x,ye.y),Ze.verticalTextBox&&fo(o.textCollisionBox.collisionVertexArray,ee.text.placed,!He||Te,ye.x,ye.y)}const Ue=He&&Boolean(!Te&&Ze.verticalIconBox);Ze.iconBox&&fo(o.iconCollisionBox.collisionVertexArray,ee.icon.placed,Ue,G?ye.x:0,G?ye.y:0),Ze.verticalIconBox&&fo(o.iconCollisionBox.collisionVertexArray,ee.icon.placed,!Ue,G?ye.x:0,G?ye.y:0)}}}if(o.fullyClipped=0===U,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ie.invProjMatrix,o.placementViewportMatrix=ie.viewportMatrix,o.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>o}setStale(){this.stale=!0}}function fo(m,o,d,_,b){m.emplaceBack(o?1:0,d?1:0,_||0,b||0),m.emplaceBack(o?1:0,d?1:0,_||0,b||0),m.emplaceBack(o?1:0,d?1:0,_||0,b||0),m.emplaceBack(o?1:0,d?1:0,_||0,b||0)}const Mm=Math.pow(2,25),Sm=Math.pow(2,24),ri=Math.pow(2,17),Zn=Math.pow(2,16),Qa=Math.pow(2,9),zf=Math.pow(2,8),eh=Math.pow(2,1);function Ke(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const o=m.placed?1:0,d=Math.floor(127*m.opacity);return d*Mm+o*Sm+d*ri+o*Zn+d*Qa+o*zf+d*eh+o}const th=0;class tn{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&void 0!==o.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,d,_,b,w){const D=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(D,b,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((A,F)=>A.sortKey-F.sortKey));this._currentPartIndex<D.length;){const A=D[this._currentPartIndex];if(d.placeLayerBucketPart(A,this._seenCrossTileIDs,_,0===A.symbolInstanceStart),this._currentPartIndex++,w())return!0}return!1}}class nh{constructor(o,d,_,b,w,D,A,F){this.placement=new Dm(o,w,D,A,F),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(o,d,_){const b=p.exported.now(),w=()=>{const D=p.exported.now()-b;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=d[o[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===D.type&&(!D.minzoom||D.minzoom<=A)&&(!D.maxzoom||D.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new tn(D)),this._inProgressLayer.continuePlacement(_[D.source],this.placement,this._showCollisionBoxes,D,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const ih=512/p.EXTENT/2;class Am{constructor(o,d,_){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let b=0;b<d.length;b++){const w=d.get(b),D=w.key;this.indexedSymbolInstances[D]||(this.indexedSymbolInstances[D]=[]),this.indexedSymbolInstances[D].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,o)})}}getScaledCoordinates(o,d){const _=ih/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*p.EXTENT+o.tileAnchorX)*_),y:Math.floor((d.canonical.y*p.EXTENT+o.tileAnchorY)*_)}}findMatches(o,d,_){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let w=0;w<o.length;w++){const D=o.get(w);if(D.crossTileID)continue;const A=this.indexedSymbolInstances[D.key];if(!A)continue;const F=this.getScaledCoordinates(D,d);for(const P of A)if(Math.abs(P.coord.x-F.x)<=b&&Math.abs(P.coord.y-F.y)<=b&&!_[P.crossTileID]){_[P.crossTileID]=!0,D.crossTileID=P.crossTileID;break}}}}class Vf{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class jf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(0!==d)for(const _ in this.indexes){const b=this.indexes[_],w={};for(const D in b){const A=b[D];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+d),w[A.tileID.key]=A}this.indexes[_]=w}this.lng=o}addBucket(o,d,_){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let w=0;w<d.symbolInstances.length;w++)d.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const b=this.usedCrossTileIDs[o.overscaledZ];for(const w in this.indexes){const D=this.indexes[w];if(Number(w)>o.overscaledZ)for(const A in D){const F=D[A];F.tileID.isChildOf(o)&&F.findMatches(d.symbolInstances,o,b)}else{const A=D[o.scaledTo(Number(w)).key];A&&A.findMatches(d.symbolInstances,o,b)}}for(let w=0;w<d.symbolInstances.length;w++){const D=d.symbolInstances.get(w);D.crossTileID||(D.crossTileID=_.generate(),b[D.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Am(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const _ in d.indexedSymbolInstances)for(const b of d.indexedSymbolInstances[_])delete this.usedCrossTileIDs[o][b.crossTileID]}removeStaleBuckets(o){let d=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const w in b)o[b[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[w]),delete b[w],d=!0)}return d}}class Ja{constructor(){this.layerIndexes={},this.crossTileIDs=new Vf,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,_,b){let w=this.layerIndexes[o.id];void 0===w&&(w=this.layerIndexes[o.id]=new jf);let D=!1;const A={};"globe"!==b.name&&w.handleWrapJump(_);for(const F of d){const P=F.getBucket(o);P&&o.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(F.tileID,P,this.crossTileIDs)&&(D=!0),A[P.bucketInstanceId]=!0)}return w.removeStaleBuckets(A)&&(D=!0),D}pruneUnusedLayers(o){const d={};o.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const el=(m,o)=>p.emitValidationErrors(m,o&&o.filter(d=>"source.canvas"!==d.identifier)),rh=p.pick(lt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Uf=p.pick(lt,["setCenter","setZoom","setBearing","setPitch"]),Gt={version:8,layers:[],sources:{}},ko={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Lr extends p.Evented{constructor(o,d={}){super(),this.map=o,this.dispatcher=new Rn(Et(),this),this.imageManager=new bi,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(o._requestManager,d.localFontFamily?p.LocalGlyphMode.all:d.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.lineAtlas=new p.LineAtlas(256,512),this.crossTileSymbolIndex=new Ja,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const _=this;this._rtlTextPluginCallback=Lr.registerForPluginStateChange(b=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(w,D)=>{if(p.triggerPluginCompletionEvent(w),D&&D.every(A=>A))for(const A in _._sourceCaches){const F=_._sourceCaches[A],P=F.getSource().type;"vector"!==P&&"geojson"!==P||F.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const w=this.getSource(b.sourceId);if(w&&w.vectorLayerIds)for(const D in this._layers){const A=this._layers[D];A.source===w.id&&this._validateLayer(A)}})}loadURL(o,d={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof d.validate?d.validate:!p.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,d.accessToken);const b=this.map._requestManager.transformRequest(o,p.ResourceType.Style);this._request=p.getJSON(b,(w,D)=>{this._request=null,w?this.fire(new p.ErrorEvent(w)):D&&this._load(D,_)})}loadJSON(o,d={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(o,!1!==d.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Gt,!1)}_updateLayerCount(o,d){const _=d?1:-1;o.is3D()&&(this._num3DLayers+=_),"circle"===o.type&&(this._numCircleLayers+=_),"symbol"===o.type&&(this._numSymbolLayers+=_)}_load(o,d){if(d&&el(this,p.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o,this._updateMapProjection();for(const b in o.sources)this.addSource(b,o.sources[b],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const _=vn(this.stylesheet.layers);this._order=_.map(b=>b.id),this._layers={},this._serializedLayers={};for(let b of _)b=p.createStyleLayer(b),b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ns(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(o){this._spriteRequest=function(d,_,b){let w,D,A;const F=p.exported.devicePixelRatio>1?"@2x":"";let P=p.getJSON(_.transformRequest(_.normalizeSpriteURL(d,F,".json"),p.ResourceType.SpriteJSON),(G,Z)=>{P=null,A||(A=G,w=Z,z())}),O=p.getImage(_.transformRequest(_.normalizeSpriteURL(d,F,".png"),p.ResourceType.SpriteImage),(G,Z)=>{O=null,A||(A=G,D=Z,z())});function z(){if(A)b(A);else if(w&&D){const G=p.exported.getImageData(D),Z={};for(const H in w){const{width:U,height:ie,x:Y,y:te,sdf:ne,pixelRatio:oe,stretchX:ee,stretchY:ae,content:ve}=w[H],Me=new p.RGBAImage({width:U,height:ie});p.RGBAImage.copy(G,Me,{x:Y,y:te},{x:0,y:0},{width:U,height:ie}),Z[H]={data:Me,pixelRatio:oe,sdf:ne,stretchX:ee,stretchY:ae,content:ve}}b(null,Z)}}return{cancel(){P&&(P.cancel(),P=null),O&&(O.cancel(),O=null)}}}(o,this.map._requestManager,(d,_)=>{if(this._spriteRequest=null,d)this.fire(new p.ErrorEvent(d));else if(_)for(const b in _)this.imageManager.addImage(b,_[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(o){const d=this.getSource(o.source);if(!d)return;const _=o.sourceLayer;_&&("geojson"===d.type||d.vectorLayerIds&&-1===d.vectorLayerIds.indexOf(_))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${d.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const d=[];for(const _ of o){const b=this._layers[_];"custom"!==b.type&&d.push(b.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&ko[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const d=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(b.length||w.length)&&this._updateWorkerLayers(b,w);for(const D in this._updatedSources){const A=this._updatedSources[D];"reload"===A?this._reloadSource(D):"clear"===A&&this._clearSource(D)}this._updateTilesForChangedImages();for(const D in this._updatedPaintProps)this._layers[D].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const _={};for(const b in this._sourceCaches){const w=this._sourceCaches[b];_[b]=w.used,w.used=!1}for(const b of this._order){const w=this._layers[b];if(w.recalculate(o,this._availableImages),!w.isHidden(o.zoom)){const A=this._getLayerSourceCache(w);A&&(A.used=!0)}const D=this.map.painter;if(D){const A=w.getProgramIds();if(!A)continue;const F=w.getProgramConfiguration(o.zoom);for(const P of A)D.useProgram(P,F)}}for(const b in _){const w=this._sourceCaches[b];_[b]!==w.used&&w.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),el(this,p.validateStyle(o)))return!1;(o=p.clone$1(o)).layers=vn(o.layers);const d=function(b,w){if(!b)return[{command:lt.setStyle,args:[w]}];let D=[];try{if(!Be(b.version,w.version))return[{command:lt.setStyle,args:[w]}];Be(b.center,w.center)||D.push({command:lt.setCenter,args:[w.center]}),Be(b.zoom,w.zoom)||D.push({command:lt.setZoom,args:[w.zoom]}),Be(b.bearing,w.bearing)||D.push({command:lt.setBearing,args:[w.bearing]}),Be(b.pitch,w.pitch)||D.push({command:lt.setPitch,args:[w.pitch]}),Be(b.sprite,w.sprite)||D.push({command:lt.setSprite,args:[w.sprite]}),Be(b.glyphs,w.glyphs)||D.push({command:lt.setGlyphs,args:[w.glyphs]}),Be(b.transition,w.transition)||D.push({command:lt.setTransition,args:[w.transition]}),Be(b.light,w.light)||D.push({command:lt.setLight,args:[w.light]}),Be(b.fog,w.fog)||D.push({command:lt.setFog,args:[w.fog]}),Be(b.projection,w.projection)||D.push({command:lt.setProjection,args:[w.projection]});const A={},F=[];!function(z,G,Z,H){let U;for(U in G=G||{},z=z||{})z.hasOwnProperty(U)&&(G.hasOwnProperty(U)||xn(U,Z,H));for(U in G)G.hasOwnProperty(U)&&(z.hasOwnProperty(U)?Be(z[U],G[U])||("geojson"===z[U].type&&"geojson"===G[U].type&&To(z,G,U)?Z.push({command:lt.setGeoJSONSourceData,args:[U,G[U].data]}):pa(U,G,Z,H)):gn(U,G,Z))}(b.sources,w.sources,F,A);const P=[];b.layers&&b.layers.forEach(z=>{z.source&&A[z.source]?D.push({command:lt.removeLayer,args:[z.id]}):P.push(z)});let O=b.terrain;O&&A[O.source]&&(D.push({command:lt.setTerrain,args:[void 0]}),O=void 0),D=D.concat(F),Be(O,w.terrain)||D.push({command:lt.setTerrain,args:[w.terrain]}),function(z,G,Z){G=G||[];const H=(z=z||[]).map(Mt),U=G.map(Mt),ie=z.reduce(Ft,{}),Y=G.reduce(Ft,{}),te=H.slice(),ne=Object.create(null);let oe,ee,ae,ve,Me,Fe,Te;for(oe=0,ee=0;oe<H.length;oe++)ae=H[oe],Y.hasOwnProperty(ae)?ee++:(Z.push({command:lt.removeLayer,args:[ae]}),te.splice(te.indexOf(ae,ee),1));for(oe=0,ee=0;oe<U.length;oe++)ae=U[U.length-1-oe],te[te.length-1-oe]!==ae&&(ie.hasOwnProperty(ae)?(Z.push({command:lt.removeLayer,args:[ae]}),te.splice(te.lastIndexOf(ae,te.length-ee),1)):ee++,Fe=te[te.length-oe],Z.push({command:lt.addLayer,args:[Y[ae],Fe]}),te.splice(te.length-oe,0,ae),ne[ae]=!0);for(oe=0;oe<U.length;oe++)if(ae=U[oe],ve=ie[ae],Me=Y[ae],!ne[ae]&&!Be(ve,Me))if(Be(ve.source,Me.source)&&Be(ve["source-layer"],Me["source-layer"])&&Be(ve.type,Me.type)){for(Te in Qe(ve.layout,Me.layout,Z,ae,null,lt.setLayoutProperty),Qe(ve.paint,Me.paint,Z,ae,null,lt.setPaintProperty),Be(ve.filter,Me.filter)||Z.push({command:lt.setFilter,args:[ae,Me.filter]}),Be(ve.minzoom,Me.minzoom)&&Be(ve.maxzoom,Me.maxzoom)||Z.push({command:lt.setLayerZoomRange,args:[ae,Me.minzoom,Me.maxzoom]}),ve)ve.hasOwnProperty(Te)&&"layout"!==Te&&"paint"!==Te&&"filter"!==Te&&"metadata"!==Te&&"minzoom"!==Te&&"maxzoom"!==Te&&(0===Te.indexOf("paint.")?Qe(ve[Te],Me[Te],Z,ae,Te.slice(6),lt.setPaintProperty):Be(ve[Te],Me[Te])||Z.push({command:lt.setLayerProperty,args:[ae,Te,Me[Te]]}));for(Te in Me)Me.hasOwnProperty(Te)&&!ve.hasOwnProperty(Te)&&"layout"!==Te&&"paint"!==Te&&"filter"!==Te&&"metadata"!==Te&&"minzoom"!==Te&&"maxzoom"!==Te&&(0===Te.indexOf("paint.")?Qe(ve[Te],Me[Te],Z,ae,Te.slice(6),lt.setPaintProperty):Be(ve[Te],Me[Te])||Z.push({command:lt.setLayerProperty,args:[ae,Te,Me[Te]]}))}else Z.push({command:lt.removeLayer,args:[ae]}),Fe=te[te.lastIndexOf(ae)+1],Z.push({command:lt.addLayer,args:[Me,Fe]})}(P,w.layers,D)}catch(A){console.warn("Unable to compute style diff:",A),D=[{command:lt.setStyle,args:[w]}]}return D}(this.serialize(),o).filter(b=>!(b.command in Uf));if(0===d.length)return!1;const _=d.filter(b=>!(b.command in rh));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);return d.forEach(b=>{"setTransition"!==b.command&&this[b.command].apply(this,b.args)}),this.stylesheet=o,this._updateMapProjection(),!0}addImage(o,d){return this.getImage(o)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,d),this._afterImageUpdated(o),this)}updateImage(o,d){this.imageManager.updateImage(o,d)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o),this._afterImageUpdated(o),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,d,_={}){if(this._checkLoaded(),void 0!==this.getSource(o))throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(p.validateSource,`sources.${o}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=_e(o,d,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o),source:b.serialize(),sourceId:o}));const w=D=>{const A=(D?"symbol:":"other:")+o,F=this._sourceCaches[A]=new p.SourceCache(A,b,D);(D?this._symbolSourceCaches:this._otherSourceCaches)[o]=F,F.style=this,F.onAdd(this.map)};w(!1),"vector"!==d.type&&"geojson"!==d.type||w(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const d=this.getSource(o);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===o)return this.fire(new p.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new p.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(o);for(const b of _)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(o,d){this._checkLoaded(),this.getSource(o).setData(d),this._changed=!0}getSource(o){const d=this._getSourceCache(o);return d&&d.getSource()}addLayer(o,d,_={}){this._checkLoaded();const b=o.id;if(this.getLayer(b))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let w;if("custom"===o.type){if(el(this,p.validateCustomStyleLayer(o)))return;w=p.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(b,o.source),o=p.clone$1(o),o=p.extend(o,{source:b})),this._validate(p.validateLayer,`layers.${b}`,o,{arrayIndex:-1},_))return;w=p.createStyleLayer(o),this._validateLayer(w),w.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}const D=d?this._order.indexOf(d):this._order.length;if(d&&-1===D)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(D,0,b),this._layerOrderChanged=!0,this._layers[b]=w;const A=this._getLayerSourceCache(w);if(this._removedLayers[b]&&w.source&&A&&"custom"!==w.type){const F=this._removedLayers[b];delete this._removedLayers[b],F.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",A.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,d){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===d)return;const _=this._order.indexOf(o);this._order.splice(_,1);const b=d?this._order.indexOf(d):this._order.length;d&&-1===b?this.fire(new p.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(b,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const d=this._layers[o];if(!d)return void this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const _=this._order.indexOf(o);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=d,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const d in this._layers)if(this._layers[d].type===o)return!0;return!1}setLayerZoomRange(o,d,_){this._checkLoaded();const b=this.getLayer(o);b?b.minzoom===d&&b.maxzoom===_||(null!=d&&(b.minzoom=d),null!=_&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,d,_={}){this._checkLoaded();const b=this.getLayer(o);if(b){if(!Be(b.filter,d))return null==d?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(p.validateFilter,`layers.${b.id}.filter`,d,{layerType:b.type},_)||(b.filter=p.clone$1(d),this._updateLayer(b)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){const d=this.getLayer(o);return d&&p.clone$1(d.filter)}setLayoutProperty(o,d,_,b={}){this._checkLoaded();const w=this.getLayer(o);w?Be(w.getLayoutProperty(d),_)||(w.setLayoutProperty(d,_,b),this._updateLayer(w)):this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,d){const _=this.getLayer(o);if(_)return _.getLayoutProperty(d);this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,d,_,b={}){this._checkLoaded();const w=this.getLayer(o);w?Be(w.getPaintProperty(d),_)||(w.setPaintProperty(d,_,b)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,d){const _=this.getLayer(o);return _&&_.getPaintProperty(d)}setFeatureState(o,d){this._checkLoaded();const _=o.source,b=o.sourceLayer,w=this.getSource(_);if(!w)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const D=w.type;if("geojson"===D&&b)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===D&&!b)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===o.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(_);for(const F of A)F.setFeatureState(b,o.id,d)}removeFeatureState(o,d){this._checkLoaded();const _=o.source,b=this.getSource(_);if(!b)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const w=b.type,D="vector"===w?o.sourceLayer:void 0;if("vector"===w&&!D)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&"string"!=typeof o.id&&"number"!=typeof o.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(_);for(const F of A)F.removeFeatureState(D,o.id,d)}getFeatureState(o){this._checkLoaded();const d=o.source,_=o.sourceLayer,b=this.getSource(d);if(b){if("vector"!==b.type||_)return void 0===o.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(_,o.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const d in this._sourceCaches){const _=this._sourceCaches[d].getSource();o[_.id]||(o[_.id]=_.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},d=>void 0!==d)}_updateLayer(o){this._updatedLayers[o.id]=!0;const d=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&d&&"raster"!==d.getSource().type&&(this._updatedSources[o.source]="reload",d.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const d=D=>"fill-extrusion"===this._layers[D].type,_={},b=[];for(let D=this._order.length-1;D>=0;D--){const A=this._order[D];if(d(A)){_[A]=D;for(const F of o){const P=F[A];if(P)for(const O of P)b.push(O)}}}b.sort((D,A)=>A.intersectionZ-D.intersectionZ);const w=[];for(let D=this._order.length-1;D>=0;D--){const A=this._order[D];if(d(A))for(let F=b.length-1;F>=0;F--){const P=b[F].feature;if(_[P.layer.id]<D)break;w.push(P),b.pop()}else for(const F of o){const P=F[A];if(P)for(const O of P)w.push(O.feature)}}return w}queryRenderedFeatures(o,d,_){d&&d.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);const b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const F of d.layers){const P=this._layers[F];if(!P)return this.fire(new p.ErrorEvent(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];b[P.source]=!0}}const w=[];d.availableImages=this._availableImages;const D=d&&d.layers?d.layers.some(F=>{const P=this.getLayer(F);return P&&P.is3D()}):this.has3DLayers(),A=Pn.createFromScreenPoints(o,_);for(const F in this._sourceCaches){const P=this._sourceCaches[F].getSource().id;d.layers&&!b[P]||w.push(be(this._sourceCaches[F],this._layers,this._serializedLayers,A,d,_,D,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(F,P,O,z,G,Z,H){const U={},ie=Z.queryRenderedSymbols(z),Y=[];for(const te of Object.keys(ie).map(Number))Y.push(H[te]);Y.sort(Je);for(const te of Y){const ne=te.featureIndex.lookupSymbolFeatures(ie[te.bucketInstanceId],P,te.bucketIndex,te.sourceLayerIndex,G.filter,G.layers,G.availableImages,F);for(const oe in ne){const ee=U[oe]=U[oe]||[],ae=ne[oe];ae.sort((ve,Me)=>{const Fe=te.featureSortOrder;if(Fe){const Te=Fe.indexOf(ve.featureIndex);return Fe.indexOf(Me.featureIndex)-Te}return Me.featureIndex-ve.featureIndex});for(const ve of ae)ee.push(ve)}}for(const te in U)U[te].forEach(ne=>{const oe=ne.feature,ee=O(F[te]).getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=ee});return U}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(o,d){d&&d.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",d.filter,null,d);const _=this._getSourceCaches(o);let b=[];for(const w of _)b=b.concat(Le(w,d));return b}addSourceType(o,d,_){return Lr.getSourceType(o)?_(new Error(`A source type called "${o}" already exists.`)):(Lr.setSourceType(o,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:d.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(o,d={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const D in o)if(!Be(o[D],_[D])){b=!0;break}if(!b)return;const w={now:p.exported.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,d),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,d=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===d){if("object"==typeof o.source){const _="terrain-dem-src";this.addSource(_,o.source),o=p.clone$1(o),o=p.extend(o,{source:_})}if(this._validate(p.validateTerrain,"terrain",o))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode)this._createTerrain(o,d);else{const _=this.terrain,b=_.get();for(const w in o)if(!Be(o[w],b[w])){_.set(o),this.stylesheet.terrain=o;const D={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(D);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const d=this.fog=new Nt(o,this.map.transform);this.stylesheet.fog=o;const _={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,_=d.get();for(const b in o)if(!Be(o[b],_[b])){d.set(o),this.stylesheet.fog=o;const w={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(w);break}}else this._createFog(o);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(_=>this.isLayerDraped(this._layers[_])),d=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...d)}_createTerrain(o,d){const _=this.terrain=new un(o,d);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const b={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(b)}_force3DLayerUpdate(){for(const o in this._layers){const d=this._layers[o];"fill-extrusion"===d.type&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const d=this._layers[o];"symbol"===d.type&&this._updateLayer(d)}}_validate(o,d,_,b,w={}){return(!w||!1!==w.validate)&&el(this,o.call(p.validateStyle,p.extend({key:d,style:this.serialize(),value:_,styleSpec:p.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const d=this._getSourceCaches(o);for(const _ of d)_.clearTiles()}_reloadSource(o){const d=this._getSourceCaches(o);for(const _ of d)_.resume(),_.reload()}_updateSources(o){for(const d in this._sourceCaches)this._sourceCaches[d].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const d=this._sourceCaches[o];d.resume(),d.reload()}}_updatePlacement(o,d,_,b,w=!1){let D=!1,A=!1;const F={};for(const P of this._order){const O=this._layers[P];if("symbol"!==O.type)continue;if(!F[O.source]){const G=this._getLayerSourceCache(O);if(!G)continue;F[O.source]=G.getRenderableIds(!0).map(Z=>G.getTileByID(Z)).sort((Z,H)=>H.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(H.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(O,F[O.source],o.center.lng,o.projection);D=D||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),w=w||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),o.zoom))&&(this.pauseablePlacement=new nh(o,this._order,w,d,_,b,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,F),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),A=!0),D&&this.pauseablePlacement.placement.setStale()),A||D)for(const P of this._order){const O=this._layers[P];"symbol"===O.type&&this.placement.updateLayerOpacities(O,F[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,d,_){this.imageManager.getImages(d.icons,_),this._updateTilesForChangedImages();const b=w=>{w&&w.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(o,d,_){this.glyphManager.getGlyphs(d.stacks,_)}getResource(o,d,_){return p.makeRequest(d,_)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return"symbol"===o.type?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const d=[];return this._otherSourceCaches[o]&&d.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&d.push(this._symbolSourceCaches[o]),d}_isSourceCacheLoaded(o){const d=this._getSourceCaches(o);return 0===d.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${o}'`))),!1):d.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Lr.getSourceType=function(m){return me[m]},Lr.setSourceType=function(m,o){me[m]=o},Lr.registerForPluginStateChange=p.registerForPluginStateChange;var ws="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Ll="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Bl={},vr={};Bl=ct("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),vr=ct("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Br=ct("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Zu=ws;var Xu={background:ct("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ct("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ct("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ct("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ct("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ct("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ct("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ct("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ct("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ct("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ct("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ct("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ct("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ct("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ct("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ct("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ct("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ct("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ct("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ct("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ct("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ct("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ct("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ct("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:ct("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ct("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ll),skyboxGradient:ct("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ll),skyboxCapture:ct("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ct("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:ct("uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)\ndiscard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function ct(m,o,d){const _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,b=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,w=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),D=m.match(b),A=o.match(b),F=ws.match(b);let P=A?A.concat(D):D;d||(Bl.staticUniforms&&(P=Bl.staticUniforms.concat(P)),vr.staticUniforms&&(P=vr.staticUniforms.concat(P))),P&&(P=P.concat(F));const O={};return{fragmentSource:m=m.replace(_,(z,G,Z,H,U)=>(O[U]=!0,"define"===G?`\n#ifndef HAS_UNIFORM_u_${U}\nvarying ${Z} ${H} ${U};\n#else\nuniform ${Z} ${H} u_${U};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${U}\n    ${Z} ${H} ${U} = u_${U};\n#endif\n`)),vertexSource:o=o.replace(_,(z,G,Z,H,U)=>{const ie="float"===H?"vec2":"vec4",Y=U.match(/color/)?"color":ie;return O[U]?"define"===G?`\n#ifndef HAS_UNIFORM_u_${U}\nuniform lowp float u_${U}_t;\nattribute ${Z} ${ie} a_${U};\nvarying ${Z} ${H} ${U};\n#else\nuniform ${Z} ${H} u_${U};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${U}\n    ${U} = a_${U};\n#else\n    ${Z} ${H} ${U} = u_${U};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${U}\n    ${U} = unpack_mix_${Y}(a_${U}, u_${U}_t);\n#else\n    ${Z} ${H} ${U} = u_${U};\n#endif\n`:"define"===G?`\n#ifndef HAS_UNIFORM_u_${U}\nuniform lowp float u_${U}_t;\nattribute ${Z} ${ie} a_${U};\n#else\nuniform ${Z} ${H} u_${U};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${U}\n    ${Z} ${H} ${U} = a_${U};\n#else\n    ${Z} ${H} ${U} = u_${U};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${U}\n    ${Z} ${H} ${U} = unpack_mix_${Y}(a_${U}, u_${U}_t);\n#else\n    ${Z} ${H} ${U} = u_${U};\n#endif\n`}),staticAttributes:w,staticUniforms:P}}class Ku{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,d,_,b,w,D,A,F){this.context=o;let P=this.boundPaintVertexBuffers.length!==b.length;for(let O=0;!P&&O<b.length;O++)this.boundPaintVertexBuffers[O]!==b[O]&&(P=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===_&&!P&&this.boundIndexBuffer===w&&this.boundVertexOffset===D&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===F?(o.bindVertexArrayOES.set(this.vao),A&&A.bind(),w&&w.dynamicDraw&&w.bind(),F&&F.bind()):this.freshBind(d,_,b,w,D,A,F)}freshBind(o,d,_,b,w,D,A){let F;const P=o.numAttributes,O=this.context,z=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=D,this.boundDynamicVertexBuffer2=A;else{F=O.currentNumAttributes||0;for(let G=P;G<F;G++)z.disableVertexAttribArray(G)}d.enableAttributes(z,o);for(const G of _)G.enableAttributes(z,o);D&&D.enableAttributes(z,o),A&&A.enableAttributes(z,o),d.bind(),d.setVertexAttribPointers(z,o,w);for(const G of _)G.bind(),G.setVertexAttribPointers(z,o,w);D&&(D.bind(),D.setVertexAttribPointers(z,o,w)),b&&b.bind(),A&&(A.bind(),A.setVertexAttribPointers(z,o,w)),O.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Gf(m,o){const d=Math.pow(2,o.canonical.z),_=o.canonical.y;return[new p.MercatorCoordinate(0,_/d).toLngLat().lat,new p.MercatorCoordinate(0,(_+1)/d).toLngLat().lat]}function $f(m,o,d,_,b,w,D){const A=m.context,F=A.gl,P=d.fbo;if(!P)return;m.prepareDrawTile();const O=m.useProgram("hillshade");A.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,P.colorAttachment.get());const z=((U,ie,Y,te)=>{const ne=Y.paint.get("hillshade-shadow-color"),oe=Y.paint.get("hillshade-highlight-color"),ee=Y.paint.get("hillshade-accent-color");let ae=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Y.paint.get("hillshade-illumination-anchor")&&(ae-=U.transform.angle);const ve=!U.options.moving;return{u_matrix:te||U.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),ve),u_image:0,u_latrange:Gf(0,ie.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),ae],u_shadow:ne,u_highlight:oe,u_accent:ee}})(m,d,_,m.terrain?o.projMatrix:null);m.prepareDrawProgram(A,O,o.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:Z,tileBoundsSegments:H}=m.getTileBoundsBuffers(d);O.draw(A,F.TRIANGLES,b,w,D,p.CullFaceMode.disabled,z,_.id,G,Z,H)}function Hf(m,o,d){if(!o.needsDEMTextureUpload)return;const _=m.context,b=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(d.stride);const w=d.getPixels();o.demTexture?o.demTexture.update(w,{premultiply:!1}):o.demTexture=new p.Texture(_,w,b.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Ln(m,o,d,_,b,w){const D=m.context,A=D.gl;if(!o.dem)return;const F=o.dem;if(D.activeTexture.set(A.TEXTURE1),Hf(m,o,F),!o.demTexture)return;o.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const P=F.dim;D.activeTexture.set(A.TEXTURE0);let O=o.fbo;if(!O){const H=new p.Texture(D,{width:P,height:P,data:null},A.RGBA);H.bind(A.LINEAR,A.CLAMP_TO_EDGE),O=o.fbo=D.createFramebuffer(P,P,!0),O.colorAttachment.set(H.texture)}D.bindFramebuffer.set(O.framebuffer),D.viewport.set([0,0,P,P]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:G,tileBoundsSegments:Z}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(D,A.TRIANGLES,_,b,w,p.CullFaceMode.disabled,((H,U)=>{const ie=U.stride,Y=p.create();return p.ortho(Y,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(Y,Y,[0,-p.EXTENT,0]),{u_matrix:Y,u_image:1,u_dimension:[ie,ie],u_zoom:H.overscaledZ,u_unpack:U.unpackVector}})(o.tileID,F),d.id,z,G,Z),o.needsHillshadePrepare=!1}const qf=(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_image0:new p.Uniform1i(m,o.u_image0),u_skirt_height:new p.Uniform1f(m,o.u_skirt_height)}),Tm=(m,o)=>({u_matrix:m,u_image0:0,u_skirt_height:o}),tl=(m,o,d,_,b,w)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:o,u_merc_matrix:d,u_zoom_transition:_,u_merc_center:b,u_image0:0,u_grid_matrix:w?Float32Array.from(w):new Float32Array(9)});function Bn(m,o){return null!=m&&null!=o&&!(!m.hasData()||!o.hasData())&&null!=m.demTexture&&null!=o.demTexture&&m.tileID.key!==o.tileID.key}const js=new class{constructor(){this.operations={}}newMorphing(m,o,d,_,b){if(m in this.operations){const w=this.operations[m];w.to.tileID.key!==d.tileID.key&&(w.queued=d)}else this.operations[m]={startTime:_,phase:0,duration:b,from:o,to:d,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const o=this.operations[m];return{from:o.from,to:o.to,phase:o.phase}}update(m){for(const o in this.operations){const d=this.operations[o];for(d.phase=(m-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,m)){delete this.operations[o];break}}}_nextOp(m,o){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=o,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},ya={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function jc(m,o){const d=1<<m.z;return!o&&(0===m.x||m.x===d-1)||0===m.y||m.y===d-1}const Uc=m=>({u_matrix:m});function Us(m,o,d,_,b){if(b>0){const w=p.exported.now(),D=(w-m.timeAdded)/b,A=o?(w-o.timeAdded)/b:-1,F=d.getSource(),P=_.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),O=!o||Math.abs(o.tileID.overscaledZ-P)>Math.abs(m.tileID.overscaledZ-P),z=O&&m.refreshedUponExpiration?1:p.clamp(O?D:1-A,0,1);return m.refreshedUponExpiration&&D>=1&&(m.refreshedUponExpiration=!1),o?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}const Gc=2*p.mercatorZfromAltitude(1,0)*p.GLOBE_RADIUS*Math.PI;class $c extends p.SourceCache{constructor(o){const d={type:"raster-dem",maxzoom:o.transform.maxZoom},_=new Rn(Et(),null),b=_e("mock-dem",d,_,o.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,d){o.state="loaded",d(null)}}class Un extends p.SourceCache{constructor(o){const d=_e("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new Rn(Et(),null),o.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,d,_){if(o.freezeTileCoverage)return;this.transform=o;const b=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,D)=>{if(w[D.key]="",!this._tiles[D.key]){const A=new p.Tile(D,this._source.tileSize*D.overscaleFactor(),o.tileZoom);A.state="loaded",this._tiles[D.key]=A}return w},{});for(const w in this._tiles)w in b||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(o){const d=this.proxyCachedFBO[o];if(void 0!==d){const _=Object.values(d);this.renderCachePool.push(..._),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class sh extends p.OverscaledTileID{constructor(o,d,_){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=d,this.projMatrix=_}}class Nr extends p.Elevation{constructor(o,d){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,b,w]=function(F){const P=new p.StructArrayLayout4i8,O=new p.StructArrayLayout3ui6,z=131;P.reserve(17161),O.reserve(33800);const G=p.EXTENT/128,Z=p.EXTENT+G/2,H=Z+G;for(let ie=-G;ie<H;ie+=G)for(let Y=-G;Y<H;Y+=G){const te=Y<0||Y>Z||ie<0||ie>Z?24575:0,ne=p.clamp(Math.round(Y),0,p.EXTENT),oe=p.clamp(Math.round(ie),0,p.EXTENT);P.emplaceBack(ne+te,oe,ne,oe)}const U=(ie,Y)=>{const te=Y*z+ie;O.emplaceBack(te+1,te,te+z),O.emplaceBack(te+z,te+z+1,te+1)};for(let ie=1;ie<129;ie++)for(let Y=1;Y<129;Y++)U(Y,ie);return[0,129].forEach(ie=>{for(let Y=0;Y<130;Y++)U(Y,ie),U(ie,Y)}),[P,O,32768]}(),D=o.context;this.gridBuffer=D.createVertexBuffer(_,p.boundsAttributes.members),this.gridIndexBuffer=D.createIndexBuffer(b),this.gridSegments=p.SegmentVector.simpleSegment(0,0,_.length,b.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,_.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Un(d.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,0,p.EXTENT,0,p.EXTENT,0,1);const A=D.gl;this._overlapStencilMode=new p.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new $c(d.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,d,_){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const b=o.terrain.properties;this.sourceCache=0===o.terrain.drapeRenderMode?this._mockSourceCache:o._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const w=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const D=this.getScaledDemTileSize();this.sourceCache.update(d,D,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,w(),this._initializing=!0),w(),d.updateElevation(!_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==o.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&"source"===o.dataType?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):"style"===o.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(F=>{const P=d.getTileByID(F).tileID;return P.projMatrix=_.calculateProjMatrix(P.toUnwrapped()),P});(function(F,P){const O=P.transform.pointCoordinate(P.transform.getCameraPoint()),z=new p.pointGeometry(O.x,O.y);F.sort((G,Z)=>{if(Z.overscaledZ-G.overscaledZ)return Z.overscaledZ-G.overscaledZ;const H=new p.pointGeometry(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),U=new p.pointGeometry(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),ie=z.mult(1<<G.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(H)-ie.distSqr(U)})})(b,this.painter),this._previousZoom=_.zoom;const w=this.proxyToSource||{};this.proxyToSource={},b.forEach(F=>{this.proxyToSource[F.key]={}}),this.terrainTileForTile={};const D=this._style._sourceCaches;for(const F in D){const P=D[F];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,o[F],w),P.usedForTerrain))continue;const O=o[F];P.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[d.id]=b.map(F=>new sh(F,F.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const A={};this._visibleDemTiles=[];for(const F of this.proxyCoords){const P=this.terrainTileForTile[F.key];if(!P)continue;const O=P.tileID.key;O in A||(this._visibleDemTiles.push(P),A[O]=O)}}_assignTerrainTiles(o){this._initializing||o.forEach(d=>{if(this.terrainTileForTile[d.key])return;const _=this._findTileCoveringTileID(d,this.sourceCache);_&&(this.terrainTileForTile[d.key]=_)})}_prepareDEMTextures(){const o=this.painter.context,d=o.gl;for(const _ in this.terrainTileForTile){const b=this.terrainTileForTile[_],w=b.dem;!w||b.demTexture&&!b.needsDEMTextureUpload||(o.activeTexture.set(d.TEXTURE1),Hf(this.painter,b,w))}}_prepareDemTileUniforms(o,d,_,b){if(!d||null==d.demTexture)return!1;const w=o.tileID.canonical,D=Math.pow(2,d.tileID.canonical.z-w.z),A=b||"";return _[`u_dem_tl${A}`]=[w.x*D%1,w.y*D%1],_[`u_dem_scale${A}`]=D,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,d=o.gl;if(!this._emptyDepthBufferTexture){const _=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(o,_,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const d=this._visibleDemTiles.reduce((_,b)=>{if(!b.dem)return _;const w=b.dem.tree.minimums[0];return w>0&&o++,_+w},0);return o?d/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,d=o.gl;o.activeTexture.set(d.TEXTURE2);const _=this._getLoadedAreaMinimum(),b=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(b,{premultiply:!1}):w=this._emptyDEMTexture=new p.Texture(o,b,d.RGBA,{premultiply:!1}),w}setupElevationDraw(o,d,_){const b=this.painter.context,w=b.gl,D=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var A;D.u_dem_size=this.sourceCache.getSource().tileSize,D.u_exaggeration=this.exaggeration();const F=this.painter.transform,P=F.projection,O=o.tileID.canonical;D.u_tile_tl_up=P.upVector(O,0,0),D.u_tile_tr_up=P.upVector(O,p.EXTENT,0),D.u_tile_br_up=P.upVector(O,p.EXTENT,p.EXTENT),D.u_tile_bl_up=P.upVector(O,0,p.EXTENT),D.u_tile_up_scale=_&&_.useDenormalizedUpVectorScale?Gc:P.upVectorScale(O,F.center.lat,F.worldSize).metersToTile;let z=null,G=null,Z=1;if(_&&_.morphing&&this._useVertexMorphing){const H=_.morphing.srcDemTile,U=_.morphing.dstDemTile;Z=_.morphing.phase,H&&U&&(this._prepareDemTileUniforms(o,H,D,"_prev")&&(G=H),this._prepareDemTileUniforms(o,U,D)&&(z=U))}if(G&&z?(b.activeTexture.set(w.TEXTURE2),z.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),b.activeTexture.set(w.TEXTURE4),G.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),D.u_dem_lerp=Z):(z=this.terrainTileForTile[o.tileID.key],b.activeTexture.set(w.TEXTURE2),(this._prepareDemTileUniforms(o,z,D)?z.demTexture:this.emptyDEMTexture).bind(w.NEAREST,w.CLAMP_TO_EDGE)),b.activeTexture.set(w.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(D.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),D.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&z){const H=(1<<z.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;D.u_meter_to_dem=H}_&&_.labelPlaneMatrixInv&&(D.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),d.setTerrainUniformValues(b,D)}renderToBackBuffer(o){const d=this.painter,_=this.painter.context;0!==o.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),this.renderingToTexture=!1,function(b,w,D,A,F){if("globe"===b.transform.projection.name)!function(P,O,z,G,Z){const H=P.context,U=H.gl;let ie,Y;const te=P.options.showTerrainWireframe?2:0,ne=(Te,Ze)=>{if(Y===Te)return;const ye=[ya[Te],"PROJECTION_GLOBE_VIEW"];Ze&&ye.push(ya[te]),ie=P.useProgram("globeRaster",null,ye),Y=Te},oe=P.colorModeForRenderPass(),ee=new p.DepthMode(U.LEQUAL,p.DepthMode.ReadWrite,P.depthRangeFor3D);js.update(Z);const ae=P.transform,ve=p.calculateGlobeMercatorMatrix(ae),Me=[p.mercatorXfromLng(ae.center.lng),p.mercatorYfromLat(ae.center.lat)],Fe=P.globeSharedBuffers;if((te?[!1,!0]:[!1]).forEach(Te=>{Y=-1;const Ze=Te?U.LINES:U.TRIANGLES;for(const ye of G){const He=z.getTile(ye),Ue=p.StencilMode.disabled,rt=O.prevTerrainTileForTile[ye.key],Re=O.terrainTileForTile[ye.key];Bn(rt,Re)&&js.newMorphing(ye.key,rt,Re,Z,250),H.activeTexture.set(U.TEXTURE0),He.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const st=js.getMorphValuesForProxy(ye.key),ft=st?1:0,at={useDenormalizedUpVectorScale:!0};st&&p.extend$1(at,{morphing:{srcDemTile:st.from,dstDemTile:st.to,phase:p.easeCubicInOut(st.phase)}});const nt=Float32Array.from(ae.globeMatrix),vt=p.globeTileLatLngCorners(ye.canonical),It=p.getGridMatrix(ye.canonical,vt),yt=tl(ae.projMatrix,nt,ve,p.globeToMercatorTransition(ae.zoom),Me,It);if(ne(ft,Te),O.setupElevationDraw(He,ie,at),P.prepareDrawProgram(H,ie,ye.toUnwrapped()),Fe){const[Dt,rn,oi]=Te?Fe.getWirefameBuffers(P.context):Fe.getGridBuffers();ie.draw(H,Ze,ee,Ue,oe,p.CullFaceMode.backCCW,yt,"globe_raster",Dt,rn,oi)}}}),Fe){ie=P.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const Te of G){const{x:Ze,y:ye,z:He}=Te.canonical,Ue=0===ye,rt=ye===(1<<He)-1,[Re,st,ft,at]=Fe.getPoleBuffers(He);if(at&&(Ue||rt)){const nt=z.getTile(Te);H.activeTexture.set(U.TEXTURE0),nt.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let vt=p.globePoleMatrixForTile(He,Ze,ae);const It=(yt,Dt)=>yt.draw(H,U.TRIANGLES,ee,p.StencilMode.disabled,oe,p.CullFaceMode.disabled,tl(ae.projMatrix,vt,vt,0,Me),"globe_pole_raster",Dt,ft,at);O.setupElevationDraw(nt,ie,{}),P.prepareDrawProgram(H,ie,Te.toUnwrapped()),Ue&&It(ie,Re),rt&&(vt=p.scale(p.create(),vt,[1,-1,1]),It(ie,st))}}}}(b,w,D,A,F);else{const P=b.context,O=P.gl;let z,G;const Z=b.options.showTerrainWireframe?2:0,H=(ne,oe)=>{if(G===ne)return;const ee=[ya[ne]];oe&&ee.push(ya[Z]),z=b.useProgram("terrainRaster",null,ee),G=ne},U=b.colorModeForRenderPass(),ie=new p.DepthMode(O.LEQUAL,p.DepthMode.ReadWrite,b.depthRangeFor3D);js.update(F);const Y=b.transform,te=6*Math.pow(1.5,22-Y.zoom)*w.exaggeration();(Z?[!1,!0]:[!1]).forEach(ne=>{G=-1;const oe=ne?O.LINES:O.TRIANGLES,[ee,ae]=ne?w.getWirefameBuffer():[w.gridIndexBuffer,w.gridSegments];for(const ve of A){const Me=D.getTile(ve),Fe=p.StencilMode.disabled,Te=w.prevTerrainTileForTile[ve.key],Ze=w.terrainTileForTile[ve.key];Bn(Te,Ze)&&js.newMorphing(ve.key,Te,Ze,F,250),P.activeTexture.set(O.TEXTURE0),Me.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST);const ye=js.getMorphValuesForProxy(ve.key),He=ye?1:0;let Ue;ye&&(Ue={morphing:{srcDemTile:ye.from,dstDemTile:ye.to,phase:p.easeCubicInOut(ye.phase)}});const rt=Tm(ve.projMatrix,jc(ve.canonical,Y.renderWorldCopies)?te/10:te);H(He,ne),w.setupElevationDraw(Me,z,Ue),b.prepareDrawProgram(P,z,ve.toUnwrapped()),z.draw(P,oe,ie,Fe,U,p.CullFaceMode.backCCW,rt,"terrain_raster",w.gridBuffer,ee,ae)}})}}(d,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,o.splice(0,o.length))}renderBatch(o){if(0===this._drapedRenderBatches.length)return o+1;this.renderingToTexture=!0;const d=this.painter,_=this.painter.context,b=this.proxySourceCache,w=this.proxiedCoords[b.id],D=this._drapedRenderBatches.shift(),A=[],F=d.style.order;let P=0;for(const O of w){const z=b.getTileByID(O.proxyTileKey),G=b.proxyCachedFBO[O.key]?b.proxyCachedFBO[O.key][o]:void 0,Z=void 0!==G?b.renderCache[G]:this.pool[P++],H=void 0!==G;if(z.texture=Z.tex,H&&!Z.dirty){A.push(z.tileID);continue}let U;_.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(_.clear({color:p.Color.transparent,stencil:0}),Z.dirty=!1);for(let ie=D.start;ie<=D.end;++ie){const Y=d.style._layers[F[ie]];if(Y.isHidden(d.transform.zoom))continue;const te=d.style._getLayerSourceCache(Y),ne=te?this.proxyToSource[O.key][te.id]:[O];if(!ne)continue;const oe=ne;_.viewport.set([0,0,Z.fb.width,Z.fb.height]),U!==(te?te.id:null)&&(this._setupStencil(Z,ne,Y,te),U=te?te.id:null),d.renderLayer(d,te,Y,oe)}this.renderedToTile?(Z.dirty=!0,A.push(z.tileID)):H||--P,5===P&&(P=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),D.end+1}postRender(){}renderCacheEfficiency(o){const d=o.order.length;if(0===d)return{efficiency:100};let _,b=0,w=0,D=!1;for(let A=0;A<d;++A){const F=o._layers[o.order[A]];this._style.isLayerDraped(F)?(D&&++b,++w):D||(D=!0,_=F.id)}return 0===w?{efficiency:100}:{efficiency:100*(1-b/w),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{o=Math.min(o,d.dem.tree.minimums[0])}),0===o?o:(o-30)*this._exaggeration}raycast(o,d,_){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const D=w.tileID,A=Math.pow(2,D.overscaledZ),{x:F,y:P}=D.canonical,O=F/A,z=(F+1)/A,G=P/A,Z=(P+1)/A;return{minx:O,miny:G,maxx:z,maxy:Z,t:w.dem.tree.raycastRoot(O,G,z,Z,o,d,_),tile:w}});b.sort((w,D)=>(null!==w.t?w.t:Number.MAX_VALUE)-(null!==D.t?D.t:Number.MAX_VALUE));for(const w of b){if(null==w.t)return null;const D=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,o,d,_);if(null!=D)return D}return null}_createFBO(){const o=this.painter.context,d=o.gl,_=this.drapeBufferSize;o.activeTexture.set(d.TEXTURE0);const b=new p.Texture(o,{width:_[0],height:_[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const w=o.createFramebuffer(_[0],_[1],!1);return w.colorAttachment.set(b.texture),w.depthAttachment=new Ol(o,w.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:w,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const d=this._style._layers[o],_=d.isHidden(this.painter.transform.zoom),b=d.getCrossfadeParameters(),w=!!b&&1!==b.t,D=d.hasTransition();return"custom"!==d.type&&!_&&(w||D)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const d in this._style._sourceCaches)if(this._style._sourceCaches[d]._source instanceof j){o=!0;break}if(o)for(let d=0;d<this._style.order.length;++d){const _=this._style._layers[this._style.order[d]],b=_.isHidden(this.painter.transform.zoom),w=this._style._getLayerSourceCache(_);if("raster"!==_.type||b||!w)continue;const D=_.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const F=this.proxyToSource[A.key][w.id];if(F)for(const P of F){const O=Us(w.getTile(P),w.findLoadedParent(P,0),w,this.painter.transform,D);(1!==O.opacity||0!==O.mix)&&this._clearRenderCacheForTile(w.id,P)}}}}_setupDrapedRenderBatches(){const o=this._style.order,d=o.length;if(0===d)return;const _=[];let b,w=0,D=this._style._layers[o[w]];for(;!this._style.isLayerDraped(D)&&D.isHidden(this.painter.transform.zoom)&&++w<d;)D=this._style._layers[o[w]];for(;w<d;++w){const A=this._style._layers[o[w]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===b&&(b=w):void 0!==b&&(_.push({start:b,end:w-1}),b=void 0))}void 0!==b&&_.push({start:b,end:w-1}),this._drapedRenderBatches=_}_setupRenderCache(o){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const D=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let A=0;A<D.length;++A){const F=Object.values(D[A]);d.renderCachePool.push(...F)}}return}this._clearRasterFadeFromRenderCache();const _=this.proxyCoords,b=this._tilesDirty;for(let D=_.length-1;D>=0;D--){const A=_[D];if(d.getTileByID(A.key),void 0!==d.proxyCachedFBO[A.key]){const F=o[A.key],P=this.proxyToSource[A.key];let O=0;for(const z in P){const G=P[z],Z=F[z];if(!Z||Z.length!==G.length||G.some((H,U)=>H!==Z[U]||b[z]&&b[z].hasOwnProperty(H.key))){O=-1;break}++O}for(const z in d.proxyCachedFBO[A.key])d.renderCache[d.proxyCachedFBO[A.key][z]].dirty=O<0||O!==Object.values(F).length}}const w=[...this._drapedRenderBatches];w.sort((D,A)=>A.end-A.start-(D.end-D.start));for(const D of w)for(const A of _){if(d.proxyCachedFBO[A.key])continue;let F=d.renderCachePool.pop();void 0===F&&d.renderCache.length<50&&(F=d.renderCache.length,d.renderCache.push(this._createFBO())),void 0!==F&&(d.proxyCachedFBO[A.key]={},d.proxyCachedFBO[A.key][D.start]=F,d.renderCache[F].dirty=!0)}this._tilesDirty={}}_setupStencil(o,d,_,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,D=w.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let A;if(_.isTileClipped())A=d.length,this._overlapStencilMode.test={func:D.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:D.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(o.key)||0),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(o,d){const _=this.painter,b=this.painter.context,w=b.gl;_._tileClippingMaskIDs.clear(),b.setColorMode(p.ColorMode.disabled),b.setDepthMode(p.DepthMode.disabled);const D=_.useProgram("clippingMask");for(const A of o){const F=--d;_._tileClippingMaskIDs.set(A.key,F),D.draw(b,w.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:w.ALWAYS,mask:0},F,255,w.KEEP,w.KEEP,w.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Uc(A.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(o){const d=this.painter.transform;if(o.x<0||o.x>d.width||o.y<0||o.y>d.height)return null;const _=[o.x,o.y,1,1];p.transformMat4$1(_,_,d.pixelMatrixInverse),p.scale$1(_,_,1/_[3]),_[0]/=d.worldSize,_[1]/=d.worldSize;const b=d._camera.position,w=p.mercatorZfromAltitude(1,d.center.lat),D=[b[0],b[1],b[2]/w,0],A=p.subtract([],_.slice(0,3),D);p.normalize(A,A);const F=this.raycast(D,A,this._exaggeration);return null!==F&&F?(p.scaleAndAdd(D,D,A,F),D[3]=D[2],D[2]*=w,D):null}drawDepth(){const o=this.painter,d=o.context,_=this.proxySourceCache,b=Math.ceil(o.width),w=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const D=d.gl,A=d.createFramebuffer(b,w,!0);d.activeTexture.set(D.TEXTURE0);const F=new p.Texture(d,{width:b,height:w,data:null},D.RGBA);F.bind(D.NEAREST,D.CLAMP_TO_EDGE),A.colorAttachment.set(F.texture);const P=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,b,w);A.depthAttachment.set(P),this._depthFBO=A,this._depthTexture=F}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,b,w]),function(D,A,F,P){if("globe"===D.transform.projection.name)return;const O=D.context,z=O.gl;O.clear({depth:1});const G=D.useProgram("terrainDepth"),Z=new p.DepthMode(z.LESS,p.DepthMode.ReadWrite,D.depthRangeFor3D);for(const H of P){const U=F.getTile(H),ie=Tm(H.projMatrix,0);A.setupElevationDraw(U,G),G.draw(O,z.TRIANGLES,Z,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,ie,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(o,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,d,_){if(o.getSource()instanceof de)return this._setupProxiedCoordsForImageSource(o,d,_);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const b=this.proxiedCoords[o.id]=[],w=this.proxyCoords;for(let A=0;A<w.length;A++){const F=w[A],P=this._findTileCoveringTileID(F,o);if(P){const O=this._createProxiedId(F,P,_[F.key]&&_[F.key][o.id]);b.push(O),this.proxyToSource[F.key][o.id]=[O]}}let D=!1;for(let A=0;A<d.length;A++){const F=o.getTile(d[A]);if(!F||!F.hasData())continue;const P=this._findTileCoveringTileID(F.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==F.tileID.canonical.z){const O=this.proxyToSource[P.tileID.key][o.id],z=this._createProxiedId(P.tileID,F,_[P.tileID.key]&&_[P.tileID.key][o.id]);O?O.splice(O.length-1,0,z):this.proxyToSource[P.tileID.key][o.id]=[z],b.push(z),D=!0}}this._sourceTilesOverlap[o.id]=D}_setupProxiedCoordsForImageSource(o,d,_){if(!o.getSource().loaded())return;const b=this.proxiedCoords[o.id]=[],w=this.proxyCoords,D=o.getSource(),A=new p.pointGeometry(D.tileID.x,D.tileID.y)._div(1<<D.tileID.z),F=D.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((O,z)=>(O.min.x=Math.min(O.min.x,z.x-A.x),O.min.y=Math.min(O.min.y,z.y-A.y),O.max.x=Math.max(O.max.x,z.x-A.x),O.max.y=Math.max(O.max.y,z.y-A.y),O),{min:new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(O,z)=>{const G=O.wrap+O.canonical.x/(1<<O.canonical.z),Z=O.canonical.y/(1<<O.canonical.z),H=p.EXTENT/(1<<O.canonical.z),U=z.wrap+z.canonical.x/(1<<z.canonical.z),ie=z.canonical.y/(1<<z.canonical.z);return G+H<U+F.min.x||G>U+F.max.x||Z+H<ie+F.min.y||Z>ie+F.max.y};for(let O=0;O<w.length;O++){const z=w[O];for(let G=0;G<d.length;G++){const Z=o.getTile(d[G]);if(!Z||!Z.hasData()||P(z,Z.tileID))continue;const H=this._createProxiedId(z,Z,_[z.key]&&_[z.key][o.id]),U=this.proxyToSource[z.key][o.id];U?U.push(H):this.proxyToSource[z.key][o.id]=[H],b.push(H)}}}_createProxiedId(o,d,_){let b=this.orthoMatrix;if(_){const w=_.find(D=>D.key===d.tileID.key);if(w)return w}if(d.tileID.key!==o.key){const w=o.canonical.z-d.tileID.canonical.z;let D,A,F;b=p.create();const P=d.tileID.wrap-o.wrap<<o.overscaledZ;w>0?(D=p.EXTENT>>w,A=D*((d.tileID.canonical.x<<w)-o.canonical.x+P),F=D*((d.tileID.canonical.y<<w)-o.canonical.y)):(D=p.EXTENT<<-w,A=p.EXTENT*(d.tileID.canonical.x-(o.canonical.x+P<<-w)),F=p.EXTENT*(d.tileID.canonical.y-(o.canonical.y<<-w))),p.ortho(b,0,D,0,D,0,1),p.translate(b,b,[A,F,0])}return new sh(d.tileID,o.key,b)}_findTileCoveringTileID(o,d){let _=d.getTile(o);if(_&&_.hasData())return _;const b=this._findCoveringTileCache[d.id],w=b[o.key];if(_=w?d.getTileByID(w):null,_&&_.hasData()||null===w)return _;let D=_?_.tileID:o,A=D.overscaledZ;const F=d.getSource().minzoom,P=[];if(!w){const z=d.getSource().maxzoom;if(o.canonical.z>=z){const G=o.canonical.z-z;d.getSource().reparseOverscaled?(A=Math.max(o.canonical.z+2,d.transform.tileZoom),D=new p.OverscaledTileID(A,o.wrap,z,o.canonical.x>>G,o.canonical.y>>G)):0!==G&&(A=z,D=new p.OverscaledTileID(A,o.wrap,z,o.canonical.x>>G,o.canonical.y>>G))}D.key!==o.key&&(P.push(D.key),_=d.getTile(D))}const O=z=>{P.forEach(G=>{b[G]=z}),P.length=0};for(A-=1;A>=F&&(!_||!_.hasData());A--){_&&O(_.tileID.key);const z=D.calculateScaledKey(A);if(_=d.getTileByID(z),_&&_.hasData())break;const G=b[z];if(null===G)break;void 0===G?P.push(z):_=d.getTileByID(G)}return O(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,d){let _=this._tilesDirty[o];_||(_=this._tilesDirty[o]={}),_[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(d){let _=0;const b=new p.StructArrayLayout2ui4,w=131;for(let D=1;D<129;D++){for(let A=1;A<129;A++)_=D*w+A,b.emplaceBack(_,_+1),b.emplaceBack(_,_+w),b.emplaceBack(_+1,_+w),128===D&&b.emplaceBack(_+w,_+w+1);b.emplaceBack(_+1,_+1+w)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Hc(m){const o=[];for(let d=0;d<m.length;d++){if(null===m[d])continue;const _=m[d].split(" ");o.push(_.pop())}return o}class Nl{static cacheKey(o,d,_){let b=`${o}${_?_.cacheKey:""}`;for(const w of d)b+=`/${w}`;return b}constructor(o,d,_,b,w,D){const A=o.gl;this.program=A.createProgram();const F=Hc(_.staticAttributes),P=b?b.getBinderAttributes():[],O=F.concat(P),z=_.staticUniforms?Hc(_.staticUniforms):[],G=b?b.getBinderUniforms():[],Z=z.concat(G),H=[];for(const ee of Z)H.indexOf(ee)<0&&H.push(ee);let U=b?b.defines():[];U=U.concat(D.map(ee=>`#define ${ee}`));const ie=U.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Zu,Br.fragmentSource,vr.fragmentSource,_.fragmentSource).join("\n"),Y=U.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Zu,Br.vertexSource,vr.vertexSource,Bl.vertexSource,_.vertexSource).join("\n"),te=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(te,ie),A.compileShader(te),A.attachShader(this.program,te);const ne=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(ne,Y),A.compileShader(ne),A.attachShader(this.program,ne),this.attributes={};const oe={};this.numAttributes=O.length;for(let ee=0;ee<this.numAttributes;ee++)O[ee]&&(A.bindAttribLocation(this.program,ee,O[ee]),this.attributes[O[ee]]=ee);A.linkProgram(this.program),A.deleteShader(ne),A.deleteShader(te);for(let ee=0;ee<H.length;ee++){const ae=H[ee];if(ae&&!oe[ae]){const ve=A.getUniformLocation(this.program,ae);ve&&(oe[ae]=ve)}}var ee,ae;this.fixedUniforms=w(o,oe),this.binderUniforms=b?b.getUniforms(o,oe):[],-1!==D.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(ee=o,(ae=oe).u_dem),u_dem_prev:new p.Uniform1i(ee,ae.u_dem_prev),u_dem_unpack:new p.Uniform4f(ee,ae.u_dem_unpack),u_dem_tl:new p.Uniform2f(ee,ae.u_dem_tl),u_dem_scale:new p.Uniform1f(ee,ae.u_dem_scale),u_dem_tl_prev:new p.Uniform2f(ee,ae.u_dem_tl_prev),u_dem_scale_prev:new p.Uniform1f(ee,ae.u_dem_scale_prev),u_dem_size:new p.Uniform1f(ee,ae.u_dem_size),u_dem_lerp:new p.Uniform1f(ee,ae.u_dem_lerp),u_exaggeration:new p.Uniform1f(ee,ae.u_exaggeration),u_depth:new p.Uniform1i(ee,ae.u_depth),u_depth_size_inv:new p.Uniform2f(ee,ae.u_depth_size_inv),u_meter_to_dem:new p.Uniform1f(ee,ae.u_meter_to_dem),u_label_plane_matrix_inv:new p.UniformMatrix4f(ee,ae.u_label_plane_matrix_inv),u_tile_tl_up:new p.Uniform3f(ee,ae.u_tile_tl_up),u_tile_tr_up:new p.Uniform3f(ee,ae.u_tile_tr_up),u_tile_br_up:new p.Uniform3f(ee,ae.u_tile_br_up),u_tile_bl_up:new p.Uniform3f(ee,ae.u_tile_bl_up),u_tile_up_scale:new p.Uniform1f(ee,ae.u_tile_up_scale)}),-1!==D.indexOf("FOG")&&(this.fogUniforms=((ee,ae)=>({u_fog_matrix:new p.UniformMatrix4f(ee,ae.u_fog_matrix),u_fog_range:new p.Uniform2f(ee,ae.u_fog_range),u_fog_color:new p.Uniform4f(ee,ae.u_fog_color),u_fog_horizon_blend:new p.Uniform1f(ee,ae.u_fog_horizon_blend),u_fog_temporal_offset:new p.Uniform1f(ee,ae.u_fog_temporal_offset)}))(o,oe))}setTerrainUniformValues(o,d){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)_[b].set(d[b])}}setFogUniformValues(o,d){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)_[b].location&&_[b].set(d[b])}}draw(o,d,_,b,w,D,A,F,P,O,z,G,Z,H,U,ie){const Y=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(_),o.setStencilMode(b),o.setColorMode(w),o.setCullFace(D);for(const ne of Object.keys(this.fixedUniforms))this.fixedUniforms[ne].set(A[ne]);H&&H.setUniforms(o,this.binderUniforms,G,{zoom:Z});const te={[Y.LINES]:2,[Y.TRIANGLES]:3,[Y.LINE_STRIP]:1}[d];for(const ne of z.get()){const oe=ne.vaos||(ne.vaos={});(oe[F]||(oe[F]=new Ku)).bind(o,this,P,H?H.getPaintVertexBuffers():[],O,ne.vertexOffset,U,ie),Y.drawElements(d,ne.primitiveLength*te,Y.UNSIGNED_SHORT,ne.primitiveOffset*te*2)}}}function Kt(m,o,d){const _=1/Ji(d,1,o.transform.tileZoom),b=Math.pow(2,d.tileID.overscaledZ),w=d.tileSize*Math.pow(2,o.transform.tileZoom)/b,D=w*(d.tileID.canonical.x+d.tileID.wrap*b),A=w*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[_,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[D>>16,A>>16],u_pixel_coord_lower:[65535&D,65535&A]}}const oh=p.create(),qc=(m,o,d,_,b,w,D,A,F)=>{const P=o.style.light,O=P.properties.get("position"),z=[O.x,O.y,O.z],G=p.create$1();"viewport"===P.properties.get("anchor")&&(p.fromRotation(G,-o.transform.angle),p.transformMat3(z,z,G));const Z=P.properties.get("color"),H=o.transform,U={u_matrix:m,u_lightpos:z,u_lightintensity:P.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+d,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:oh,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===H.projection.name&&(U.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],U.u_zoom_transition=D,U.u_inv_rot_matrix=F,U.u_merc_center=A,U.u_up_dir=H.projection.upVector(new p.CanonicalTileID(0,0,0),A[0]*p.EXTENT,A[1]*p.EXTENT),U.u_height_lift=w),U},je=(m,o,d,_,b,w,D,A,F,P,O)=>{const z=qc(m,o,d,_,b,A,F,P,O),G={u_height_factor:-Math.pow(2,b.overscaledZ)/D.tileSize/8};return p.extend(z,Kt(w,o,D),G)},er=m=>({u_matrix:m}),Oi=(m,o,d,_)=>p.extend(er(m),Kt(d,o,_)),Gs=(m,o)=>({u_matrix:m,u_world:o}),va=(m,o,d,_,b)=>p.extend(Oi(m,o,d,_),{u_world:b}),ns=p.create(),Fo=(m,o,d,_,b,w)=>{const D=m.transform,A="globe"===D.projection.name;let F;if("map"===w.paint.get("circle-pitch-alignment"))if(A){const O=p.globePixelsToTileUnits(D.zoom,o.canonical);F=Float32Array.from([O,0,0,O])}else F=D.calculatePixelsToTileUnitsMatrix(d);else F=new Float32Array([D.pixelsToGLUnits[0],0,0,D.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:D.cameraToCenterDistance,u_matrix:m.translatePosMatrix(o.projMatrix,d,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:F,u_inv_rot_matrix:ns,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return A&&(P.u_inv_rot_matrix=_,P.u_merc_center=b,P.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],P.u_zoom_transition=p.globeToMercatorTransition(D.zoom),P.u_up_dir=D.projection.upVector(o.canonical,b[0],b[1])),P},ah=m=>{const o=[];return"map"===m.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===m.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o},Wc=(m,o,d)=>{const _=p.EXTENT/d.tileSize;return{u_matrix:m,u_camera_to_center_distance:o.cameraToCenterDistance,u_extrude_scale:[o.pixelsToGLUnits[0]/_,o.pixelsToGLUnits[1]/_]}},Zc=(m,o,d=1)=>({u_matrix:m,u_color:o,u_overlay:0,u_overlay_scale:d}),nl=p.create(),ur=(m,o,d,_,b,w,D)=>{const A=m.transform,F="globe"===A.projection.name,P=F?p.globePixelsToTileUnits(A.zoom,o.canonical):Ji(d,1,w),O={u_matrix:o.projMatrix,u_extrude_scale:P,u_intensity:D,u_inv_rot_matrix:nl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return F&&(O.u_inv_rot_matrix=_,O.u_merc_center=b,O.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],O.u_zoom_transition=p.globeToMercatorTransition(A.zoom),O.u_up_dir=A.projection.upVector(o.canonical,b[0],b[1])),O},Im=(m,o,d,_,b,w,D)=>{const A=m.transform,F=A.calculatePixelsToTileUnitsMatrix(o),P={u_matrix:qt(m,o,d,b),u_pixels_to_tile_units:F,u_device_pixel_ratio:D,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:w,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Qn(d)){const O=ut(o,m.transform);P.u_texsize=o.lineAtlasTexture.size,P.u_scale=[O,_.fromScale,_.toScale],P.u_mix=_.t}return P},zr=(m,o,d,_,b,w)=>{const D=m.transform,A=ut(o,D);return{u_matrix:qt(m,o,d,b),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:D.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:w,u_image:0,u_scale:[A,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ut(m,o){return 1/Ji(m,1,o.tileZoom)}function qt(m,o,d,_){return m.translatePosMatrix(_||o.tileID.projMatrix,o,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function Qn(m){const o=m.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}const Vr=(m,o,d,_,b,w)=>{return{u_matrix:m,u_tl_parent:o,u_scale_parent:d,u_fade_t:_.mix,u_opacity:_.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(A=b.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(D=b.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:Ro(b.paint.get("raster-hue-rotate")),u_perspective_transform:w};var D,A};function Ro(m){m*=Math.PI/180;const o=Math.sin(m),d=Math.cos(m);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const si=p.create(),Po=(m,o,d,_,b,w,D,A,F,P,O,z,G,Z)=>{const H=b.transform,U={u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:H.width/H.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:D,u_coord_matrix:A,u_is_text:+F,u_pitch_with_map:+_,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:si,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:si};return"globe"===H.projection.name&&(U.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],U.u_zoom_transition=z,U.u_inv_rot_matrix=Z,U.u_merc_center=G,U.u_camera_forward=H._camera.forward(),U.u_ecef_origin=p.globeECEFOrigin(H.globeMatrix,O.toUnwrapped()),U.u_tile_matrix=Float32Array.from(H.globeMatrix)),U},Xn=(m,o,d,_,b,w,D,A,F,P,O,z,G,Z,H)=>{const{cameraToCenterDistance:U,_pitch:ie}=b.transform;return p.extend(Po(m,o,d,_,b,w,D,A,F,P,z,G,Z,H),{u_gamma_scale:_?U*Math.cos(b.terrain?0:ie):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+O})},po=(m,o,d,_,b,w,D,A,F,P,O,z,G,Z)=>p.extend(Xn(m,o,d,_,b,w,D,A,!0,F,!0,O,z,G,Z),{u_texsize_icon:P,u_texture_icon:1}),il=(m,o,d)=>({u_matrix:m,u_opacity:o,u_color:d}),Zt=(m,o,d,_,b,w)=>p.extend(function(D,A,F,P){const O=F.imageManager.getPattern(D.from.toString()),z=F.imageManager.getPattern(D.to.toString()),{width:G,height:Z}=F.imageManager.getPixelSize(),H=Math.pow(2,P.tileID.overscaledZ),U=P.tileSize*Math.pow(2,F.transform.tileZoom)/H,ie=U*(P.tileID.canonical.x+P.tileID.wrap*H),Y=U*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[G,Z],u_mix:A.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/Ji(P,1,F.transform.tileZoom),u_pixel_coord_upper:[ie>>16,Y>>16],u_pixel_coord_lower:[65535&ie,65535&Y]}}(_,w,d,b),{u_matrix:m,u_opacity:o}),hn={fillExtrusion:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_lightpos:new p.Uniform3f(m,o.u_lightpos),u_lightintensity:new p.Uniform1f(m,o.u_lightintensity),u_lightcolor:new p.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new p.Uniform1f(m,o.u_vertical_gradient),u_opacity:new p.Uniform1f(m,o.u_opacity),u_tile_id:new p.Uniform3f(m,o.u_tile_id),u_zoom_transition:new p.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new p.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(m,o.u_merc_center),u_up_dir:new p.Uniform3f(m,o.u_up_dir),u_height_lift:new p.Uniform1f(m,o.u_height_lift)}),fillExtrusionPattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_lightpos:new p.Uniform3f(m,o.u_lightpos),u_lightintensity:new p.Uniform1f(m,o.u_lightintensity),u_lightcolor:new p.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new p.Uniform1f(m,o.u_vertical_gradient),u_height_factor:new p.Uniform1f(m,o.u_height_factor),u_tile_id:new p.Uniform3f(m,o.u_tile_id),u_zoom_transition:new p.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new p.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(m,o.u_merc_center),u_up_dir:new p.Uniform3f(m,o.u_up_dir),u_height_lift:new p.Uniform1f(m,o.u_height_lift),u_image:new p.Uniform1i(m,o.u_image),u_texsize:new p.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new p.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new p.Uniform3f(m,o.u_scale),u_fade:new p.Uniform1f(m,o.u_fade),u_opacity:new p.Uniform1f(m,o.u_opacity)}),fill:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix)}),fillPattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_image:new p.Uniform1i(m,o.u_image),u_texsize:new p.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new p.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new p.Uniform3f(m,o.u_scale),u_fade:new p.Uniform1f(m,o.u_fade)}),fillOutline:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_world:new p.Uniform2f(m,o.u_world)}),fillOutlinePattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_world:new p.Uniform2f(m,o.u_world),u_image:new p.Uniform1i(m,o.u_image),u_texsize:new p.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new p.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new p.Uniform3f(m,o.u_scale),u_fade:new p.Uniform1f(m,o.u_fade)}),circle:(m,o)=>({u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_extrude_scale:new p.UniformMatrix2f(m,o.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_inv_rot_matrix:new p.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(m,o.u_merc_center),u_tile_id:new p.Uniform3f(m,o.u_tile_id),u_zoom_transition:new p.Uniform1f(m,o.u_zoom_transition),u_up_dir:new p.Uniform3f(m,o.u_up_dir)}),collisionBox:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_extrude_scale:new p.Uniform2f(m,o.u_extrude_scale)}),collisionCircle:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_inv_matrix:new p.UniformMatrix4f(m,o.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(m,o.u_viewport_size)}),debug:(m,o)=>({u_color:new p.UniformColor(m,o.u_color),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_overlay:new p.Uniform1i(m,o.u_overlay),u_overlay_scale:new p.Uniform1f(m,o.u_overlay_scale)}),clippingMask:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix)}),heatmap:(m,o)=>({u_extrude_scale:new p.Uniform1f(m,o.u_extrude_scale),u_intensity:new p.Uniform1f(m,o.u_intensity),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_inv_rot_matrix:new p.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(m,o.u_merc_center),u_tile_id:new p.Uniform3f(m,o.u_tile_id),u_zoom_transition:new p.Uniform1f(m,o.u_zoom_transition),u_up_dir:new p.Uniform3f(m,o.u_up_dir)}),heatmapTexture:(m,o)=>({u_image:new p.Uniform1i(m,o.u_image),u_color_ramp:new p.Uniform1i(m,o.u_color_ramp),u_opacity:new p.Uniform1f(m,o.u_opacity)}),hillshade:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_image:new p.Uniform1i(m,o.u_image),u_latrange:new p.Uniform2f(m,o.u_latrange),u_light:new p.Uniform2f(m,o.u_light),u_shadow:new p.UniformColor(m,o.u_shadow),u_highlight:new p.UniformColor(m,o.u_highlight),u_accent:new p.UniformColor(m,o.u_accent)}),hillshadePrepare:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_image:new p.Uniform1i(m,o.u_image),u_dimension:new p.Uniform2f(m,o.u_dimension),u_zoom:new p.Uniform1f(m,o.u_zoom),u_unpack:new p.Uniform4f(m,o.u_unpack)}),line:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_pixels_to_tile_units:new p.UniformMatrix2f(m,o.u_pixels_to_tile_units),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(m,o.u_units_to_pixels),u_dash_image:new p.Uniform1i(m,o.u_dash_image),u_gradient_image:new p.Uniform1i(m,o.u_gradient_image),u_image_height:new p.Uniform1f(m,o.u_image_height),u_texsize:new p.Uniform2f(m,o.u_texsize),u_scale:new p.Uniform3f(m,o.u_scale),u_mix:new p.Uniform1f(m,o.u_mix),u_alpha_discard_threshold:new p.Uniform1f(m,o.u_alpha_discard_threshold)}),linePattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_texsize:new p.Uniform2f(m,o.u_texsize),u_pixels_to_tile_units:new p.UniformMatrix2f(m,o.u_pixels_to_tile_units),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_image:new p.Uniform1i(m,o.u_image),u_units_to_pixels:new p.Uniform2f(m,o.u_units_to_pixels),u_scale:new p.Uniform3f(m,o.u_scale),u_fade:new p.Uniform1f(m,o.u_fade),u_alpha_discard_threshold:new p.Uniform1f(m,o.u_alpha_discard_threshold)}),raster:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_tl_parent:new p.Uniform2f(m,o.u_tl_parent),u_scale_parent:new p.Uniform1f(m,o.u_scale_parent),u_fade_t:new p.Uniform1f(m,o.u_fade_t),u_opacity:new p.Uniform1f(m,o.u_opacity),u_image0:new p.Uniform1i(m,o.u_image0),u_image1:new p.Uniform1i(m,o.u_image1),u_brightness_low:new p.Uniform1f(m,o.u_brightness_low),u_brightness_high:new p.Uniform1f(m,o.u_brightness_high),u_saturation_factor:new p.Uniform1f(m,o.u_saturation_factor),u_contrast_factor:new p.Uniform1f(m,o.u_contrast_factor),u_spin_weights:new p.Uniform3f(m,o.u_spin_weights),u_perspective_transform:new p.Uniform2f(m,o.u_perspective_transform)}),symbolIcon:(m,o)=>({u_is_size_zoom_constant:new p.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new p.Uniform1f(m,o.u_size_t),u_size:new p.Uniform1f(m,o.u_size),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_rotate_symbol:new p.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new p.Uniform1f(m,o.u_fade_change),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new p.Uniform1i(m,o.u_is_text),u_pitch_with_map:new p.Uniform1i(m,o.u_pitch_with_map),u_texsize:new p.Uniform2f(m,o.u_texsize),u_tile_id:new p.Uniform3f(m,o.u_tile_id),u_zoom_transition:new p.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new p.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(m,o.u_merc_center),u_camera_forward:new p.Uniform3f(m,o.u_camera_forward),u_tile_matrix:new p.UniformMatrix4f(m,o.u_tile_matrix),u_ecef_origin:new p.Uniform3f(m,o.u_ecef_origin),u_texture:new p.Uniform1i(m,o.u_texture)}),symbolSDF:(m,o)=>({u_is_size_zoom_constant:new p.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new p.Uniform1f(m,o.u_size_t),u_size:new p.Uniform1f(m,o.u_size),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_rotate_symbol:new p.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new p.Uniform1f(m,o.u_fade_change),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new p.Uniform1i(m,o.u_is_text),u_pitch_with_map:new p.Uniform1i(m,o.u_pitch_with_map),u_texsize:new p.Uniform2f(m,o.u_texsize),u_texture:new p.Uniform1i(m,o.u_texture),u_gamma_scale:new p.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_tile_id:new p.Uniform3f(m,o.u_tile_id),u_zoom_transition:new p.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new p.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(m,o.u_merc_center),u_camera_forward:new p.Uniform3f(m,o.u_camera_forward),u_tile_matrix:new p.UniformMatrix4f(m,o.u_tile_matrix),u_ecef_origin:new p.Uniform3f(m,o.u_ecef_origin),u_is_halo:new p.Uniform1i(m,o.u_is_halo)}),symbolTextAndIcon:(m,o)=>({u_is_size_zoom_constant:new p.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new p.Uniform1f(m,o.u_size_t),u_size:new p.Uniform1f(m,o.u_size),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_rotate_symbol:new p.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new p.Uniform1f(m,o.u_fade_change),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new p.Uniform1i(m,o.u_is_text),u_pitch_with_map:new p.Uniform1i(m,o.u_pitch_with_map),u_texsize:new p.Uniform2f(m,o.u_texsize),u_texsize_icon:new p.Uniform2f(m,o.u_texsize_icon),u_texture:new p.Uniform1i(m,o.u_texture),u_texture_icon:new p.Uniform1i(m,o.u_texture_icon),u_gamma_scale:new p.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(m,o.u_is_halo)}),background:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_opacity:new p.Uniform1f(m,o.u_opacity),u_color:new p.UniformColor(m,o.u_color)}),backgroundPattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_opacity:new p.Uniform1f(m,o.u_opacity),u_image:new p.Uniform1i(m,o.u_image),u_pattern_tl_a:new p.Uniform2f(m,o.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(m,o.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(m,o.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(m,o.u_pattern_br_b),u_texsize:new p.Uniform2f(m,o.u_texsize),u_mix:new p.Uniform1f(m,o.u_mix),u_pattern_size_a:new p.Uniform2f(m,o.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(m,o.u_pattern_size_b),u_scale_a:new p.Uniform1f(m,o.u_scale_a),u_scale_b:new p.Uniform1f(m,o.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,o.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(m,o.u_tile_units_to_pixels)}),terrainRaster:qf,terrainDepth:qf,skybox:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_sun_direction:new p.Uniform3f(m,o.u_sun_direction),u_cubemap:new p.Uniform1i(m,o.u_cubemap),u_opacity:new p.Uniform1f(m,o.u_opacity),u_temporal_offset:new p.Uniform1f(m,o.u_temporal_offset)}),skyboxGradient:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_color_ramp:new p.Uniform1i(m,o.u_color_ramp),u_center_direction:new p.Uniform3f(m,o.u_center_direction),u_radius:new p.Uniform1f(m,o.u_radius),u_opacity:new p.Uniform1f(m,o.u_opacity),u_temporal_offset:new p.Uniform1f(m,o.u_temporal_offset)}),skyboxCapture:(m,o)=>({u_matrix_3f:new p.UniformMatrix3f(m,o.u_matrix_3f),u_sun_direction:new p.Uniform3f(m,o.u_sun_direction),u_sun_intensity:new p.Uniform1f(m,o.u_sun_intensity),u_color_tint_r:new p.Uniform4f(m,o.u_color_tint_r),u_color_tint_m:new p.Uniform4f(m,o.u_color_tint_m),u_luminance:new p.Uniform1f(m,o.u_luminance)}),globeRaster:(m,o)=>({u_proj_matrix:new p.UniformMatrix4f(m,o.u_proj_matrix),u_globe_matrix:new p.UniformMatrix4f(m,o.u_globe_matrix),u_merc_matrix:new p.UniformMatrix4f(m,o.u_merc_matrix),u_zoom_transition:new p.Uniform1f(m,o.u_zoom_transition),u_merc_center:new p.Uniform2f(m,o.u_merc_center),u_image0:new p.Uniform1i(m,o.u_image0),u_grid_matrix:new p.UniformMatrix3f(m,o.u_grid_matrix)}),globeAtmosphere:(m,o)=>({u_frustum_tl:new p.Uniform3f(m,o.u_frustum_tl),u_frustum_tr:new p.Uniform3f(m,o.u_frustum_tr),u_frustum_br:new p.Uniform3f(m,o.u_frustum_br),u_frustum_bl:new p.Uniform3f(m,o.u_frustum_bl),u_globe_pos:new p.Uniform3f(m,o.u_globe_pos),u_globe_radius:new p.Uniform1f(m,o.u_globe_radius),u_opacity:new p.Uniform1f(m,o.u_opacity),u_fadeout_range:new p.Uniform1f(m,o.u_fadeout_range),u_start_color:new p.Uniform3f(m,o.u_start_color),u_end_color:new p.Uniform3f(m,o.u_end_color)})};let Cs;function Yu(m,o,d,_,b,w,D){const A=m.context,F=A.gl,P=m.useProgram("collisionBox"),O=[];let z=0,G=0;for(let ne=0;ne<_.length;ne++){const oe=_[ne],ee=o.getTile(oe),ae=ee.getBucket(d);if(!ae)continue;let ve=oe.projMatrix;0===b[0]&&0===b[1]||(ve=m.translatePosMatrix(oe.projMatrix,ee,b,w));const Me=D?ae.textCollisionBox:ae.iconCollisionBox,Fe=ae.collisionCircleArray;if(Fe.length>0){const Te=p.create(),Ze=ve;p.mul(Te,ae.placementInvProjMatrix,m.transform.glCoordMatrix),p.mul(Te,Te,ae.placementViewportMatrix),O.push({circleArray:Fe,circleOffset:G,transform:Ze,invTransform:Te}),z+=Fe.length/4,G=z}Me&&(m.terrain&&m.terrain.setupElevationDraw(ee,P),P.draw(A,F.LINES,p.DepthMode.disabled,p.StencilMode.disabled,m.colorModeForRenderPass(),p.CullFaceMode.disabled,Wc(ve,m.transform,ee),d.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,null,m.transform.zoom,null,Me.collisionVertexBuffer,Me.collisionVertexBufferExt))}if(!D||!O.length)return;const Z=m.useProgram("collisionCircle"),H=new p.StructArrayLayout2f1f2i16;H.resize(4*z),H._trim();let U=0;for(const ne of O)for(let oe=0;oe<ne.circleArray.length/4;oe++){const ee=4*oe,ae=ne.circleArray[ee+0],ve=ne.circleArray[ee+1],Me=ne.circleArray[ee+2],Fe=ne.circleArray[ee+3];H.emplace(U++,ae,ve,Me,Fe,0),H.emplace(U++,ae,ve,Me,Fe,1),H.emplace(U++,ae,ve,Me,Fe,2),H.emplace(U++,ae,ve,Me,Fe,3)}(!Cs||Cs.length<2*z)&&(Cs=function(ne){const oe=2*ne,ee=new p.StructArrayLayout3ui6;ee.resize(oe),ee._trim();for(let ae=0;ae<oe;ae++){const ve=6*ae;ee.uint16[ve+0]=4*ae+0,ee.uint16[ve+1]=4*ae+1,ee.uint16[ve+2]=4*ae+2,ee.uint16[ve+3]=4*ae+2,ee.uint16[ve+4]=4*ae+3,ee.uint16[ve+5]=4*ae+0}return ee}(z));const ie=A.createIndexBuffer(Cs,!0),Y=A.createVertexBuffer(H,p.collisionCircleLayout.members,!0);for(const ne of O){const oe={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(te=m.transform).cameraToCenterDistance,u_viewport_size:[te.width,te.height]};Z.draw(A,F.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,m.colorModeForRenderPass(),p.CullFaceMode.disabled,oe,d.id,Y,ie,p.SegmentVector.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,m.transform.zoom,null,null,null)}var te;Y.destroy(),ie.destroy()}const xa=p.create();function $i(m,o,d,_,b,w){const{horizontalAlign:D,verticalAlign:A}=p.getAnchorAlignment(m),F=-(D-.5)*o,P=-(A-.5)*d,O=p.evaluateVariableOffset(m,_);return new p.pointGeometry((F/b+O[0])*w,(P/b+O[1])*w)}function Xc(m,o,d,_,b,w,D,A,F,P,O,z){const G=m.text.placedSymbolArray,Z=m.text.dynamicLayoutVertexArray,H=m.icon.dynamicLayoutVertexArray,U={},ie=A.projMatrix,Y=w.elevation,te=z.upVectorScale(A.canonical,w.center.lat,w.worldSize);Z.clear();for(let ne=0;ne<G.length;ne++){const oe=G.get(ne),ee=m.allowVerticalPlacement&&!oe.placedOrientation,ae=oe.hidden||!oe.crossTileID||ee?null:_[oe.crossTileID];if(ae){const ve=new p.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),Me=z.upVector(A.canonical,ve.x,ve.y),Fe=Y?Y.getAtTileOffset(A,ve.x,ve.y):0,Te=Pr([oe.projectedAnchorX+Fe*Me[0]*te.metersToTile,oe.projectedAnchorY+Fe*Me[1]*te.metersToTile,oe.projectedAnchorZ+Fe*Me[2]*te.metersToTile],d?ie:D),Ze=ni(w.cameraToCenterDistance,Te.signedDistanceFromCamera);let ye=b.evaluateSizeForFeature(m.textSizeData,P,oe)*Ze/p.ONE_EM;d&&(ye*=m.tilePixelRatio/F);const{width:He,height:Ue,anchor:rt,textOffset:Re,textScale:st}=ae,ft=$i(rt,He,Ue,Re,st,ye),at=d?Wt(ve.add(ft),D,Fe*te.metersToLabelSpace).point:Te.point.add(o?ft.rotate(-w.angle):ft),nt=m.allowVerticalPlacement&&oe.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let vt=0;vt<oe.numGlyphs;vt++)p.addDynamicAttributes(Z,at,nt);O&&oe.associatedIconIndex>=0&&(U[oe.associatedIconIndex]={shiftedAnchor:at,angle:nt})}else Pi(oe.numGlyphs,Z)}if(O){H.clear();const ne=m.icon.placedSymbolArray;for(let oe=0;oe<ne.length;oe++){const ee=ne.get(oe);if(ee.hidden)Pi(ee.numGlyphs,H);else{const ae=U[oe];if(ae)for(let ve=0;ve<ee.numGlyphs;ve++)p.addDynamicAttributes(H,ae.shiftedAnchor,ae.angle);else Pi(ee.numGlyphs,H)}}m.icon.dynamicLayoutVertexBuffer.updateData(H)}m.text.dynamicLayoutVertexBuffer.updateData(Z)}function zl(m,o,d){return d.iconsInText&&o?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function is(m,o,d,_,b,w,D,A,F,P,O,z){const G=m.context,Z=G.gl,H=m.transform,U="map"===A,ie="map"===F,Y=U&&"point"!==d.layout.get("symbol-placement"),te=U&&!ie&&!Y,ne=void 0!==d.layout.get("symbol-sort-key").constantOr(1);let oe=!1;const ee=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),ae=[p.mercatorXfromLng(H.center.lng),p.mercatorYfromLat(H.center.lat)],ve=d.layout.get("text-variable-anchor"),Me="globe"===H.projection.name,Fe=Me?p.globeToMercatorTransition(H.zoom):0,Te=[],Ze=[];m.terrain&&ie&&Ze.push("PITCH_WITH_MAP_TERRAIN"),Me&&Ze.push("PROJECTION_GLOBE_VIEW");for(const ye of _){const He=o.getTile(ye),Ue=He.getBucket(d);if(!Ue||Ue.projection!==H.projection.name)continue;const rt=b?Ue.text:Ue.icon;if(!rt||Ue.fullyClipped||!rt.segments.get().length)continue;const Re=rt.programConfigurations.get(d.id),st=b||Ue.sdfIcons,ft=b?Ue.textSizeData:Ue.iconSizeData,at=ie||0!==H.pitch,nt=p.evaluateSizeForZoom(ft,H.zoom);let vt,It,yt,Dt,rn=[0,0],oi=null;if(b){if(It=He.glyphAtlasTexture,yt=Z.LINEAR,vt=He.glyphAtlasTexture.size,Ue.iconsInText){rn=He.imageAtlasTexture.size,oi=He.imageAtlasTexture;const ls="composite"===ft.kind||"camera"===ft.kind;Dt=at||m.options.rotating||m.options.zooming||ls?Z.LINEAR:Z.NEAREST}}else{const ls=1!==d.layout.get("icon-size").constantOr(0)||Ue.iconsNeedLinear;It=He.imageAtlasTexture,yt=st||m.options.rotating||m.options.zooming||ls||at?Z.LINEAR:Z.NEAREST,vt=He.imageAtlasTexture.size}const hr=m.transform.calculatePixelsToTileUnitsMatrix(He),Si=Mn(ye.projMatrix,He.tileID.canonical,ie,U,m.transform,hr),wr=m.terrain&&ie&&Y?p.invert(p.create(),Si):xa,os=ga(ye.projMatrix,He.tileID.canonical,ie,U,m.transform,hr),Ds=ve&&Ue.hasTextData(),Zs="none"!==d.layout.get("icon-text-fit")&&Ds&&Ue.hasIconData();if(Y){const ls=H.elevation,Ca=ls?ls.getAtTileOffsetFunc(ye,H.center.lat,H.worldSize,H.projection):Ch=>[0,0,0];Ut(Ue,ye.projMatrix,m,b,Si,os,ie,P,Ca,ye)}const Uo=Y||b&&ve||Zs,ai=m.translatePosMatrix(ye.projMatrix,He,w,D),di=Uo?xa:Si,_n=m.translatePosMatrix(os,He,w,D,!0),yi=H.projection.createInversionMatrix(H,ye.canonical),as=Uo?Ze.concat(["PROJECTED_POS_ON_VIEWPORT"]):Ze,li=st&&0!==d.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1);let Cr;Cr=st?Ue.iconsInText?po(ft.kind,nt,te,ie,m,ai,di,_n,vt,rn,ye,Fe,ae,yi):Xn(ft.kind,nt,te,ie,m,ai,di,_n,b,vt,!0,ye,Fe,ae,yi):Po(ft.kind,nt,te,ie,m,ai,di,_n,b,vt,ye,Fe,ae,yi);const Go={program:m.useProgram(zl(st,b,Ue),Re,as),buffers:rt,uniformValues:Cr,atlasTexture:It,atlasTextureIcon:oi,atlasInterpolation:yt,atlasInterpolationIcon:Dt,isSDF:st,hasHalo:li,tile:He,labelPlaneMatrixInv:wr};if(ne&&Ue.canOverlap){oe=!0;const ls=rt.segments.get();for(const Ca of ls)Te.push({segments:new p.SegmentVector([Ca]),sortKey:Ca.sortKey,state:Go})}else Te.push({segments:rt.segments,sortKey:0,state:Go})}oe&&Te.sort((ye,He)=>ye.sortKey-He.sortKey);for(const ye of Te){const He=ye.state;if(m.terrain&&m.terrain.setupElevationDraw(He.tile,He.program,{useDepthForOcclusion:!Me,labelPlaneMatrixInv:He.labelPlaneMatrixInv}),G.activeTexture.set(Z.TEXTURE0),He.atlasTexture.bind(He.atlasInterpolation,Z.CLAMP_TO_EDGE),He.atlasTextureIcon&&(G.activeTexture.set(Z.TEXTURE1),He.atlasTextureIcon&&He.atlasTextureIcon.bind(He.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),He.isSDF){const Ue=He.uniformValues;He.hasHalo&&(Ue.u_is_halo=1,Kn(He.buffers,ye.segments,d,m,He.program,ee,O,z,Ue)),Ue.u_is_halo=0}Kn(He.buffers,ye.segments,d,m,He.program,ee,O,z,He.uniformValues)}}function Kn(m,o,d,_,b,w,D,A,F){const P=_.context;b.draw(P,P.gl.TRIANGLES,w,D,A,p.CullFaceMode.disabled,F,d.id,m.layoutVertexBuffer,m.indexBuffer,o,d.paint,_.transform.zoom,m.programConfigurations.get(d.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Qu(m,o,d,_,b,w,D){const A=m.context.gl,F=d.paint.get("fill-pattern"),P=F&&F.constantOr(1),O=d.getCrossfadeParameters();let z,G,Z,H,U;D?(G=P&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=A.LINES):(G=P?"fillPattern":"fill",z=A.TRIANGLES);for(const ie of _){const Y=o.getTile(ie);if(P&&!Y.patternsLoaded())continue;const te=Y.getBucket(d);if(!te)continue;m.prepareDrawTile();const ne=te.programConfigurations.get(d.id),oe=m.useProgram(G,ne);P&&(m.context.activeTexture.set(A.TEXTURE0),Y.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ne.updatePaintBuffers(O));const ee=F.constantOr(null);if(ee&&Y.imageAtlas){const ve=Y.imageAtlas,Me=ve.patternPositions[ee.to.toString()],Fe=ve.patternPositions[ee.from.toString()];Me&&Fe&&ne.setConstantPatternPositions(Me,Fe)}const ae=m.translatePosMatrix(ie.projMatrix,Y,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(D){H=te.indexBuffer2,U=te.segments2;const ve=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];Z="fillOutlinePattern"===G&&P?va(ae,m,O,Y,ve):Gs(ae,ve)}else H=te.indexBuffer,U=te.segments,Z=P?Oi(ae,m,O,Y):er(ae);m.prepareDrawProgram(m.context,oe,ie.toUnwrapped()),oe.draw(m.context,z,b,m.stencilModeForClipping(ie),w,p.CullFaceMode.disabled,Z,d.id,te.layoutVertexBuffer,H,U,d.paint,m.transform.zoom,ne)}}function Vl(m,o,d,_,b,w,D){const A=m.context,F=A.gl,P=m.transform,O=d.paint.get("fill-extrusion-pattern"),z=O.constantOr(1),G=d.getCrossfadeParameters(),Z=d.paint.get("fill-extrusion-opacity"),H=function(ne){if("globe"!==ne.projection.name)return 0;const oe=Math.PI/32,ee=Math.tan(oe),ae=p.earthRadius;return ae*Math.sqrt(1+2*ee*ee)-ae}(P),U="globe"===P.projection.name,ie=U?p.globeToMercatorTransition(P.zoom):0,Y=[p.mercatorXfromLng(P.center.lng),p.mercatorYfromLat(P.center.lat)],te=[];U&&te.push("PROJECTION_GLOBE_VIEW");for(const ne of _){const oe=o.getTile(ne),ee=oe.getBucket(d);if(!ee||ee.projection!==P.projection.name)continue;const ae=ee.programConfigurations.get(d.id),ve=m.useProgram(z?"fillExtrusionPattern":"fillExtrusion",ae,te);if(m.terrain){const He=m.terrain;if(m.style.terrainSetForDrapingOnly())He.setupElevationDraw(oe,ve,{useMeterToDem:!0});else{if(!ee.enableTerrain)continue;if(He.setupElevationDraw(oe,ve,{useMeterToDem:!0}),jr(A,o,ne,ee,d,He),!ee.centroidVertexBuffer){const Ue=ve.attributes.a_centroid_pos;void 0!==Ue&&F.vertexAttrib2f(Ue,0,0)}}}z&&(m.context.activeTexture.set(F.TEXTURE0),oe.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),ae.updatePaintBuffers(G));const Me=O.constantOr(null);if(Me&&oe.imageAtlas){const He=oe.imageAtlas,Ue=He.patternPositions[Me.to.toString()],rt=He.patternPositions[Me.from.toString()];Ue&&rt&&ae.setConstantPatternPositions(Ue,rt)}const Fe=m.translatePosMatrix(ne.projMatrix,oe,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Te=P.projection.createInversionMatrix(P,ne.canonical),Ze=d.paint.get("fill-extrusion-vertical-gradient"),ye=z?je(Fe,m,Ze,Z,ne,G,oe,H,ie,Y,Te):qc(Fe,m,Ze,Z,ne,H,ie,Y,Te);m.prepareDrawProgram(A,ve,ne.toUnwrapped()),ve.draw(A,A.gl.TRIANGLES,b,w,D,p.CullFaceMode.backCCW,ye,d.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,d.paint,m.transform.zoom,ae,m.terrain?ee.centroidVertexBuffer:null,U?ee.layoutVertexExtBuffer:null)}}function jr(m,o,d,_,b,w){const D=[Y=>{let te=Y.canonical.x-1,ne=Y.wrap;return te<0&&(te=(1<<Y.canonical.z)-1,ne--),new p.OverscaledTileID(Y.overscaledZ,ne,Y.canonical.z,te,Y.canonical.y)},Y=>{let te=Y.canonical.x+1,ne=Y.wrap;return te===1<<Y.canonical.z&&(te=0,ne++),new p.OverscaledTileID(Y.overscaledZ,ne,Y.canonical.z,te,Y.canonical.y)},Y=>new p.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,(0===Y.canonical.y?1<<Y.canonical.z:Y.canonical.y)-1),Y=>new p.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y===(1<<Y.canonical.z)-1?0:Y.canonical.y+1)],A=Y=>{const te=o.getSource().minzoom,ne=ee=>{const ae=o.getTileByID(ee);if(ae&&ae.hasData())return ae.getBucket(b)},oe=[0,-1,1];for(const ee of oe){if(Y.overscaledZ+ee<te)continue;const ae=ne(Y.calculateScaledKey(Y.overscaledZ+ee));if(ae)return ae}},F=[0,0,0],P=(Y,te)=>(F[0]=Math.min(Y.min.y,te.min.y),F[1]=Math.max(Y.max.y,te.max.y),F[2]=p.EXTENT-te.min.x>Y.max.x?te.min.x-p.EXTENT:Y.max.x,F),O=(Y,te)=>(F[0]=Math.min(Y.min.x,te.min.x),F[1]=Math.max(Y.max.x,te.max.x),F[2]=p.EXTENT-te.min.y>Y.max.y?te.min.y-p.EXTENT:Y.max.y,F),z=[(Y,te)=>P(Y,te),(Y,te)=>P(te,Y),(Y,te)=>O(Y,te),(Y,te)=>O(te,Y)],G=new p.pointGeometry(0,0);let Z,H,U;const ie=(Y,te,ne,oe,ee)=>{const ae=[[oe?ne:Y,oe?Y:ne,0],[oe?ne:te,oe?te:ne,0]],ve=ee<0?p.EXTENT+ee:ee,Me=[oe?ve:(Y+te)/2,oe?(Y+te)/2:ve,0];return 0===ne&&ee<0||0!==ne&&ee>0?w.getForTilePoints(U,[Me],!0,H):ae.push(Me),w.getForTilePoints(d,ae,!0,Z),Math.max(ae[0][2],ae[1][2],Me[2])/w.exaggeration()};for(let Y=0;Y<4;Y++){const te=(Y<2?1:5)-Y,ne=_.borders[Y];if(0===ne.length)continue;const oe=U=D[Y](d),ee=A(oe);if(!(ee&&ee instanceof p.FillExtrusionBucket&&ee.enableTerrain)||_.borderDoneWithNeighborZ[Y]===ee.canonical.z&&ee.borderDoneWithNeighborZ[te]===_.canonical.z||(H=w.findDEMTileFor(oe),!H||!H.dem))continue;if(!Z){const Fe=w.findDEMTileFor(d);if(!Fe||!Fe.dem)return;Z=Fe}const ae=ee.borders[te];let ve=0;const Me=ee.borderDoneWithNeighborZ[te]!==_.canonical.z;if(_.canonical.z===ee.canonical.z){for(let Fe=0;Fe<ne.length;Fe++){const Te=_.featuresOnBorder[ne[Fe]],Ze=Te.borders[Y];let ye;for(;ve<ae.length&&(ye=ee.featuresOnBorder[ae[ve]],!(ye.borders[te][1]>Ze[0]+3));)Me&&ee.encodeCentroid(void 0,ye,!1),ve++;if(ye&&ve<ae.length){const He=ve;let Ue=0;for(;!(ye.borders[te][0]>Ze[1]-3)&&(Ue++,++ve!==ae.length);)ye=ee.featuresOnBorder[ae[ve]];if(ye=ee.featuresOnBorder[ae[He]],Te.intersectsCount()>1||ye.intersectsCount()>1||1!==Ue){1!==Ue&&(ve=He),_.encodeCentroid(void 0,Te,!1),Me&&ee.encodeCentroid(void 0,ye,!1);continue}const rt=z[Y](Te,ye),Re=Y%2?p.EXTENT-1:0;G.x=ie(rt[0],Math.min(p.EXTENT-1,rt[1]),Re,Y<2,rt[2]),G.y=0,_.encodeCentroid(G,Te,!1),Me&&ee.encodeCentroid(G,ye,!1)}else _.encodeCentroid(void 0,Te,!1)}_.borderDoneWithNeighborZ[Y]=ee.canonical.z,_.needsCentroidUpdate=!0,Me&&(ee.borderDoneWithNeighborZ[te]=_.canonical.z,ee.needsCentroidUpdate=!0)}else{for(const Fe of ne)_.encodeCentroid(void 0,_.featuresOnBorder[Fe],!1);if(Me){for(const Fe of ae)ee.encodeCentroid(void 0,ee.featuresOnBorder[Fe],!1);ee.borderDoneWithNeighborZ[te]=_.canonical.z,ee.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[Y]=ee.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(m)}const rs=new p.Color(1,0,0,1),Kc=new p.Color(0,1,0,1),Yc=new p.Color(0,0,1,1),rl=new p.Color(1,0,1,1),Ur=new p.Color(0,1,1,1);function et(m,o,d,_){Qc(m,0,o+d/2,m.transform.width,d,_)}function $s(m,o,d,_){Qc(m,o-d/2,0,d,m.transform.height,_)}function Qc(m,o,d,_,b,w){const D=m.context,A=D.gl;A.enable(A.SCISSOR_TEST),A.scissor(o*p.exported.devicePixelRatio,d*p.exported.devicePixelRatio,_*p.exported.devicePixelRatio,b*p.exported.devicePixelRatio),D.clear({color:w}),A.disable(A.SCISSOR_TEST)}function Wf(m,o,d){const _=m.context,b=_.gl,w="globe"===m.transform.projection.name,D=d.projMatrix,A=m.useProgram("debug",null,w?["PROJECTION_GLOBE_VIEW"]:null),F=o.getTileByID(d.key);m.terrain&&m.terrain.setupElevationDraw(F,A);const P=p.DepthMode.disabled,O=p.StencilMode.disabled,z=m.colorModeForRenderPass(),G="$debug";_.activeTexture.set(b.TEXTURE0),m.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),w?F._makeGlobeTileDebugBuffers(m.context,m.transform.projection):F._makeDebugTileBoundsBuffers(m.context,m.transform.projection);const Z=F._tileDebugBuffer||m.debugBuffer,H=F._tileDebugIndexBuffer||m.debugIndexBuffer,U=F._tileDebugSegments||m.debugSegments;A.draw(_,b.LINE_STRIP,P,O,z,p.CullFaceMode.disabled,Zc(D,p.Color.red),G,Z,H,U,null,null,null,F._globeTileDebugBorderBuffer);const ie=F.latestRawTileData,Y=Math.floor((ie&&ie.byteLength||0)/1024),te=o.getTile(d).tileSize,ne=512/Math.min(te,512)*(d.overscaledZ/m.transform.zoom)*.5;let oe=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(oe+=` => ${d.overscaledZ}`),function(Me,Fe){Me.initDebugOverlayCanvas();const Te=Me.debugOverlayCanvas,Ze=Me.context.gl,ye=Me.debugOverlayCanvas.getContext("2d");ye.clearRect(0,0,Te.width,Te.height),ye.shadowColor="white",ye.shadowBlur=2,ye.lineWidth=1.5,ye.strokeStyle="white",ye.textBaseline="top",ye.font="bold 36px Open Sans, sans-serif",ye.fillText(Fe,5,5),ye.strokeText(Fe,5,5),Me.debugOverlayTexture.update(Te),Me.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}(m,`${oe} ${Y}kb`);const ee=F._tileDebugTextBuffer||m.debugBuffer,ae=F._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,ve=F._tileDebugTextSegments||m.debugSegments;A.draw(_,b.TRIANGLES,P,O,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,Zc(D,p.Color.transparent,ne),G,ee,ae,ve,null,null,null,F._globeTileDebugTextBuffer)}const km=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Jc}=km;function ba(m,o,d,_){m.emplaceBack(o,d,_)}class Ju{constructor(o){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,ba(this.vertexArray,-1,-1,1),ba(this.vertexArray,1,-1,1),ba(this.vertexArray,-1,1,1),ba(this.vertexArray,1,1,1),ba(this.vertexArray,-1,-1,-1),ba(this.vertexArray,1,-1,-1),ba(this.vertexArray,-1,1,-1),ba(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Jc),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function sl(m,o,d,_,b,w){const D=m.gl,A=o.paint.get("sky-atmosphere-color"),F=o.paint.get("sky-atmosphere-halo-color"),P=o.paint.get("sky-atmosphere-sun-intensity"),O={u_matrix_3f:p.fromMat4(p.create$1(),_),u_sun_direction:b,u_sun_intensity:P,u_color_tint_r:[(H=A).r,H.g,H.b,H.a],u_color_tint_m:[(U=F).r,U.g,U.b,U.a],u_luminance:5e-5};var H,U;D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+w,o.skyboxTexture,0),d.draw(m,D.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,O,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}function ol(m,o){return p.transformMat4(m,m,o)}const Zf={symbol:function(m,o,d,_,b){if("translucent"!==m.renderPass)return;const w=p.StencilMode.disabled,D=m.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(A,F,P,O,z,G,Z){const H=F.transform,U="map"===z,ie="map"===G;for(const Y of A){const te=O.getTile(Y),ne=te.getBucket(P);if(!ne||ne.projection!==H.projection.name||!ne.text||!ne.text.segments.get().length)continue;const oe=p.evaluateSizeForZoom(ne.textSizeData,H.zoom),ee=F.transform.calculatePixelsToTileUnitsMatrix(te),ae=Mn(Y.projMatrix,te.tileID.canonical,ie,U,F.transform,ee),ve="none"!==P.layout.get("icon-text-fit")&&ne.hasIconData();if(oe){const Me=Math.pow(2,H.zoom-te.tileID.overscaledZ);Xc(ne,U,ie,Z,p.symbolSize,H,ae,Y,Me,oe,ve,H.projection)}}}(_,m,d,o,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b),0!==d.paint.get("icon-opacity").constantOr(1)&&is(m,o,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),w,D),0!==d.paint.get("text-opacity").constantOr(1)&&is(m,o,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),w,D),o.map.showCollisionBoxes&&(Yu(m,o,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Yu(m,o,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,d,_){if("translucent"!==m.renderPass)return;const b=d.paint.get("circle-opacity"),w=d.paint.get("circle-stroke-width"),D=d.paint.get("circle-stroke-opacity"),A=void 0!==d.layout.get("circle-sort-key").constantOr(1);if(0===b.constantOr(1)&&(0===w.constantOr(1)||0===D.constantOr(1)))return;const F=m.context,P=F.gl,O=m.transform,z=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),G=p.StencilMode.disabled,Z=m.colorModeForRenderPass(),H="globe"===O.projection.name,U=[p.mercatorXfromLng(O.center.lng),p.mercatorYfromLat(O.center.lat)],ie=[];for(let te=0;te<_.length;te++){const ne=_[te],oe=o.getTile(ne),ee=oe.getBucket(d);if(!ee)continue;const ae=ee.programConfigurations.get(d.id),ve=ah(d);H&&ve.push("PROJECTION_GLOBE_VIEW");const Me=m.useProgram("circle",ae,ve),Fe=ee.layoutVertexBuffer,Te=ee.globeExtVertexBuffer,Ze=ee.indexBuffer,ye=O.projection.createInversionMatrix(O,ne.canonical),He={programConfiguration:ae,program:Me,layoutVertexBuffer:Fe,globeExtVertexBuffer:Te,indexBuffer:Ze,uniformValues:Fo(m,ne,oe,ye,U,d),tile:oe};if(A){const Ue=ee.segments.get();for(const rt of Ue)ie.push({segments:new p.SegmentVector([rt]),sortKey:rt.sortKey,state:He})}else ie.push({segments:ee.segments,sortKey:0,state:He})}A&&ie.sort((te,ne)=>te.sortKey-ne.sortKey);const Y={useDepthForOcclusion:!H};for(const te of ie){const{programConfiguration:ne,program:oe,layoutVertexBuffer:ee,globeExtVertexBuffer:ae,indexBuffer:ve,uniformValues:Me,tile:Fe}=te.state,Te=te.segments;m.terrain&&m.terrain.setupElevationDraw(Fe,oe,Y),m.prepareDrawProgram(F,oe,Fe.tileID.toUnwrapped()),oe.draw(F,P.TRIANGLES,z,G,Z,p.CullFaceMode.disabled,Me,d.id,ee,ve,Te,d.paint,O.zoom,ne,H?ae:null)}},heatmap:function(m,o,d,_){if(0!==d.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const b=m.context,w=b.gl,D=p.StencilMode.disabled,A=new p.ColorMode([w.ONE,w.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(G,Z,H){const U=G.gl;G.activeTexture.set(U.TEXTURE1),G.viewport.set([0,0,Z.width/4,Z.height/4]);let ie=H.heatmapFbo;if(ie)U.bindTexture(U.TEXTURE_2D,ie.colorAttachment.get()),G.bindFramebuffer.set(ie.framebuffer);else{const Y=U.createTexture();U.bindTexture(U.TEXTURE_2D,Y),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),ie=H.heatmapFbo=G.createFramebuffer(Z.width/4,Z.height/4,!1),function(te,ne,oe,ee){const ae=te.gl;ae.texImage2D(ae.TEXTURE_2D,0,ae.RGBA,ne.width/4,ne.height/4,0,ae.RGBA,te.extRenderToTextureHalfFloat?te.extTextureHalfFloat.HALF_FLOAT_OES:ae.UNSIGNED_BYTE,null),ee.colorAttachment.set(oe)}(G,Z,Y,ie)}})(b,m,d),b.clear({color:p.Color.transparent});const F=m.transform,P="globe"===F.projection.name,O=P?["PROJECTION_GLOBE_VIEW"]:null,z=[p.mercatorXfromLng(F.center.lng),p.mercatorYfromLat(F.center.lat)];for(let G=0;G<_.length;G++){const Z=_[G];if(o.hasRenderableParent(Z))continue;const H=o.getTile(Z),U=H.getBucket(d);if(!U)continue;const ie=U.programConfigurations.get(d.id),Y=m.useProgram("heatmap",ie,O),{zoom:te}=m.transform;m.terrain&&m.terrain.setupElevationDraw(H,Y),m.prepareDrawProgram(b,Y,Z.toUnwrapped());const ne=F.projection.createInversionMatrix(F,Z.canonical);Y.draw(b,w.TRIANGLES,p.DepthMode.disabled,D,A,p.CullFaceMode.disabled,ur(m,Z,H,ne,z,te,d.paint.get("heatmap-intensity")),d.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,d.paint,m.transform.zoom,ie,P?U.globeExtVertexBuffer:null)}b.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(b,w){const D=b.context,A=D.gl,F=w.heatmapFbo;if(!F)return;D.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,F.colorAttachment.get()),D.activeTexture.set(A.TEXTURE1);let P=w.colorRampTexture;P||(P=w.colorRampTexture=new p.Texture(D,w.colorRamp,A.RGBA)),P.bind(A.LINEAR,A.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(D,A.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,b.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:w.paint.get("heatmap-opacity")},w.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,w.paint,b.transform.zoom)}(m,d))},line:function(m,o,d,_){if("translucent"!==m.renderPass)return;const b=d.paint.get("line-opacity"),w=d.paint.get("line-width");if(0===b.constantOr(1)||0===w.constantOr(1))return;const D=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),A=m.colorModeForRenderPass(),F=m.terrain&&m.terrain.renderingToTexture?1:p.exported.devicePixelRatio,P=d.paint.get("line-dasharray"),O=P.constantOr(1),z=d.layout.get("line-cap"),G=d.paint.get("line-pattern"),Z=G.constantOr(1),H=d.paint.get("line-gradient"),U=d.getCrossfadeParameters(),ie=Z?"linePattern":"line",Y=m.context,te=Y.gl,ne=(ee=>{const ae=[];Qn(ee)&&ae.push("RENDER_LINE_DASH"),ee.paint.get("line-gradient")&&ae.push("RENDER_LINE_GRADIENT");const ve=ee.paint.get("line-pattern").constantOr(1),Me=1!==ee.paint.get("line-opacity").constantOr(1);return!ve&&Me&&ae.push("RENDER_LINE_ALPHA_DISCARD"),ae})(d);let oe=ne.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(oe=!1);for(const ee of _){const ae=o.getTile(ee);if(Z&&!ae.patternsLoaded())continue;const ve=ae.getBucket(d);if(!ve)continue;m.prepareDrawTile();const Me=ve.programConfigurations.get(d.id),Fe=m.useProgram(ie,Me,ne),Te=G.constantOr(null);if(Te&&ae.imageAtlas){const Re=ae.imageAtlas,st=Re.patternPositions[Te.to.toString()],ft=Re.patternPositions[Te.from.toString()];st&&ft&&Me.setConstantPatternPositions(st,ft)}const Ze=P.constantOr(null),ye=z.constantOr(null);if(!Z&&Ze&&ye&&ae.lineAtlas){const Re=ae.lineAtlas,st=Re.getDash(Ze.to,ye),ft=Re.getDash(Ze.from,ye);st&&ft&&Me.setConstantPatternPositions(st,ft)}const He=m.terrain?ee.projMatrix:null,Ue=Z?zr(m,ae,d,U,He,F):Im(m,ae,d,U,He,ve.lineClipsArray.length,F);if(H){const Re=ve.gradients[d.id];let st=Re.texture;if(d.gradientVersion!==Re.version){let ft=256;if(d.stepInterpolant){const at=o.getSource().maxzoom,nt=ee.canonical.z===at?Math.ceil(1<<m.transform.maxZoom-ee.canonical.z):1;ft=p.clamp(p.nextPowerOfTwo(ve.maxLineLength/p.EXTENT*1024*nt),256,Y.maxTextureSize)}Re.gradient=p.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:ft,image:Re.gradient||void 0,clips:ve.lineClipsArray}),Re.texture?Re.texture.update(Re.gradient):Re.texture=new p.Texture(Y,Re.gradient,te.RGBA),Re.version=d.gradientVersion,st=Re.texture}Y.activeTexture.set(te.TEXTURE1),st.bind(d.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}O&&(Y.activeTexture.set(te.TEXTURE0),ae.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),Me.updatePaintBuffers(U)),Z&&(Y.activeTexture.set(te.TEXTURE0),ae.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Me.updatePaintBuffers(U)),m.prepareDrawProgram(Y,Fe,ee.toUnwrapped());const rt=Re=>{Fe.draw(Y,te.TRIANGLES,D,Re,A,p.CullFaceMode.disabled,Ue,d.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,d.paint,m.transform.zoom,Me,ve.layoutVertexBuffer2)};if(oe){const Re=m.stencilModeForClipping(ee).ref;0===Re&&m.terrain&&Y.clear({stencil:0});const st={func:te.EQUAL,mask:255};Ue.u_alpha_discard_threshold=.8,rt(new p.StencilMode(st,Re,255,te.KEEP,te.KEEP,te.INVERT)),Ue.u_alpha_discard_threshold=0,rt(new p.StencilMode(st,Re,255,te.KEEP,te.KEEP,te.KEEP))}else rt(m.stencilModeForClipping(ee))}oe&&(m.resetStencilClippingMasks(),m.terrain&&Y.clear({stencil:0}))},fill:function(m,o,d,_){const b=d.paint.get("fill-color"),w=d.paint.get("fill-opacity");if(0===w.constantOr(1))return;const D=m.colorModeForRenderPass(),A=d.paint.get("fill-pattern"),F=m.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===b.constantOr(p.Color.transparent).a&&1===w.constantOr(0)?"opaque":"translucent";if(m.renderPass===F){const P=m.depthModeForSublayer(1,"opaque"===m.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Qu(m,o,d,_,P,D,!1)}if("translucent"===m.renderPass&&d.paint.get("fill-antialias")){const P=m.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Qu(m,o,d,_,P,D,!0)}},"fill-extrusion":function(m,o,d,_){const b=d.paint.get("fill-extrusion-opacity");if(0!==b&&"translucent"===m.renderPass){const w=new p.DepthMode(m.context.gl.LEQUAL,p.DepthMode.ReadWrite,m.depthRangeFor3D);if(1!==b||d.paint.get("fill-extrusion-pattern").constantOr(1))Vl(m,o,d,_,w,p.StencilMode.disabled,p.ColorMode.disabled),Vl(m,o,d,_,w,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const D=m.colorModeForRenderPass();Vl(m,o,d,_,w,p.StencilMode.disabled,D)}}},hillshade:function(m,o,d,_){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass)return;const b=m.context,w=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),D=m.colorModeForRenderPass(),A=m.terrain&&m.terrain.renderingToTexture,[F,P]="translucent"!==m.renderPass||A?[{},_]:m.stencilConfigForOverlap(_);for(const O of P){const z=o.getTile(O);if(z.needsHillshadePrepare&&"offscreen"===m.renderPass)Ln(m,z,d,w,p.StencilMode.disabled,D);else if("translucent"===m.renderPass){const G=A&&m.terrain?m.terrain.stencilModeForRTTOverlap(O):F[O.overscaledZ];$f(m,O,z,d,w,G,D)}}b.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,o,d,_,b,w){if("translucent"!==m.renderPass||0===d.paint.get("raster-opacity")||!_.length)return;const D=m.context,A=D.gl,F=o.getSource(),P=m.useProgram("raster"),O=m.colorModeForRenderPass(),z=m.terrain&&m.terrain.renderingToTexture,[G,Z]=F instanceof de||z?[{},_]:m.stencilConfigForOverlap(_),H=Z[Z.length-1].overscaledZ,U=!m.options.moving;for(const ie of Z){const Y=z?p.DepthMode.disabled:m.depthModeForSublayer(ie.overscaledZ-H,1===d.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,A.LESS),te=ie.toUnwrapped(),ne=o.getTile(ie);if(z&&(!ne||!ne.hasData()))continue;const oe=z?ie.projMatrix:m.transform.calculateProjMatrix(te,U),ee=m.terrain&&z?m.terrain.stencilModeForRTTOverlap(ie):G[ie.overscaledZ],ae=w?0:d.paint.get("raster-fade-duration");ne.registerFadeDuration(ae);const ve=o.findLoadedParent(ie,0),Me=Us(ne,ve,o,m.transform,ae);let Fe,Te;m.terrain&&m.terrain.prepareDrawTile();const Ze="nearest"===d.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;D.activeTexture.set(A.TEXTURE0),ne.texture.bind(Ze,A.CLAMP_TO_EDGE),D.activeTexture.set(A.TEXTURE1),ve?(ve.texture.bind(Ze,A.CLAMP_TO_EDGE),Fe=Math.pow(2,ve.tileID.overscaledZ-ne.tileID.overscaledZ),Te=[ne.tileID.canonical.x*Fe%1,ne.tileID.canonical.y*Fe%1]):ne.texture.bind(Ze,A.CLAMP_TO_EDGE);const ye=Vr(oe,Te||[0,0],Fe||1,Me,d,F instanceof de?F.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(D,P,te),F instanceof de)F.boundsBuffer&&F.boundsSegments&&P.draw(D,A.TRIANGLES,Y,p.StencilMode.disabled,O,p.CullFaceMode.disabled,ye,d.id,F.boundsBuffer,m.quadTriangleIndexBuffer,F.boundsSegments);else{const{tileBoundsBuffer:He,tileBoundsIndexBuffer:Ue,tileBoundsSegments:rt}=m.getTileBoundsBuffers(ne);P.draw(D,A.TRIANGLES,Y,ee,O,p.CullFaceMode.disabled,ye,d.id,He,Ue,rt)}}m.resetStencilClippingMasks()},background:function(m,o,d,_){const b=d.paint.get("background-color"),w=d.paint.get("background-opacity");if(0===w)return;const D=m.context,A=D.gl,F=m.transform,P=F.tileSize,O=d.paint.get("background-pattern");if(m.isPatternMissing(O))return;const z=!O&&1===b.a&&1===w&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==z)return;const G=p.StencilMode.disabled,Z=m.depthModeForSublayer(0,"opaque"===z?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),H=m.colorModeForRenderPass(),U=m.useProgram(O?"backgroundPattern":"background");let ie,Y=_;Y||(ie=m.getBackgroundTiles(),Y=Object.values(ie).map(ne=>ne.tileID)),O&&(D.activeTexture.set(A.TEXTURE0),m.imageManager.bind(m.context));const te=d.getCrossfadeParameters();for(const ne of Y){const oe=ne.toUnwrapped(),ee=_?ne.projMatrix:m.transform.calculateProjMatrix(oe);m.prepareDrawTile();const ae=o?o.getTile(ne):ie?ie[ne.key]:new p.Tile(ne,P,F.zoom,m),ve=O?Zt(ee,w,m,O,{tileID:ne,tileSize:P},te):il(ee,w,b);m.prepareDrawProgram(D,U,oe);const{tileBoundsBuffer:Me,tileBoundsIndexBuffer:Fe,tileBoundsSegments:Te}=m.getTileBoundsBuffers(ae);U.draw(D,A.TRIANGLES,Z,G,H,p.CullFaceMode.disabled,ve,d.id,Me,Fe,Te)}},sky:function(m,o,d){const _=m.transform,b="mercator"===_.projection.name||"globe"===_.projection.name?1:p.smoothstep(7,8,_.zoom),w=d.paint.get("sky-opacity")*b;if(0===w)return;const D=m.context,A=d.paint.get("sky-type"),F=new p.DepthMode(D.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),P=m.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===m.renderPass?d.needsSkyboxCapture(m)&&(function(O,z,G,Z){const H=O.context,U=H.gl;let ie=z.skyboxFbo;if(!ie){ie=z.skyboxFbo=H.createFramebuffer(32,32,!1),z.skyboxGeometry=new Ju(H),z.skyboxTexture=H.gl.createTexture(),U.bindTexture(U.TEXTURE_CUBE_MAP,z.skyboxTexture),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR);for(let oe=0;oe<6;++oe)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,U.RGBA,32,32,0,U.RGBA,U.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(ie.framebuffer),H.viewport.set([0,0,32,32]);const Y=z.getCenter(O,!0),te=O.useProgram("skyboxCapture"),ne=new Float64Array(16);p.identity(ne),p.rotateY(ne,ne,.5*-Math.PI),sl(H,z,te,ne,Y,0),p.identity(ne),p.rotateY(ne,ne,.5*Math.PI),sl(H,z,te,ne,Y,1),p.identity(ne),p.rotateX(ne,ne,.5*-Math.PI),sl(H,z,te,ne,Y,2),p.identity(ne),p.rotateX(ne,ne,.5*Math.PI),sl(H,z,te,ne,Y,3),p.identity(ne),sl(H,z,te,ne,Y,4),p.identity(ne),p.rotateY(ne,ne,Math.PI),sl(H,z,te,ne,Y,5),H.viewport.set([0,0,O.width,O.height])}(m,d),d.markSkyboxValid(m)):"sky"===m.renderPass&&function(O,z,G,Z,H){const U=O.context,ie=U.gl,Y=O.transform,te=O.useProgram("skybox");U.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_CUBE_MAP,z.skyboxTexture);const ne={u_matrix:Y.skyboxMatrix,u_sun_direction:z.getCenter(O,!1),u_cubemap:0,u_opacity:Z,u_temporal_offset:H};O.prepareDrawProgram(U,te),te.draw(U,ie.TRIANGLES,G,p.StencilMode.disabled,O.colorModeForRenderPass(),p.CullFaceMode.backCW,ne,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(m,d,F,w,P):"gradient"===A&&"sky"===m.renderPass&&function(O,z,G,Z,H){const U=O.context,ie=U.gl,Y=O.transform,te=O.useProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new Ju(U)),U.activeTexture.set(ie.TEXTURE0);let ne=z.colorRampTexture;ne||(ne=z.colorRampTexture=new p.Texture(U,z.colorRamp,ie.RGBA)),ne.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const oe=(ee=Y.skyboxMatrix,ae=z.getCenter(O,!1),ve=z.paint.get("sky-gradient-radius"),Me=Z,Fe=H,{u_matrix:ee,u_color_ramp:0,u_center_direction:ae,u_radius:p.degToRad(ve),u_opacity:Me,u_temporal_offset:Fe});var ee,ae,ve,Me,Fe;O.prepareDrawProgram(U,te),te.draw(U,ie.TRIANGLES,G,p.StencilMode.disabled,O.colorModeForRenderPass(),p.CullFaceMode.backCW,oe,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(m,d,F,w,P)},debug:function(m,o,d){for(let _=0;_<d.length;_++)Wf(m,o,d[_])},custom:function(m,o,d){const _=m.context,b=d.implementation;if(m.transform.projection.unsupportedLayers&&m.transform.projection.unsupportedLayers.includes("custom"))p.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===m.renderPass){const w=b.prerender;w&&(m.setCustomLayerDefaults(),_.setColorMode(m.colorModeForRenderPass()),w.call(b,_.gl,m.transform.customLayerMatrix()),_.setDirty(),m.setBaseState())}else if("translucent"===m.renderPass){m.setCustomLayerDefaults(),_.setColorMode(m.colorModeForRenderPass()),_.setStencilMode(p.StencilMode.disabled);const w="3d"===b.renderingMode?new p.DepthMode(m.context.gl.LEQUAL,p.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,p.DepthMode.ReadOnly);_.setDepthMode(w),b.render(_.gl,m.transform.customLayerMatrix()),_.setDirty(),m.setBaseState(),_.bindFramebuffer.set(null)}}};class Fm{constructor(o,d){this.context=new N(o),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ja,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(o,d){const _=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Nr(this,o));const b=this._terrain;this.transform.elevation=_?b:null,b.update(o,this.transform,d)}_updateFog(o){const d=o.fog;if(!d||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,b]=d.getFovAdjustedRange(this.transform._fov);if(_>b)return void(this.transform.fogCullDistSq=null);const w=_+.78*(b-_);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,d){if(this.width=o*p.exported.devicePixelRatio,this.height=d*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const o=this.context,d=new p.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(p.EXTENT,0),d.emplaceBack(0,p.EXTENT),d.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(d,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const _=new p.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(p.EXTENT,0),_.emplaceBack(0,p.EXTENT),_.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=o.createVertexBuffer(_,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const b=new p.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(b,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const w=new p.StructArrayLayout4i8;w.emplaceBack(0,0,0,0),w.emplaceBack(p.EXTENT,0,p.EXTENT,0),w.emplaceBack(0,p.EXTENT,0,p.EXTENT),w.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(w,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const D=new p.StructArrayLayout3ui6;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(D);const A=new p.StructArrayLayout1ui2;for(const P of[0,1,3,2,0])A.emplaceBack(P);this.debugIndexBuffer=o.createIndexBuffer(A),this.emptyTexture=new p.Texture(o,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=p.create();const F=this.context.gl;this.stencilClearMode=new p.StencilMode({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.loadTimeStamps.push(p.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,d=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(o,d.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,Uc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(o,d,_){if(!d||this.currentStencilSource===d.id||!o.isTileClipped()||!_||0===_.length)return;const b=[];let w=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const O of _)if(this._tileClippingMaskIDs.has(O.key)||(w=!0),this._skippedStencilTileIDs.has(O.key)){if(!d.getTile(O).getBucket(o))continue;this._skippedStencilTileIDs.delete(O.key),b.push(O)}if(!w&&0===b.length)return}const D=this.context,A=D.gl;D.setColorMode(p.ColorMode.disabled),D.setDepthMode(p.DepthMode.disabled);const F=this.useProgram("clippingMask"),P=O=>{const z=d.getTile(O),{tileBoundsBuffer:G,tileBoundsIndexBuffer:Z,tileBoundsSegments:H}=this.getTileBoundsBuffers(z);F.draw(D,A.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:A.GREATER,mask:255},this._tileClippingMaskIDs.get(O.key)||0,255,A.KEEP,A.KEEP,A.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Uc(O.projMatrix),"$clipping",G,Z,H)};if(!w&&b.length>0)for(const O of b)P(O);else{(0===this._tileClippingMaskIDs.size||this.nextStencilID+_.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const O of _)this._tileClippingMaskIDs.set(O.key,this.nextStencilID++),d.getTile(O).getBucket(o)?P(O):this._skippedStencilTileIDs.add(O.key)}0===this._skippedStencilTileIDs.size&&(this.currentStencilSource=d.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new p.StencilMode({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const d=this.context.gl;return new p.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs.get(o.key)||0,0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(o){const d=this.context.gl,_=o.sort((D,A)=>A.overscaledZ-D.overscaledZ),b=_[_.length-1].overscaledZ,w=_[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const D={};for(let A=0;A<w;A++)D[A+b]=new p.StencilMode({func:d.GEQUAL,mask:255},A+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=w,[D,_]}return[{[b]:p.StencilMode.disabled},_]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([o.CONSTANT_COLOR,o.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(o,d,_){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new p.DepthMode(_||this.context.gl.LEQUAL,d,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,d){this.style=o,this.options=d,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const _=this.style.order,b=this.style._sourceCaches;for(const P in b){const O=b[P];O.used&&O.prepare(this.context)}const w={},D={},A={};for(const P in b){const O=b[P];w[P]=O.getVisibleCoordinates(),D[P]=w[P].slice().reverse(),A[P]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<_.length;P++)if(this.style._layers[_[P]].is3D()){this.opaquePassCutoff=P;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const P of _){const O=this.style._layers[P],z=o._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const G=z?D[z.id]:void 0;("custom"===O.type||O.isSky()||G&&G.length)&&this.renderLayer(this,z,O,G)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let F=p.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(F=this.style.fog.properties.get("color")),this.context.clear({color:d.showOverdrawInspector?p.Color.black:F,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[_[this.currentLayer]],O=o._getLayerSourceCache(P);if(P.isSky())continue;const z=O?D[O.id]:void 0;this._renderTileClippingMasks(P,O,z),this.renderLayer(this,O,P,z)}if(this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const P=this.style._layers[_[this.currentLayer]],O=o._getLayerSourceCache(P);P.isSky()&&this.renderLayer(this,O,P,O?D[O.id]:void 0)}for("globe"===this.transform.projection.name&&function(P){const O=P.context,z=O.gl,G=P.transform,Z=new p.DepthMode(z.LEQUAL,p.DepthMode.ReadOnly,[0,1]),H=P.useProgram("globeAtmosphere"),U=G.centerOffset,ie=G._camera.getCameraToClipPerspective(G._fov,G.width/G.height,G._nearZ,G._farZ);ie[8]=2*-U.x/G.width,ie[9]=2*U.y/G.height;const Y=p.invert([],ie),te=p.mul([],Y,G.projMatrix),ne={u_frustum_tl:ol([-1,1,1],Y),u_frustum_tr:ol([1,1,1],Y),u_frustum_br:ol([1,-1,1],Y),u_frustum_bl:ol([-1,-1,1],Y),u_globe_pos:ol([G.globeMatrix[12],G.globeMatrix[13],G.globeMatrix[14]],te),u_globe_radius:G.worldSize/2/Math.PI-1,u_opacity:1-p.globeToMercatorTransition(G.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};P.prepareDrawProgram(O,H);const oe=P.globeSharedBuffers;oe&&H.draw(O,z.TRIANGLES,Z,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,ne,"skybox",oe.atmosphereVertexBuffer,oe.atmosphereIndexBuffer,oe.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const P=this.style._layers[_[this.currentLayer]],O=o._getLayerSourceCache(P);if(P.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(P)){if(P.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=O?("symbol"===P.type?A:D)[O.id]:void 0;this._renderTileClippingMasks(P,O,O?w[O.id]:void 0),this.renderLayer(this,O,P,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let P=null;p.values(this.style._layers).forEach(O=>{const z=o._getLayerSourceCache(O);z&&!O.isHidden(this.transform.zoom)&&(!P||P.getSource().maxzoom<z.getSource().maxzoom)&&(P=z)}),P&&this.options.showTileBoundaries&&Zf.debug(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const O=P.transform.padding;et(P,P.transform.height-(O.top||0),3,rs),et(P,O.bottom||0,3,Kc),$s(P,O.left||0,3,Yc),$s(P,P.transform.width-(O.right||0),3,rl);const z=P.transform.centerPoint;var G,Z,H,U;Qc(G=P,(Z=z.x)-1,(H=P.transform.height-z.y)-10,2,20,U=Ur),Qc(G,Z-10,H-1,20,2,U)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,d,_,b){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||b&&b.length)&&(this.id=_.id,this.gpuTimingStart(_),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(_.type)||Zf[_.type](o,d,_,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let _=this.gpuTimers[o.id];_||(_=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),_.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,_.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const d={};for(const _ in o){const b=o[_],w=this.context.extTimerQuery,D=w.getQueryObjectEXT(b.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(b.query),d[_]=D}return d}translatePosMatrix(o,d,_,b,w){if(!_[0]&&!_[1])return o;const D=w?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(D){const P=Math.sin(D),O=Math.cos(D);_=[_[0]*O-_[1]*P,_[0]*P+_[1]*O]}const A=[w?_[0]:Ji(d,_[0],this.transform.zoom),w?_[1]:Ji(d,_[1],this.transform.zoom),0],F=new Float32Array(16);return p.translate(F,o,A),F}saveTileTexture(o){const d=this._tileTextures[o.size[0]];d?d.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const d=this.imageManager.getPattern(o.from.toString()),_=this.imageManager.getPattern(o.to.toString());return!d||!_}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,d=this.style&&this.style.fog,_=[];return this.terrain&&!this.terrain.renderingToTexture&&_.push("TERRAIN"),d&&!o&&0!==d.getOpacity(this.transform.pitch)&&_.push("FOG"),o&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(o,d,_){this.cache=this.cache||{};const b=_||[],w=this.currentGlobalDefines().concat(b),D=Nl.cacheKey(o,w,d);return this.cache[D]||(this.cache[D]=new Nl(this.context,o,Xu[o],d,hn[o],w)),this.cache[D]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(o,d,_){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const w=b.getOpacity(this.transform.pitch);0!==w&&d.setFogUniformValues(o,((D,A,F,P)=>{const O=A.properties.get("color"),z=D.frameCounter/1e3%1,G=[O.r/O.a,O.g/O.a,O.b/O.a,P];return{u_fog_matrix:F?D.transform.calculateFogTileMatrix(F):D.identityMat,u_fog_range:A.getFovAdjustedRange(D.transform._fov),u_fog_color:G,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:z}})(this,b,_,w))}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,d=o.createTexture();return o.bindTexture(o.TEXTURE_2D,d),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&0!==o.getOpacity(this.transform.pitch)}getBackgroundTiles(){const o=this._backgroundTiles,d=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const b of _)d[b.key]=o[b.key]||new p.Tile(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class al{constructor(o=0,d=0,_=0,b=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=_,this.right=b}interpolate(o,d,_){return null!=d.top&&null!=o.top&&(this.top=p.number(o.top,d.top,_)),null!=d.bottom&&null!=o.bottom&&(this.bottom=p.number(o.bottom,d.bottom,_)),null!=d.left&&null!=o.left&&(this.left=p.number(o.left,d.left,_)),null!=d.right&&null!=o.right&&(this.right=p.number(o.right,d.right,_)),this}getCenter(o,d){const _=p.clamp((this.left+o-this.right)/2,0,o),b=p.clamp((this.top+d-this.bottom)/2,0,d);return new p.pointGeometry(_,b)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new al(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Rm(m,o){const d=p.getColumn(m,3);p.fromQuat(m,o),p.setColumn(m,3,d)}function Xf(m,o){const d=p.identity$1([]);return p.rotateZ$1(d,d,-o),p.rotateX$1(d,d,-m),d}function lh(m,o){const d=[m[0],m[1],0],_=[o[0],o[1],0];if(p.length(d)>=1e-15){const D=p.normalize([],d);p.scale$2(_,D,p.dot(_,D)),o[0]=_[0],o[1]=_[1]}const b=p.cross([],o,m);if(p.len(b)<1e-15)return null;const w=Math.atan2(-b[1],b[0]);return Xf(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),w)}class ed{constructor(o,d){this.position=o,this.orientation=d}get position(){return this._position}set position(o){if(o){const d=o instanceof p.MercatorCoordinate?o:new p.MercatorCoordinate(o[0],o[1],o[2]);this._renderWorldCopies&&(d.x=p.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(o,d){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(o)):0,b=this.position,w=p.MercatorCoordinate.fromLngLat(o,_),D=[w.x-b.x,w.y-b.y,w.z-b.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=lh(D,d)}setPitchBearing(o,d){this.orientation=Xf(p.degToRad(o),p.degToRad(-d))}}class td{constructor(o,d){this._transform=p.identity([]),this.orientation=d,this.position=o}get mercatorPosition(){const o=this.position;return new p.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=p.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var d;o&&p.setColumn(this._transform,3,[(d=o)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||p.identity$1([]),o&&Rm(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,d){this._orientation=Xf(o,d),Rm(this._transform,this._orientation)}forward(){const o=p.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=p.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=p.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,d){const _=new Float64Array(16);return p.invert(_,this.getWorldToCamera(o,d)),_}getWorldToCameraPosition(o,d,_){const b=this.position;p.scale$2(b,b,-o);const w=new Float64Array(16);return p.fromScaling(w,[_,_,_]),p.translate(w,w,b),w[10]*=d,w}getWorldToCamera(o,d){const _=new Float64Array(16),b=new Float64Array(4),w=this.position;return p.conjugate(b,this._orientation),p.scale$2(w,w,-o),p.fromQuat(_,b),p.translate(_,_,w),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=d,_[9]*=d,_[10]*=d,_[11]*=d,_}getCameraToClipPerspective(o,d,_,b){const w=new Float64Array(16);return p.perspective(w,o,d,_,b),w}getDistanceToElevation(o){const d=0===o?0:p.mercatorZfromAltitude(o,this.position[1]),_=this.forward();return(d-this.position[2])/_[2]}clone(){return new td([...this.position],[...this.orientation])}}function nd(m,o){const d=id(m),_=function(w,D,A,F,P){const O=new p.LngLat(A.lng-180*ll,A.lat),z=new p.LngLat(A.lng+180*ll,A.lat),G=w.project(O.lng,O.lat),Z=w.project(z.lng,z.lat),H=-Math.atan2(Z.y-G.y,Z.x-G.x),U=p.MercatorCoordinate.fromLngLat(A);U.y=p.clamp(U.y,-.999975,.999975);const ie=U.toLngLat(),Y=w.project(ie.lng,ie.lat),te=p.MercatorCoordinate.fromLngLat(ie);te.x+=ll;const ne=te.toLngLat(),oe=w.project(ne.lng,ne.lat),ee=Oo(oe.x-Y.x,oe.y-Y.y,H),ae=p.MercatorCoordinate.fromLngLat(ie);ae.y+=ll;const ve=ae.toLngLat(),Me=w.project(ve.lng,ve.lat),Fe=Oo(Me.x-Y.x,Me.y-Y.y,H),Te=Math.abs(ee.x)/Math.abs(Fe.y),Ze=p.identity([]);p.rotateZ(Ze,Ze,-H*(1-(P?0:F)));const ye=p.identity([]);return p.scale(ye,ye,[1,1-(1-Te)*F,1]),ye[4]=-Fe.x/Fe.y*F,p.rotateZ(ye,ye,H),p.multiply$1(ye,Ze,ye),ye}(m.projection,0,m.center,d,o),b=eu(m);return p.scale(_,_,[b,b,1]),_}function eu(m){const o=m.projection,d=id(m),_=Kf(o,m.center),b=Kf(o,p.LngLat.convert(o.center));return Math.pow(2,_*d+(1-d)*b)}function id(m){const o=m.projection.range;if(!o)return 0;const d=Math.max(m.width,m.height),_=Math.log(d/1024)/Math.LN2;return p.smoothstep(o[0]+_,o[1]+_,m.zoom)}const ll=1/4e4;function Kf(m,o){const d=p.clamp(o.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=new p.LngLat(o.lng-180*ll,d),b=new p.LngLat(o.lng+180*ll,d),w=m.project(_.lng,d),D=m.project(b.lng,d),A=p.MercatorCoordinate.fromLngLat(_),F=p.MercatorCoordinate.fromLngLat(b),P=D.x-w.x,O=D.y-w.y,z=F.x-A.x,G=F.y-A.y,Z=Math.sqrt((z*z+G*G)/(P*P+O*O));return Math.log(Z)/Math.LN2}function Oo(m,o,d){const _=Math.cos(d),b=Math.sin(d);return{x:m*_-o*b,y:m*b+o*_}}class rd{constructor(o,d,_,b,w,D,A){this.tileSize=512,this._renderWorldCopies=void 0===w||w,this._minZoom=o||0,this._maxZoom=d||22,this._minPitch=null==_?0:_,this._maxPitch=null==b?60:b,this.setProjection(D),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new al,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new td,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const o=new rd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(o){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||d)&&this._updateCameraOnTerrain(),(o||d)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(o){null==o&&(o={name:"mercator"}),this.projectionOptions=o;const d=this.projection?this.getProjection():void 0;this.projection=p.getProjection(o);const _=this.getProjection();return Be(d,_)?null:(this._calcMatrices(),_)}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.pointGeometry(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const d=-o*Math.PI/180;var _,b,w,D,A,F,P,O,z,G;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(_=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),b=this.rotationMatrix,D=this.angle,A=(w=this.rotationMatrix)[0],F=w[1],P=w[2],O=w[3],z=Math.sin(D),G=Math.cos(D),b[0]=A*G+P*z,b[1]=F*G+O*z,b[2]=A*-z+P*G,b[3]=F*-z+O*G)}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const d=p.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const d=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const o=this._elevation;this._centerAltitude=o.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=o.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let b=0,w=0;for(let D=0;D<d.length;D++){const A=new p.pointGeometry(d[D][0]*this.width,_+d[D][1]*(this.height-_)),F=o.pointCoordinate(A);if(!F)continue;const P=1/Math.hypot(F[0]-this._camera.position[0],F[1]-this._camera.position[1]);b+=F[3]*P,w+=P}return 0===w?NaN:b/w}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const o=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(o),w=this._mercatorZfromZoom(this._maxZoom),D=Math.max(b-_,w);this._setZoom(this._zoomFromMercatorZ(D))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let _;_=o.z<this._camera.position[2]?[d.x,d.y,d.z]:[o.x,o.y,o.z];const b=p.length(p.sub([],this._camera.position,_));return p.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let d=!1;if(o.orientation&&!p.exactEquals(o.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(o.orientation)),o.position){const _=[o.position.x,o.position.y,o.position.z];p.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,d=new ed;return d.position=new p.MercatorCoordinate(o[0],o[1],o[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(o){if(!p.length$1(o))return!1;p.normalize$1(o,o);const d=p.transformQuat([],[0,0,-1],o),_=p.transformQuat([],[0,-1,0],o);if(_[2]<0)return!1;const b=lh(d,_);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(o){const d=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;o[2]=p.clamp(o[2],b/_,b/d),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,_){this._unmodified=!1,this._edgeInsets.interpolate(o,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const d=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(o){const d=[new p.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const _=this.pointCoordinate(new p.pointGeometry(0,0)),b=this.pointCoordinate(new p.pointGeometry(this.width,0)),w=this.pointCoordinate(new p.pointGeometry(this.width,this.height)),D=this.pointCoordinate(new p.pointGeometry(0,this.height)),A=Math.floor(Math.min(_.x,b.x,w.x,D.x)),F=Math.floor(Math.max(_.x,b.x,w.x,D.x)),P=1;for(let O=A-P;O<=F+P;O++)0!==O&&d.push(new p.UnwrappedTileID(O,o))}return d}coveringTiles(o){let d=this.coveringZoomLevel(o);const _=d,b=this.elevation&&!o.isTerrainDEM,w="mercator"===this.projection.name;if(void 0!==o.minzoom&&d<o.minzoom)return[];void 0!==o.maxzoom&&d>o.maxzoom&&(d=o.maxzoom);const D=this.locationCoordinate(this.center),A=this.center.lat,F=1<<d,P=[F*D.x,F*D.y,0],O="globe"===this.projection.name,z=!O,G=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,z),Z=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),H=F*p.mercatorZfromAltitude(1,this.center.lat),U=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),ie=[F*Z.x,F*Z.y,U*(z?1:H)],Y=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,ne=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,oe=o.isTerrainDEM?-ne:this._elevation?this._elevation.getMinElevationBelowMSL():0,ee=this.projection.isReprojectedInTileSpace?eu(this):1,ae=Re=>{const ft=new p.MercatorCoordinate(Re.x+25e-6,Re.y,Re.z),at=new p.MercatorCoordinate(Re.x,Re.y+25e-6,Re.z),nt=Re.toLngLat(),vt=ft.toLngLat(),It=at.toLngLat(),yt=this.locationCoordinate(nt),Dt=this.locationCoordinate(vt),rn=this.locationCoordinate(It),oi=Math.hypot(Dt.x-yt.x,Dt.y-yt.y),hr=Math.hypot(rn.x-yt.x,rn.y-yt.y);return Math.sqrt(oi*hr)*ee/25e-6},ve=Re=>{const st=ne,ft=oe;return{aabb:p.tileAABB(this,F,0,0,0,Re,ft,st,this.projection),zoom:0,x:0,y:0,minZ:ft,maxZ:st,wrap:Re,fullyVisible:!1}},Me=[];let Fe=[];const Te=d,Ze=o.reparseOverscaled?_:d,ye=Re=>Re*Re,He=ye((U-this._centerAltitude)*H),Ue=Re=>{if(!this._elevation||!Re.tileID||!w)return;const st=this._elevation.getMinMaxForTile(Re.tileID),ft=Re.aabb;st?(ft.min[2]=st.min,ft.max[2]=st.max,ft.center[2]=(ft.min[2]+ft.max[2])/2):(Re.shouldSplit=rt(Re),Re.shouldSplit||(ft.min[2]=ft.max[2]=ft.center[2]=this._centerAltitude))},rt=Re=>{if(Re.zoom<te)return!0;if(Re.zoom===Te)return!1;if(null!=Re.shouldSplit)return Re.shouldSplit;const st=Re.aabb.distanceX(ie),ft=Re.aabb.distanceY(ie);let at=He,nt=1;if(O){at=ye(Re.aabb.distanceZ(ie));const It=Math.pow(2,Re.zoom),yt=p.latFromMercatorY((Re.y+1)/It),Dt=p.latFromMercatorY(Re.y/It),rn=Math.min(Math.max(A,yt),Dt),oi=p.circumferenceAtLatitude(rn)/p.circumferenceAtLatitude(A);nt=Math.min(oi,1)}else if(b&&(at=ye(Re.aabb.distanceZ(ie)*H)),this.projection.isReprojectedInTileSpace&&_<=5){const It=Math.pow(2,Re.zoom),yt=ae(new p.MercatorCoordinate((Re.x+.5)/It,(Re.y+.5)/It));nt=yt>.85?1:yt}const vt=st*st+ft*ft+at;return vt<ye((1<<Te-Re.zoom)*Y*nt*((It,yt)=>{if(yt*ye(.707)<It)return 1;const Dt=Math.sqrt(yt/It);return Dt/(1.4144271570014144+(Math.pow(1.1,Dt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(at,He),vt))};if(this.renderWorldCopies)for(let Re=1;Re<=3;Re++)Me.push(ve(-Re)),Me.push(ve(Re));for(Me.push(ve(0));Me.length>0;){const Re=Me.pop(),st=Re.x,ft=Re.y;let at=Re.fullyVisible;if(!at){const nt=Re.aabb.intersects(G);if(0===nt)continue;at=2===nt}if(Re.zoom!==Te&&rt(Re))for(let nt=0;nt<4;nt++){const vt=(st<<1)+nt%2,It=(ft<<1)+(nt>>1),yt={aabb:w?Re.aabb.quadrant(nt):p.tileAABB(this,F,Re.zoom+1,vt,It,Re.wrap,Re.minZ,Re.maxZ,this.projection),zoom:Re.zoom+1,x:vt,y:It,wrap:Re.wrap,fullyVisible:at,tileID:void 0,shouldSplit:void 0,minZ:Re.minZ,maxZ:Re.maxZ};b&&!O&&(yt.tileID=new p.OverscaledTileID(Re.zoom+1===Te?Ze:Re.zoom+1,Re.wrap,Re.zoom+1,vt,It),Ue(yt)),Me.push(yt)}else{const nt=Re.zoom===Te?Ze:Re.zoom;if(o.minzoom&&o.minzoom>nt)continue;const vt=P[0]-(.5+st+(Re.wrap<<Re.zoom))*(1<<d-Re.zoom),It=P[1]-.5-ft,yt=Re.tileID?Re.tileID:new p.OverscaledTileID(nt,Re.wrap,Re.zoom,st,ft);Fe.push({tileID:yt,distanceSq:vt*vt+It*It})}}if(this.fogCullDistSq){const Re=this.fogCullDistSq,st=this.horizonLineFromTop();Fe=Fe.filter(ft=>{const at=[0,0,0,1],nt=[p.EXTENT,p.EXTENT,0,1],vt=this.calculateFogTileMatrix(ft.tileID.toUnwrapped());p.transformMat4$1(at,at,vt),p.transformMat4$1(nt,nt,vt);const It=p.getAABBPointSquareDist(at,nt);if(0===It)return!0;let yt=!1;const Dt=this._elevation;if(Dt&&It>Re&&0!==st){const rn=this.calculateProjMatrix(ft.tileID.toUnwrapped());let oi;o.isTerrainDEM||(oi=Dt.getMinMaxForTile(ft.tileID)),oi||(oi={min:oe,max:ne});const hr=p.furthestTileCorner(this.rotation),Si=[hr[0]*p.EXTENT,hr[1]*p.EXTENT,oi.max];p.transformMat4(Si,Si,rn),yt=(1-Si[1])*this.height*.5<st}return It<Re||yt})}return Fe.sort((Re,st)=>Re.distanceSq-st.distanceSq).map(Re=>Re.tileID)}resize(o,d){this.width=o,this.height=d,this.pixelsToGLUnits=[2/o,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const d=p.clamp(o.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=this.projection.project(o.lng,d);return new p.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(o,d){let _,b;const w=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;_=(d.x-w.x)/A,b=(d.y-w.y)/A}else{const A=this.pointCoordinate(d),F=this.pointCoordinate(w);_=A.x-F.x,b=A.y-F.y}const D=this.locationCoordinate(o);this.setLocation(new p.MercatorCoordinate(D.x-_,D.y-b))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this._coordinatePoint(this.locationCoordinate(o),!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,d){const _=d?p.mercatorZfromAltitude(d,o.lat):void 0,b=this.projection.project(o.lng,o.lat);return new p.MercatorCoordinate(b.x,b.y,_)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,d){const _=null!=d?d:this._centerAltitude,b=[o.x,o.y,0,1],w=[o.x,o.y,1,1];p.transformMat4$1(b,b,this.pixelMatrixInverse),p.transformMat4$1(w,w,this.pixelMatrixInverse);const D=w[3];p.scale$1(b,b,1/b[3]),p.scale$1(w,w,1/D);const A=b[2],F=w[2];return{p0:b,p1:w,t:A===F?0:(_-A)/(F-A)}}screenPointToMercatorRay(o){const d=[o.x,o.y,0,1],_=[o.x,o.y,1,1];return p.transformMat4$1(d,d,this.pixelMatrixInverse),p.transformMat4$1(_,_,this.pixelMatrixInverse),p.scale$1(d,d,1/d[3]),p.scale$1(_,_,1/_[3]),d[2]=p.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,_[2]=p.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,p.scale$1(d,d,1/this.worldSize),p.scale$1(_,_,1/this.worldSize),new p.Ray([d[0],d[1],d[2]],p.normalize([],p.sub([],_,d)))}rayIntersectionCoordinate(o){const{p0:d,p1:_,t:b}=o,w=p.mercatorZfromAltitude(d[2],this._center.lat),D=p.mercatorZfromAltitude(_[2],this._center.lat);return new p.MercatorCoordinate(p.number(d[0],_[0],b)/this.worldSize,p.number(d[1],_[1],b)/this.worldSize,p.number(w,D,b))}pointCoordinate(o,d=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,d)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);const d=this.elevation;let _=this.elevation.pointCoordinate(o);if(_)return new p.MercatorCoordinate(_[0],_[1],_[2]);let b=0,w=this.horizonLineFromTop();if(o.y>w)return this.pointCoordinate(o);const D=.02*w,A=o.clone();for(let F=0;F<10&&w-b>D;F++){A.y=p.number(b,w,.66);const P=d.pointCoordinate(A);P?(w=A.y,_=P):b=A.y}return _?new p.MercatorCoordinate(_[0],_[1],_[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){if(this.elevation)return!this.elevation.pointCoordinate(o);{const d=this.horizonLineFromTop();return o.y<d}}_coordinatePoint(o,d){const _=d&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,b=[o.x*this.worldSize,o.y*this.worldSize,_+o.toAltitude(),1];return p.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new p.pointGeometry(b[0]/b[3],b[1]/b[3]):new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,d){const _=new p.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),b=new p.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),w=new p.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),D=new p.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let A=this.pointCoordinate(_,o),F=this.pointCoordinate(b,o);const P=this.pointCoordinate(w,d),O=this.pointCoordinate(D,d),z=(G,Z)=>(Z.y-G.y)/(Z.x-G.x);return A.y>1&&F.y>=0?A=new p.MercatorCoordinate((1-O.y)/z(O,A)+O.x,1):A.y<0&&F.y<=1&&(A=new p.MercatorCoordinate(-O.y/z(O,A)+O.x,0)),F.y>1&&A.y>=0?F=new p.MercatorCoordinate((1-P.y)/z(P,F)+P.x,1):F.y<0&&A.y<=1&&(F=new p.MercatorCoordinate(-P.y/z(P,F)+P.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(P))}_getBounds3D(){const o=this.elevation;if(!o.visibleDemTiles.length)return this._getBounds(0,0);const d=o.visibleDemTiles.reduce((_,b)=>{if(b.dem){const w=b.dem.tree;_.min=Math.min(_.min,w.minimums[0]),_.max=Math.max(_.max,w.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBounds(d.min*o.exaggeration(),d.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-d*(1-this._horizonShift);return o?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,d){return this.projection.createTileMatrix(this,d,o)}calculateDistanceTileData(o){const d=o.key,_=this._distanceTileDataCache;if(_[d])return _[d];const b=o.canonical,w=1/this.height,D=this.cameraWorldSize/this.zoomScale(b.z),A=(b.x+Math.pow(2,b.z)*o.wrap)*D,F=b.y*D,P=this.point,O=this.angle,z=Math.sin(-O),G=-Math.cos(-O);return _[d]={bearing:[z,G],center:[(P.x-A)*w,(P.y-F)*w],scale:D/p.EXTENT*w},_[d]}calculateFogTileMatrix(o){const d=o.key,_=this._fogTileMatrixCache;if(_[d])return _[d];const b=this.calculatePosMatrix(o,this.cameraWorldSize);return p.multiply$1(b,this.worldToFogMatrix,b),_[d]=new Float32Array(b),_[d]}calculateProjMatrix(o,d=!1){const _=o.key,b=d?this._alignedProjMatrixCache:this._projMatrixCache;if(b[_])return b[_];const w=this.calculatePosMatrix(o,this.worldSize);return p.multiply$1(w,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,w),b[_]=new Float32Array(w),b[_]}calculatePixelsToTileUnitsMatrix(o){const d=o.tileID.key,_=this._pixelsToTileUnitsCache;if(_[d])return _[d];const b=function(w,D){const{scale:A}=w.tileTransform,F=A*p.EXTENT/(w.tileSize*Math.pow(2,D.zoom-w.tileID.overscaledZ+w.tileID.canonical.z));return P=new Float32Array(4),G=(O=D.inverseAdjustmentMatrix)[1],Z=O[2],H=O[3],ie=(z=[F,F])[1],P[0]=O[0]*(U=z[0]),P[1]=G*U,P[2]=Z*ie,P[3]=H*ie,P;var P,O,z,G,Z,H,U,ie}(o,this);return _[d]=b,_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const d=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),b=this._camera.forward(),w=p.mercatorZfromAltitude(1,this._center.lat);_[2]/=w,b[2]/=w,p.normalize(b,b);const D=o.raycast(_,b,o.exaggeration());if(D){const A=p.scaleAndAdd([],_,b,D),F=new p.MercatorCoordinate(A[0],A[1],p.mercatorZfromAltitude(A[2],p.latFromMercatorY(A[1]))),P=(F.z+p.length([F.x-_[0],F.y-_[1],F.z-_[2]*w]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=F.toAltitude(),this._center=this.coordinateLocation(F),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const d=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),b=o.getAtPointOrZero(new p.MercatorCoordinate(..._)),w=this._minimumHeightOverTerrain()*Math.cos(p.degToRad(this._maxPitch)),D=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*b;if(D<w){const A=this.locationCoordinate(this._center,this._centerAltitude),F=[A.x-_[0],A.y-_[1],A.z-_[2]],P=p.length(F);F[2]-=(w-D)/this._projectionScaler;const O=p.length(F);if(0===O)return;p.scale$2(F,F,P/O*this._projectionScaler),this._camera.position=[A.x-F[0],A.y-F[1],A.z*this._projectionScaler-F[2]],this._camera.orientation=lh(F,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const z=this.center;return z.lat=p.clamp(z.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(z.lng=p.clamp(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}const o=this._unmodified,{x:d,y:_}=this.point;let b=0,w=d,D=_;const A=this.width/2,F=this.height/2,P=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(_-F<P&&(D=P+F),_+F>O&&(D=O-F),O-P<this.height&&(b=Math.max(b,this.height/(O-P)),D=(O+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const z=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,Z=this.worldSize/2-(z+G)/2;w=(d+Z+this.worldSize)%this.worldSize-Z,w-A<z&&(w=z+A),w+A>G&&(w=G-A),G-z<this.width&&(b=Math.max(b,this.width/(G-z)),w=(G+z)/2)}w===d&&D===_||(this.center=this.unproject(new p.pointGeometry(w,D))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this._fov/2,d=this.centerOffset,_=this.pixelsPerMeter;this._projectionScaler=_/(p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(o)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?_:1),w=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);w[8]=2*-d.x/this.width,w[9]=2*d.y/this.height;let D=p.mul([],w,b);if(this.projection.isReprojectedInTileSpace){const oe=this.locationCoordinate(this.center),ee=p.identity([]);p.translate(ee,ee,[oe.x*this.worldSize,oe.y*this.worldSize,0]),p.multiply$1(ee,ee,nd(this)),p.translate(ee,ee,[-oe.x*this.worldSize,-oe.y*this.worldSize,0]),p.multiply$1(D,D,ee),this.inverseAdjustmentMatrix=function(ae){const ve=nd(ae,!0);return aa([],[ve[0],ve[1],ve[4],ve[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],D,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=D,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const A=new Float32Array(16);p.identity(A),p.scale(A,A,[1,-1,1]),p.rotateX(A,A,this._pitch),p.rotateZ(A,A,this.angle);const F=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),P=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-d.x/this.width,F[9]=2*(d.y+P)/this.height,this.skyboxMatrix=p.multiply$1(A,F,A);const O=this.point,z=O.x,G=O.y,Z=this.width%2/2,H=this.height%2/2,U=Math.cos(this.angle),ie=Math.sin(this.angle),Y=z-Math.round(z)+U*Z+ie*H,te=G-Math.round(G)+U*H+ie*Z,ne=new Float64Array(D);if(p.translate(ne,ne,[Y>.5?Y-1:Y,te>.5?te-1:te,0]),this.alignedProjMatrix=ne,D=p.create(),p.scale(D,D,[this.width/2,-this.height/2,1]),p.translate(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=p.create(),p.scale(D,D,[1,-1,1]),p.translate(D,D,[-1,-1,0]),p.scale(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=p.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},D=p.invert(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");this.pixelMatrixInverse=D,this.globeMatrix="globe"===this.projection.name?p.calculateGlobeMatrix(this):D,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,d=this.cameraPixelsPerMeter,_=this._camera.position,b=1/this.height,w=[o,o,d];p.scale$2(w,w,b),p.scale$2(_,_,-1),p.multiply$2(_,_,w);const D=p.create();p.translate(D,D,_),p.scale(D,D,w),this.mercatorFogMatrix=D,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,d,b)}_computeCameraPosition(o){const d=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),b=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-o/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-_[0]*w,b.y/this.worldSize-_[1]*w,o/this.worldSize*this._centerAltitude-_[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=o[2];let b=1;_>0&&(b=Math.min((d-this._camera.position[2])/_,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,o,b),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const o=this._camera.position,d=this._camera.forward(),{pitch:_,bearing:b}=this._camera.getPitchBearing(),w=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,D=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),A=Math.max((o[2]-w)/Math.cos(_),D),F=this._zoomFromMercatorZ(A);p.scaleAndAdd(o,o,d,A),this._pitch=p.clamp(_,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(b,-Math.PI,Math.PI),this._setZoom(p.clamp(F,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(o,d){const _=Math.min(o.x,d.x),b=Math.max(o.x,d.x),w=Math.min(o.y,d.y),D=Math.max(o.y,d.y);if(w<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new p.pointGeometry(_,w),new p.pointGeometry(b,D),new p.pointGeometry(_,D),new p.pointGeometry(b,w)],F=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const O of A){const z=this.pointRayIntersection(O);if(z.t<0)return!0;const G=this.rayIntersectionCoordinate(z);if(G.x<F||G.y<0||G.x>P||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.pointGeometry(0,0),new p.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,d){const _=p.length(p.sub([],this._camera.position,o)),b=this._zoomFromMercatorZ(_)+d;return _-this._mercatorZfromZoom(b)}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.pointGeometry(0,o))}}function Li(m,o){let d=!1,_=null;const b=()=>{_=null,d&&(m(),_=setTimeout(b,o),d=!1)};return()=>(d=!0,_||b(),_)}class ch{constructor(o){this._hashName=o&&encodeURIComponent(o),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Li(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,p.window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(o){const d=this._map;if(!d)return"";const _=d.getCenter(),b=Math.round(100*d.getZoom())/100,w=Math.ceil((b*Math.LN2+Math.log(512/360/.5))/Math.LN10),D=Math.pow(10,w),A=Math.round(_.lng*D)/D,F=Math.round(_.lat*D)/D,P=d.getBearing(),O=d.getPitch();let z="";if(z+=o?`/${A}/${F}/${b}`:`${b}/${F}/${A}`,(P||O)&&(z+="/"+Math.round(10*P)/10),O&&(z+=`/${Math.round(O)}`),this._hashName){const G=this._hashName;let Z=!1;const H=p.window.location.hash.slice(1).split("&").map(U=>{const ie=U.split("=")[0];return ie===G?(Z=!0,`${ie}=${z}`):U}).filter(U=>U);return Z||H.push(`${G}=${z}`),`#${H.join("&")}`}return`#${z}`}_getCurrentHash(){const o=p.window.location.hash.replace("#","");if(this._hashName){let d;return o.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(d=_)}),(d&&d[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){const _=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(d[3]||0):o.getBearing();return o.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,o)}}const Lo={linearity:.3,easing:p.bezier(0,0,.3,1)},Yf=p.extend({deceleration:2500,maxSpeed:1400},Lo),uh=p.extend({deceleration:20,maxSpeed:1400},Lo),dh=p.extend({deceleration:1e3,maxSpeed:360},Lo),Qf=p.extend({deceleration:1e3,maxSpeed:90},Lo);class sd{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=p.exported.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new p.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const w=Nn(d.pan.mag(),_,p.extend({},Yf,o||{}));b.offset=d.pan.mult(w.amount/d.pan.mag()),b.center=this._map.transform.center,tu(b,w)}if(d.zoom){const w=Nn(d.zoom,_,uh);b.zoom=this._map.transform.zoom+w.amount,tu(b,w)}if(d.bearing){const w=Nn(d.bearing,_,dh);b.bearing=this._map.transform.bearing+p.clamp(w.amount,-179,179),tu(b,w)}if(d.pitch){const w=Nn(d.pitch,_,Qf);b.pitch=this._map.transform.pitch+w.amount,tu(b,w)}if(b.zoom||b.bearing){const w=void 0===d.pinchAround?d.around:d.pinchAround;b.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function tu(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function Nn(m,o,d){const{maxSpeed:_,linearity:b,deceleration:w}=d,D=p.clamp(m*b/(o/1e3),-_,_),A=Math.abs(D)/(w*b);return{easing:d.easing,duration:1e3*A,amount:D*(A/2)}}class Gr extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,_,b={}){const w=ts(d.getCanvasContainer(),_),D=d.unproject(w);super(o,p.extend({point:w,lngLat:D,originalEvent:_},b)),this._defaultPrevented=!1,this.target=d}}class jl extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,_){const b="touchend"===o?_.changedTouches:_.touches,w=on(d.getCanvasContainer(),b),D=w.map(F=>d.unproject(F)),A=w.reduce((F,P,O,z)=>F.add(P.div(z.length)),new p.pointGeometry(0,0));super(o,{points:w,point:A,lngLats:D,lngLat:d.unproject(A),originalEvent:_}),this._defaultPrevented=!1}}class hh extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,_){super(o,{originalEvent:_}),this._defaultPrevented=!1}}class Pm{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new hh(o.type,this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new Gr(o.type,this._map,o))}mouseup(o){this._map.fire(new Gr(o.type,this._map,o))}preclick(o){const d=p.extend({},o);d.type="preclick",this._map.fire(new Gr(d.type,this._map,d))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Gr(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Gr(o.type,this._map,o))}mouseover(o){this._map.fire(new Gr(o.type,this._map,o))}mouseout(o){this._map.fire(new Gr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new jl(o.type,this._map,o))}touchmove(o){this._map.fire(new jl(o.type,this._map,o))}touchend(o){this._map.fire(new jl(o.type,this._map,o))}touchcancel(o){this._map.fire(new jl(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hs{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Gr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Gr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Om{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&0===o.button&&(Fr(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const _=d;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=_,this._box||(this._box=Bt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const w=Math.min(b.x,_.x),D=Math.max(b.x,_.x),A=Math.min(b.y,_.y),F=Math.max(b.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${A}px)`,this._box.style.width=D-w+"px",this._box.style.height=F-A+"px")})}mouseupWindow(o,d){if(!this._active||0!==o.button)return;const _=this._startPos,b=d;if(this.reset(),es(),_.x!==b.x||_.y!==b.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:w=>w.fitScreenCoordinates(_,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),$u(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new p.Event(o,{originalEvent:d}))}}function Gn(m,o){const d={};for(let _=0;_<m.length;_++)d[m[_].identifier]=o[_];return d}class qs{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=o.timeStamp),_.length===this.numTouches&&(this.centroid=function(b){const w=new p.pointGeometry(0,0);for(const D of b)w._add(D);return w.div(b.length)}(d),this.touches=Gn(_,d)))}touchmove(o,d,_){if(this.aborted||!this.centroid)return;const b=Gn(_,d);for(const w in this.touches){const D=this.touches[w],A=b[w];(!A||A.dist(D)>30)&&(this.aborted=!0)}}touchend(o,d,_){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Ul{constructor(o){this.singleTap=new qs(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,d,_){this.singleTap.touchstart(o,d,_)}touchmove(o,d,_){this.singleTap.touchmove(o,d,_)}touchend(o,d,_){const b=this.singleTap.touchend(o,d,_);if(b){const w=o.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(b)<30;if(w&&D||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class We{constructor(){this._zoomIn=new Ul({numTouches:1,numTaps:2}),this._zoomOut=new Ul({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,_){this._zoomIn.touchstart(o,d,_),this._zoomOut.touchstart(o,d,_)}touchmove(o,d,_){this._zoomIn.touchmove(o,d,_),this._zoomOut.touchmove(o,d,_)}touchend(o,d,_){const b=this._zoomIn.touchend(o,d,_),w=this._zoomOut.touchend(o,d,_);return b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()+1,around:D.unproject(b)},{originalEvent:o})}):w?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()-1,around:D.unproject(w)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Jf={0:1,2:2};class fh{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,d){return!1}_move(o,d){return{}}mousedown(o,d){if(this._lastPoint)return;const _=$a(o);this._correctButton(o,_)&&(this._lastPoint=d,this._eventButton=_)}mousemoveWindow(o,d){const _=this._lastPoint;if(_)if(o.preventDefault(),null!=this._eventButton&&function(b,w){const D=Jf[w];return void 0===b.buttons||(b.buttons&D)!==D}(o,this._eventButton))this.reset();else if(this._moved||!(d.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(_,d)}mouseupWindow(o){this._lastPoint&&$a(o)===this._eventButton&&(this._moved&&es(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wa extends fh{mousedown(o,d){super.mousedown(o,d),this._lastPoint&&(this._active=!0)}_correctButton(o,d){return 0===d&&!o.ctrlKey}_move(o,d){return{around:d,panDelta:d.sub(o)}}}class tr extends fh{_correctButton(o,d){return 0===d&&o.ctrlKey||2===d}_move(o,d){const _=.8*(d.x-o.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(o){o.preventDefault()}}class ph extends fh{_correctButton(o,d){return 0===d&&o.ctrlKey||2===d}_move(o,d){const _=-.5*(d.y-o.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(o){o.preventDefault()}}class od{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.pointGeometry(0,0)}touchstart(o,d,_){return this._calculateTransform(o,d,_)}touchmove(o,d,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.preventDefault(),this._calculateTransform(o,d,_)}}touchend(o,d,_){this._calculateTransform(o,d,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,_){_.length>0&&(this._active=!0);const b=Gn(_,d),w=new p.pointGeometry(0,0),D=new p.pointGeometry(0,0);let A=0;for(const P in b){const O=b[P],z=this._touches[P];z&&(w._add(O),D._add(O.sub(z)),A++,b[P]=O)}if(this._touches=b,A<this._minTouches||!D.mag())return;const F=D.div(A);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(A),panDelta:F}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Bt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Bo{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,d,_){return{}}touchstart(o,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,_){const b=this._firstTwoTouches;if(!b)return;o.preventDefault();const[w,D]=b,A=nr(_,d,w),F=nr(_,d,D);if(!A||!F)return;const P=this._aroundCenter?null:A.add(F).div(2);return this._move([A,F],P,o)}touchend(o,d,_){if(!this._firstTwoTouches)return;const[b,w]=this._firstTwoTouches,D=nr(_,d,b),A=nr(_,d,w);D&&A||(this._active&&es(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function nr(m,o,d){for(let _=0;_<m.length;_++)if(m[_].identifier===d)return o[_]}function ad(m,o){return Math.log(m/o)/Math.LN2}class ld extends Bo{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const _=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(ad(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ad(this._distance,_),pinchAround:d}}}function mh(m,o){return 180*m.angleWith(o)/Math.PI}class Ws extends Bo{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d){const _=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:mh(this._vector,_),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,_=mh(o,this._startVector);return Math.abs(_)<d}}function Gl(m){return Math.abs(m.y)>Math.abs(m.x)}class $l extends Bo{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Gl(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,_){const b=this._lastPoints;if(!b)return;const w=o[0].sub(b[0]),D=o[1].sub(b[1]);return this._map._cooperativeGestures&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(w,D,_.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(w.y+D.y)/2*-.5})}gestureBeginsVertically(o,d,_){if(void 0!==this._valid)return this._valid;const b=o.mag()>=2,w=d.mag()>=2;if(!b&&!w)return;if(!b||!w)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const D=o.y>0==d.y>0;return Gl(o)&&Gl(d)&&D}}const zt={panStep:100,bearingStep:15,pitchStep:10};class Lm{constructor(){const o=zt;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,_=0,b=0,w=0,D=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?_=-1:(o.preventDefault(),w=-1);break;case 39:o.shiftKey?_=1:(o.preventDefault(),w=1);break;case 38:o.shiftKey?b=1:(o.preventDefault(),D=-1);break;case 40:o.shiftKey?b=-1:(o.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:A=>{const F=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:ep,zoom:d?Math.round(F)+d*(o.shiftKey?2:1):F,bearing:A.getBearing()+_*this._bearingStep,pitch:A.getPitch()+b*this._pitchStep,offset:[-w*this._panStep,-D*this._panStep],center:A.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ep(m){return m*(2-m)}const gh=4.000244140625;class tp{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=o.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const _=p.exported.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==d&&d%gh==0?this._type="wheel":0!==d&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=ts(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,d=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(0!==this._delta){const F="wheel"===this._type&&Math.abs(this._delta)>gh?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&0!==P&&(P=1/P);const O=d(),z=Math.pow(2,O),G="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(G*P))),"wheel"===this._type&&(this._startZoom=d(),this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:d(),b=this._startZoom,w=this._easing;let D,A=!1;if("wheel"===this._type&&b&&w){const F=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),P=w(F);D=p.number(b,_,P),F<1?this._frameId||(this._frameId=!0):A=!0}else D=_,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:D-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=p.ease;if(this._prevEase){const _=this._prevEase,b=(p.exported.now()-_.start)/_.duration,w=_.easing(b+.01)-_.easing(b),D=.27/Math.sqrt(w*w+1e-4)*.01,A=Math.sqrt(.0729-D*D);d=p.bezier(D,A,.25,1)}return this._prevEase={start:p.exported.now(),duration:o,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Bt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!p.window.document.fullscreenElement||!!p.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class _h{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class np{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,d){return o.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(o.shiftKey?-1:1),around:_.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yh{constructor(){this._tap=new Ul({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,d,_){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=d[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(o,d,_))}touchmove(o,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=d[0],w=b.y-this._swipePoint.y;return this._swipePoint=b,o.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(o,d,_)}touchend(o,d,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(o,d,_)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $e{constructor(o,d,_){this._el=o,this._mousePan=d,this._touchPan=_}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bn{constructor(o,d,_){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class No{constructor(o,d,_,b){this._el=o,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const mi=m=>m.zoom||m.drag||m.pitch||m.rotate;class cd extends p.Event{}class Hl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,d){const _=p.sub([],d,o);this.radius=p.length(_[2]<0?p.div([],_,this.constants):[_[0],_[1],0])}projectRay(o){p.div(o,o,this.constants),p.normalize(o,o),p.mul$1(o,o,this.constants);const d=p.scale$2([],o,this.radius);if(d[2]>0){const _=p.scale$2([],[0,0,1],p.dot(d,[0,0,1])),b=p.scale$2([],p.normalize([],[d[0],d[1],0]),this.radius),w=p.add([],d,p.scale$2([],p.sub([],p.add([],b,_),d),2));d[0]=w[0],d[1]=w[1]}return d}}function xr(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class ud{constructor(o,d){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new sd(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Hl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),p.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[b,w,D]of this._listeners)b.addEventListener(w,b===p.window.document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(const[o,d,_]of this._listeners)o.removeEventListener(d,o===p.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(o){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new Pm(d,o));const b=d.boxZoom=new Om(d,o);this._add("boxZoom",b);const w=new We,D=new np;d.doubleClickZoom=new _h(D,w),this._add("tapZoom",w),this._add("clickZoom",D);const A=new yh;this._add("tapDragZoom",A);const F=d.touchPitch=new $l(d);this._add("touchPitch",F);const P=new tr(o),O=new ph(o);d.dragRotate=new bn(o,P,O),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const z=new wa(o),G=new od(d,o);d.dragPan=new $e(_,z,G),this._add("mousePan",z),this._add("touchPan",G,["touchZoom","touchRotate"]);const Z=new Ws,H=new ld;d.touchZoomRotate=new No(_,H,Z,A),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Hs(d));const U=d.scrollZoom=new tp(d,this);this._add("scrollZoom",U,["mousePan"]);const ie=d.keyboard=new Lm;this._add("keyboard",ie);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[Y]&&d[Y].enable(o[Y])}_add(o,d,_){this._handlers.push({handlerName:o,handler:d,allowed:_}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!mi(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,d,_){for(const b in o)if(b!==_&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const d=[];for(const _ of o)this._el.contains(_.target)&&d.push(_);return d}handleEvent(o,d){this._updatingCamera=!0;const _="renderFrame"===o.type,b=_?void 0:o,w={needsRenderFrame:!1},D={},A={},F=o.touches?this._getMapTouches(o.touches):void 0,P=F?on(this._el,F):_?void 0:ts(this._el,o);for(const{handlerName:G,handler:Z,allowed:H}of this._handlers){if(!Z.isEnabled())continue;let U;this._blockedByActive(A,H,G)?Z.reset():Z[d||o.type]&&(U=Z[d||o.type](o,P,F),this.mergeHandlerResult(w,D,U,G,b),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||Z.isActive())&&(A[G]=Z)}const O={};for(const G in this._previousActiveHandlers)A[G]||(O[G]=b);this._previousActiveHandlers=A,(Object.keys(O).length||xr(w))&&(this._changes.push([w,D,O]),this._triggerRenderFrame()),(Object.keys(A).length||xr(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=w;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(o,d,_,b,w){if(!_)return;p.extend(o,_);const D={handlerName:b,originalEvent:_.originalEvent||w};void 0!==_.zoomDelta&&(d.zoom=D),void 0!==_.panDelta&&(d.drag=D),void 0!==_.pitchDelta&&(d.pitch=D),void 0!==_.bearingDelta&&(d.rotate=D)}_applyChanges(){const o={},d={},_={};for(const[b,w,D]of this._changes)b.panDelta&&(o.panDelta=(o.panDelta||new p.pointGeometry(0,0))._add(b.panDelta)),b.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(o.around=b.around),void 0!==b.aroundCoord&&(o.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(o.pinchAround=b.pinchAround),b.noInertia&&(o.noInertia=b.noInertia),p.extend(d,w),p.extend(_,D);this._updateMapTransform(o,d,_),this._changes=[]}_updateMapTransform(o,d,_){const b=this._map,w=b.transform,D=te=>[te.x,te.y,te.z];if((te=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!xr(o)){const te=w.zoom;w.cameraElevationReference="sea",w.recenterOnTerrain(),w.cameraElevationReference="ground",te!==w.zoom&&this._map._update(!0)}if(!xr(o))return void this._fireEvents(d,_,!0);let{panDelta:A,zoomDelta:F,bearingDelta:P,pitchDelta:O,around:z,aroundCoord:G,pinchAround:Z}=o;void 0!==Z&&(z=Z),(te=>d.drag&&!this._eventsInProgress.drag)()&&z&&(this._dragOrigin=D(w.pointCoordinate3D(z)),this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",b._stop(!0),z=z||b.transform.centerPoint,P&&(w.bearing+=P),O&&(w.pitch+=O),w._updateCameraState();const H=[0,0,0];if(A){const te=w.pointCoordinate(z);if("globe"===w.projection.name){const ne=p.latFromMercatorY(te.y),oe=w.center.lat,ee=Math.min(p.mercatorZfromAltitude(1,ne)/p.mercatorZfromAltitude(1,oe),2);A=A.rotate(-w.angle),H[0]=-A.x/w.worldSize*ee,H[1]=-A.y/w.worldSize*ee}else{const ne=w.pointCoordinate(z.sub(A));te&&ne&&(H[0]=ne.x-te.x,H[1]=ne.y-te.y)}}const U=w.zoom,ie=[0,0,0];if(F){const te=D(G||w.pointCoordinate3D(z)),ne={dir:p.normalize([],p.sub([],te,w._camera.position))};if(ne.dir[2]<0){const oe=w.zoomDeltaToMovement(te,F);p.scale$2(ie,ne.dir,oe)}}const Y=p.add(H,H,ie);w._translateCameraConstrained(Y),F&&Math.abs(w.zoom-U)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,_,!0)}_fireEvents(o,d,_){const b=mi(this._eventsInProgress),w=mi(o),D={};for(const O in o){const{originalEvent:z}=o[O];this._eventsInProgress[O]||(D[`${O}start`]=z),this._eventsInProgress[O]=o[O]}!b&&w&&this._fireEvent("movestart",w.originalEvent);for(const O in D)this._fireEvent(O,D[O]);w&&this._fireEvent("move",w.originalEvent);for(const O in o){const{originalEvent:z}=o[O];this._fireEvent(O,z)}const A={};let F;for(const O in this._eventsInProgress){const{handlerName:z,originalEvent:G}=this._eventsInProgress[O];this._handlersById[z].isActive()||(delete this._eventsInProgress[O],F=d[z]||G,A[`${O}end`]=F)}for(const O in A)this._fireEvent(O,A[O]);const P=mi(this._eventsInProgress);if(_&&(b||w)&&!P){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=G=>0!==G&&-this._bearingSnap<G&&G<this._bearingSnap;O?(z(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:F})):(this._map.fire(new p.Event("moveend",{originalEvent:F})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new p.Event(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new cd("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ql="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ip extends p.Evented{constructor(o,d){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=d.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}panBy(o,d,_){return o=p.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,p.extend({offset:o},d),_)}panTo(o,d,_){return this.easeTo(p.extend({center:o},d),_)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,_){return this.easeTo(p.extend({zoom:o},d),_)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,_){return this.easeTo(p.extend({bearing:o},d),_)}resetNorth(o,d){return this.rotateTo(0,p.extend({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}cameraForBounds(o,d){o=p.LngLatBounds.convert(o);const _=d&&d.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),_,d)}_extendCameraOptions(o){const d={top:0,bottom:0,right:0,left:0};if("number"==typeof(o=p.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding){const _=o.padding;o.padding={top:_,bottom:_,right:_,left:_}}return o.padding=p.extend(d,o.padding),o}_cameraForBoxAndBearing(o,d,_,b){const w=this._extendCameraOptions(b),D=this.transform,A=D.padding,F=D.project(p.LngLat.convert(o)),P=D.project(p.LngLat.convert(d)),O=new p.pointGeometry(F.x,P.y),z=new p.pointGeometry(P.x,F.y),G=-p.degToRad(_),Z=F.rotate(G),H=P.rotate(G),U=O.rotate(G),ie=z.rotate(G),Y=new p.pointGeometry(Math.max(Z.x,H.x,U.x,ie.x),Math.max(Z.y,H.y,U.y,ie.y)),te=new p.pointGeometry(Math.min(Z.x,H.x,U.x,ie.x),Math.min(Z.y,H.y,U.y,ie.y)),ne=Y.sub(te),oe=(D.width-((A.left||0)+(A.right||0)+w.padding.left+w.padding.right))/ne.x,ee=(D.height-((A.top||0)+(A.bottom||0)+w.padding.top+w.padding.bottom))/ne.y;if(ee<0||oe<0)return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ae=Math.min(D.scaleZoom(D.scale*Math.min(oe,ee)),w.maxZoom),ve="number"==typeof w.offset.x&&"number"==typeof w.offset.y?new p.pointGeometry(w.offset.x,w.offset.y):p.pointGeometry.convert(w.offset),Me=new p.pointGeometry((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(_*Math.PI/180),Fe=ve.add(Me).mult(D.scale/D.zoomScale(ae));return{center:D.unproject(F.add(P).div(2).sub(Fe)),zoom:ae,bearing:_}}_cameraForBox(o,d,_,b,w){const D=this._extendCameraOptions(w);_=_||0,b=b||0,o=p.LngLat.convert(o),d=p.LngLat.convert(d);const A=this.transform.clone();A.padding=D.padding;const F=this.getFreeCameraOptions(),P=new p.LngLat(.5*(o.lng+d.lng),.5*(o.lat+d.lat)),O=.5*(_+b);if(A._camera.position[2]<p.mercatorZfromAltitude(O,P.lat))return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");F.lookAtPoint(P),A.setFreeCameraOptions(F);const z=p.MercatorCoordinate.fromLngLat(o),G=p.MercatorCoordinate.fromLngLat(d),Z=A.pointRayIntersection(A.centerPoint,O),H=[(U=A.rayIntersectionCoordinate(Z)).x,U.y,U.z];var U;const ie=A.screenPointToMercatorRay(A.centerPoint),Y="globe"!==A.projection.name;let te,ne=0;do{const oe=Math.floor(A.zoom),ee=1<<oe,ae=Math.min(ee*z.x,ee*G.x),ve=Math.min(ee*z.y,ee*G.y),Me=Math.max(ee*z.x,ee*G.x),Fe=Math.max(ee*z.y,ee*G.y),Te=new p.Aabb([ae,ve,_],[Me,Fe,b]),Ze=p.Frustum.fromInvProjectionMatrix(A.invProjMatrix,A.worldSize,oe,Y);if(2!==Te.intersects(Ze)){te&&(A._camera.position=p.scaleAndAdd([],A._camera.position,ie.dir,-te),A._updateStateFromCamera());break}const ye=p.sub([],A._camera.position,H);te=.5*p.length(ye),A._camera.position=p.scaleAndAdd([],A._camera.position,ie.dir,te);try{A._updateStateFromCamera()}catch(He){return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ne<10);return{center:A.center,zoom:A.zoom,bearing:A.bearing,pitch:A.pitch}}fitBounds(o,d,_){return this._fitInternal(this.cameraForBounds(o,d),d,_)}_raycastElevationBox(o,d){const _=this.transform.elevation;if(!_)return;const b=new p.pointGeometry(o.x,d.y),w=new p.pointGeometry(d.x,o.y),D=_.pointCoordinate(o);if(!D)return;const A=_.pointCoordinate(d);if(!A)return;const F=_.pointCoordinate(b);if(!F)return;const P=_.pointCoordinate(w);if(!P)return;const O=new p.MercatorCoordinate(D[0],D[1]).toLngLat(),z=new p.MercatorCoordinate(A[0],A[1]).toLngLat(),G=new p.MercatorCoordinate(F[0],F[1]).toLngLat(),Z=new p.MercatorCoordinate(P[0],P[1]).toLngLat(),H=Math.min(O.lng,Math.min(z.lng,Math.min(G.lng,Z.lng))),U=Math.min(O.lat,Math.min(z.lat,Math.min(G.lat,Z.lat))),ie=Math.max(O.lng,Math.max(z.lng,Math.max(G.lng,Z.lng))),Y=Math.max(O.lat,Math.max(z.lat,Math.max(G.lat,Z.lat))),te=Math.min(D[3],Math.min(A[3],Math.min(F[3],P[3]))),ne=Math.max(D[3],Math.max(A[3],Math.max(F[3],P[3])));return{minLngLat:new p.LngLat(H,U),maxLngLat:new p.LngLat(ie,Y),minAltitude:te,maxAltitude:ne}}fitScreenCoordinates(o,d,_,b,w){let D,A,F,P;const O=p.pointGeometry.convert(o),z=p.pointGeometry.convert(d),G=this._raycastElevationBox(O,z);if(G)D=G.minLngLat,A=G.maxLngLat,F=G.minAltitude,P=G.maxAltitude;else{if(this.transform.anyCornerOffEdge(O,z))return this;D=this.transform.pointLocation(O),A=this.transform.pointLocation(z)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(p.pointGeometry.convert(o)),this.transform.pointLocation(p.pointGeometry.convert(d)),_,b):this._cameraForBox(D,A,F,P,b),b,w)}_fitInternal(o,d,_){return o?(delete(d=p.extend(o,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(o,d){this.stop();const _=o.preloadOnly?this.transform.clone():this.transform;let b=!1,w=!1,D=!1;return"zoom"in o&&_.zoom!==+o.zoom&&(b=!0,_.zoom=+o.zoom),void 0!==o.center&&(_.center=p.LngLat.convert(o.center)),"bearing"in o&&_.bearing!==+o.bearing&&(w=!0,_.bearing=+o.bearing),"pitch"in o&&_.pitch!==+o.pitch&&(D=!0,_.pitch=+o.pitch),null==o.padding||_.isPaddingEqual(o.padding)||(_.padding=o.padding),o.preloadOnly?(this._preloadTiles(_),this):(this.fire(new p.Event("movestart",d)).fire(new p.Event("move",d)),b&&this.fire(new p.Event("zoomstart",d)).fire(new p.Event("zoom",d)).fire(new p.Event("zoomend",d)),w&&this.fire(new p.Event("rotatestart",d)).fire(new p.Event("rotate",d)).fire(new p.Event("rotateend",d)),D&&this.fire(new p.Event("pitchstart",d)).fire(new p.Event("pitch",d)).fire(new p.Event("pitchend",d)),this.fire(new p.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(ql),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,d){const _=this.transform;if(!_.projection.supportsFreeCamera)return p.warnOnce(ql),this;this.stop();const b=_.zoom,w=_.pitch,D=_.bearing;_.setFreeCameraOptions(o);const A=b!==_.zoom,F=w!==_.pitch,P=D!==_.bearing;return this.fire(new p.Event("movestart",d)).fire(new p.Event("move",d)),A&&this.fire(new p.Event("zoomstart",d)).fire(new p.Event("zoom",d)).fire(new p.Event("zoomend",d)),P&&this.fire(new p.Event("rotatestart",d)).fire(new p.Event("rotate",d)).fire(new p.Event("rotateend",d)),F&&this.fire(new p.Event("pitchstart",d)).fire(new p.Event("pitch",d)).fire(new p.Event("pitchend",d)),this.fire(new p.Event("moveend",d)),this}easeTo(o,d){this._stop(!1,o.easeId),(!1===(o=p.extend({offset:[0,0],duration:500,easing:p.ease},o)).animate||!o.essential&&p.exported.prefersReducedMotion)&&(o.duration=0);const _=this.transform,b=this.getZoom(),w=this.getBearing(),D=this.getPitch(),A=this.getPadding(),F="zoom"in o?+o.zoom:b,P="bearing"in o?this._normalizeBearing(o.bearing,w):w,O="pitch"in o?+o.pitch:D,z="padding"in o?o.padding:_.padding,G=p.pointGeometry.convert(o.offset);let Z,H,U;if("globe"===_.projection.name){const Fe=p.MercatorCoordinate.fromLngLat(_.center),Te=G.rotate(-_.angle);Fe.x+=Te.x/_.worldSize,Fe.y+=Te.y/_.worldSize;const Ze=Fe.toLngLat(),ye=p.LngLat.convert(o.center||Ze);this._normalizeCenter(ye),Z=_.centerPoint.add(Te),H=new p.pointGeometry(Fe.x,Fe.y).mult(_.worldSize),U=new p.pointGeometry(p.mercatorXfromLng(ye.lng),p.mercatorYfromLat(ye.lat)).mult(_.worldSize).sub(H)}else{Z=_.centerPoint.add(G);const Fe=_.pointLocation(Z),Te=p.LngLat.convert(o.center||Fe);this._normalizeCenter(Te),H=_.project(Fe),U=_.project(Te).sub(H)}const ie=_.zoomScale(F-b);let Y,te;o.around&&(Y=p.LngLat.convert(o.around),te=_.locationPoint(Y));const ne=this._zooming||F!==b,oe=this._rotating||w!==P,ee=this._pitching||O!==D,ae=!_.isPaddingEqual(z),ve=Fe=>Te=>{if(ne&&(Fe.zoom=p.number(b,F,Te)),oe&&(Fe.bearing=p.number(w,P,Te)),ee&&(Fe.pitch=p.number(D,O,Te)),ae&&(Fe.interpolatePadding(A,z,Te),Z=Fe.centerPoint.add(G)),Y)Fe.setLocationAtPoint(Y,te);else{const Ze=Fe.zoomScale(Fe.zoom-b),ye=F>b?Math.min(2,ie):Math.max(.5,ie),He=Math.pow(ye,1-Te),Ue=Fe.unproject(H.add(U.mult(Te*He)).mult(Ze));Fe.setLocationAtPoint(Fe.renderWorldCopies?Ue.wrap():Ue,Z)}return o.preloadOnly||this._fireMoveEvents(d),Fe};if(o.preloadOnly){const Fe=this._emulate(ve,o.duration,_);return this._preloadTiles(Fe),this}const Me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=oe,this._pitching=ee,this._padding=ae,this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,Me),this._ease(ve(_),Fe=>{_.recenterOnTerrain(),this._afterEase(d,Fe)},o),this}_prepareEase(o,d,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||_.moving||this.fire(new p.Event("movestart",o)),this._zooming&&!_.zooming&&this.fire(new p.Event("zoomstart",o)),this._rotating&&!_.rotating&&this.fire(new p.Event("rotatestart",o)),this._pitching&&!_.pitching&&this.fire(new p.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new p.Event("move",o)),this._zooming&&this.fire(new p.Event("zoom",o)),this._rotating&&this.fire(new p.Event("rotate",o)),this._pitching&&this.fire(new p.Event("pitch",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,b=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.Event("zoomend",o)),b&&this.fire(new p.Event("rotateend",o)),w&&this.fire(new p.Event("pitchend",o)),this.fire(new p.Event("moveend",o))}flyTo(o,d){if(!o.essential&&p.exported.prefersReducedMotion){const at=p.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(at,d)}this.stop(),o=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},o);const _=this.transform,b=this.getZoom(),w=this.getBearing(),D=this.getPitch(),A=this.getPadding(),F="zoom"in o?p.clamp(+o.zoom,_.minZoom,_.maxZoom):b,P="bearing"in o?this._normalizeBearing(o.bearing,w):w,O="pitch"in o?+o.pitch:D,z="padding"in o?o.padding:_.padding,G=_.zoomScale(F-b),Z=p.pointGeometry.convert(o.offset);let H=_.centerPoint.add(Z);const U=_.pointLocation(H),ie=p.LngLat.convert(o.center||U);this._normalizeCenter(ie);const Y=_.project(U),te=_.project(ie).sub(Y);let ne=o.curve;const oe=Math.max(_.width,_.height),ee=oe/G,ae=te.mag();if("minZoom"in o){const at=p.clamp(Math.min(o.minZoom,b,F),_.minZoom,_.maxZoom),nt=oe/_.zoomScale(at-b);ne=Math.sqrt(nt/ae*2)}const ve=ne*ne;function Me(at){const nt=(ee*ee-oe*oe+(at?-1:1)*ve*ve*ae*ae)/(2*(at?ee:oe)*ve*ae);return Math.log(Math.sqrt(nt*nt+1)-nt)}function Fe(at){return(Math.exp(at)-Math.exp(-at))/2}function Te(at){return(Math.exp(at)+Math.exp(-at))/2}const Ze=Me(0);let ye=function(at){return Te(Ze)/Te(Ze+ne*at)},He=function(at){return oe*((Te(Ze)*(Fe(nt=Ze+ne*at)/Te(nt))-Fe(Ze))/ve)/ae;var nt},Ue=(Me(1)-Ze)/ne;if(Math.abs(ae)<1e-6||!isFinite(Ue)){if(Math.abs(oe-ee)<1e-6)return this.easeTo(o,d);const at=ee<oe?-1:1;Ue=Math.abs(Math.log(ee/oe))/ne,He=function(){return 0},ye=function(nt){return Math.exp(at*ne*nt)}}o.duration="duration"in o?+o.duration:1e3*Ue/("screenSpeed"in o?+o.screenSpeed/ne:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const rt=w!==P,Re=O!==D,st=!_.isPaddingEqual(z),ft=at=>nt=>{const vt=nt*Ue,It=1/ye(vt);at.zoom=1===nt?F:b+at.scaleZoom(It),rt&&(at.bearing=p.number(w,P,nt)),Re&&(at.pitch=p.number(D,O,nt)),st&&(at.interpolatePadding(A,z,nt),H=at.centerPoint.add(Z));const yt=1===nt?ie:at.unproject(Y.add(te.mult(He(vt))).mult(It));return at.setLocationAtPoint(at.renderWorldCopies?yt.wrap():yt,H),at._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(d),at};if(o.preloadOnly){const at=this._emulate(ft,o.duration,_);return this._preloadTiles(at),this}return this._zooming=!0,this._rotating=rt,this._pitching=Re,this._padding=st,this._prepareEase(d,!1),this._ease(ft(_),()=>this._afterEase(d),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,d)}if(!o){const _=this.handlers;_&&_.stop(!1)}return this}_ease(o,d,_){!1===_.animate||0===_.duration?(o(1),d()):(this._easeStart=p.exported.now(),this._easeOptions=_,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,d){o=p.wrap(o,-180,180);const _=Math.abs(o-d);return Math.abs(o-360-d)<_&&(o-=360),Math.abs(o+360-d)<_&&(o+=360),o}_normalizeCenter(o){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const _=o.lng-d.center.lng;o.lng+=_>180?-360:_<-180?360:0}_emulate(o,d,_){const b=Math.ceil(15*d/1e3),w=[],D=o(_.clone());for(let A=0;A<=b;A++){const F=D(A/b);w.push(F.clone())}return w}}class dd{constructor(o={}){this.options=o,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const d=this.options&&this.options.compact;return this._map=o,this._container=Bt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Bt("button","mapboxgl-ctrl-attrib-button",this._container),Bt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Bt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===d&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,d){const _=this._map._getUIString(`AttributionControl.${d}`);o.setAttribute("aria-label",_),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(o){const _=d.reduce((b,w,D)=>(w.value&&(b+=`${w.key}=${w.value}${D<d.length-1?"&":""}`),b),"?");o.href=`${p.config.FEEDBACK_URL}/${_}${this._map._hash?this._map._hash.getHashString(!0):""}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._sourceCaches;for(const b in d){const w=d[b];if(w.used){const D=w.getSource();D.attribution&&o.indexOf(D.attribution)<0&&o.push(D.attribution)}}o.sort((b,w)=>b.length-w.length),o=o.filter((b,w)=>{for(let D=w+1;D<o.length;D++)if(o[D].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const _=o.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,o.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class nu{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=Bt("div","mapboxgl-ctrl");const d=Bt("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(0===Object.entries(o).length)return!0;for(const d in o){const _=o[d].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const d=o[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class iu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const b of _)if(b.id===o)return void(b.cancelled=!0)}run(o=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Hi(m,o,d){if(m=new p.LngLat(m.lng,m.lat),o){const _=new p.LngLat(m.lng-360,m.lat),b=new p.LngLat(m.lng+360,m.lat),w=360*Math.ceil(Math.abs(m.lng-d.center.lng)/360),D=d.locationPoint(m).distSqr(o),A=o.x<0||o.y<0||o.x>d.width||o.y>d.height;d.locationPoint(_).distSqr(o)<D&&(A||Math.abs(_.lng-d.center.lng)<w)?m=_:d.locationPoint(b).distSqr(o)<D&&(A||Math.abs(b.lng-d.center.lng)<w)&&(m=b)}for(;Math.abs(m.lng-d.center.lng)>180;){const _=d.locationPoint(m);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;m.lng>d.center.lng?m.lng-=360:m.lng+=360}return m}const Es={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ru extends p.Evented{constructor(o,d){if(super(),(o instanceof p.window.HTMLElement||d)&&(o=p.extend({element:o},d)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),o&&o.element)this._element=o.element,this._offset=p.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Bt("div");const b=41,w=27,D=gt("svg",{display:"block",height:b*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${b}`},this._element),A=gt("radialGradient",{id:"shadowGradient"},gt("defs",{},D));gt("stop",{offset:"10%","stop-opacity":.4},A),gt("stop",{offset:"100%","stop-opacity":.05},A),gt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},D),gt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},D),gt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},D),gt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},D),this._offset=p.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const _=this._element.classList;for(const b in Es)_.remove(`mapboxgl-marker-anchor-${b}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=p.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const d=o.code,_=o.charCode||o.keyCode;"Space"!==d&&"Enter"!==d&&32!==_&&13!==_||this.togglePopup()}_onMapClick(o){const d=o.originalEvent.target,_=this._element;this._popup&&(d===_||_.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const o=this._map;if(!o)return;const d=this._pos;if(!d||d.x<0||d.x>o.transform.width||d.y<0||d.y>o.transform.height)return void this._clearFadeTimer();const _=o.unproject(d);let b=!1;if(o.transform._terrainEnabled()&&o.getTerrain()){const D=o.getFreeCameraOptions();if(D.position){const A=D.position.toLngLat();b=A.distanceTo(_)<.9*A.distanceTo(this._lngLat)}}const w=(1-o._queryFogOpacity(_))*(b?.2:1);this._element.style.opacity=`${w}`,this._popup&&this._popup._setOpacity(`${w}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o)return;const d=this._offset.mult(this._scale),_=this._calculatePitch(),b=this._calculateRotation();this._element.style.transform=`\n            translate(${o.x}px, ${o.y}px) ${Es[this._anchor]}\n            rotateX(${_}deg) rotateZ(${b}deg)\n            translate(${d.x}px, ${d.y}px)\n        `}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:this._map&&"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:this._map&&"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(o){p.window.cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Hi(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),!0===o?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!d.getTerrain()&&!d.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=p.pointGeometry.convert(o),this._update(),this}_onMove(o){const d=this._map;if(d){if(!this._isDragging){const _=this._clickTolerance||d._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(o){const d=this._map;d&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos),this._pointerdownPos=o.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const d=this._map;return d&&(o?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Wl{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const d=p.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,d,_){this._start=this.getValue(d),this._end=o,this._startTime=d,this._endTime=d+_}}const zo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},vh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Zl(m){m.parentNode&&m.parentNode.removeChild(m)}const xh={showCompass:!0,showZoom:!0,visualizePitch:!1};class bh{constructor(o,d,_=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new tr({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,_&&(this.mousePitch=new ph({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(o,d){this.mouseRotate.mousedown(o,d),this.mousePitch&&this.mousePitch.mousedown(o,d),Fr()}move(o,d){const _=this.map,b=this.mouseRotate.mousemoveWindow(o,d),w=b&&b.bearingDelta;if(w&&_.setBearing(_.getBearing()+w),this.mousePitch){const D=this.mousePitch.mousemoveWindow(o,d),A=D&&D.pitchDelta;A&&_.setPitch(_.getPitch()+A)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){$u(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(p.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),ts(this.element,o)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,ts(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=on(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=on(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const dr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let br,Xl=0,Vo=!1;const wh={maxWidth:100,unit:"metric"};function su(m,o,d){const _=d&&d.maxWidth||100,b=m._containerHeight/2,w=m._containerWidth/2-_/2,D=m.unproject([w,b]),A=m.unproject([w+_,b]),F=D.distanceTo(A);if(d&&"imperial"===d.unit){const P=3.2808*F;P>5280?jo(o,_,P/5280,m._getUIString("ScaleControl.Miles"),m):jo(o,_,P,m._getUIString("ScaleControl.Feet"),m)}else d&&"nautical"===d.unit?jo(o,_,F/1852,m._getUIString("ScaleControl.NauticalMiles"),m):F>=1e3?jo(o,_,F/1e3,m._getUIString("ScaleControl.Kilometers"),m):jo(o,_,F,m._getUIString("ScaleControl.Meters"),m)}function jo(m,o,d,_,b){const w=function(A){const F=Math.pow(10,`${Math.floor(A)}`.length-1);let P=A/F;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(O){const z=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*z)/z}(P),F*P}(d),D=w/d;b._requestDomTask(()=>{m.style.width=o*D+"px",m.innerHTML=`${w}&nbsp;${_}`})}const ss={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},$n=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Kl(m=new p.pointGeometry(0,0),o="bottom"){if("number"==typeof m){const d=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(o){case"top":return new p.pointGeometry(0,m);case"top-left":return new p.pointGeometry(d,d);case"top-right":return new p.pointGeometry(-d,d);case"bottom":return new p.pointGeometry(0,-m);case"bottom-left":return new p.pointGeometry(d,-d);case"bottom-right":return new p.pointGeometry(-d,-d);case"left":return new p.pointGeometry(m,0);case"right":return new p.pointGeometry(-m,0)}return new p.pointGeometry(0,0)}return m instanceof p.pointGeometry||Array.isArray(m)?p.pointGeometry.convert(m):p.pointGeometry.convert(m[o]||[0,0])}const cl={version:p.version,supported:Wn,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends ip{constructor(m){if(null!=(m=p.extend({},vh,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(m.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new rd(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._renderTaskQueue=new iu,this._domRenderTaskQueue=new iu,this._controls=[],this._markers=[],this._mapId=p.uniqueId(),this._locale=p.extend({},zo,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Wl(0),this._explicitProjection=null,this._requestManager=new p.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,"string"==typeof m.container){if(this._container=p.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new ud(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new ch("string"==typeof m.hash&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,p.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new dd({customAttribution:m.customAttribution})),this._logoControl=new nu,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new p.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new p.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(m,o){if(void 0===o&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=m.onAdd(this);this._controls.push(m);const _=this._controlPositions[o];return-1!==o.indexOf("bottom")?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new p.Event("movestart",m)).fire(new p.Event("move",m)),this.fire(new p.Event("resize",m)),o&&this.fire(new p.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(p.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=null==m?-2:m)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=null==m?22:m)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=null==m?0:m)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=null==m?85:m)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(m){return this._lazyInitEmptyStyle(),m?"string"==typeof m&&(m={name:m}):m=null,this._updateProjection(m)}_updateProjection(m){null===m&&(this._explicitProjection=null);const o=m||this.getProjection(),d=this.transform.setProjection(o);if(m&&(this._explicitProjection=this.transform.getProjection()),d){this.painter.clearBackgroundTiles();for(const _ in this.style._sourceCaches)this.style._sourceCaches[_].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(m){return this.transform.locationPoint3D(p.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(p.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(m,o,d){if("mouseenter"===m||"mouseover"===m){let _=!1;const b=D=>{const A=o.filter(P=>this.getLayer(P)),F=A.length?this.queryRenderedFeatures(D.point,{layers:A}):[];F.length?_||(_=!0,d.call(this,new Gr(m,this,D.originalEvent,{features:F}))):_=!1},w=()=>{_=!1};return{layers:new Set(o),listener:d,delegates:{mousemove:b,mouseout:w}}}if("mouseleave"===m||"mouseout"===m){let _=!1;const b=D=>{const A=o.filter(F=>this.getLayer(F));(A.length?this.queryRenderedFeatures(D.point,{layers:A}):[]).length?_=!0:_&&(_=!1,d.call(this,new Gr(m,this,D.originalEvent)))},w=D=>{_&&(_=!1,d.call(this,new Gr(m,this,D.originalEvent)))};return{layers:new Set(o),listener:d,delegates:{mousemove:b,mouseout:w}}}{const _=b=>{const w=o.filter(A=>this.getLayer(A)),D=w.length?this.queryRenderedFeatures(b.point,{layers:w}):[];D.length&&(b.features=D,d.call(this,b),delete b.features)};return{layers:new Set(o),listener:d,delegates:{[m]:_}}}}on(m,o,d){if(void 0===d)return super.on(m,o);Array.isArray(o)||(o=[o]);const _=this._createDelegatedListener(m,o,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(const b in _.delegates)this.on(b,_.delegates[b]);return this}once(m,o,d){if(void 0===d)return super.once(m,o);Array.isArray(o)||(o=[o]);const _=this._createDelegatedListener(m,o,d);for(const b in _.delegates)this.once(b,_.delegates[b]);return this}off(m,o,d){if(void 0===d)return super.off(m,o);o=new Set(Array.isArray(o)?o:[o]);const _=(w,D)=>{if(w.size!==D.size)return!1;for(const A of w)if(!D.has(A))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[m]:void 0;return b&&(w=>{for(let D=0;D<w.length;D++){const A=w[D];if(A.listener===d&&_(A.layers,o)){for(const F in A.delegates)this.off(F,A.delegates[F]);return w.splice(D,1),this}}})(b),this}queryRenderedFeatures(m,o){return this.style?(void 0!==o||void 0===m||m instanceof p.pointGeometry||Array.isArray(m)||(o=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(m,o){return this.style.querySourceFeatures(m,o)}queryTerrainElevation(m,o){const d=this.transform.elevation;return d?(o=p.extend({},{exaggerated:!0},o),d.getAtPoint(p.MercatorCoordinate.fromLngLat(m),null,o.exaggerated)):null}setStyle(m,o){return!1!==(o=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(m,o))}_getUIString(m){const o=this._locale[m];if(null==o)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new Lr(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof m?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Lr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,o){if("string"==typeof m){const d=this._requestManager.normalizeStyleURL(m),_=this._requestManager.transformRequest(d,p.ResourceType.Style);p.getJSON(_,(b,w)=>{b?this.fire(new p.ErrorEvent(b)):w&&this._updateDiff(w,o)})}else"object"==typeof m&&this._updateDiff(m,o)}_updateDiff(m,o){try{this.style.setState(m)&&this._update(!0)}catch(d){p.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(m,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(m,o){return this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const o in m){const d=m[o]._tiles;for(const _ in d){const b=d[_];if("loaded"!==b.state&&"errored"!==b.state)return!1}}return!0}addSourceType(m,o,d){this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,d)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,o,{pixelRatio:d=1,sdf:_=!1,stretchX:b,stretchY:w,content:D}={}){if(this._lazyInitEmptyStyle(),o instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&o instanceof p.window.ImageBitmap){const{width:A,height:F,data:P}=p.exported.getImageData(o);this.style.addImage(m,{data:new p.RGBAImage({width:A,height:F},P),pixelRatio:d,stretchX:b,stretchY:w,content:D,sdf:_,version:0})}else if(void 0===o.width||void 0===o.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:F}=o,P=o;this.style.addImage(m,{data:new p.RGBAImage({width:A,height:F},new Uint8Array(P.data)),pixelRatio:d,stretchX:b,stretchY:w,content:D,sdf:_,version:0,userImage:P}),P.onAdd&&P.onAdd(this,m)}}updateImage(m,o){const d=this.style.getImage(m);if(!d)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=o instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&o instanceof p.window.ImageBitmap?p.exported.getImageData(o):o,{width:b,height:w}=_;void 0!==b&&void 0!==w?b===d.data.width&&w===d.data.height?(d.data.replace(_.data,!(o instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&o instanceof p.window.ImageBitmap)),this.style.updateImage(m,d)):this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,o){p.getImage(this._requestManager.transformRequest(m,p.ResourceType.Image),(d,_)=>{o(d,_ instanceof p.window.HTMLImageElement?p.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(m,o){return this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)}moveLayer(m,o){return this.style.moveLayer(m,o),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,o,d){return this.style.setLayerZoomRange(m,o,d),this._update(!0)}setFilter(m,o,d={}){return this.style.setFilter(m,o,d),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,o,d,_={}){return this.style.setPaintProperty(m,o,d,_),this._update(!0)}getPaintProperty(m,o){return this.style.getPaintProperty(m,o)}setLayoutProperty(m,o,d,_={}){return this.style.setLayoutProperty(m,o,d,_),this._update(!0)}getLayoutProperty(m,o){return this.style.getLayoutProperty(m,o)}setLight(m,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(m),this.transform):0}setFeatureState(m,o){return this.style.setFeatureState(m,o),this._update()}removeFeatureState(m,o){return this.style.removeFeatureState(m,o),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let d,_,b,w=this._container;for(;w&&(!_||!b);){const D=p.window.getComputedStyle(w).transform;D&&"none"!==D&&(d=D.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&"0"!==d[0]&&"1"!==d[0]&&(_=d[0]),d[3]&&"0"!==d[3]&&"1"!==d[3]&&(b=d[3])),w=w.parentElement}this._containerWidth=_?Math.abs(m/_):m,this._containerHeight=b?Math.abs(o/b):o}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=Bt("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=Bt("div","mapboxgl-canvas-container",m);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=Bt("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=Bt("div","mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{_[b]=Bt("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,o){const d=p.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(m),this._canvas.height=d*Math.ceil(o),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const o=this._markers.indexOf(m);-1!==o&&this._markers.splice(o,1)}_setupPainter(){const m=p.extend({},Wn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);o?(p.storeAuthState(o,!0),this.painter=new Fm(o,this.transform),this.on("data",d=>{"source"===d.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(o)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let o;const d=this.painter.context.extTimerQuery,_=p.exported.now();if(this.listens("gpu-timing-frame")&&(o=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;let b=!1;const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,P=this.transform.pitch,O=p.exported.now();this.style.zoomHistory.update(F,O);const z=new p.EvaluationParameters(F,{now:O,fadeDuration:w,pitch:P,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),G=z.crossFadingFactor();1===G&&G===this._crossFadingFactor||(b=!0,this._crossFadingFactor=G),this.style.update(z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let D=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),D=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerUpdate()):D=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const F=p.exported.now()-_;d.endQueryEXT(d.TIME_ELAPSED_EXT,o),setTimeout(()=>{const P=d.getQueryObjectEXT(o,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(o),this.fire(new p.Event("gpu-timing-frame",{cpuTime:F,gpuTime:P}))},50)}if(this.listens("gpu-timing-layer")){const F=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(F);this.fire(new p.Event("gpu-timing-layer",{layerTimes:P}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||D;if(A||this._repaint)this.triggerRepaint();else{const F=!this.isMoving()&&this.loaded();if(F&&(D=this._updateAverageElevation(_,!0)),D)this.triggerRepaint();else if(this._triggerFrame(!1),F&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const m of this._markers)m._update()}_updateAverageElevation(m,o=!1){const d=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&d(0);if((o||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const _=this.transform.averageElevation;let b=this.transform.sampleAverageElevation(),w=!1;this.transform.elevation&&(w=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=m;const D=Math.abs(_-b);if(D>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(b),d(b);this._averageElevation.easeTo(b,m,300)}else if(D>1e-4)return this._averageElevation.jumpTo(b),d(b)}return!!this._averageElevation.isEasing(m)&&d(this._averageElevation.getValue(m))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===p.AUTH_ERR_MSG||401===m.status)){const o=this.painter.context.gl;p.storeAuthState(o,!1),this._logoControl instanceof nu&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const d=this.painter.context.gl,_=d.createFramebuffer();function b(w){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,w,0);const D=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,D),D}return d.bindFramebuffer(d.FRAMEBUFFER,_),this._canvasPixelComparison(b(m),o.canvasCopies.map(b),o.timeStamps)}_canvasPixelComparison(m,o,d){let _=d[1]-d[0];const b=m.length/4;for(let w=0;w<o.length;w++){const D=o[w];let A=0;for(let F=0;F<D.length;F+=4)D[F]===m[F]&&D[F+1]===m[F+1]&&D[F+2]===m[F+2]&&D[F+3]===m[F+3]&&(A+=1);_+=(d[w+2]-d[w+1])*(1-A/b)}return _}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),Zl(this._canvasContainer),Zl(this._controlContainer),Zl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=p.exported.frame(o=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(o)}))}_preloadTiles(m){const o=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(o,(d,_)=>d._preloadTiles(m,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,o){p.setCacheLimits(m,o)}get version(){return p.version}},NavigationControl:class{constructor(m){this.options=p.extend({},xh,m),this._container=Bt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),Bt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),Bt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:o}):d.resetNorth({},{originalEvent:o}))}),this._compassIcon=Bt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const o=m.getZoom(),d=o===m.getMaxZoom(),_=o===m.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bh(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,o){const d=Bt("button",m,this._container);return d.type="button",d.addEventListener("click",o),d}_setButtonTitle(m,o){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${o}`);m.setAttribute("aria-label",d),m.firstElementChild&&m.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends p.Evented{constructor(m){super(),this.options=p.extend({},dr,m),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Li(this._updateMarkerRotation,20)}onAdd(m){var o;return this._map=m,this._container=Bt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,void 0!==br?o(br):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(d=>{br="denied"!==d.state,o(br)}):(br=!!p.window.navigator.geolocation,o(br)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Xl=0,Vo=!1}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),d=m.coords;return!!o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",m)),this._finish()}}_updateCamera(m){const o=new p.LngLat(m.coords.longitude,m.coords.latitude),d=m.coords.accuracy,_=this._map.getBearing(),b=p.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(d),b,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new p.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._containerHeight/2,o=this._map.unproject([0,m]),d=this._map.unproject([100,m]),_=o.distanceTo(d)/100,b=Math.ceil(2*this._accuracy/_);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&Vo)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=Bt("button","mapboxgl-ctrl-geolocate",this._container),Bt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===m){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Bt("div","mapboxgl-user-location"),this._dotElement.appendChild(Bt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Bt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ru({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Bt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ru({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Xl--,Vo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Xl++,Xl>1?(m={maximumAge:6e5,timeout:0},Vo=!0):(m=this.options.positionOptions,Vo=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(o=>{"granted"===o&&m()}).catch(console.error):m()}_clearWatch(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:dd,ScaleControl:class{constructor(m){this.options=p.extend({},wh,m),p.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){su(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=Bt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,su(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof p.window.HTMLElement?this._container=m.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Bt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=Bt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Bt("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(m){super(),this.options=p.extend(Object.create(ss),m),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=p.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(p.window.document.createTextNode(m))}setHTML(m){const o=p.window.document.createDocumentFragment(),d=p.window.document.createElement("body");let _;for(d.innerHTML=m;_=d.firstChild,_;)o.appendChild(_);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=Bt("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(m),this.options.closeButton){const d=this._closeButton=Bt("button","mapboxgl-popup-close-button",o);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let o;return this._classList.delete(m)?o=!1:(this._classList.add(m),o=!0),this._updateClassList(),o}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const o=this._map,d=this._container,_=this._pos;if(!o||!d||!_)return"bottom";const b=d.offsetWidth,w=d.offsetHeight,D=_.x<b/2,A=_.x>o.transform.width-b/2;if(_.y+m<w)return D?"top-left":A?"top-right":"top";if(_.y>o.transform.height-w){if(D)return"bottom-left";if(A)return"bottom-right"}return D?"left":A?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),m.className=o.join(" ")}_update(m){const o=this._map,d=this._content;if(!o||!this._lngLat&&!this._trackPointer||!d)return;let _=this._container;if(_||(_=this._container=Bt("div","mapboxgl-popup",o.getContainer()),this._tip=Bt("div","mapboxgl-popup-tip",_),_.appendChild(d)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Hi(this._lngLat,this._pos,o.transform)),!this._trackPointer||m){const b=this._pos=this._trackPointer&&m?m:o.project(this._lngLat),w=Kl(this.options.offset),D=this._anchor=this._getAnchor(w.y),A=Kl(this.options.offset,D),F=b.add(A).round();o._requestDomTask(()=>{this._container&&D&&(this._container.style.transform=`${Es[D]} translate(${F.x}px,${F.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector($n);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._content&&(this._content.style.opacity=m),this._tip&&(this._tip.style.opacity=m)}},Marker:ru,Style:Lr,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.pointGeometry,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:ed,Evented:p.Evented,config:p.config,prewarm:function(){Et().acquire(xt)},clearPrewarmedResources:function(){const m=_t;m&&(m.isPreloaded()&&1===m.numActive()?(m.release(xt),_t=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(m){p.config.ACCESS_TOKEN=m},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(m){p.config.API_URL=m},get workerCount(){return pt.workerCount},set workerCount(m){pt.workerCount=m},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){p.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){p.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return cl}),wn}()}},Cm=>{Cm(Cm.s=888)}]);